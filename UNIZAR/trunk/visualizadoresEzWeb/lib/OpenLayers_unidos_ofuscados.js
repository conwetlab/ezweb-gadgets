/*
Aviso de licencia
-----------------
El código fuente contenido en este fichero es propiedad
intelectual del Grupo de Sistemas de Información Avanzados
(IAAA), del Dpto. de Informática e Ingeniería de Sistemas
de la Universidad de Zaragoza (http://iaaa.cps.unizar.es)


Este código fuente se proporciona únicamente como
mecanismo para posibilitar la ejecución de la aplicación
que lo contiene, por razones técnicas, y se licencia
para ese uso exclusivamente. El hecho de estar leyendo
este aviso de licencia ya implica, por tanto, un acceso no
autorizado a este código.


Los dueños de la propiedad intelectual de este código
fuente prohiben expresamente cualquier uso del
mismo distinto al enunciado en el párrafo anterior,
incluyendo su lectura, análisis, copia a cualquier formato,
incluyendo papel, transmisión por cualquier medio, modificación
y su utilización (tal cual o tras modificarlo) en aplicaciones
distintas a aquella para la que el código ha sido licenciado.
*/
(function(){var a=(typeof OpenLayers=="object"&&OpenLayers.singleFile);window.OpenLayers={_scriptName:(!a)?"lib/OpenLayers.js":"OpenLayers.js",_getScriptLocation:function(){var k="";var l=OpenLayers._scriptName;var b=document.getElementsByTagName("script");for(var f=0;f<b.length;f++){var m=b[f].getAttribute("src");if(m){var c=m.lastIndexOf(l);var g=m.lastIndexOf("?");if(g<0){g=m.length}if((c>-1)&&(c+l.length==g)){k=m.slice(0,g-l.length);break}}}return k}}})();OpenLayers.VERSION_NUMBER="$Revision: 1.1 $";OpenLayers.Util={};OpenLayers.Util.getElement=function(){var f=[];for(var c=0,a=arguments.length;c<a;c++){var b=arguments[c];if(typeof b=="string"){b=document.getElementById(b)}if(arguments.length==1){return b}f.push(b)}return f};if(typeof window.$==="undefined"){window.$=OpenLayers.Util.getElement}OpenLayers.Util.extend=function(a,g){a=a||{};if(g){for(var f in g){var c=g[f];if(c!==undefined){a[f]=c}}var b=typeof window.Event=="function"&&g instanceof window.Event;if(!b&&g.hasOwnProperty&&g.hasOwnProperty("toString")){a.toString=g.toString}}return a};OpenLayers.Util.removeItem=function(c,b){for(var a=c.length-1;a>=0;a--){if(c[a]==b){c.splice(a,1)}}return c};OpenLayers.Util.clearArray=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"array = []"}));a.length=0};OpenLayers.Util.indexOf=function(f,c){for(var b=0,a=f.length;b<a;b++){if(f[b]==c){return b}}return -1};OpenLayers.Util.modifyDOMElement=function(g,m,f,k,a,c,l,b){if(m){g.id=m}if(f){g.style.left=f.x+"px";g.style.top=f.y+"px"}if(k){g.style.width=k.w+"px";g.style.height=k.h+"px"}if(a){g.style.position=a}if(c){g.style.border=c}if(l){g.style.overflow=l}if(parseFloat(b)>=0&&parseFloat(b)<1){g.style.filter="alpha(opacity="+(b*100)+")";g.style.opacity=b}else{if(parseFloat(b)==1){g.style.filter="";g.style.opacity=""}}};OpenLayers.Util.createDiv=function(a,o,m,k,g,c,b,l){var f=document.createElement("div");if(k){f.style.backgroundImage="url("+k+")"}if(!a){a=OpenLayers.Util.createUniqueID("OpenLayersDiv")}if(!g){g="absolute"}OpenLayers.Util.modifyDOMElement(f,a,o,m,g,c,b,l);return f};OpenLayers.Util.createImage=function(a,m,l,g,f,c,k,o){var b=document.createElement("img");if(!a){a=OpenLayers.Util.createUniqueID("OpenLayersDiv")}if(!f){f="relative"}OpenLayers.Util.modifyDOMElement(b,a,m,l,f,c,null,k);if(o){b.style.display="none";OpenLayers.Event.observe(b,"load",OpenLayers.Function.bind(OpenLayers.Util.onImageLoad,b));OpenLayers.Event.observe(b,"error",OpenLayers.Function.bind(OpenLayers.Util.onImageLoadError,b))}b.style.alt=a;b.galleryImg="no";if(g){b.src=g}return b};OpenLayers.Util.setOpacity=function(b,a){OpenLayers.Util.modifyDOMElement(b,null,null,null,null,null,null,a)};OpenLayers.Util.onImageLoad=function(){if(!this.viewRequestID||(this.map&&this.viewRequestID==this.map.viewRequestID)){this.style.backgroundColor="transparent";this.style.display=""}};OpenLayers.Util.onImageLoadErrorColor="pink";OpenLayers.IMAGE_RELOAD_ATTEMPTS=0;OpenLayers.Util.onImageLoadError=function(){this._attempts=(this._attempts)?(this._attempts+1):1;if(this._attempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS){var f=this.urls;if(f&&f instanceof Array&&f.length>1){var g=this.src.toString();var c,a;for(a=0;c=f[a];a++){if(g.indexOf(c)!=-1){break}}var l=Math.floor(f.length*Math.random());var b=f[l];a=0;while(b==c&&a++<4){l=Math.floor(f.length*Math.random());b=f[l]}this.src=g.replace(c,b)}else{this.src=this.src}}else{this.style.backgroundColor=OpenLayers.Util.onImageLoadErrorColor}this.style.display=""};OpenLayers.Util.alphaHackNeeded=null;OpenLayers.Util.alphaHack=function(){if(OpenLayers.Util.alphaHackNeeded==null){var f=navigator.appVersion.split("MSIE");var a=parseFloat(f[1]);var b=false;try{b=!!(document.body.filters)}catch(c){}OpenLayers.Util.alphaHackNeeded=(b&&(a>=5.5)&&(a<7))}return OpenLayers.Util.alphaHackNeeded};OpenLayers.Util.modifyAlphaImageDiv=function(a,b,p,o,l,k,c,f,m){OpenLayers.Util.modifyDOMElement(a,b,p,o,k,null,null,m);var g=a.childNodes[0];if(l){g.src=l}OpenLayers.Util.modifyDOMElement(g,a.id+"_innerImage",null,o,"relative",c);if(OpenLayers.Util.alphaHack()){if(a.style.display!="none"){a.style.display="inline-block"}if(f==null){f="scale"}a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+g.src+"', sizingMethod='"+f+"')";if(parseFloat(a.style.opacity)>=0&&parseFloat(a.style.opacity)<1){a.style.filter+=" alpha(opacity="+a.style.opacity*100+")"}g.style.filter="alpha(opacity=0)"}};OpenLayers.Util.createAlphaImageDiv=function(b,p,o,l,k,c,f,m,q){var a=OpenLayers.Util.createDiv();var g=OpenLayers.Util.createImage(null,null,null,null,null,null,null,false);a.appendChild(g);if(q){g.style.display="none";OpenLayers.Event.observe(g,"load",OpenLayers.Function.bind(OpenLayers.Util.onImageLoad,a));OpenLayers.Event.observe(g,"error",OpenLayers.Function.bind(OpenLayers.Util.onImageLoadError,a))}OpenLayers.Util.modifyAlphaImageDiv(a,b,p,o,l,k,c,f,m);return a};OpenLayers.Util.upperCaseObject=function(b){var a={};for(var c in b){a[c.toUpperCase()]=b[c]}return a};OpenLayers.Util.applyDefaults=function(f,c){f=f||{};var b=typeof window.Event=="function"&&c instanceof window.Event;for(var a in c){if(f[a]===undefined||(!b&&c.hasOwnProperty&&c.hasOwnProperty(a)&&!f.hasOwnProperty(a))){f[a]=c[a]}}if(!b&&c&&c.hasOwnProperty&&c.hasOwnProperty("toString")&&!f.hasOwnProperty("toString")){f.toString=c.toString}return f};OpenLayers.Util.getParameterString=function(m){var l=[];for(var c in m){var g=m[c];if((g!=null)&&(typeof g!="function")){var b;if(typeof g=="object"&&g.constructor==Array){var k=[];for(var f=0,a=g.length;f<a;f++){k.push(encodeURIComponent(g[f]))}b=k.join(",")}else{b=encodeURIComponent(g)}l.push(encodeURIComponent(c)+"="+b)}}return l.join("&")};OpenLayers.ImgPath="";OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||(OpenLayers._getScriptLocation()+"img/")};OpenLayers.Util.Try=function(){var f=null;for(var c=0,a=arguments.length;c<a;c++){var b=arguments[c];try{f=b();break}catch(g){}}return f};OpenLayers.Util.getNodes=function(c,b){var a=OpenLayers.Util.Try(function(){return OpenLayers.Util._getNodes(c.documentElement.childNodes,b)},function(){return OpenLayers.Util._getNodes(c.childNodes,b)});return a};OpenLayers.Util._getNodes=function(c,g){var b=[];for(var f=0,a=c.length;f<a;f++){if(c[f].nodeName==g){b.push(c[f])}}return b};OpenLayers.Util.getTagText=function(c,f,b){var a=OpenLayers.Util.getNodes(c,f);if(a&&(a.length>0)){if(!b){b=0}if(a[b].childNodes.length>1){return a.childNodes[1].nodeValue}else{if(a[b].childNodes.length==1){return a[b].firstChild.nodeValue}}}else{return""}};OpenLayers.Util.getXmlNodeValue=function(a){var b=null;OpenLayers.Util.Try(function(){b=a.text;if(!b){b=a.textContent}if(!b){b=a.firstChild.nodeValue}},function(){b=a.textContent});return b};OpenLayers.Util.mouseLeft=function(a,c){var b=(a.relatedTarget)?a.relatedTarget:a.toElement;while(b!=c&&b!=null){b=b.parentNode}return(b!=c)};OpenLayers.Util.DEFAULT_PRECISION=14;OpenLayers.Util.toFloat=function(b,a){if(a==null){a=OpenLayers.Util.DEFAULT_PRECISION}var b;if(a==0){b=parseFloat(b)}else{b=parseFloat(parseFloat(b).toPrecision(a))}return b};OpenLayers.Util.rad=function(a){return a*Math.PI/180};OpenLayers.Util.distVincenty=function(k,c){var Y=6378137,X=6356752.3142,S=1/298.257223563;var r=OpenLayers.Util.rad(c.lon-k.lon);var V=Math.atan((1-S)*Math.tan(OpenLayers.Util.rad(k.lat)));var U=Math.atan((1-S)*Math.tan(OpenLayers.Util.rad(c.lat)));var q=Math.sin(V),m=Math.cos(V);var p=Math.sin(U),l=Math.cos(U);var E=r,u=2*Math.PI;var D=20;while(Math.abs(E-u)>1e-12&&--D>0){var M=Math.sin(E),g=Math.cos(E);var Z=Math.sqrt((l*M)*(l*M)+(m*p-q*l*g)*(m*p-q*l*g));if(Z==0){return 0}var Q=q*p+m*l*g;var K=Math.atan2(Z,Q);var o=Math.asin(m*l*M/Z);var R=Math.cos(o)*Math.cos(o);var v=Q-2*q*p/R;var H=S/16*R*(4+S*(4-3*R));u=E;E=r+(1-H)*S*Math.sin(o)*(K+H*Z*(v+H*Q*(-1+2*v*v)))}if(D==0){return NaN}var G=R*(Y*Y-X*X)/(X*X);var J=1+G/16384*(4096+G*(-768+G*(320-175*G)));var I=G/1024*(256+G*(-128+G*(74-47*G)));var O=I*Z*(v+I/4*(Q*(-1+2*v*v)-I/6*v*(-3+4*Z*Z)*(-3+4*v*v)));var F=X*J*(K-O);var T=F.toFixed(3)/1000;return T};OpenLayers.Util.getParameters=function(b){b=b||window.location.href;var a="";if(OpenLayers.String.contains(b,"?")){var c=b.indexOf("?")+1;var g=OpenLayers.String.contains(b,"#")?b.indexOf("#"):b.length;a=b.substring(c,g)}var u={};var f=a.split(/[&;]/);for(var m=0,o=f.length;m<o;++m){var l=f[m].split("=");if(l[0]){var q=decodeURIComponent(l[0]);var p=l[1]||"";p=p.split(",");for(var k=0,r=p.length;k<r;k++){p[k]=decodeURIComponent(p[k])}if(p.length==1){p=p[0]}u[q]=p}}return u};OpenLayers.Util.getArgs=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Util.getParameters"}));return OpenLayers.Util.getParameters(a)};OpenLayers.Util.lastSeqID=0;OpenLayers.Util.createUniqueID=function(a){if(a==null){a="id_"}OpenLayers.Util.lastSeqID+=1;return a+OpenLayers.Util.lastSeqID};OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.3701,km:39370.1,dd:4374754,yd:36};OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches;OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd;OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m;OpenLayers.METERS_PER_INCH=0.0254000508001016;OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:0.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:0.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:0.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:0.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:0.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:0.0254/OpenLayers.METERS_PER_INCH,MicroInch:0.0000254/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:0.01/OpenLayers.METERS_PER_INCH,Kilometer:1000/OpenLayers.METERS_PER_INCH,Yard:0.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:0.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:0.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:0.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:0.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:0.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:0.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:0.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:0.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:0.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:0.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:0.1/OpenLayers.METERS_PER_INCH,Millimeter:0.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:0.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:0.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:0.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:0.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:0.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:0.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:0.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:0.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":50000/OpenLayers.METERS_PER_INCH,"150kilometers":150000/OpenLayers.METERS_PER_INCH});OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1000,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:OpenLayers.INCHES_PER_UNIT.Meter*100,km:OpenLayers.INCHES_PER_UNIT.Meter*1000,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH});OpenLayers.DOTS_PER_INCH=72;OpenLayers.Util.normalizeScale=function(b){var a=(b>1)?(1/b):b;return a};OpenLayers.Util.getResolutionFromScale=function(f,a){if(a==null){a="degrees"}var c=OpenLayers.Util.normalizeScale(f);var b=1/(c*OpenLayers.INCHES_PER_UNIT[a]*OpenLayers.DOTS_PER_INCH);return b};OpenLayers.Util.getScaleFromResolution=function(b,a){if(a==null){a="degrees"}var c=b*OpenLayers.INCHES_PER_UNIT[a]*OpenLayers.DOTS_PER_INCH;return c};OpenLayers.Util.safeStopPropagation=function(a){OpenLayers.Event.stop(a,true)};OpenLayers.Util.pagePosition=function(g){var a=0,f=0;var b=g;var k=g;while(b){if(b==document.body){if(OpenLayers.Element.getStyle(k,"position")=="absolute"){break}}a+=b.offsetTop||0;f+=b.offsetLeft||0;k=b;try{b=b.offsetParent}catch(c){OpenLayers.Console.error(OpenLayers.i18n("pagePositionFailed",{elemId:b.id}));break}}b=g;while(b){a-=b.scrollTop||0;f-=b.scrollLeft||0;b=b.parentNode}return[f,a]};OpenLayers.Util.isEquivalentUrl=function(k,g,c){c=c||{};OpenLayers.Util.applyDefaults(c,{ignoreCase:true,ignorePort80:true,ignoreHash:true});var b=OpenLayers.Util.createUrlObject(k,c);var a=OpenLayers.Util.createUrlObject(g,c);for(var f in b){if(f!=="args"){if(b[f]!=a[f]){return false}}}for(var f in b.args){if(b.args[f]!=a.args[f]){return false}delete a.args[f]}for(var f in a.args){return false}return true};OpenLayers.Util.createUrlObject=function(c,q){q=q||{};if(!(/^\w+:\/\//).test(c)){var l=window.location;var g=l.port?":"+l.port:"";var m=l.protocol+"//"+l.host.split(":").shift()+g;if(c.indexOf("/")===0){c=m+c}else{var k=l.pathname.split("/");k.pop();c=m+k.join("/")+"/"+c}}if(q.ignoreCase){c=c.toLowerCase()}var o=document.createElement("a");o.href=c;var f={};f.host=o.host.split(":").shift();f.protocol=o.protocol;if(q.ignorePort80){f.port=(o.port=="80"||o.port=="0")?"":o.port}else{f.port=(o.port==""||o.port=="0")?"80":o.port}f.hash=(q.ignoreHash||o.hash==="#")?"":o.hash;var b=o.search;if(!b){var p=c.indexOf("?");b=(p!=-1)?c.substr(p):""}f.args=OpenLayers.Util.getParameters(b);f.pathname=(o.pathname.charAt(0)=="/")?o.pathname:"/"+o.pathname;return f};OpenLayers.Util.removeTail=function(b){var c=null;var a=b.indexOf("?");var f=b.indexOf("#");if(a==-1){c=(f!=-1)?b.substr(0,f):b}else{c=(f!=-1)?b.substr(0,Math.min(a,f)):b.substr(0,a)}return c};OpenLayers.Util.getBrowserName=function(){var b="";var a=navigator.userAgent.toLowerCase();if(a.indexOf("opera")!=-1){b="opera"}else{if(a.indexOf("msie")!=-1){b="msie"}else{if(a.indexOf("safari")!=-1){b="safari"}else{if(a.indexOf("mozilla")!=-1){if(a.indexOf("firefox")!=-1){b="firefox"}else{b="mozilla"}}}}}return b};OpenLayers.Util.getRenderedDimensions=function(b,u,v){var p,g;var a=document.createElement("div");a.style.visibility="hidden";var r=(v&&v.containerElement)?v.containerElement:document.body;if(u){if(u.w){p=u.w;a.style.width=p+"px"}else{if(u.h){g=u.h;a.style.height=g+"px"}}}if(v&&v.displayClass){a.className=v.displayClass}var k=document.createElement("div");k.innerHTML=b;k.style.overflow="visible";if(k.childNodes){for(var f=0,c=k.childNodes.length;f<c;f++){if(!k.childNodes[f].style){continue}k.childNodes[f].style.overflow="visible"}}a.appendChild(k);r.appendChild(a);var q=false;var o=a.parentNode;while(o&&o.tagName.toLowerCase()!="body"){var m=OpenLayers.Element.getStyle(o,"position");if(m=="absolute"){q=true;break}else{if(m&&m!="static"){break}}o=o.parentNode}if(!q){a.style.position="absolute"}if(!p){p=parseInt(k.scrollWidth);a.style.width=p+"px"}if(!g){g=parseInt(k.scrollHeight)}a.removeChild(k);r.removeChild(a);return new OpenLayers.Size(p,g)};OpenLayers.Util.getScrollbarWidth=function(){var c=OpenLayers.Util._scrollbarWidth;if(c==null){var g=null;var f=null;var a=0;var b=0;g=document.createElement("div");g.style.position="absolute";g.style.top="-1000px";g.style.left="-1000px";g.style.width="100px";g.style.height="50px";g.style.overflow="hidden";f=document.createElement("div");f.style.width="100%";f.style.height="200px";g.appendChild(f);document.body.appendChild(g);a=f.offsetWidth;g.style.overflow="scroll";b=f.offsetWidth;document.body.removeChild(document.body.lastChild);OpenLayers.Util._scrollbarWidth=(a-b);c=OpenLayers.Util._scrollbarWidth}return c};OpenLayers.String={startsWith:function(b,a){return(b.indexOf(a)==0)},contains:function(b,a){return(b.indexOf(a)!=-1)},trim:function(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(k){var f=k.split("-");var b=f[0];for(var c=1,a=f.length;c<a;c++){var g=f[c];b+=g.charAt(0).toUpperCase()+g.substring(1)}return b},format:function(f,c,a){if(!c){c=window}var b=function(o,g){var m;var l=g.split(/\.+/);for(var k=0;k<l.length;k++){if(k==0){m=c}m=m[l[k]]}if(typeof m=="function"){m=a?m.apply(null,a):m()}if(typeof m=="undefined"){return"undefined"}else{return m}};return f.replace(OpenLayers.String.tokenRegEx,b)},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(a){return OpenLayers.String.numberRegEx.test(a)},numericIf:function(a){return OpenLayers.String.isNumeric(a)?parseFloat(a):a}};if(!String.prototype.startsWith){String.prototype.startsWith=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.startsWith"}));return OpenLayers.String.startsWith(this,a)}}if(!String.prototype.contains){String.prototype.contains=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.contains"}));return OpenLayers.String.contains(this,a)}}if(!String.prototype.trim){String.prototype.trim=function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.trim"}));return OpenLayers.String.trim(this)}}if(!String.prototype.camelize){String.prototype.camelize=function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.camelize"}));return OpenLayers.String.camelize(this)}}OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(a,c){var b=0;if(c>0){b=parseFloat(a.toPrecision(c))}return b},format:function(c,a,l,o){a=(typeof a!="undefined")?a:0;l=(typeof l!="undefined")?l:OpenLayers.Number.thousandsSeparator;o=(typeof o!="undefined")?o:OpenLayers.Number.decimalSeparator;if(a!=null){c=parseFloat(c.toFixed(a))}var b=c.toString().split(".");if(b.length==1&&a==null){a=0}var f=b[0];if(l){var g=/(-?[0-9]+)([0-9]{3})/;while(g.test(f)){f=f.replace(g,"$1"+l+"$2")}}var k;if(a==0){k=f}else{var m=b.length>1?b[1]:"0";if(a!=null){m=m+new Array(a-m.length+1).join("0")}k=f+o+m}return k}};if(!Number.prototype.limitSigDigs){Number.prototype.limitSigDigs=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Number.limitSigDigs"}));return OpenLayers.Number.limitSigDigs(this,a)}}OpenLayers.Function={bind:function(c,b){var a=Array.prototype.slice.apply(arguments,[2]);return function(){var f=a.concat(Array.prototype.slice.apply(arguments,[0]));return c.apply(b,f)}},bindAsEventListener:function(b,a){return function(c){return b.call(a,c||window.event)}}};if(!Function.prototype.bind){Function.prototype.bind=function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Function.bind"}));Array.prototype.unshift.apply(arguments,[this]);return OpenLayers.Function.bind.apply(null,arguments)}}if(!Function.prototype.bindAsEventListener){Function.prototype.bindAsEventListener=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Function.bindAsEventListener"}));return OpenLayers.Function.bindAsEventListener(this,a)}}OpenLayers.Array={filter:function(l,k,b){var f=[];if(Array.prototype.filter){f=l.filter(k,b)}else{var a=l.length;if(typeof k!="function"){throw new TypeError()}for(var c=0;c<a;c++){if(c in l){var g=l[c];if(k.call(b,g,c,l)){f.push(g)}}}}return f}};OpenLayers.Class=function(){var f=function(){if(arguments&&arguments[0]!=OpenLayers.Class.isPrototype){this.initialize.apply(this,arguments)}};var c={};var k,b;for(var g=0,a=arguments.length;g<a;++g){if(typeof arguments[g]=="function"){if(g==0&&a>1){b=arguments[g].prototype.initialize;arguments[g].prototype.initialize=function(){};c=new arguments[g];if(b===undefined){delete arguments[g].prototype.initialize}else{arguments[g].prototype.initialize=b}}k=arguments[g].prototype}else{k=arguments[g]}OpenLayers.Util.extend(c,k)}f.prototype=c;return f};OpenLayers.Class.isPrototype=function(){};OpenLayers.Class.create=function(){return function(){if(arguments&&arguments[0]!=OpenLayers.Class.isPrototype){this.initialize.apply(this,arguments)}}};OpenLayers.Class.inherit=function(){var f=arguments[0];var g=new f(OpenLayers.Class.isPrototype);for(var c=1,a=arguments.length;c<a;c++){if(typeof arguments[c]=="function"){var b=arguments[c];arguments[c]=new b(OpenLayers.Class.isPrototype)}OpenLayers.Util.extend(g,arguments[c])}return g};OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(f,a,b,c){if(f!=null){this.left=OpenLayers.Util.toFloat(f)}if(a!=null){this.bottom=OpenLayers.Util.toFloat(a)}if(b!=null){this.right=OpenLayers.Util.toFloat(b)}if(c!=null){this.top=OpenLayers.Util.toFloat(c)}},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(b){var a=false;if(b!=null){a=((this.left==b.left)&&(this.right==b.right)&&(this.top==b.top)&&(this.bottom==b.bottom))}return a},toString:function(){return("left-bottom=("+this.left+","+this.bottom+") right-top=("+this.right+","+this.top+")")},toArray:function(){return[this.left,this.bottom,this.right,this.top]},toBBOX:function(a){if(a==null){a=6}var b=Math.pow(10,a);var c=Math.round(this.left*b)/b+","+Math.round(this.bottom*b)/b+","+Math.round(this.right*b)/b+","+Math.round(this.top*b)/b;return c},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return(this.right-this.left)},getHeight:function(){return(this.top-this.bottom)},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){if(!this.centerLonLat){this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2)}return this.centerLonLat},scale:function(k,m){if(m==null){m=this.getCenterLonLat()}var a=[];var g,f;if(m.CLASS_NAME=="OpenLayers.LonLat"){g=m.lon;f=m.lat}else{g=m.x;f=m.y}var c=(this.left-g)*k+g;var b=(this.bottom-f)*k+f;var o=(this.right-g)*k+g;var l=(this.top-f)*k+f;return new OpenLayers.Bounds(c,b,o,l)},add:function(a,c){if((a==null)||(c==null)){var b=OpenLayers.i18n("boundsAddError");OpenLayers.Console.error(b);return null}return new OpenLayers.Bounds(this.left+a,this.bottom+c,this.right+a,this.top+c)},extend:function(a){var b=null;if(a){switch(a.CLASS_NAME){case"OpenLayers.LonLat":b=new OpenLayers.Bounds(a.lon,a.lat,a.lon,a.lat);break;case"OpenLayers.Geometry.Point":b=new OpenLayers.Bounds(a.x,a.y,a.x,a.y);break;case"OpenLayers.Bounds":b=a;break}if(b){this.centerLonLat=null;if((this.left==null)||(b.left<this.left)){this.left=b.left}if((this.bottom==null)||(b.bottom<this.bottom)){this.bottom=b.bottom}if((this.right==null)||(b.right>this.right)){this.right=b.right}if((this.top==null)||(b.top>this.top)){this.top=b.top}}}},containsLonLat:function(b,a){return this.contains(b.lon,b.lat,a)},containsPixel:function(b,a){return this.contains(b.x,b.y,a)},contains:function(b,f,a){if(a==null){a=true}if(b==null||f==null){return false}b=OpenLayers.Util.toFloat(b);f=OpenLayers.Util.toFloat(f);var c=false;if(a){c=((b>=this.left)&&(b<=this.right)&&(f>=this.bottom)&&(f<=this.top))}else{c=((b>this.left)&&(b<this.right)&&(f>this.bottom)&&(f<this.top))}return c},intersectsBounds:function(g,b){if(b==null){b=true}var f=false;var m=(this.left==g.right||this.right==g.left||this.top==g.bottom||this.bottom==g.top);if(b||!m){var l=(((g.bottom>=this.bottom)&&(g.bottom<=this.top))||((this.bottom>=g.bottom)&&(this.bottom<=g.top)));var k=(((g.top>=this.bottom)&&(g.top<=this.top))||((this.top>g.bottom)&&(this.top<g.top)));var c=(((g.left>=this.left)&&(g.left<=this.right))||((this.left>=g.left)&&(this.left<=g.right)));var a=(((g.right>=this.left)&&(g.right<=this.right))||((this.right>=g.left)&&(this.right<=g.right)));f=((l||k)&&(c||a))}return f},containsBounds:function(l,b,a){if(b==null){b=false}if(a==null){a=true}var c=this.contains(l.left,l.bottom,a);var f=this.contains(l.right,l.bottom,a);var k=this.contains(l.left,l.top,a);var g=this.contains(l.right,l.top,a);return(b)?(c||f||k||g):(c&&f&&k&&g)},determineQuadrant:function(c){var b="";var a=this.getCenterLonLat();b+=(c.lat<a.lat)?"b":"t";b+=(c.lon<a.lon)?"l":"r";return b},transform:function(f,b){this.centerLonLat=null;var g=OpenLayers.Projection.transform({x:this.left,y:this.bottom},f,b);var a=OpenLayers.Projection.transform({x:this.right,y:this.bottom},f,b);var c=OpenLayers.Projection.transform({x:this.left,y:this.top},f,b);var k=OpenLayers.Projection.transform({x:this.right,y:this.top},f,b);this.left=Math.min(g.x,c.x);this.bottom=Math.min(g.y,a.y);this.right=Math.max(a.x,k.x);this.top=Math.max(c.y,k.y);return this},wrapDateLine:function(a,c){c=c||{};var f=c.leftTolerance||0;var b=c.rightTolerance||0;var g=this.clone();if(a){while(g.left<a.left&&(g.right-b)<=a.left){g=g.add(a.getWidth(),0)}while((g.left+f)>=a.right&&g.right>a.right){g=g.add(-a.getWidth(),0)}}return g},CLASS_NAME:"OpenLayers.Bounds"});OpenLayers.Bounds.fromString=function(b){var a=b.split(",");return OpenLayers.Bounds.fromArray(a)};OpenLayers.Bounds.fromArray=function(a){return new OpenLayers.Bounds(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]))};OpenLayers.Bounds.fromSize=function(a){return new OpenLayers.Bounds(0,a.h,a.w,0)};OpenLayers.Bounds.oppositeQuadrant=function(a){var b="";b+=(a.charAt(0)=="t")?"b":"t";b+=(a.charAt(1)=="l")?"r":"l";return b};OpenLayers.Element={visible:function(a){return OpenLayers.Util.getElement(a).style.display!="none"},toggle:function(){for(var c=0,a=arguments.length;c<a;c++){var b=OpenLayers.Util.getElement(arguments[c]);var f=OpenLayers.Element.visible(b)?"hide":"show";OpenLayers.Element[f](b)}},hide:function(){for(var c=0,a=arguments.length;c<a;c++){var b=OpenLayers.Util.getElement(arguments[c]);b.style.display="none"}},show:function(){for(var c=0,a=arguments.length;c<a;c++){var b=OpenLayers.Util.getElement(arguments[c]);b.style.display=""}},remove:function(a){a=OpenLayers.Util.getElement(a);a.parentNode.removeChild(a)},getHeight:function(a){a=OpenLayers.Util.getElement(a);return a.offsetHeight},getDimensions:function(b){b=OpenLayers.Util.getElement(b);if(OpenLayers.Element.getStyle(b,"display")!="none"){return{width:b.offsetWidth,height:b.offsetHeight}}var a=b.style;var g=a.visibility;var c=a.position;a.visibility="hidden";a.position="absolute";a.display="";var k=b.clientWidth;var f=b.clientHeight;a.display="none";a.position=c;a.visibility=g;return{width:k,height:f}},hasClass:function(b,a){var c=b.className;return(!!c&&new RegExp("(^|\\s)"+a+"(\\s|$)").test(c))},addClass:function(b,a){if(!OpenLayers.Element.hasClass(b,a)){b.className+=(b.className?" ":"")+a}return b},removeClass:function(b,a){var c=b.className;if(c){b.className=OpenLayers.String.trim(c.replace(new RegExp("(^|\\s+)"+a+"(\\s+|$)")," "))}return b},toggleClass:function(b,a){if(OpenLayers.Element.hasClass(b,a)){OpenLayers.Element.removeClass(b,a)}else{OpenLayers.Element.addClass(b,a)}return b},getStyle:function(c,f){c=OpenLayers.Util.getElement(c);var g=null;if(c&&c.style){g=c.style[OpenLayers.String.camelize(f)];if(!g){if(document.defaultView&&document.defaultView.getComputedStyle){var b=document.defaultView.getComputedStyle(c,null);g=b?b.getPropertyValue(f):null}else{if(c.currentStyle){g=c.currentStyle[OpenLayers.String.camelize(f)]}}}var a=["left","top","right","bottom"];if(window.opera&&(OpenLayers.Util.indexOf(a,f)!=-1)&&(OpenLayers.Element.getStyle(c,"position")=="static")){g="auto"}}return g=="auto"?null:g}};OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(b,a){this.lon=OpenLayers.Util.toFloat(b);this.lat=OpenLayers.Util.toFloat(a)},toString:function(){return("lon="+this.lon+",lat="+this.lat)},toShortString:function(){return(this.lon+", "+this.lat)},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(c,a){if((c==null)||(a==null)){var b=OpenLayers.i18n("lonlatAddError");OpenLayers.Console.error(b);return null}return new OpenLayers.LonLat(this.lon+c,this.lat+a)},equals:function(b){var a=false;if(b!=null){a=((this.lon==b.lon&&this.lat==b.lat)||(isNaN(this.lon)&&isNaN(this.lat)&&isNaN(b.lon)&&isNaN(b.lat)))}return a},transform:function(c,b){var a=OpenLayers.Projection.transform({x:this.lon,y:this.lat},c,b);this.lon=a.x;this.lat=a.y;return this},wrapDateLine:function(a){var b=this.clone();if(a){while(b.lon<a.left){b.lon+=a.getWidth()}while(b.lon>a.right){b.lon-=a.getWidth()}}return b},CLASS_NAME:"OpenLayers.LonLat"});OpenLayers.LonLat.fromString=function(b){var a=b.split(",");return new OpenLayers.LonLat(parseFloat(a[0]),parseFloat(a[1]))};OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(a,b){this.x=parseFloat(a);this.y=parseFloat(b)},toString:function(){return("x="+this.x+",y="+this.y)},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(a){var b=false;if(a!=null){b=((this.x==a.x&&this.y==a.y)||(isNaN(this.x)&&isNaN(this.y)&&isNaN(a.x)&&isNaN(a.y)))}return b},add:function(a,c){if((a==null)||(c==null)){var b=OpenLayers.i18n("pixelAddError");OpenLayers.Console.error(b);return null}return new OpenLayers.Pixel(this.x+a,this.y+c)},offset:function(a){var b=this.clone();if(a){b=this.add(a.x,a.y)}return b},CLASS_NAME:"OpenLayers.Pixel"});OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(a,b){this.w=parseFloat(a);this.h=parseFloat(b)},toString:function(){return("w="+this.w+",h="+this.h)},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(b){var a=false;if(b!=null){a=((this.w==b.w&&this.h==b.h)||(isNaN(this.w)&&isNaN(this.h)&&isNaN(b.w)&&isNaN(b.h)))}return a},CLASS_NAME:"OpenLayers.Size"});OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(a){alert(a)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"};(function(){var b=document.getElementsByTagName("script");for(var c=0,a=b.length;c<a;++c){if(b[c].src.indexOf("firebug.js")!=-1){if(console){OpenLayers.Util.extend(OpenLayers.Console,console);break}}}})();OpenLayers.Tween=OpenLayers.Class({INTERVAL:10,easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,interval:null,playing:false,initialize:function(a){this.easing=(a)?a:OpenLayers.Easing.Expo.easeOut},start:function(c,b,f,a){this.playing=true;this.begin=c;this.finish=b;this.duration=f;this.callbacks=a.callbacks;this.time=0;if(this.interval){window.clearInterval(this.interval);this.interval=null}if(this.callbacks&&this.callbacks.start){this.callbacks.start.call(this,this.begin)}this.interval=window.setInterval(OpenLayers.Function.bind(this.play,this),this.INTERVAL)},stop:function(){if(!this.playing){return}if(this.callbacks&&this.callbacks.done){this.callbacks.done.call(this,this.finish)}window.clearInterval(this.interval);this.interval=null;this.playing=false},play:function(){var l={};for(var g in this.begin){var a=this.begin[g];var k=this.finish[g];if(a==null||k==null||isNaN(a)||isNaN(k)){OpenLayers.Console.error("invalid value for Tween")}var m=k-a;l[g]=this.easing.apply(this,[this.time,a,m,this.duration])}this.time++;if(this.callbacks&&this.callbacks.eachStep){this.callbacks.eachStep.call(this,l)}if(this.time>this.duration){if(this.callbacks&&this.callbacks.done){this.callbacks.done.call(this,this.finish);this.playing=false}window.clearInterval(this.interval);this.interval=null}},CLASS_NAME:"OpenLayers.Tween"});OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"};OpenLayers.Easing.Linear={easeIn:function(f,a,k,g){return k*f/g+a},easeOut:function(f,a,k,g){return k*f/g+a},easeInOut:function(f,a,k,g){return k*f/g+a},CLASS_NAME:"OpenLayers.Easing.Linear"};OpenLayers.Easing.Expo={easeIn:function(f,a,k,g){return(f==0)?a:k*Math.pow(2,10*(f/g-1))+a},easeOut:function(f,a,k,g){return(f==g)?a+k:k*(-Math.pow(2,-10*f/g)+1)+a},easeInOut:function(f,a,k,g){if(f==0){return a}if(f==g){return a+k}if((f/=g/2)<1){return k/2*Math.pow(2,10*(f-1))+a}return k/2*(-Math.pow(2,-10*--f)+2)+a},CLASS_NAME:"OpenLayers.Easing.Expo"};OpenLayers.Easing.Quad={easeIn:function(f,a,k,g){return k*(f/=g)*f+a},easeOut:function(f,a,k,g){return -k*(f/=g)*(f-2)+a},easeInOut:function(f,a,k,g){if((f/=g/2)<1){return k/2*f*f+a}return -k/2*((--f)*(f-2)-1)+a},CLASS_NAME:"OpenLayers.Easing.Quad"};OpenLayers.Rico=new Object();OpenLayers.Rico.Corner={round:function(f,b){f=OpenLayers.Util.getElement(f);this._setOptions(b);var a=this.options.color;if(this.options.color=="fromElement"){a=this._background(f)}var c=this.options.bgColor;if(this.options.bgColor=="fromParent"){c=this._background(f.offsetParent)}this._roundCornersImpl(f,a,c)},changeColor:function(c,b){c.style.backgroundColor=b;var a=c.parentNode.getElementsByTagName("span");for(var f=0;f<a.length;f++){a[f].style.backgroundColor=b}},changeOpacity:function(c,k){var f=k;var a="alpha(opacity="+k*100+")";c.style.opacity=f;c.style.filter=a;var b=c.parentNode.getElementsByTagName("span");for(var g=0;g<b.length;g++){b[g].style.opacity=f;b[g].style.filter=a}},reRound:function(f,c){var b=f.parentNode.childNodes[0];var a=f.parentNode.childNodes[2];f.parentNode.removeChild(b);f.parentNode.removeChild(a);this.round(f.parentNode,c)},_roundCornersImpl:function(c,a,b){if(this.options.border){this._renderBorder(c,b)}if(this._isTopRounded()){this._roundTopCorners(c,a,b)}if(this._isBottomRounded()){this._roundBottomCorners(c,a,b)}},_renderBorder:function(f,g){var b="1px solid "+this._borderColor(g);var a="border-left: "+b;var k="border-right: "+b;var c="style='"+a+";"+k+"'";f.innerHTML="<div "+c+">"+f.innerHTML+"</div>"},_roundTopCorners:function(c,a,g){var f=this._createCorner(g);for(var b=0;b<this.options.numSlices;b++){f.appendChild(this._createCornerSlice(a,g,b,"top"))}c.style.paddingTop=0;c.insertBefore(f,c.firstChild)},_roundBottomCorners:function(c,a,g){var f=this._createCorner(g);for(var b=(this.options.numSlices-1);b>=0;b--){f.appendChild(this._createCornerSlice(a,g,b,"bottom"))}c.style.paddingBottom=0;c.appendChild(f)},_createCorner:function(b){var a=document.createElement("div");a.style.backgroundColor=(this._isTransparent()?"transparent":b);return a},_createCornerSlice:function(c,f,l,a){var g=document.createElement("span");var b=g.style;b.backgroundColor=c;b.display="block";b.height="1px";b.overflow="hidden";b.fontSize="1px";var k=this._borderColor(c,f);if(this.options.border&&l==0){b.borderTopStyle="solid";b.borderTopWidth="1px";b.borderLeftWidth="0px";b.borderRightWidth="0px";b.borderBottomWidth="0px";b.height="0px";b.borderColor=k}else{if(k){b.borderColor=k;b.borderStyle="solid";b.borderWidth="0px 1px"}}if(!this.options.compact&&(l==(this.options.numSlices-1))){b.height="2px"}this._setMargin(g,l,a);this._setBorder(g,l,a);return g},_setOptions:function(a){this.options={corners:"all",color:"fromElement",bgColor:"fromParent",blend:true,border:false,compact:false};OpenLayers.Util.extend(this.options,a||{});this.options.numSlices=this.options.compact?2:4;if(this._isTransparent()){this.options.blend=false}},_whichSideTop:function(){if(this._hasString(this.options.corners,"all","top")){return""}if(this.options.corners.indexOf("tl")>=0&&this.options.corners.indexOf("tr")>=0){return""}if(this.options.corners.indexOf("tl")>=0){return"left"}else{if(this.options.corners.indexOf("tr")>=0){return"right"}}return""},_whichSideBottom:function(){if(this._hasString(this.options.corners,"all","bottom")){return""}if(this.options.corners.indexOf("bl")>=0&&this.options.corners.indexOf("br")>=0){return""}if(this.options.corners.indexOf("bl")>=0){return"left"}else{if(this.options.corners.indexOf("br")>=0){return"right"}}return""},_borderColor:function(a,b){if(a=="transparent"){return b}else{if(this.options.border){return this.options.border}else{if(this.options.blend){return this._blend(b,a)}else{return""}}}},_setMargin:function(f,g,b){var c=this._marginSize(g);var a=b=="top"?this._whichSideTop():this._whichSideBottom();if(a=="left"){f.style.marginLeft=c+"px";f.style.marginRight="0px"}else{if(a=="right"){f.style.marginRight=c+"px";f.style.marginLeft="0px"}else{f.style.marginLeft=c+"px";f.style.marginRight=c+"px"}}},_setBorder:function(f,g,b){var c=this._borderSize(g);var a=b=="top"?this._whichSideTop():this._whichSideBottom();if(a=="left"){f.style.borderLeftWidth=c+"px";f.style.borderRightWidth="0px"}else{if(a=="right"){f.style.borderRightWidth=c+"px";f.style.borderLeftWidth="0px"}else{f.style.borderLeftWidth=c+"px";f.style.borderRightWidth=c+"px"}}if(this.options.border!=false){f.style.borderLeftWidth=c+"px";f.style.borderRightWidth=c+"px"}},_marginSize:function(g){if(this._isTransparent()){return 0}var f=[5,3,2,1];var a=[3,2,1,0];var c=[2,1];var b=[1,0];if(this.options.compact&&this.options.blend){return b[g]}else{if(this.options.compact){return c[g]}else{if(this.options.blend){return a[g]}else{return f[g]}}}},_borderSize:function(g){var f=[5,3,2,1];var b=[2,1,1,1];var a=[1,0];var c=[0,2,0,0];if(this.options.compact&&(this.options.blend||this._isTransparent())){return 1}else{if(this.options.compact){return a[g]}else{if(this.options.blend){return b[g]}else{if(this.options.border){return c[g]}else{if(this._isTransparent()){return f[g]}}}}}return 0},_hasString:function(b){for(var a=1;a<arguments.length;a++){if(b.indexOf(arguments[a])>=0){return true}}return false},_blend:function(c,a){var b=OpenLayers.Rico.Color.createFromHex(c);b.blend(OpenLayers.Rico.Color.createFromHex(a));return b},_background:function(a){try{return OpenLayers.Rico.Color.createColorFromBackground(a).asHex()}catch(b){return"#ffffff"}},_isTransparent:function(){return this.options.color=="transparent"},_isTopRounded:function(){return this._hasString(this.options.corners,"all","top","tl","tr")},_isBottomRounded:function(){return this._hasString(this.options.corners,"all","bottom","bl","br")},_hasSingleTextChild:function(a){return a.childNodes.length==1&&a.childNodes[0].nodeType==3}};OpenLayers.Rico.Color=OpenLayers.Class({initialize:function(c,b,a){this.rgb={r:c,g:b,b:a}},setRed:function(a){this.rgb.r=a},setGreen:function(a){this.rgb.g=a},setBlue:function(a){this.rgb.b=a},setHue:function(b){var a=this.asHSB();a.h=b;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(a.h,a.s,a.b)},setSaturation:function(b){var a=this.asHSB();a.s=b;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(a.h,a.s,a.b)},setBrightness:function(a){var c=this.asHSB();c.b=a;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(c.h,c.s,c.b)},darken:function(b){var a=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(a.h,a.s,Math.max(a.b-b,0))},brighten:function(b){var a=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(a.h,a.s,Math.min(a.b+b,1))},blend:function(a){this.rgb.r=Math.floor((this.rgb.r+a.rgb.r)/2);this.rgb.g=Math.floor((this.rgb.g+a.rgb.g)/2);this.rgb.b=Math.floor((this.rgb.b+a.rgb.b)/2)},isBright:function(){var a=this.asHSB();return this.asHSB().b>0.5},isDark:function(){return !this.isBright()},asRGB:function(){return"rgb("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+")"},asHex:function(){return"#"+this.rgb.r.toColorPart()+this.rgb.g.toColorPart()+this.rgb.b.toColorPart()},asHSB:function(){return OpenLayers.Rico.Color.RGBtoHSB(this.rgb.r,this.rgb.g,this.rgb.b)},toString:function(){return this.asHex()}});OpenLayers.Rico.Color.createFromHex=function(f){if(f.length==4){var b=f;var f="#";for(var c=1;c<4;c++){f+=(b.charAt(c)+b.charAt(c))}}if(f.indexOf("#")==0){f=f.substring(1)}var k=f.substring(0,2);var g=f.substring(2,4);var a=f.substring(4,6);return new OpenLayers.Rico.Color(parseInt(k,16),parseInt(g,16),parseInt(a,16))};OpenLayers.Rico.Color.createColorFromBackground=function(f){var b=RicoUtil.getElementsComputedStyle(OpenLayers.Util.getElement(f),"backgroundColor","background-color");if(b=="transparent"&&f.parentNode){return OpenLayers.Rico.Color.createColorFromBackground(f.parentNode)}if(b==null){return new OpenLayers.Rico.Color(255,255,255)}if(b.indexOf("rgb(")==0){var a=b.substring(4,b.length-1);var c=a.split(",");return new OpenLayers.Rico.Color(parseInt(c[0]),parseInt(c[1]),parseInt(c[2]))}else{if(b.indexOf("#")==0){return OpenLayers.Rico.Color.createFromHex(b)}else{return new OpenLayers.Rico.Color(255,255,255)}}};OpenLayers.Rico.Color.HSBtoRGB=function(m,k,r){var c=0;var g=0;var u=0;if(k==0){c=parseInt(r*255+0.5);g=c;u=c}else{var l=(m-Math.floor(m))*6;var o=l-Math.floor(l);var b=r*(1-k);var a=r*(1-k*o);var v=r*(1-(k*(1-o)));switch(parseInt(l)){case 0:c=(r*255+0.5);g=(v*255+0.5);u=(b*255+0.5);break;case 1:c=(a*255+0.5);g=(r*255+0.5);u=(b*255+0.5);break;case 2:c=(b*255+0.5);g=(r*255+0.5);u=(v*255+0.5);break;case 3:c=(b*255+0.5);g=(a*255+0.5);u=(r*255+0.5);break;case 4:c=(v*255+0.5);g=(b*255+0.5);u=(r*255+0.5);break;case 5:c=(r*255+0.5);g=(b*255+0.5);u=(a*255+0.5);break}}return{r:parseInt(c),g:parseInt(g),b:parseInt(u)}};OpenLayers.Rico.Color.RGBtoHSB=function(a,l,u){var m;var k;var q;var v=(a>l)?a:l;if(u>v){v=u}var o=(a<l)?a:l;if(u<o){o=u}q=v/255;if(v!=0){k=(v-o)/v}else{k=0}if(k==0){m=0}else{var c=(v-a)/(v-o);var p=(v-l)/(v-o);var f=(v-u)/(v-o);if(a==v){m=f-p}else{if(l==v){m=2+c-f}else{m=4+p-c}}m=m/6;if(m<0){m=m+1}}return{h:m,s:k,b:q}};OpenLayers.ProxyHost="";OpenLayers.nullHandler=function(a){OpenLayers.Console.userError(OpenLayers.i18n("unhandledRequest",{statusText:a.statusText}))};OpenLayers.loadURL=function(f,l,b,g,c){if(typeof l=="string"){l=OpenLayers.Util.getParameters(l)}var k=(g)?g:OpenLayers.nullHandler;var a=(c)?c:OpenLayers.nullHandler;return OpenLayers.Request.GET({url:f,params:l,success:k,failure:a,scope:b})};OpenLayers.parseXMLString=function(c){var a=c.indexOf("<");if(a>0){c=c.substring(a)}var b=OpenLayers.Util.Try(function(){var f=new ActiveXObject("Microsoft.XMLDOM");f.loadXML(c);return f},function(){return new DOMParser().parseFromString(c,"text/xml")},function(){var f=new XMLHttpRequest();f.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(c),false);if(f.overrideMimeType){f.overrideMimeType("text/xml")}f.send(null);return f.responseXML});return b};OpenLayers.Ajax={emptyFunction:function(){},getTransport:function(){return OpenLayers.Util.Try(function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||false},activeRequestCount:0};OpenLayers.Ajax.Responders={responders:[],register:function(b){for(var a=0;a<this.responders.length;a++){if(b==this.responders[a]){return}}this.responders.push(b)},unregister:function(a){OpenLayers.Util.removeItem(this.reponders,a)},dispatch:function(k,c,g){var a;for(var b=0;b<this.responders.length;b++){a=this.responders[b];if(a[k]&&typeof a[k]=="function"){try{a[k].apply(a,[c,g])}catch(f){}}}}};OpenLayers.Ajax.Responders.register({onCreate:function(){OpenLayers.Ajax.activeRequestCount++},onComplete:function(){OpenLayers.Ajax.activeRequestCount--}});OpenLayers.Ajax.Base=OpenLayers.Class({initialize:function(a){this.options={method:"post",asynchronous:true,contentType:"application/xml",parameters:""};OpenLayers.Util.extend(this.options,a||{});this.options.method=this.options.method.toLowerCase();if(typeof this.options.parameters=="string"){this.options.parameters=OpenLayers.Util.getParameters(this.options.parameters)}}});OpenLayers.Ajax.Request=OpenLayers.Class(OpenLayers.Ajax.Base,{_complete:false,initialize:function(b,a){OpenLayers.Ajax.Base.prototype.initialize.apply(this,[a]);if(OpenLayers.ProxyHost&&OpenLayers.String.startsWith(b,"http")){b=OpenLayers.ProxyHost+encodeURIComponent(b)}this.transport=OpenLayers.Ajax.getTransport();this.request(b)},request:function(b){this.url=b;this.method=this.options.method;var f=OpenLayers.Util.extend({},this.options.parameters);if(this.method!="get"&&this.method!="post"){f._method=this.method;this.method="post"}this.parameters=f;if(f=OpenLayers.Util.getParameterString(f)){if(this.method=="get"){this.url+=((this.url.indexOf("?")>-1)?"&":"?")+f}else{if(/Konqueror|Safari|KHTML/.test(navigator.userAgent)){f+="&_="}}}try{var a=new OpenLayers.Ajax.Response(this);if(this.options.onCreate){this.options.onCreate(a)}OpenLayers.Ajax.Responders.dispatch("onCreate",this,a);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous){window.setTimeout(OpenLayers.Function.bind(this.respondToReadyState,this,1),10)}this.transport.onreadystatechange=OpenLayers.Function.bind(this.onStateChange,this);this.setRequestHeaders();this.body=this.method=="post"?(this.options.postBody||f):null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType){this.onStateChange()}}catch(c){this.dispatchException(c)}},onStateChange:function(){var a=this.transport.readyState;if(a>1&&!((a==4)&&this._complete)){this.respondToReadyState(this.transport.readyState)}},setRequestHeaders:function(){var g={"X-Requested-With":"XMLHttpRequest",Accept:"text/javascript, text/html, application/xml, text/xml, */*",OpenLayers:true};if(this.method=="post"){g["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:"");if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005){g.Connection="close"}}if(typeof this.options.requestHeaders=="object"){var c=this.options.requestHeaders;if(typeof c.push=="function"){for(var b=0,f=c.length;b<f;b+=2){g[c[b]]=c[b+1]}}else{for(var b in c){g[b]=c[b]}}}for(var a in g){this.transport.setRequestHeader(a,g[a])}},success:function(){var a=this.getStatus();return !a||(a>=200&&a<300)},getStatus:function(){try{return this.transport.status||0}catch(a){return 0}},respondToReadyState:function(a){var c=OpenLayers.Ajax.Request.Events[a];var b=new OpenLayers.Ajax.Response(this);if(c=="Complete"){try{this._complete=true;(this.options["on"+b.status]||this.options["on"+(this.success()?"Success":"Failure")]||OpenLayers.Ajax.emptyFunction)(b)}catch(f){this.dispatchException(f)}var g=b.getHeader("Content-type")}try{(this.options["on"+c]||OpenLayers.Ajax.emptyFunction)(b);OpenLayers.Ajax.Responders.dispatch("on"+c,this,b)}catch(f){this.dispatchException(f)}if(c=="Complete"){this.transport.onreadystatechange=OpenLayers.Ajax.emptyFunction}},getHeader:function(a){try{return this.transport.getResponseHeader(a)}catch(b){return null}},dispatchException:function(c){var f=this.options.onException;if(f){f(this,c);OpenLayers.Ajax.Responders.dispatch("onException",this,c)}else{var g=false;var a=OpenLayers.Ajax.Responders.responders;for(var b=0;b<a.length;b++){if(a[b].onException){g=true;break}}if(g){OpenLayers.Ajax.Responders.dispatch("onException",this,c)}else{throw c}}}});OpenLayers.Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];OpenLayers.Ajax.Response=OpenLayers.Class({status:0,statusText:"",initialize:function(c){this.request=c;var f=this.transport=c.transport,a=this.readyState=f.readyState;if((a>2&&!(!!(window.attachEvent&&!window.opera)))||a==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=f.responseText==null?"":String(f.responseText)}if(a==4){var b=f.responseXML;this.responseXML=b===undefined?null:b}},getStatus:OpenLayers.Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||""}catch(a){return""}},getHeader:OpenLayers.Ajax.Request.prototype.getHeader,getResponseHeader:function(a){return this.transport.getResponseHeader(a)}});OpenLayers.Ajax.getElementsByTagNameNS=function(b,a,c,g){var f=null;if(b.getElementsByTagNameNS){f=b.getElementsByTagNameNS(a,g)}else{f=b.getElementsByTagName(c+":"+g)}return f};OpenLayers.Ajax.serializeXMLToString=function(a){var b=new XMLSerializer();var c=b.serializeToString(a);return c};OpenLayers.Event={observers:false,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(a){return a.target||a.srcElement},isLeftClick:function(a){return(((a.which)&&(a.which==1))||((a.button)&&(a.button==1)))},isRightClick:function(a){return(((a.which)&&(a.which==3))||((a.button)&&(a.button==2)))},stop:function(b,a){if(!a){if(b.preventDefault){b.preventDefault()}else{b.returnValue=false}}if(b.stopPropagation){b.stopPropagation()}else{b.cancelBubble=true}},findElement:function(c,b){var a=OpenLayers.Event.element(c);while(a.parentNode&&(!a.tagName||(a.tagName.toUpperCase()!=b.toUpperCase()))){a=a.parentNode}return a},observe:function(b,f,c,a){var g=OpenLayers.Util.getElement(b);a=a||false;if(f=="keypress"&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||g.attachEvent)){f="keydown"}if(!this.observers){this.observers={}}if(!g._eventCacheID){var k="eventCacheID_";if(g.id){k=g.id+"_"+k}g._eventCacheID=OpenLayers.Util.createUniqueID(k)}var l=g._eventCacheID;if(!this.observers[l]){this.observers[l]=[]}this.observers[l].push({element:g,name:f,observer:c,useCapture:a});if(g.addEventListener){g.addEventListener(f,c,a)}else{if(g.attachEvent){g.attachEvent("on"+f,c)}}},stopObservingElement:function(a){var b=OpenLayers.Util.getElement(a);var c=b._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[c])},_removeElementObservers:function(g){if(g){for(var b=g.length-1;b>=0;b--){var c=g[b];var a=new Array(c.element,c.name,c.observer,c.useCapture);var f=OpenLayers.Event.stopObserving.apply(this,a)}}},stopObserving:function(m,a,l,b){b=b||false;var k=OpenLayers.Util.getElement(m);var f=k._eventCacheID;if(a=="keypress"){if(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||k.detachEvent){a="keydown"}}var p=false;var c=OpenLayers.Event.observers[f];if(c){var g=0;while(!p&&g<c.length){var o=c[g];if((o.name==a)&&(o.observer==l)&&(o.useCapture==b)){c.splice(g,1);if(c.length==0){delete OpenLayers.Event.observers[f]}p=true;break}g++}}if(p){if(k.removeEventListener){k.removeEventListener(a,l,b)}else{if(k&&k.detachEvent){k.detachEvent("on"+a,l)}}}return p},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var a in OpenLayers.Event.observers){var b=OpenLayers.Event.observers[a];OpenLayers.Event._removeElementObservers.apply(this,[b])}OpenLayers.Event.observers=false}},CLASS_NAME:"OpenLayers.Event"};OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,false);if(window.Event){OpenLayers.Util.applyDefaults(window.Event,OpenLayers.Event)}else{var Event=OpenLayers.Event}OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur"],listeners:null,object:null,element:null,eventTypes:null,eventHandler:null,fallThrough:null,includeXY:false,clearMouseListener:null,initialize:function(c,g,l,k,b){OpenLayers.Util.extend(this,b);this.object=c;this.fallThrough=k;this.listeners={};this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this);this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this);this.eventTypes=[];if(l!=null){for(var f=0,a=l.length;f<a;f++){this.addEventType(l[f])}}if(g!=null){this.attachToElement(g)}},destroy:function(){if(this.element){OpenLayers.Event.stopObservingElement(this.element);if(this.element.hasScrollEvent){OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener)}}this.element=null;this.listeners=null;this.object=null;this.eventTypes=null;this.fallThrough=null;this.eventHandler=null},addEventType:function(a){if(!this.listeners[a]){this.eventTypes.push(a);this.listeners[a]=[]}},attachToElement:function(f){if(this.element){OpenLayers.Event.stopObservingElement(this.element)}this.element=f;for(var c=0,a=this.BROWSER_EVENTS.length;c<a;c++){var b=this.BROWSER_EVENTS[c];this.addEventType(b);OpenLayers.Event.observe(f,b,this.eventHandler)}OpenLayers.Event.observe(f,"dragstart",OpenLayers.Event.stop)},on:function(a){for(var b in a){if(b!="scope"){this.register(b,a.scope,a[b])}}},register:function(b,f,c){if((c!=null)&&(OpenLayers.Util.indexOf(this.eventTypes,b)!=-1)){if(f==null){f=this.object}var a=this.listeners[b];a.push({obj:f,func:c})}},registerPriority:function(b,f,c){if(c!=null){if(f==null){f=this.object}var a=this.listeners[b];if(a!=null){a.unshift({obj:f,func:c})}}},un:function(a){for(var b in a){if(b!="scope"){this.unregister(b,a.scope,a[b])}}},unregister:function(f,k,g){if(k==null){k=this.object}var c=this.listeners[f];if(c!=null){for(var b=0,a=c.length;b<a;b++){if(c[b].obj==k&&c[b].func==g){c.splice(b,1);break}}}},remove:function(a){if(this.listeners[a]!=null){this.listeners[a]=[]}},triggerEvent:function(g,b){var f=this.listeners[g];if(!f||f.length==0){return}if(b==null){b={}}b.object=this.object;b.element=this.element;if(!b.type){b.type=g}var f=f.slice(),k;for(var c=0,a=f.length;c<a;c++){var l=f[c];k=l.func.apply(l.obj,[b]);if((k!=undefined)&&(k==false)){break}}if(!this.fallThrough){OpenLayers.Event.stop(b,true)}return k},handleBrowserEvent:function(a){if(this.includeXY){a.xy=this.getMousePosition(a)}this.triggerEvent(a.type,a)},clearMouseCache:function(){this.element.scrolls=null;this.element.lefttop=null;this.element.offsets=null},getMousePosition:function(a){if(!this.includeXY){this.clearMouseCache()}else{if(!this.element.hasScrollEvent){OpenLayers.Event.observe(window,"scroll",this.clearMouseListener);this.element.hasScrollEvent=true}}if(!this.element.scrolls){this.element.scrolls=[(document.documentElement.scrollLeft||document.body.scrollLeft),(document.documentElement.scrollTop||document.body.scrollTop)]}if(!this.element.lefttop){this.element.lefttop=[(document.documentElement.clientLeft||0),(document.documentElement.clientTop||0)]}if(!this.element.offsets){this.element.offsets=OpenLayers.Util.pagePosition(this.element);this.element.offsets[0]+=this.element.scrolls[0];this.element.offsets[1]+=this.element.scrolls[1]}return new OpenLayers.Pixel((a.clientX+this.element.scrolls[0])-this.element.offsets[0]-this.element.lefttop[0],(a.clientY+this.element.scrolls[1])-this.element.offsets[1]-this.element.lefttop[1])},CLASS_NAME:"OpenLayers.Events"});OpenLayers.Request={DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:true,user:undefined,password:undefined,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},events:new OpenLayers.Events(this,null,["complete","success","failure"]),issue:function(f){var l=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost});f=OpenLayers.Util.applyDefaults(f,l);var k=new OpenLayers.Request.XMLHttpRequest();var a=f.url;if(f.params){var g=OpenLayers.Util.getParameterString(f.params);if(g.length>0){var o=(a.indexOf("?")>-1)?"&":"?";a+=o+g}}if(f.proxy&&(a.indexOf("http")==0)){a=f.proxy+encodeURIComponent(a)}k.open(f.method,a,f.async,f.user,f.password);for(var m in f.headers){k.setRequestHeader(m,f.headers[m])}var b=(f.scope)?OpenLayers.Function.bind(f.callback,f.scope):f.callback;var p;if(f.success){p=(f.scope)?OpenLayers.Function.bind(f.success,f.scope):f.success}var c;if(f.failure){c=(f.scope)?OpenLayers.Function.bind(f.failure,f.scope):f.failure}var q=this.events;k.onreadystatechange=function(){if(k.readyState==OpenLayers.Request.XMLHttpRequest.DONE){var r=q.triggerEvent("complete",{request:k,config:f,requestUrl:a});if(r!==false){b(k);if(!k.status||(k.status>=200&&k.status<300)){q.triggerEvent("success",{request:k,config:f,requestUrl:a});if(p){p(k)}}if(k.status&&(k.status<200||k.status>=300)){q.triggerEvent("failure",{request:k,config:f,requestUrl:a});if(c){c(k)}}}}};if(f.async===false){k.send(f.data)}else{window.setTimeout(function(){k.send(f.data)},0)}return k},GET:function(a){a=OpenLayers.Util.extend(a,{method:"GET"});return OpenLayers.Request.issue(a)},POST:function(a){a=OpenLayers.Util.extend(a,{method:"POST"});a.headers=a.headers?a.headers:{};if(!("CONTENT-TYPE" in OpenLayers.Util.upperCaseObject(a.headers))){a.headers["Content-Type"]="application/xml"}return OpenLayers.Request.issue(a)},PUT:function(a){a=OpenLayers.Util.extend(a,{method:"PUT"});a.headers=a.headers?a.headers:{};if(!("CONTENT-TYPE" in OpenLayers.Util.upperCaseObject(a.headers))){a.headers["Content-Type"]="application/xml"}return OpenLayers.Request.issue(a)},DELETE:function(a){a=OpenLayers.Util.extend(a,{method:"DELETE"});return OpenLayers.Request.issue(a)},HEAD:function(a){a=OpenLayers.Util.extend(a,{method:"HEAD"});return OpenLayers.Request.issue(a)},OPTIONS:function(a){a=OpenLayers.Util.extend(a,{method:"OPTIONS"});return OpenLayers.Request.issue(a)}};(function(){var f=window.XMLHttpRequest;var m=!!window.controllers,g=window.document.all&&!window.opera;function c(){this._object=f?new f:new window.ActiveXObject("Microsoft.XMLHTTP")}if(m&&f.wrapped){c.wrapped=f.wrapped}c.UNSENT=0;c.OPENED=1;c.HEADERS_RECEIVED=2;c.LOADING=3;c.DONE=4;c.prototype.readyState=c.UNSENT;c.prototype.responseText="";c.prototype.responseXML=null;c.prototype.status=0;c.prototype.statusText="";c.prototype.onreadystatechange=null;c.onreadystatechange=null;c.onopen=null;c.onsend=null;c.onabort=null;c.prototype.open=function(r,A,q,B,p){this._async=q;var v=this,u=this.readyState;if(g){var o=function(){if(v._object.readyState!=c.DONE){a(v)}};if(q){window.attachEvent("onunload",o)}}this._object.onreadystatechange=function(){if(m&&!q){return}v.readyState=v._object.readyState;l(v);if(v._aborted){v.readyState=c.UNSENT;return}if(v.readyState==c.DONE){a(v);if(g&&q){window.detachEvent("onunload",o)}}if(u!=v.readyState){k(v)}u=v.readyState};if(c.onopen){c.onopen.apply(this,arguments)}this._object.open(r,A,q,B,p);if(!q&&m){this.readyState=c.OPENED;k(this)}};c.prototype.send=function(o){if(c.onsend){c.onsend.apply(this,arguments)}if(o&&o.nodeType){o=window.XMLSerializer?new window.XMLSerializer().serializeToString(o):o.xml;if(!this._headers["Content-Type"]){this._object.setRequestHeader("Content-Type","application/xml")}}this._object.send(o);if(m&&!this._async){this.readyState=c.OPENED;l(this);while(this.readyState<c.DONE){this.readyState++;k(this);if(this._aborted){return}}}};c.prototype.abort=function(){if(c.onabort){c.onabort.apply(this,arguments)}if(this.readyState>c.UNSENT){this._aborted=true}this._object.abort();a(this)};c.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()};c.prototype.getResponseHeader=function(o){return this._object.getResponseHeader(o)};c.prototype.setRequestHeader=function(o,p){if(!this._headers){this._headers={}}this._headers[o]=p;return this._object.setRequestHeader(o,p)};c.prototype.toString=function(){return"[object XMLHttpRequest]"};c.toString=function(){return"[XMLHttpRequest]"};function k(o){if(o.onreadystatechange){o.onreadystatechange.apply(o)}if(c.onreadystatechange){c.onreadystatechange.apply(o)}}function b(p){var o=p.responseXML;if(g&&o&&!o.documentElement&&p.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)){o=new ActiveXObject("Microsoft.XMLDOM");o.loadXML(p.responseText)}if(o){if((g&&o.parseError!=0)||(o.documentElement&&o.documentElement.tagName=="parsererror")){return null}}return o}function l(o){try{o.responseText=o._object.responseText}catch(p){}try{o.responseXML=b(o._object)}catch(p){}try{o.status=o._object.status}catch(p){}try{o.statusText=o._object.statusText}catch(p){}}function a(o){o._object.onreadystatechange=new window.Function;delete o._headers}if(!window.Function.prototype.apply){window.Function.prototype.apply=function(o,p){if(!p){p=[]}o.__func=this;o.__func(p[0],p[1],p[2],p[3],p[4]);delete o.__func}}OpenLayers.Request.XMLHttpRequest=c})();OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,initialize:function(b,a){OpenLayers.Util.extend(this,a);this.projCode=b;if(window.Proj4js){this.proj=new Proj4js.Proj(b)}},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(a){if(a&&a.getCode){return this.getCode()==a.getCode()}else{return false}},destroy:function(){delete this.proj;delete this.projCode},CLASS_NAME:"OpenLayers.Projection"});OpenLayers.Projection.transforms={};OpenLayers.Projection.addTransform=function(c,b,a){if(!OpenLayers.Projection.transforms[c]){OpenLayers.Projection.transforms[c]={}}OpenLayers.Projection.transforms[c][b]=a};OpenLayers.Projection.transform=function(a,c,b){if(c.proj&&b.proj){a=Proj4js.transform(c.proj,b.proj,a)}else{if(c&&b&&OpenLayers.Projection.transforms[c.getCode()]&&OpenLayers.Projection.transforms[c.getCode()][b.getCode()]){OpenLayers.Projection.transforms[c.getCode()][b.getCode()](a)}}return a};OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1000},EVENT_TYPES:["preaddlayer","addlayer","removelayer","changelayer","movestart","move","moveend","zoomend","popupopen","popupclose","addmarker","removemarker","clearmarkers","mouseover","mouseout","mousemove","dragstart","drag","dragend","changebaselayer"],id:null,fractionalZoom:false,events:null,allOverlays:false,div:null,dragging:false,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,viewRequestID:0,tileSize:null,projection:"EPSG:4326",units:"degrees",resolutions:null,maxResolution:1.40625,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:true,panTween:null,eventListeners:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,paddingForPopups:null,initialize:function(m,f){if(arguments.length===1&&typeof m==="object"){f=m;m=f&&f.div}this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT);this.maxExtent=new OpenLayers.Bounds(-180,-90,180,90);this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15);this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css";OpenLayers.Util.extend(this,f);this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_");this.div=OpenLayers.Util.getElement(m);if(!this.div){this.div=document.createElement("div");this.div.style.height="1px";this.div.style.width="1px"}OpenLayers.Element.addClass(this.div,"olMap");var l=this.div.id+"_OpenLayers_ViewPort";this.viewPortDiv=OpenLayers.Util.createDiv(l,null,null,null,"relative",null,"hidden");this.viewPortDiv.style.width="100%";this.viewPortDiv.style.height="100%";this.viewPortDiv.className="olMapViewport";this.div.appendChild(this.viewPortDiv);l=this.div.id+"_OpenLayers_Container";this.layerContainerDiv=OpenLayers.Util.createDiv(l);this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1;this.viewPortDiv.appendChild(this.layerContainerDiv);this.events=new OpenLayers.Events(this,this.div,this.EVENT_TYPES,this.fallThrough,{includeXY:true});this.updateSize();if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}this.events.register("movestart",this,this.updateSize);if(OpenLayers.String.contains(navigator.appName,"Microsoft")){this.events.register("resize",this,this.updateSize)}else{this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this);OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy)}if(this.theme){var k=true;var c=document.getElementsByTagName("link");for(var g=0,a=c.length;g<a;++g){if(OpenLayers.Util.isEquivalentUrl(c.item(g).href,this.theme)){k=false;break}}if(k){var b=document.createElement("link");b.setAttribute("rel","stylesheet");b.setAttribute("type","text/css");b.setAttribute("href",this.theme);document.getElementsByTagName("head")[0].appendChild(b)}}this.layers=[];if(this.controls==null){if(OpenLayers.Control!=null){this.controls=[new OpenLayers.Control.Navigation(),new OpenLayers.Control.PanZoom(),new OpenLayers.Control.ArgParser(),new OpenLayers.Control.Attribution()]}else{this.controls=[]}}for(var g=0,a=this.controls.length;g<a;g++){this.addControlToMap(this.controls[g])}this.popups=[];this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this);OpenLayers.Event.observe(window,"unload",this.unloadDestroy)},render:function(a){this.div=OpenLayers.Util.getElement(a);OpenLayers.Element.addClass(this.div,"olMap");this.events.attachToElement(this.div);this.viewPortDiv.parentNode.removeChild(this.viewPortDiv);this.div.appendChild(this.viewPortDiv);this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy){return false}OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy);this.unloadDestroy=null;if(this.updateSizeDestroy){OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy)}else{this.events.unregister("resize",this,this.updateSize)}this.paddingForPopups=null;if(this.controls!=null){for(var a=this.controls.length-1;a>=0;--a){this.controls[a].destroy()}this.controls=null}if(this.layers!=null){for(var a=this.layers.length-1;a>=0;--a){this.layers[a].destroy(false)}this.layers=null}if(this.viewPortDiv){this.div.removeChild(this.viewPortDiv)}this.viewPortDiv=null;if(this.eventListeners){this.events.un(this.eventListeners);this.eventListeners=null}this.events.destroy();this.events=null},setOptions:function(a){OpenLayers.Util.extend(this,a)},getTileSize:function(){return this.tileSize},getBy:function(g,c,a){var f=(typeof a.test=="function");var b=OpenLayers.Array.filter(this[g],function(k){return k[c]==a||(f&&a.test(k[c]))});return b},getLayersBy:function(b,a){return this.getBy("layers",b,a)},getLayersByName:function(a){return this.getLayersBy("name",a)},getLayersByClass:function(a){return this.getLayersBy("CLASS_NAME",a)},getControlsBy:function(b,a){return this.getBy("controls",b,a)},getControlsByClass:function(a){return this.getControlsBy("CLASS_NAME",a)},getLayer:function(g){var b=null;for(var f=0,a=this.layers.length;f<a;f++){var c=this.layers[f];if(c.id==g){b=c;break}}return b},setLayerZIndex:function(b,a){b.setZIndex(this.Z_INDEX_BASE[b.isBaseLayer?"BaseLayer":"Overlay"]+a*5)},resetLayersZIndex:function(){for(var c=0,a=this.layers.length;c<a;c++){var b=this.layers[c];this.setLayerZIndex(b,c)}},addLayer:function(c){for(var b=0,a=this.layers.length;b<a;b++){if(this.layers[b]==c){var f=OpenLayers.i18n("layerAlreadyAdded",{layerName:c.name});OpenLayers.Console.warn(f);return false}}if(this.allOverlays){c.isBaseLayer=false}this.events.triggerEvent("preaddlayer",{layer:c});c.div.className="olLayerDiv";c.div.style.overflow="";this.setLayerZIndex(c,this.layers.length);if(c.isFixed){this.viewPortDiv.appendChild(c.div)}else{this.layerContainerDiv.appendChild(c.div)}this.layers.push(c);c.setMap(this);if(c.isBaseLayer||(this.allOverlays&&!this.baseLayer)){if(this.baseLayer==null){this.setBaseLayer(c)}else{c.setVisibility(false)}}else{c.redraw()}this.events.triggerEvent("addlayer",{layer:c});c.afterAdd()},addLayers:function(c){for(var b=0,a=c.length;b<a;b++){this.addLayer(c[b])}},removeLayer:function(c,g){if(g==null){g=true}if(c.isFixed){this.viewPortDiv.removeChild(c.div)}else{this.layerContainerDiv.removeChild(c.div)}OpenLayers.Util.removeItem(this.layers,c);c.removeMap(this);c.map=null;if(this.baseLayer==c){this.baseLayer=null;if(g){for(var b=0,a=this.layers.length;b<a;b++){var f=this.layers[b];if(f.isBaseLayer||this.allOverlays){this.setBaseLayer(f);break}}}}this.resetLayersZIndex();this.events.triggerEvent("removelayer",{layer:c})},getNumLayers:function(){return this.layers.length},getLayerIndex:function(a){return OpenLayers.Util.indexOf(this.layers,a)},setLayerIndex:function(f,b){var g=this.getLayerIndex(f);if(b<0){b=0}else{if(b>this.layers.length){b=this.layers.length}}if(g!=b){this.layers.splice(g,1);this.layers.splice(b,0,f);for(var c=0,a=this.layers.length;c<a;c++){this.setLayerZIndex(this.layers[c],c)}this.events.triggerEvent("changelayer",{layer:f,property:"order"});if(this.allOverlays){if(b===0){this.setBaseLayer(f)}else{if(this.baseLayer!==this.layers[0]){this.setBaseLayer(this.layers[0])}}}}},raiseLayer:function(b,c){var a=this.getLayerIndex(b)+c;this.setLayerIndex(b,a)},setBaseLayer:function(g){var f=null;if(this.baseLayer){f=this.baseLayer.getExtent()}if(g!=this.baseLayer){if(OpenLayers.Util.indexOf(this.layers,g)!=-1){if(this.baseLayer!=null&&!this.allOverlays){this.baseLayer.setVisibility(false)}this.baseLayer=g;this.viewRequestID++;if(!this.allOverlays){this.baseLayer.visibility=true}var a=this.getCenter();if(a!=null){var b=(f)?f.getCenterLonLat():a;var c=(f)?this.getZoomForExtent(f,true):this.getZoomForResolution(this.resolution,true);this.setCenter(b,c,false,true)}this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}}},addControl:function(b,a){this.controls.push(b);this.addControlToMap(b,a)},addControlToMap:function(b,a){b.outsideViewport=(b.div!=null);if(this.displayProjection&&!b.displayProjection){b.displayProjection=this.displayProjection}b.setMap(this);var c=b.draw(a);if(c){if(!b.outsideViewport){c.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length;this.viewPortDiv.appendChild(c)}}},getControl:function(g){var b=null;for(var c=0,a=this.controls.length;c<a;c++){var f=this.controls[c];if(f.id==g){b=f;break}}return b},removeControl:function(a){if((a)&&(a==this.getControl(a.id))){if(a.div&&(a.div.parentNode==this.viewPortDiv)){this.viewPortDiv.removeChild(a.div)}OpenLayers.Util.removeItem(this.controls,a)}},addPopup:function(a,f){if(f){for(var b=this.popups.length-1;b>=0;--b){this.removePopup(this.popups[b])}}a.map=this;this.popups.push(a);var c=a.draw();if(c){c.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length;this.layerContainerDiv.appendChild(c)}},removePopup:function(a){OpenLayers.Util.removeItem(this.popups,a);if(a.div){try{this.layerContainerDiv.removeChild(a.div)}catch(b){}}a.map=null},getSize:function(){var a=null;if(this.size!=null){a=this.size.clone()}return a},updateSize:function(){this.events.clearMouseCache();var c=this.getCurrentSize();var k=this.getSize();if(k==null){this.size=k=c}if(!c.equals(k)){this.size=c;for(var f=0,b=this.layers.length;f<b;f++){this.layers[f].onMapResize()}if(this.baseLayer!=null){var a=new OpenLayers.Pixel(c.w/2,c.h/2);var l=this.getLonLatFromViewPortPx(a);var g=this.getZoom();this.zoom=null;this.setCenter(this.getCenter(),g)}}},getCurrentSize:function(){var a=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);if(a.w==0&&a.h==0||isNaN(a.w)&&isNaN(a.h)){var b=OpenLayers.Element.getDimensions(this.div);a.w=b.width;a.h=b.height}if(a.w==0&&a.h==0||isNaN(a.w)&&isNaN(a.h)){a.w=parseInt(this.div.style.width);a.h=parseInt(this.div.style.height)}return a},calculateBounds:function(a,b){var g=null;if(a==null){a=this.getCenter()}if(b==null){b=this.getResolution()}if((a!=null)&&(b!=null)){var f=this.getSize();var k=f.w*b;var c=f.h*b;g=new OpenLayers.Bounds(a.lon-k/2,a.lat-c/2,a.lon+k/2,a.lat+c/2)}return g},getCenter:function(){var a=null;if(this.center){a=this.center.clone()}return a},getZoom:function(){return this.zoom},pan:function(f,c,g){g=OpenLayers.Util.applyDefaults(g,{animate:true,dragging:false});var k=this.getViewPortPxFromLonLat(this.getCenter());var b=k.add(f,c);if(!g.dragging||!b.equals(k)){var a=this.getLonLatFromViewPortPx(b);if(g.animate){this.panTo(a)}else{this.setCenter(a,null,g.dragging)}}},panTo:function(b){if(this.panMethod&&this.getExtent().scale(this.panRatio).containsLonLat(b)){if(!this.panTween){this.panTween=new OpenLayers.Tween(this.panMethod)}var a=this.getCenter();if(b.lon==a.lon&&b.lat==a.lat){return}var f={lon:a.lon,lat:a.lat};var c={lon:b.lon,lat:b.lat};this.panTween.start(f,c,this.panDuration,{callbacks:{start:OpenLayers.Function.bind(function(g){this.events.triggerEvent("movestart")},this),eachStep:OpenLayers.Function.bind(function(g){g=new OpenLayers.LonLat(g.lon,g.lat);this.moveTo(g,this.zoom,{dragging:true,noEvent:true})},this),done:OpenLayers.Function.bind(function(g){g=new OpenLayers.LonLat(g.lon,g.lat);this.moveTo(g,this.zoom,{noEvent:true});this.events.triggerEvent("moveend")},this)}})}else{this.setCenter(b)}},setCenter:function(c,a,b,f){this.moveTo(c,a,{dragging:b,forceZoomChange:f,caller:"setCenter"})},moveTo:function(l,u,B){if(!B){B={}}var r=B.dragging;var c=B.forceZoomChange;var m=B.noEvent;if(this.panTween&&B.caller=="setCenter"){this.panTween.stop()}if(!this.center&&!this.isValidLonLat(l)){l=this.maxExtent.getCenterLonLat()}if(this.restrictedExtent!=null){if(l==null){l=this.getCenter()}if(u==null){u=this.getZoom()}var f=this.getResolutionForZoom(u);var v=this.calculateBounds(l,f);if(!this.restrictedExtent.containsBounds(v)){var A=this.restrictedExtent.getCenterLonLat();if(v.getWidth()>this.restrictedExtent.getWidth()){l=new OpenLayers.LonLat(A.lon,l.lat)}else{if(v.left<this.restrictedExtent.left){l=l.add(this.restrictedExtent.left-v.left,0)}else{if(v.right>this.restrictedExtent.right){l=l.add(this.restrictedExtent.right-v.right,0)}}}if(v.getHeight()>this.restrictedExtent.getHeight()){l=new OpenLayers.LonLat(l.lon,A.lat)}else{if(v.bottom<this.restrictedExtent.bottom){l=l.add(0,this.restrictedExtent.bottom-v.bottom)}else{if(v.top>this.restrictedExtent.top){l=l.add(0,this.restrictedExtent.top-v.top)}}}}}var b=c||((this.isValidZoomLevel(u))&&(u!=this.getZoom()));var g=(this.isValidLonLat(l))&&(!l.equals(this.center));if(b||g||!r){if(!this.dragging&&!m){this.events.triggerEvent("movestart")}if(g){if((!b)&&(this.center)){this.centerLayerContainer(l)}this.center=l.clone()}if((b)||(this.layerContainerOrigin==null)){this.layerContainerOrigin=this.center.clone();this.layerContainerDiv.style.left="0px";this.layerContainerDiv.style.top="0px"}if(b){this.zoom=u;this.resolution=this.getResolutionForZoom(u);this.viewRequestID++}var a=this.getExtent();if(this.baseLayer.visibility){this.baseLayer.moveTo(a,b,r);if(r){this.baseLayer.events.triggerEvent("move")}else{this.baseLayer.events.triggerEvent("moveend",{zoomChanged:b})}}a=this.baseLayer.getExtent();for(var k=0,p=this.layers.length;k<p;k++){var o=this.layers[k];if(o!==this.baseLayer&&!o.isBaseLayer){var q=o.calculateInRange();if(o.inRange!=q){o.inRange=q;if(!q){o.display(false)}this.events.triggerEvent("changelayer",{layer:o,property:"visibility"})}if(q&&o.visibility){o.moveTo(a,b,r);if(r){o.events.triggerEvent("move")}else{o.events.triggerEvent("moveend",{zoomChanged:b})}}}}if(b){for(var k=0,p=this.popups.length;k<p;k++){this.popups[k].updatePosition()}}this.events.triggerEvent("move");if(b){this.events.triggerEvent("zoomend")}}if(!r&&!m){this.events.triggerEvent("moveend")}this.dragging=!!r},centerLayerContainer:function(b){var a=this.getViewPortPxFromLonLat(this.layerContainerOrigin);var c=this.getViewPortPxFromLonLat(b);if((a!=null)&&(c!=null)){this.layerContainerDiv.style.left=Math.round(a.x-c.x)+"px";this.layerContainerDiv.style.top=Math.round(a.y-c.y)+"px"}},isValidZoomLevel:function(a){return((a!=null)&&(a>=0)&&(a<this.getNumZoomLevels()))},isValidLonLat:function(c){var b=false;if(c!=null){var a=this.getMaxExtent();b=a.containsLonLat(c)}return b},getProjection:function(){var a=this.getProjectionObject();return a?a.getCode():null},getProjectionObject:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.projection}return a},getMaxResolution:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.maxResolution}return a},getMaxExtent:function(b){var a=null;if(b&&b.restricted&&this.restrictedExtent){a=this.restrictedExtent}else{if(this.baseLayer!=null){a=this.baseLayer.maxExtent}}return a},getNumZoomLevels:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.numZoomLevels}return a},getExtent:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.getExtent()}return a},getResolution:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.getResolution()}return a},getUnits:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.units}return a},getScale:function(){var c=null;if(this.baseLayer!=null){var b=this.getResolution();var a=this.baseLayer.units;c=OpenLayers.Util.getScaleFromResolution(b,a)}return c},getZoomForExtent:function(c,b){var a=null;if(this.baseLayer!=null){a=this.baseLayer.getZoomForExtent(c,b)}return a},getResolutionForZoom:function(b){var a=null;if(this.baseLayer){a=this.baseLayer.getResolutionForZoom(b)}return a},getZoomForResolution:function(a,c){var b=null;if(this.baseLayer!=null){b=this.baseLayer.getZoomForResolution(a,c)}return b},zoomTo:function(a){if(this.isValidZoomLevel(a)){this.setCenter(null,a)}},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTo(this.getZoom()-1)},zoomToExtent:function(f,c){var b=f.getCenterLonLat();if(this.baseLayer.wrapDateLine){var a=this.getMaxExtent();f=f.clone();while(f.right<f.left){f.right+=a.getWidth()}b=f.getCenterLonLat().wrapDateLine(a)}this.setCenter(b,this.getZoomForExtent(f,c))},zoomToMaxExtent:function(c){var b=(c)?c.restricted:true;var a=this.getMaxExtent({restricted:b});this.zoomToExtent(a)},zoomToScale:function(m,l){var f=OpenLayers.Util.getResolutionFromScale(m,this.baseLayer.units);var c=this.getSize();var k=c.w*f;var b=c.h*f;var a=this.getCenter();var g=new OpenLayers.Bounds(a.lon-k/2,a.lat-b/2,a.lon+k/2,a.lat+b/2);this.zoomToExtent(g,l)},getLonLatFromViewPortPx:function(a){var b=null;if(this.baseLayer!=null){b=this.baseLayer.getLonLatFromViewPortPx(a)}return b},getViewPortPxFromLonLat:function(b){var a=null;if(this.baseLayer!=null){a=this.baseLayer.getViewPortPxFromLonLat(b)}return a},getLonLatFromPixel:function(a){return this.getLonLatFromViewPortPx(a)},getPixelFromLonLat:function(b){var a=this.getViewPortPxFromLonLat(b);a.x=Math.round(a.x);a.y=Math.round(a.y);return a},getViewPortPxFromLayerPx:function(f){var c=null;if(f!=null){var b=parseInt(this.layerContainerDiv.style.left);var a=parseInt(this.layerContainerDiv.style.top);c=f.add(b,a)}return c},getLayerPxFromViewPortPx:function(c){var f=null;if(c!=null){var b=-parseInt(this.layerContainerDiv.style.left);var a=-parseInt(this.layerContainerDiv.style.top);f=c.add(b,a);if(isNaN(f.x)||isNaN(f.y)){f=null}}return f},getLonLatFromLayerPx:function(a){a=this.getViewPortPxFromLayerPx(a);return this.getLonLatFromViewPortPx(a)},getLayerPxFromLonLat:function(b){var a=this.getPixelFromLonLat(b);return this.getLayerPxFromViewPortPx(a)},CLASS_NAME:"OpenLayers.Map"});OpenLayers.Map.TILE_WIDTH=256;OpenLayers.Map.TILE_HEIGHT=256;OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:null,alwaysInRange:null,EVENT_TYPES:["loadstart","loadend","loadcancel","visibilitychanged","move","moveend"],events:null,map:null,isBaseLayer:false,alpha:false,displayInLayerSwitcher:true,visibility:true,attribution:null,inRange:false,imageSize:null,imageOffset:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:false,wrapDateLine:false,transitionEffect:null,SUPPORTED_TRANSITIONS:["resize"],initialize:function(b,a){this.addOptions(a);this.name=b;if(this.id==null){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");this.div=OpenLayers.Util.createDiv(this.id);this.div.style.width="100%";this.div.style.height="100%";this.div.dir="ltr";this.events=new OpenLayers.Events(this,this.div,this.EVENT_TYPES);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}}if(this.wrapDateLine){this.displayOutsideMaxExtent=true}},destroy:function(a){if(a==null){a=true}if(this.map!=null){this.map.removeLayer(this,a)}this.projection=null;this.map=null;this.name=null;this.div=null;this.options=null;if(this.events){if(this.eventListeners){this.events.un(this.eventListeners)}this.events.destroy()}this.eventListeners=null;this.events=null},clone:function(a){if(a==null){a=new OpenLayers.Layer(this.name,this.options)}OpenLayers.Util.applyDefaults(a,this);a.map=null;return a},setName:function(a){if(a!=this.name){this.name=a;if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"name"})}}},addOptions:function(a){if(this.options==null){this.options={}}OpenLayers.Util.extend(this.options,a);OpenLayers.Util.extend(this,a)},onMapResize:function(){},redraw:function(){var b=false;if(this.map){this.inRange=this.calculateInRange();var c=this.getExtent();if(c&&this.inRange&&this.visibility){var a=true;this.moveTo(c,a,false);this.events.triggerEvent("moveend",{zoomChanged:a});b=true}}return b},moveTo:function(b,a,c){var f=this.visibility;if(!this.isBaseLayer){f=f&&this.inRange}this.display(f)},setMap:function(b){if(this.map==null){this.map=b;this.maxExtent=this.maxExtent||this.map.maxExtent;this.projection=this.projection||this.map.projection;if(this.projection&&typeof this.projection=="string"){this.projection=new OpenLayers.Projection(this.projection)}this.units=this.projection.getUnits()||this.units||this.map.units;this.initResolutions();if(!this.isBaseLayer){this.inRange=this.calculateInRange();var a=((this.visibility)&&(this.inRange));this.div.style.display=a?"":"none"}this.setTileSize()}},afterAdd:function(){},removeMap:function(a){},getImageSize:function(){return(this.imageSize||this.tileSize)},setTileSize:function(a){var b=(a)?a:((this.tileSize)?this.tileSize:this.map.getTileSize());this.tileSize=b;if(this.gutter){this.imageOffset=new OpenLayers.Pixel(-this.gutter,-this.gutter);this.imageSize=new OpenLayers.Size(b.w+(2*this.gutter),b.h+(2*this.gutter))}},getVisibility:function(){return this.visibility},setVisibility:function(a){if(a!=this.visibility){this.visibility=a;this.display(a);this.redraw();if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"})}this.events.triggerEvent("visibilitychanged")}},display:function(a){var b=this.calculateInRange();if(a!=(this.div.style.display!="none")){this.div.style.display=(a&&b)?"block":"none"}},calculateInRange:function(){var b=false;if(this.alwaysInRange){b=true}else{if(this.map){var a=this.map.getResolution();b=((a>=this.minResolution)&&(a<=this.maxResolution))}}return b},setIsBaseLayer:function(a){if(a!=this.isBaseLayer){this.isBaseLayer=a;if(this.map!=null){this.map.events.triggerEvent("changebaselayer",{layer:this})}}},initResolutions:function(){var u=new Array("projection","units","scales","resolutions","maxScale","minScale","maxResolution","minResolution","minExtent","maxExtent","numZoomLevels","maxZoomLevel");var b=["projection","units"];var g=false;var f={};for(var k=0,o=u.length;k<o;k++){var A=u[k];if(this.options[A]&&OpenLayers.Util.indexOf(b,A)==-1){g=true}f[A]=this.options[A]||this.map[A]}if(this.alwaysInRange==null){this.alwaysInRange=!g}if((this.options.minScale!=null||this.options.maxScale!=null)&&this.options.scales==null){f.scales=null}if((this.options.minResolution!=null||this.options.maxResolution!=null)&&this.options.resolutions==null){f.resolutions=null}if((!f.numZoomLevels)&&(f.maxZoomLevel)){f.numZoomLevels=f.maxZoomLevel+1}if((f.scales!=null)||(f.resolutions!=null)){if(f.scales!=null){f.resolutions=[];for(var k=0,o=f.scales.length;k<o;k++){var c=f.scales[k];f.resolutions[k]=OpenLayers.Util.getResolutionFromScale(c,f.units)}}f.numZoomLevels=f.resolutions.length}else{if(f.minScale){f.maxResolution=OpenLayers.Util.getResolutionFromScale(f.minScale,f.units)}else{if(f.maxResolution=="auto"){var v=this.map.getSize();var r=f.maxExtent.getWidth()/v.w;var m=f.maxExtent.getHeight()/v.h;f.maxResolution=Math.max(r,m)}}if(f.maxScale!=null){f.minResolution=OpenLayers.Util.getResolutionFromScale(f.maxScale,f.units)}else{if((f.minResolution=="auto")&&(f.minExtent!=null)){var v=this.map.getSize();var r=f.minExtent.getWidth()/v.w;var m=f.minExtent.getHeight()/v.h;f.minResolution=Math.max(r,m)}}if(f.minResolution!=null&&this.options.numZoomLevels==undefined){var q=f.maxResolution/f.minResolution;f.numZoomLevels=Math.floor(Math.log(q)/Math.log(2))+1}f.resolutions=new Array(f.numZoomLevels);var a=2;if(typeof f.minResolution=="number"&&f.numZoomLevels>1){a=Math.pow((f.maxResolution/f.minResolution),(1/(f.numZoomLevels-1)))}for(var k=0;k<f.numZoomLevels;k++){var p=f.maxResolution/Math.pow(a,k);f.resolutions[k]=p}}f.resolutions.sort(function(C,B){return(B-C)});this.resolutions=f.resolutions;this.maxResolution=f.resolutions[0];var l=f.resolutions.length-1;this.minResolution=f.resolutions[l];this.scales=[];for(var k=0,o=f.resolutions.length;k<o;k++){this.scales[k]=OpenLayers.Util.getScaleFromResolution(f.resolutions[k],f.units)}this.minScale=this.scales[0];this.maxScale=this.scales[this.scales.length-1];this.numZoomLevels=f.numZoomLevels},getResolution:function(){var a=this.map.getZoom();return this.getResolutionForZoom(a)},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(b,c){var f=this.map.getSize();var a=Math.max(b.getWidth()/f.w,b.getHeight()/f.h);return this.getZoomForResolution(a,c)},getDataExtent:function(){},getResolutionForZoom:function(c){c=Math.max(0,Math.min(c,this.resolutions.length-1));var b;if(this.map.fractionalZoom){var a=Math.floor(c);var f=Math.ceil(c);b=this.resolutions[a]-((c-a)*(this.resolutions[a]-this.resolutions[f]))}else{b=this.resolutions[Math.round(c)]}return b},getZoomForResolution:function(g,a){var u;if(this.map.fractionalZoom){var p=0;var c=this.resolutions.length-1;var f=this.resolutions[p];var b=this.resolutions[c];var o;for(var k=0,l=this.resolutions.length;k<l;++k){o=this.resolutions[k];if(o>=g){f=o;p=k}if(o<=g){b=o;c=k;break}}var m=f-b;if(m>0){u=p+((f-g)/m)}else{u=p}}else{var q;var r=Number.POSITIVE_INFINITY;for(var k=0,l=this.resolutions.length;k<l;k++){if(a){q=Math.abs(this.resolutions[k]-g);if(q>r){break}r=q}else{if(this.resolutions[k]<g){break}}}u=Math.max(0,k-1)}return u},getLonLatFromViewPortPx:function(b){var g=null;if(b!=null){var f=this.map.getSize();var a=this.map.getCenter();if(a){var c=this.map.getResolution();var l=b.x-(f.w/2);var k=b.y-(f.h/2);g=new OpenLayers.LonLat(a.lon+l*c,a.lat-k*c);if(this.wrapDateLine){g=g.wrapDateLine(this.maxExtent)}}}return g},getViewPortPxFromLonLat:function(f){var b=null;if(f!=null){var a=this.map.getResolution();var c=this.map.getExtent();b=new OpenLayers.Pixel((1/a*(f.lon-c.left)),(1/a*(c.top-f.lat)))}return b},setOpacity:function(b){if(b!=this.opacity){this.opacity=b;for(var f=0,a=this.div.childNodes.length;f<a;++f){var c=this.div.childNodes[f].firstChild;OpenLayers.Util.modifyDOMElement(c,null,null,null,null,null,null,b)}}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(a){this.div.style.zIndex=a},adjustBounds:function(b){if(this.gutter){var a=this.gutter*this.map.getResolution();b=new OpenLayers.Bounds(b.left-a,b.bottom-a,b.right+a,b.top+a)}if(this.wrapDateLine){var c={rightTolerance:this.getResolution()};b=b.wrapDateLine(this.maxExtent,c)}return b},CLASS_NAME:"OpenLayers.Layer"});OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(a,b,f,c){this.url=a;this.size=(b)?b:new OpenLayers.Size(20,20);this.offset=f?f:new OpenLayers.Pixel(-(this.size.w/2),-(this.size.h/2));this.calculateOffset=c;var g=OpenLayers.Util.createUniqueID("OL_Icon_");this.imageDiv=OpenLayers.Util.createAlphaImageDiv(g)},destroy:function(){this.erase();OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild);this.imageDiv.innerHTML="";this.imageDiv=null},clone:function(){return new OpenLayers.Icon(this.url,this.size,this.offset,this.calculateOffset)},setSize:function(a){if(a!=null){this.size=a}this.draw()},setUrl:function(a){if(a!=null){this.url=a}this.draw()},draw:function(a){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute");this.moveTo(a);return this.imageDiv},erase:function(){if(this.imageDiv!=null&&this.imageDiv.parentNode!=null){OpenLayers.Element.remove(this.imageDiv)}},setOpacity:function(a){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,a)},moveTo:function(a){if(a!=null){this.px=a}if(this.imageDiv!=null){if(this.px==null){this.display(false)}else{if(this.calculateOffset){this.offset=this.calculateOffset(this.size)}var b=this.px.offset(this.offset);OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,b)}}},display:function(a){this.imageDiv.style.display=(a)?"":"none"},isDrawn:function(){var a=(this.imageDiv&&this.imageDiv.parentNode&&(this.imageDiv.parentNode.nodeType!=11));return a},CLASS_NAME:"OpenLayers.Icon"});OpenLayers.Marker=OpenLayers.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(c,b){this.lonlat=c;var a=(b)?b:OpenLayers.Marker.defaultIcon();if(this.icon==null){this.icon=a}else{this.icon.url=a.url;this.icon.size=a.size;this.icon.offset=a.offset;this.icon.calculateOffset=a.calculateOffset}this.events=new OpenLayers.Events(this,this.icon.imageDiv,null)},destroy:function(){this.erase();this.map=null;this.events.destroy();this.events=null;if(this.icon!=null){this.icon.destroy();this.icon=null}},draw:function(a){return this.icon.draw(a)},erase:function(){if(this.icon!=null){this.icon.erase()}},moveTo:function(a){if((a!=null)&&(this.icon!=null)){this.icon.moveTo(a)}this.lonlat=this.map.getLonLatFromLayerPx(a)},isDrawn:function(){var a=(this.icon&&this.icon.isDrawn());return a},onScreen:function(){var b=false;if(this.map){var a=this.map.getExtent();b=a.containsLonLat(this.lonlat)}return b},inflate:function(b){if(this.icon){var a=new OpenLayers.Size(this.icon.size.w*b,this.icon.size.h*b);this.icon.setSize(a)}},setOpacity:function(a){this.icon.setOpacity(a)},setUrl:function(a){this.icon.setUrl(a)},display:function(a){this.icon.display(a)},CLASS_NAME:"OpenLayers.Marker"});OpenLayers.Marker.defaultIcon=function(){var a=OpenLayers.Util.getImagesLocation()+"marker.png";var b=new OpenLayers.Size(21,25);var c=function(f){return new OpenLayers.Pixel(-(f.w/2),-f.h)};return new OpenLayers.Icon(a,b,null,c)};OpenLayers.Marker.Box=OpenLayers.Class(OpenLayers.Marker,{bounds:null,div:null,initialize:function(b,c,a){this.bounds=b;this.div=OpenLayers.Util.createDiv();this.div.style.overflow="hidden";this.events=new OpenLayers.Events(this,this.div,null);this.setBorder(c,a)},destroy:function(){this.bounds=null;this.div=null;OpenLayers.Marker.prototype.destroy.apply(this,arguments)},setBorder:function(a,b){if(!a){a="red"}if(!b){b=2}this.div.style.border=b+"px solid "+a},draw:function(a,b){OpenLayers.Util.modifyDOMElement(this.div,null,a,b);return this.div},onScreen:function(){var b=false;if(this.map){var a=this.map.getExtent();b=a.containsBounds(this.bounds,true,true)}return b},display:function(a){this.div.style.display=(a)?"":"none"},CLASS_NAME:"OpenLayers.Marker.Box"});OpenLayers.Popup=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:false,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:false,fixPadding:function(){if(typeof this.padding=="number"){this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding)}},panMapIfOutOfView:false,keepInMap:false,closeOnMove:false,map:null,initialize:function(l,c,k,b,g,f){if(l==null){l=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")}this.id=l;this.lonlat=c;this.contentSize=(k!=null)?k:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT);if(b!=null){this.contentHTML=b}this.backgroundColor=OpenLayers.Popup.COLOR;this.opacity=OpenLayers.Popup.OPACITY;this.border=OpenLayers.Popup.BORDER;this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden");this.div.className=this.displayClass;var a=this.id+"_GroupDiv";this.groupDiv=OpenLayers.Util.createDiv(a,null,null,null,"relative",null,"hidden");var l=this.div.id+"_contentDiv";this.contentDiv=OpenLayers.Util.createDiv(l,null,this.contentSize.clone(),null,"relative");this.contentDiv.className=this.contentDisplayClass;this.groupDiv.appendChild(this.contentDiv);this.div.appendChild(this.groupDiv);if(g){this.addCloseBox(f)}this.registerEvents()},destroy:function(){this.id=null;this.lonlat=null;this.size=null;this.contentHTML=null;this.backgroundColor=null;this.opacity=null;this.border=null;if(this.closeOnMove&&this.map){this.map.events.unregister("movestart",this,this.hide)}this.events.destroy();this.events=null;if(this.closeDiv){OpenLayers.Event.stopObservingElement(this.closeDiv);this.groupDiv.removeChild(this.closeDiv)}this.closeDiv=null;this.div.removeChild(this.groupDiv);this.groupDiv=null;if(this.map!=null){this.map.removePopup(this)}this.map=null;this.div=null;this.autoSize=null;this.minSize=null;this.maxSize=null;this.padding=null;this.panMapIfOutOfView=null},draw:function(a){if(a==null){if((this.lonlat!=null)&&(this.map!=null)){a=this.map.getLayerPxFromLonLat(this.lonlat)}}if(this.closeOnMove){this.map.events.register("movestart",this,this.hide)}if(!this.disableFirefoxOverflowHack&&OpenLayers.Util.getBrowserName()=="firefox"){this.map.events.register("movestart",this,function(){var b=document.defaultView.getComputedStyle(this.contentDiv,null);var c=b.getPropertyValue("overflow");if(c!="hidden"){this.contentDiv._oldOverflow=c;this.contentDiv.style.overflow="hidden"}});this.map.events.register("moveend",this,function(){var b=this.contentDiv._oldOverflow;if(b){this.contentDiv.style.overflow=b;this.contentDiv._oldOverflow=null}})}this.moveTo(a);if(!this.autoSize&&!this.size){this.setSize(this.contentSize)}this.setBackgroundColor();this.setOpacity();this.setBorder();this.setContentHTML();if(this.panMapIfOutOfView){this.panIntoView()}return this.div},updatePosition:function(){if((this.lonlat)&&(this.map)){var a=this.map.getLayerPxFromLonLat(this.lonlat);if(a){this.moveTo(a)}}},moveTo:function(a){if((a!=null)&&(this.div!=null)){this.div.style.left=a.x+"px";this.div.style.top=a.y+"px"}},visible:function(){return OpenLayers.Element.visible(this.div)},toggle:function(){if(this.visible()){this.hide()}else{this.show()}},show:function(){OpenLayers.Element.show(this.div);if(this.panMapIfOutOfView){this.panIntoView()}},hide:function(){OpenLayers.Element.hide(this.div)},setSize:function(c){this.size=c.clone();var b=this.getContentDivPadding();var a=b.left+b.right;var g=b.top+b.bottom;this.fixPadding();a+=this.padding.left+this.padding.right;g+=this.padding.top+this.padding.bottom;if(this.closeDiv){var f=parseInt(this.closeDiv.style.width);a+=f+b.right}this.size.w+=a;this.size.h+=g;if(OpenLayers.Util.getBrowserName()=="msie"){this.contentSize.w+=b.left+b.right;this.contentSize.h+=b.bottom+b.top}if(this.div!=null){this.div.style.width=this.size.w+"px";this.div.style.height=this.size.h+"px"}if(this.contentDiv!=null){this.contentDiv.style.width=c.w+"px";this.contentDiv.style.height=c.h+"px"}},updateSize:function(){var g="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>";var m=(this.map)?this.map.layerContainerDiv:document.body;var o=OpenLayers.Util.getRenderedDimensions(g,null,{displayClass:this.displayClass,containerElement:m});var l=this.getSafeContentSize(o);var k=null;if(l.equals(o)){k=o}else{var b=new OpenLayers.Size();b.w=(l.w<o.w)?l.w:null;b.h=(l.h<o.h)?l.h:null;if(b.w&&b.h){k=l}else{var f=OpenLayers.Util.getRenderedDimensions(g,b,{displayClass:this.contentDisplayClass,containerElement:m});var c=OpenLayers.Element.getStyle(this.contentDiv,"overflow");if((c!="hidden")&&(f.equals(l))){var a=OpenLayers.Util.getScrollbarWidth();if(b.w){f.h+=a}else{f.w+=a}}k=this.getSafeContentSize(f)}}this.setSize(k)},setBackgroundColor:function(a){if(a!=undefined){this.backgroundColor=a}if(this.div!=null){this.div.style.backgroundColor=this.backgroundColor}},setOpacity:function(a){if(a!=undefined){this.opacity=a}if(this.div!=null){this.div.style.opacity=this.opacity;this.div.style.filter="alpha(opacity="+this.opacity*100+")"}},setBorder:function(a){if(a!=undefined){this.border=a}if(this.div!=null){this.div.style.border=this.border}},setContentHTML:function(a){if(a!=null){this.contentHTML=a}if((this.contentDiv!=null)&&(this.contentHTML!=null)&&(this.contentHTML!=this.contentDiv.innerHTML)){this.contentDiv.innerHTML=this.contentHTML;if(this.autoSize){this.registerImageListeners();this.updateSize()}}},registerImageListeners:function(){var k=function(){this.popup.updateSize();if(this.popup.visible()&&this.popup.panMapIfOutOfView){this.popup.panIntoView()}OpenLayers.Event.stopObserving(this.img,"load",this.img._onImageLoad)};var b=this.contentDiv.getElementsByTagName("img");for(var g=0,a=b.length;g<a;g++){var c=b[g];if(c.width==0||c.height==0){var f={popup:this,img:c};c._onImgLoad=OpenLayers.Function.bind(k,f);OpenLayers.Event.observe(c,"load",c._onImgLoad)}}},getSafeContentSize:function(q){var f=q.clone();var o=this.getContentDivPadding();var p=o.left+o.right;var l=o.top+o.bottom;this.fixPadding();p+=this.padding.left+this.padding.right;l+=this.padding.top+this.padding.bottom;if(this.closeDiv){var c=parseInt(this.closeDiv.style.width);p+=c+o.right}if(this.minSize){f.w=Math.max(f.w,(this.minSize.w-p));f.h=Math.max(f.h,(this.minSize.h-l))}if(this.maxSize){f.w=Math.min(f.w,(this.maxSize.w-p));f.h=Math.min(f.h,(this.maxSize.h-l))}if(this.map&&this.map.size){var k=0,g=0;if(this.keepInMap&&!this.panMapIfOutOfView){var m=this.map.getPixelFromLonLat(this.lonlat);switch(this.relativePosition){case"tr":k=m.x;g=this.map.size.h-m.y;break;case"tl":k=this.map.size.w-m.x;g=this.map.size.h-m.y;break;case"bl":k=this.map.size.w-m.x;g=m.y;break;case"br":k=m.x;g=m.y;break;default:k=m.x;g=this.map.size.h-m.y;break}}var a=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-l-g;var b=this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-p-k;f.w=Math.min(f.w,b);f.h=Math.min(f.h,a)}return f},getContentDivPadding:function(){var a=this._contentDivPadding;if(!a){if(this.div.parentNode==null){this.div.style.display="none";document.body.appendChild(this.div)}a=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top"));this._contentDivPadding=a;if(this.div.parentNode==document.body){document.body.removeChild(this.div);this.div.style.display=""}}return a},addCloseBox:function(c){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,new OpenLayers.Size(17,17));this.closeDiv.className="olPopupCloseBox";var b=this.getContentDivPadding();this.closeDiv.style.right=b.right+"px";this.closeDiv.style.top=b.top+"px";this.groupDiv.appendChild(this.closeDiv);var a=c||function(f){this.hide();OpenLayers.Event.stop(f)};OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(a,this))},panIntoView:function(){var g=this.map.getSize();var f=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top)));var c=f.clone();if(f.x<this.map.paddingForPopups.left){c.x=this.map.paddingForPopups.left}else{if((f.x+this.size.w)>(g.w-this.map.paddingForPopups.right)){c.x=g.w-this.map.paddingForPopups.right-this.size.w}}if(f.y<this.map.paddingForPopups.top){c.y=this.map.paddingForPopups.top}else{if((f.y+this.size.h)>(g.h-this.map.paddingForPopups.bottom)){c.y=g.h-this.map.paddingForPopups.bottom-this.size.h}}var b=f.x-c.x;var a=f.y-c.y;this.map.pan(b,a)},registerEvents:function(){this.events=new OpenLayers.Events(this,this.div,null,true);this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,scope:this})},onmousedown:function(a){this.mousedown=true;OpenLayers.Event.stop(a,true)},onmousemove:function(a){if(this.mousedown){OpenLayers.Event.stop(a,true)}},onmouseup:function(a){if(this.mousedown){this.mousedown=false;OpenLayers.Event.stop(a,true)}},onclick:function(a){OpenLayers.Event.stop(a,true)},onmouseout:function(a){this.mousedown=false},ondblclick:function(a){OpenLayers.Event.stop(a,true)},CLASS_NAME:"OpenLayers.Popup"});OpenLayers.Popup.WIDTH=200;OpenLayers.Popup.HEIGHT=200;OpenLayers.Popup.COLOR="white";OpenLayers.Popup.OPACITY=1;OpenLayers.Popup.BORDER="0px";OpenLayers.Tile=OpenLayers.Class({EVENT_TYPES:["loadstart","loadend","reload","unload"],events:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:false,initialize:function(f,a,g,b,c){this.layer=f;this.position=a.clone();this.bounds=g.clone();this.url=b;this.size=c.clone();this.id=OpenLayers.Util.createUniqueID("Tile_");this.events=new OpenLayers.Events(this,null,this.EVENT_TYPES)},unload:function(){if(this.isLoading){this.isLoading=false;this.events.triggerEvent("unload")}},destroy:function(){this.layer=null;this.bounds=null;this.size=null;this.position=null;this.events.destroy();this.events=null},clone:function(a){if(a==null){a=new OpenLayers.Tile(this.layer,this.position,this.bounds,this.url,this.size)}OpenLayers.Util.applyDefaults(a,this);return a},draw:function(){var a=this.layer.maxExtent;var b=(a&&this.bounds.intersectsBounds(a,false));this.shouldDraw=(b||this.layer.displayOutsideMaxExtent);this.clear();return this.shouldDraw},moveTo:function(b,a,c){if(c==null){c=true}this.bounds=b.clone();this.position=a.clone();if(c){this.draw()}},clear:function(){},getBoundsFromBaseLayer:function(a){var k=OpenLayers.i18n("reprojectDeprecated",{layerName:this.layer.name});OpenLayers.Console.warn(k);var f=this.layer.map.getLonLatFromLayerPx(a);var c=a.clone();c.x+=this.size.w;c.y+=this.size.h;var b=this.layer.map.getLonLatFromLayerPx(c);if(f.lon>b.lon){if(f.lon<0){f.lon=-180-(f.lon+180)}else{b.lon=180+b.lon+180}}var g=new OpenLayers.Bounds(f.lon,b.lat,b.lon,f.lat);return g},showTile:function(){if(this.shouldDraw){this.show()}},show:function(){},hide:function(){},CLASS_NAME:"OpenLayers.Tile"});OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,layerAlphaHack:null,isBackBuffer:false,lastRatio:1,isFirstDraw:true,backBufferTile:null,initialize:function(f,a,g,b,c){OpenLayers.Tile.prototype.initialize.apply(this,arguments);this.url=b;this.frame=document.createElement("div");this.frame.style.overflow="hidden";this.frame.style.position="absolute";this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack()},destroy:function(){if(this.imgDiv!=null){if(this.layerAlphaHack){OpenLayers.Event.stopObservingElement(this.imgDiv.childNodes[0].id)}OpenLayers.Event.stopObservingElement(this.imgDiv.id);if(this.imgDiv.parentNode==this.frame){this.frame.removeChild(this.imgDiv);this.imgDiv.map=null}this.imgDiv.urls=null;this.imgDiv.src=OpenLayers.Util.getImagesLocation()+"blank.gif"}this.imgDiv=null;if((this.frame!=null)&&(this.frame.parentNode==this.layer.div)){this.layer.div.removeChild(this.frame)}this.frame=null;if(this.backBufferTile){this.backBufferTile.destroy();this.backBufferTile=null}this.layer.events.unregister("loadend",this,this.resetBackBuffer);OpenLayers.Tile.prototype.destroy.apply(this,arguments)},clone:function(a){if(a==null){a=new OpenLayers.Tile.Image(this.layer,this.position,this.bounds,this.url,this.size)}a=OpenLayers.Tile.prototype.clone.apply(this,[a]);a.imgDiv=null;return a},draw:function(){if(this.layer!=this.layer.map.baseLayer&&this.layer.reproject){this.bounds=this.getBoundsFromBaseLayer(this.position)}var a=OpenLayers.Tile.prototype.draw.apply(this,arguments);if(OpenLayers.Util.indexOf(this.layer.SUPPORTED_TRANSITIONS,this.layer.transitionEffect)!=-1){if(a){if(!this.backBufferTile){this.backBufferTile=this.clone();this.backBufferTile.hide();this.backBufferTile.isBackBuffer=true;this.events.register("loadend",this,this.resetBackBuffer);this.layer.events.register("loadend",this,this.resetBackBuffer)}this.startTransition()}else{if(this.backBufferTile){this.backBufferTile.clear()}}}else{if(a&&this.isFirstDraw){this.events.register("loadend",this,this.showTile);this.isFirstDraw=false}}if(!a){return false}if(this.isLoading){this.events.triggerEvent("reload")}else{this.isLoading=true;this.events.triggerEvent("loadstart")}return this.renderTile()},resetBackBuffer:function(){this.showTile();if(this.backBufferTile&&(this.isFirstDraw||!this.layer.numLoadingTiles)){this.isFirstDraw=false;var a=this.layer.maxExtent;var b=(a&&this.bounds.intersectsBounds(a,false));if(b){this.backBufferTile.position=this.position;this.backBufferTile.bounds=this.bounds;this.backBufferTile.size=this.size;this.backBufferTile.imageSize=this.layer.imageSize||this.size;this.backBufferTile.imageOffset=this.layer.imageOffset;this.backBufferTile.resolution=this.layer.getResolution();this.backBufferTile.renderTile()}this.backBufferTile.hide()}},renderTile:function(){if(this.imgDiv==null){this.initImgDiv()}this.imgDiv.viewRequestID=this.layer.map.viewRequestID;if(this.layer.async){this.layer.getURLasync(this.bounds,this,"url",this.positionImage)}else{if(this.layer.url instanceof Array){this.imgDiv.urls=this.layer.url.slice()}this.url=this.layer.getURL(this.bounds);this.positionImage()}return true},positionImage:function(){if(this.layer==null){return}OpenLayers.Util.modifyDOMElement(this.frame,null,this.position,this.size);var a=this.layer.getImageSize();if(this.layerAlphaHack){OpenLayers.Util.modifyAlphaImageDiv(this.imgDiv,null,null,a,this.url)}else{OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,a);this.imgDiv.src=this.url}},clear:function(){if(this.imgDiv){this.hide();if(OpenLayers.Tile.Image.useBlankTile){this.imgDiv.src=OpenLayers.Util.getImagesLocation()+"blank.gif"}}},initImgDiv:function(){var f=this.layer.imageOffset;var b=this.layer.getImageSize();if(this.layerAlphaHack){this.imgDiv=OpenLayers.Util.createAlphaImageDiv(null,f,b,null,"relative",null,null,null,true)}else{this.imgDiv=OpenLayers.Util.createImage(null,f,b,null,"relative",null,null,true)}this.imgDiv.className="olTileImage";this.frame.style.zIndex=this.isBackBuffer?0:1;this.frame.appendChild(this.imgDiv);this.layer.div.appendChild(this.frame);if(this.layer.opacity!=null){OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,null,null,null,null,this.layer.opacity)}this.imgDiv.map=this.layer.map;var c=function(){if(this.isLoading){this.isLoading=false;this.events.triggerEvent("loadend")}};if(this.layerAlphaHack){OpenLayers.Event.observe(this.imgDiv.childNodes[0],"load",OpenLayers.Function.bind(c,this))}else{OpenLayers.Event.observe(this.imgDiv,"load",OpenLayers.Function.bind(c,this))}var a=function(){if(this.imgDiv._attempts>OpenLayers.IMAGE_RELOAD_ATTEMPTS){c.call(this)}};OpenLayers.Event.observe(this.imgDiv,"error",OpenLayers.Function.bind(a,this))},checkImgURL:function(){if(this.layer){var a=this.layerAlphaHack?this.imgDiv.firstChild.src:this.imgDiv.src;if(!OpenLayers.Util.isEquivalentUrl(a,this.url)){this.hide()}}},startTransition:function(){if(!this.backBufferTile||!this.backBufferTile.imgDiv){return}var f=1;if(this.backBufferTile.resolution){f=this.backBufferTile.resolution/this.layer.getResolution()}if(f!=this.lastRatio){if(this.layer.transitionEffect=="resize"){var c=new OpenLayers.LonLat(this.backBufferTile.bounds.left,this.backBufferTile.bounds.top);var b=new OpenLayers.Size(this.backBufferTile.size.w*f,this.backBufferTile.size.h*f);var a=this.layer.map.getLayerPxFromLonLat(c);OpenLayers.Util.modifyDOMElement(this.backBufferTile.frame,null,a,b);var g=this.backBufferTile.imageSize;g=new OpenLayers.Size(g.w*f,g.h*f);var k=this.backBufferTile.imageOffset;if(k){k=new OpenLayers.Pixel(k.x*f,k.y*f)}OpenLayers.Util.modifyDOMElement(this.backBufferTile.imgDiv,null,k,g);this.backBufferTile.show()}}else{if(this.layer.singleTile){this.backBufferTile.show()}else{this.backBufferTile.hide()}}this.lastRatio=f},show:function(){this.frame.style.display="";if(OpenLayers.Util.indexOf(this.layer.SUPPORTED_TRANSITIONS,this.layer.transitionEffect)!=-1){if(navigator.userAgent.toLowerCase().indexOf("gecko")!=-1){this.frame.scrollLeft=this.frame.scrollLeft}}},hide:function(){this.frame.style.display="none"},CLASS_NAME:"OpenLayers.Tile.Image"});OpenLayers.Tile.Image.useBlankTile=(OpenLayers.Util.getBrowserName()=="safari"||OpenLayers.Util.getBrowserName()=="opera");OpenLayers.Tile.WFS=OpenLayers.Class(OpenLayers.Tile,{features:null,url:null,request:null,initialize:function(f,a,g,b,c){OpenLayers.Tile.prototype.initialize.apply(this,arguments);this.url=b;this.features=[]},destroy:function(){OpenLayers.Tile.prototype.destroy.apply(this,arguments);this.destroyAllFeatures();this.features=null;this.url=null;if(this.request){this.request.abort();this.request=null}},clear:function(){this.destroyAllFeatures()},draw:function(){if(OpenLayers.Tile.prototype.draw.apply(this,arguments)){if(this.isLoading){this.events.triggerEvent("reload")}else{this.isLoading=true;this.events.triggerEvent("loadstart")}this.loadFeaturesForRegion(this.requestSuccess)}},loadFeaturesForRegion:function(b,a){if(this.request){this.request.abort()}this.request=OpenLayers.Request.GET({url:this.url,success:b,failure:a,scope:this})},requestSuccess:function(b){if(this.features){var f=b.responseXML;if(!f||!f.documentElement){f=b.responseText}if(this.layer.vectorMode){this.layer.addFeatures(this.layer.formatObject.read(f))}else{var a=new OpenLayers.Format.XML();if(typeof f=="string"){f=a.read(f)}var c=a.getElementsByTagNameNS(f,"http://www.opengis.net/gml","featureMember");this.addResults(c)}}if(this.events){this.events.triggerEvent("loadend")}this.request=null},addResults:function(c){for(var b=0;b<c.length;b++){var a=new this.layer.featureClass(this.layer,c[b]);this.features.push(a)}},destroyAllFeatures:function(){while(this.features.length>0){var a=this.features.shift();a.destroy()}},CLASS_NAME:"OpenLayers.Tile.WFS"});OpenLayers.Layer.Image=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:true,url:null,extent:null,size:null,tile:null,aspectRatio:null,initialize:function(c,b,g,f,a){this.url=b;this.extent=g;this.maxExtent=g;this.size=f;OpenLayers.Layer.prototype.initialize.apply(this,[c,a]);this.aspectRatio=(this.extent.getHeight()/this.size.h)/(this.extent.getWidth()/this.size.w)},destroy:function(){if(this.tile){this.removeTileMonitoringHooks(this.tile);this.tile.destroy();this.tile=null}OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(a){if(a==null){a=new OpenLayers.Layer.Image(this.name,this.url,this.extent,this.size,this.options)}a=OpenLayers.Layer.prototype.clone.apply(this,[a]);return a},setMap:function(a){if(this.options.maxResolution==null){this.options.maxResolution=this.aspectRatio*this.extent.getWidth()/this.size.w}OpenLayers.Layer.prototype.setMap.apply(this,arguments)},moveTo:function(g,a,k){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var b=(this.tile==null);if(a||b){this.setTileSize();var f=new OpenLayers.LonLat(this.extent.left,this.extent.top);var c=this.map.getLayerPxFromLonLat(f);if(b){this.tile=new OpenLayers.Tile.Image(this,c,this.extent,null,this.tileSize);this.addTileMonitoringHooks(this.tile)}else{this.tile.size=this.tileSize.clone();this.tile.position=c.clone()}this.tile.draw()}},setTileSize:function(){var b=this.extent.getWidth()/this.map.getResolution();var a=this.extent.getHeight()/this.map.getResolution();this.tileSize=new OpenLayers.Size(b,a)},addTileMonitoringHooks:function(a){a.onLoadStart=function(){this.events.triggerEvent("loadstart")};a.events.register("loadstart",this,a.onLoadStart);a.onLoadEnd=function(){this.events.triggerEvent("loadend")};a.events.register("loadend",this,a.onLoadEnd);a.events.register("unload",this,a.onLoadEnd)},removeTileMonitoringHooks:function(a){a.unload();a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,scope:this})},setUrl:function(a){this.url=a;this.tile.draw()},getURL:function(a){return this.url},CLASS_NAME:"OpenLayers.Layer.Image"});OpenLayers.Layer.SphericalMercator={getExtent:function(){var a=null;if(this.sphericalMercator){a=this.map.calculateBounds()}else{a=OpenLayers.Layer.FixedZoomLevels.prototype.getExtent.apply(this)}return a},initMercatorParameters:function(){this.RESOLUTIONS=[];var a=156543.0339;for(var b=0;b<=this.MAX_ZOOM_LEVEL;++b){this.RESOLUTIONS[b]=a/Math.pow(2,b)}this.units="m";this.projection="EPSG:900913"},forwardMercator:function(c,b){var a=c*20037508.34/180;var f=Math.log(Math.tan((90+b)*Math.PI/360))/(Math.PI/180);f=f*20037508.34/180;return new OpenLayers.LonLat(a,f)},inverseMercator:function(a,f){var c=(a/20037508.34)*180;var b=(f/20037508.34)*180;b=180/Math.PI*(2*Math.atan(Math.exp(b*Math.PI/180))-Math.PI/2);return new OpenLayers.LonLat(c,b)},projectForward:function(a){var b=OpenLayers.Layer.SphericalMercator.forwardMercator(a.x,a.y);a.x=b.lon;a.y=b.lat;return a},projectInverse:function(a){var b=OpenLayers.Layer.SphericalMercator.inverseMercator(a.x,a.y);a.x=b.lon;a.y=b.lat;return a}};OpenLayers.Projection.addTransform("EPSG:4326","EPSG:900913",OpenLayers.Layer.SphericalMercator.projectForward);OpenLayers.Projection.addTransform("EPSG:900913","EPSG:4326",OpenLayers.Layer.SphericalMercator.projectInverse);OpenLayers.Layer.EventPane=OpenLayers.Class(OpenLayers.Layer,{smoothDragPan:true,isBaseLayer:true,isFixed:true,pane:null,mapObject:null,initialize:function(b,a){OpenLayers.Layer.prototype.initialize.apply(this,arguments);if(this.pane==null){this.pane=OpenLayers.Util.createDiv(this.div.id+"_EventPane")}},destroy:function(){this.mapObject=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setMap:function(a){OpenLayers.Layer.prototype.setMap.apply(this,arguments);this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1;this.pane.style.display=this.div.style.display;this.pane.style.width="100%";this.pane.style.height="100%";if(OpenLayers.Util.getBrowserName()=="msie"){this.pane.style.background="url("+OpenLayers.Util.getImagesLocation()+"blank.gif)"}if(this.isFixed){this.map.viewPortDiv.appendChild(this.pane)}else{this.map.layerContainerDiv.appendChild(this.pane)}this.loadMapObject();if(this.mapObject==null){this.loadWarningMessage()}},removeMap:function(a){if(this.pane&&this.pane.parentNode){this.pane.parentNode.removeChild(this.pane);this.pane=null}OpenLayers.Layer.prototype.removeMap.apply(this,arguments)},loadWarningMessage:function(){this.div.style.backgroundColor="darkblue";var l=this.map.getSize();var a=Math.min(l.w,300);var g=Math.min(l.h,200);var b=new OpenLayers.Size(a,g);var f=new OpenLayers.Pixel(l.w/2,l.h/2);var c=f.add(-b.w/2,-b.h/2);var k=OpenLayers.Util.createDiv(this.name+"_warning",c,b,null,null,null,"auto");k.style.padding="7px";k.style.backgroundColor="yellow";k.innerHTML=this.getWarningHTML();this.div.appendChild(k)},getWarningHTML:function(){return""},display:function(a){OpenLayers.Layer.prototype.display.apply(this,arguments);this.pane.style.display=this.div.style.display},setZIndex:function(a){OpenLayers.Layer.prototype.setZIndex.apply(this,arguments);this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1},moveTo:function(c,f,p){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);if(this.mapObject!=null){var g=this.map.getCenter();var l=this.map.getZoom();if(g!=null){var k=this.getMapObjectCenter();var b=this.getOLLonLatFromMapObjectLonLat(k);var m=this.getMapObjectZoom();var u=this.getOLZoomFromMapObjectZoom(m);if(!(g.equals(b))||!(l==u)){if(p&&this.dragPanMapObject&&this.smoothDragPan){var o=this.map.getViewPortPxFromLonLat(b);var q=this.map.getViewPortPxFromLonLat(g);this.dragPanMapObject(q.x-o.x,o.y-q.y)}else{var a=this.getMapObjectLonLatFromOLLonLat(g);var r=this.getMapObjectZoomFromOLZoom(l);this.setMapObjectCenter(a,r,p)}}}}},getLonLatFromViewPortPx:function(a){var b=null;if((this.mapObject!=null)&&(this.getMapObjectCenter()!=null)){var f=this.getMapObjectPixelFromOLPixel(a);var c=this.getMapObjectLonLatFromMapObjectPixel(f);b=this.getOLLonLatFromMapObjectLonLat(c)}return b},getViewPortPxFromLonLat:function(b){var a=null;if((this.mapObject!=null)&&(this.getMapObjectCenter()!=null)){var f=this.getMapObjectLonLatFromOLLonLat(b);var c=this.getMapObjectPixelFromMapObjectLonLat(f);a=this.getOLPixelFromMapObjectPixel(c)}return a},getOLLonLatFromMapObjectLonLat:function(f){var a=null;if(f!=null){var c=this.getLongitudeFromMapObjectLonLat(f);var b=this.getLatitudeFromMapObjectLonLat(f);a=new OpenLayers.LonLat(c,b)}return a},getMapObjectLonLatFromOLLonLat:function(a){var b=null;if(a!=null){b=this.getMapObjectLonLatFromLonLat(a.lon,a.lat)}return b},getOLPixelFromMapObjectPixel:function(f){var b=null;if(f!=null){var a=this.getXFromMapObjectPixel(f);var c=this.getYFromMapObjectPixel(f);b=new OpenLayers.Pixel(a,c)}return b},getMapObjectPixelFromOLPixel:function(a){var b=null;if(a!=null){b=this.getMapObjectPixelFromXY(a.x,a.y)}return b},CLASS_NAME:"OpenLayers.Layer.EventPane"});OpenLayers.Layer.FixedZoomLevels=OpenLayers.Class({initialize:function(){},initResolutions:function(){var c=new Array("minZoomLevel","maxZoomLevel","numZoomLevels");for(var b=0,a=c.length;b<a;b++){var k=c[b];this[k]=(this.options[k]!=null)?this.options[k]:this.map[k]}if((this.minZoomLevel==null)||(this.minZoomLevel<this.MIN_ZOOM_LEVEL)){this.minZoomLevel=this.MIN_ZOOM_LEVEL}var l;var g=this.MAX_ZOOM_LEVEL-this.minZoomLevel+1;if(((this.options.numZoomLevels==null)&&(this.options.maxZoomLevel!=null))||((this.numZoomLevels==null)&&(this.maxZoomLevel!=null))){l=this.maxZoomLevel-this.minZoomLevel+1}else{l=this.numZoomLevels}if(l!=null){this.numZoomLevels=Math.min(l,g)}else{this.numZoomLevels=g}this.maxZoomLevel=this.minZoomLevel+this.numZoomLevels-1;if(this.RESOLUTIONS!=null){var f=0;this.resolutions=[];for(var b=this.minZoomLevel;b<=this.maxZoomLevel;b++){this.resolutions[f++]=this.RESOLUTIONS[b]}this.maxResolution=this.resolutions[0];this.minResolution=this.resolutions[this.resolutions.length-1]}},getResolution:function(){if(this.resolutions!=null){return OpenLayers.Layer.prototype.getResolution.apply(this,arguments)}else{var a=null;var c=this.map.getSize();var b=this.getExtent();if((c!=null)&&(b!=null)){a=Math.max(b.getWidth()/c.w,b.getHeight()/c.h)}return a}},getExtent:function(){var c=null;var b=this.map.getSize();var g=new OpenLayers.Pixel(0,0);var k=this.getLonLatFromViewPortPx(g);var a=new OpenLayers.Pixel(b.w,b.h);var f=this.getLonLatFromViewPortPx(a);if((k!=null)&&(f!=null)){c=new OpenLayers.Bounds(k.lon,f.lat,f.lon,k.lat)}return c},getZoomForResolution:function(a){if(this.resolutions!=null){return OpenLayers.Layer.prototype.getZoomForResolution.apply(this,arguments)}else{var b=OpenLayers.Layer.prototype.getExtent.apply(this,[]);return this.getZoomForExtent(b)}},getOLZoomFromMapObjectZoom:function(a){var b=null;if(a!=null){b=a-this.minZoomLevel}return b},getMapObjectZoomFromOLZoom:function(a){var b=null;if(a!=null){b=a+this.minZoomLevel}return b},CLASS_NAME:"OpenLayers.Layer.FixedZoomLevels"});OpenLayers.Layer.Google=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:0,MAX_ZOOM_LEVEL:19,RESOLUTIONS:[1.40625,0.703125,0.3515625,0.17578125,0.087890625,0.0439453125,0.02197265625,0.010986328125,0.0054931640625,0.00274658203125,0.001373291015625,0.0006866455078125,0.00034332275390625,0.000171661376953125,0.0000858306884765625,0.00004291534423828125,0.00002145767211914062,0.00001072883605957031,0.00000536441802978515,0.00000268220901489257],type:null,sphericalMercator:false,dragObject:null,termsOfUse:null,poweredBy:null,initialize:function(b,a){OpenLayers.Layer.EventPane.prototype.initialize.apply(this,arguments);OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,arguments);this.addContainerPxFunction();if(this.sphericalMercator){OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator);this.initMercatorParameters()}},loadMapObject:function(){try{this.mapObject=new GMap2(this.div);if(typeof this.mapObject.getDragObject=="function"){this.dragObject=this.mapObject.getDragObject()}else{this.dragPanMapObject=null}this.termsOfUse=this.div.lastChild;this.div.removeChild(this.termsOfUse);if(this.isFixed){this.map.viewPortDiv.appendChild(this.termsOfUse)}else{this.map.layerContainerDiv.appendChild(this.termsOfUse)}this.termsOfUse.style.zIndex="1100";this.termsOfUse.style.display=this.div.style.display;this.termsOfUse.style.right="";this.termsOfUse.style.bottom="";this.termsOfUse.className="olLayerGoogleCopyright";this.poweredBy=this.div.lastChild;this.div.removeChild(this.poweredBy);if(this.isFixed){this.map.viewPortDiv.appendChild(this.poweredBy)}else{this.map.layerContainerDiv.appendChild(this.poweredBy)}this.poweredBy.style.zIndex="1100";this.poweredBy.style.display=this.div.style.display;this.poweredBy.style.right="";this.poweredBy.style.bottom="";this.poweredBy.className="olLayerGooglePoweredBy gmnoprint"}catch(a){OpenLayers.Console.error(a)}},setMap:function(a){OpenLayers.Layer.EventPane.prototype.setMap.apply(this,arguments);if(this.type!=null){this.map.events.register("moveend",this,this.setMapType)}},setMapType:function(){if(this.mapObject.getCenter()!=null){if(OpenLayers.Util.indexOf(this.mapObject.getMapTypes(),this.type)==-1){this.mapObject.addMapType(this.type)}this.mapObject.setMapType(this.type);this.map.events.unregister("moveend",this,this.setMapType)}},onMapResize:function(){if(this.visibility&&this.mapObject.isLoaded()){this.mapObject.checkResize()}else{if(!this._resized){var a=this;var b=GEvent.addListener(this.mapObject,"load",function(){GEvent.removeListener(b);delete a._resized;a.mapObject.checkResize();a.moveTo(a.map.getCenter(),a.map.getZoom())})}this._resized=true}},display:function(a){OpenLayers.Layer.EventPane.prototype.display.apply(this,arguments);this.termsOfUse.style.display=this.div.style.display;this.poweredBy.style.display=this.div.style.display},removeMap:function(a){if(this.termsOfUse&&this.termsOfUse.parentNode){this.termsOfUse.parentNode.removeChild(this.termsOfUse);this.termsOfUse=null}if(this.poweredBy&&this.poweredBy.parentNode){this.poweredBy.parentNode.removeChild(this.poweredBy);this.poweredBy=null}OpenLayers.Layer.EventPane.prototype.removeMap.apply(this,arguments)},getOLBoundsFromMapObjectBounds:function(b){var c=null;if(b!=null){var a=b.getSouthWest();var f=b.getNorthEast();if(this.sphericalMercator){a=this.forwardMercator(a.lng(),a.lat());f=this.forwardMercator(f.lng(),f.lat())}else{a=new OpenLayers.LonLat(a.lng(),a.lat());f=new OpenLayers.LonLat(f.lng(),f.lat())}c=new OpenLayers.Bounds(a.lon,a.lat,f.lon,f.lat)}return c},getMapObjectBoundsFromOLBounds:function(c){var b=null;if(c!=null){var a=this.sphericalMercator?this.inverseMercator(c.bottom,c.left):new OpenLayers.LonLat(c.bottom,c.left);var f=this.sphericalMercator?this.inverseMercator(c.top,c.right):new OpenLayers.LonLat(c.top,c.right);b=new GLatLngBounds(new GLatLng(a.lat,a.lon),new GLatLng(f.lat,f.lon))}return b},addContainerPxFunction:function(){if((typeof GMap2!="undefined")&&!GMap2.prototype.fromLatLngToContainerPixel){GMap2.prototype.fromLatLngToContainerPixel=function(b){var a=this.fromLatLngToDivPixel(b);var c=this.getContainer().firstChild.firstChild;a.x+=c.offsetLeft;a.y+=c.offsetTop;return a}}},getWarningHTML:function(){return OpenLayers.i18n("googleWarning")},setMapObjectCenter:function(a,b){this.mapObject.setCenter(a,b)},dragPanMapObject:function(b,a){this.dragObject.moveBy(new GSize(-b,a))},getMapObjectCenter:function(){return this.mapObject.getCenter()},getMapObjectZoom:function(){return this.mapObject.getZoom()},getMapObjectLonLatFromMapObjectPixel:function(a){return this.mapObject.fromContainerPixelToLatLng(a)},getMapObjectPixelFromMapObjectLonLat:function(a){return this.mapObject.fromLatLngToContainerPixel(a)},getMapObjectZoomFromMapObjectBounds:function(a){return this.mapObject.getBoundsZoomLevel(a)},getLongitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.lng(),a.lat()).lon:a.lng()},getLatitudeFromMapObjectLonLat:function(b){var a=this.sphericalMercator?this.forwardMercator(b.lng(),b.lat()).lat:b.lat();return a},getMapObjectLonLatFromLonLat:function(f,b){var c;if(this.sphericalMercator){var a=this.inverseMercator(f,b);c=new GLatLng(a.lat,a.lon)}else{c=new GLatLng(b,f)}return c},getXFromMapObjectPixel:function(a){return a.x},getYFromMapObjectPixel:function(a){return a.y},getMapObjectPixelFromXY:function(a,b){return new GPoint(a,b)},CLASS_NAME:"OpenLayers.Layer.Google"});OpenLayers.Layer.VirtualEarth=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:1,MAX_ZOOM_LEVEL:17,RESOLUTIONS:[1.40625,0.703125,0.3515625,0.17578125,0.087890625,0.0439453125,0.02197265625,0.010986328125,0.0054931640625,0.00274658203125,0.001373291015625,0.0006866455078125,0.00034332275390625,0.000171661376953125,0.0000858306884765625,0.00004291534423828125,0.00002145767211914062],type:null,sphericalMercator:false,initialize:function(b,a){OpenLayers.Layer.EventPane.prototype.initialize.apply(this,arguments);OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,arguments);if(this.sphericalMercator){OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator);this.initMercatorParameters()}},loadMapObject:function(){var a=OpenLayers.Util.createDiv(this.name);var c=this.map.getSize();a.style.width=c.w+"px";a.style.height=c.h+"px";this.div.appendChild(a);try{this.mapObject=new VEMap(this.name)}catch(b){}if(this.mapObject!=null){try{this.mapObject.LoadMap(null,null,this.type,true);this.mapObject.AttachEvent("onmousedown",function(){return true})}catch(b){}this.mapObject.HideDashboard()}if(!this.mapObject||!this.mapObject.vemapcontrol||!this.mapObject.vemapcontrol.PanMap||(typeof this.mapObject.vemapcontrol.PanMap!="function")){this.dragPanMapObject=null}},getWarningHTML:function(){return OpenLayers.i18n("getLayerWarning",{layerType:"VE",layerLib:"VirtualEarth"})},setMapObjectCenter:function(a,b){this.mapObject.SetCenterAndZoom(a,b)},getMapObjectCenter:function(){return this.mapObject.GetCenter()},dragPanMapObject:function(b,a){this.mapObject.vemapcontrol.PanMap(b,-a)},getMapObjectZoom:function(){return this.mapObject.GetZoomLevel()},getMapObjectLonLatFromMapObjectPixel:function(a){return(typeof VEPixel!="undefined")?this.mapObject.PixelToLatLong(a):this.mapObject.PixelToLatLong(a.x,a.y)},getMapObjectPixelFromMapObjectLonLat:function(a){return this.mapObject.LatLongToPixel(a)},getLongitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.Longitude,a.Latitude).lon:a.Longitude},getLatitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.Longitude,a.Latitude).lat:a.Latitude},getMapObjectLonLatFromLonLat:function(f,b){var c;if(this.sphericalMercator){var a=this.inverseMercator(f,b);c=new VELatLong(a.lat,a.lon)}else{c=new VELatLong(b,f)}return c},getXFromMapObjectPixel:function(a){return a.x},getYFromMapObjectPixel:function(a){return a.y},getMapObjectPixelFromXY:function(a,b){return(typeof VEPixel!="undefined")?new VEPixel(a,b):new Msn.VE.Pixel(a,b)},CLASS_NAME:"OpenLayers.Layer.VirtualEarth"});OpenLayers.Layer.Yahoo=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:0,MAX_ZOOM_LEVEL:17,RESOLUTIONS:[1.40625,0.703125,0.3515625,0.17578125,0.087890625,0.0439453125,0.02197265625,0.010986328125,0.0054931640625,0.00274658203125,0.001373291015625,0.0006866455078125,0.00034332275390625,0.000171661376953125,0.0000858306884765625,0.00004291534423828125,0.00002145767211914062,0.00001072883605957031],type:null,sphericalMercator:false,initialize:function(b,a){OpenLayers.Layer.EventPane.prototype.initialize.apply(this,arguments);OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,arguments);if(this.sphericalMercator){OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator);this.initMercatorParameters()}},loadMapObject:function(){try{var a=this.getMapObjectSizeFromOLSize(this.map.getSize());this.mapObject=new YMap(this.div,this.type,a);this.mapObject.disableKeyControls();this.mapObject.disableDragMap();if(!this.mapObject.moveByXY||(typeof this.mapObject.moveByXY!="function")){this.dragPanMapObject=null}}catch(b){}},onMapResize:function(){try{var a=this.getMapObjectSizeFromOLSize(this.map.getSize());this.mapObject.resizeTo(a)}catch(b){}},setMap:function(a){OpenLayers.Layer.EventPane.prototype.setMap.apply(this,arguments);this.map.events.register("moveend",this,this.fixYahooEventPane)},fixYahooEventPane:function(){var a=OpenLayers.Util.getElement("ygddfdiv");if(a!=null){if(a.parentNode!=null){a.parentNode.removeChild(a)}this.map.events.unregister("moveend",this,this.fixYahooEventPane)}},getWarningHTML:function(){return OpenLayers.i18n("getLayerWarning",{layerType:"Yahoo",layerLib:"Yahoo"})},getOLZoomFromMapObjectZoom:function(a){var b=null;if(a!=null){b=OpenLayers.Layer.FixedZoomLevels.prototype.getOLZoomFromMapObjectZoom.apply(this,[a]);b=18-b}return b},getMapObjectZoomFromOLZoom:function(a){var b=null;if(a!=null){b=OpenLayers.Layer.FixedZoomLevels.prototype.getMapObjectZoomFromOLZoom.apply(this,[a]);b=18-b}return b},setMapObjectCenter:function(a,b){this.mapObject.drawZoomAndCenter(a,b)},getMapObjectCenter:function(){return this.mapObject.getCenterLatLon()},dragPanMapObject:function(b,a){this.mapObject.moveByXY({x:-b,y:a})},getMapObjectZoom:function(){return this.mapObject.getZoomLevel()},getMapObjectLonLatFromMapObjectPixel:function(a){return this.mapObject.convertXYLatLon(a)},getMapObjectPixelFromMapObjectLonLat:function(a){return this.mapObject.convertLatLonXY(a)},getLongitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.Lon,a.Lat).lon:a.Lon},getLatitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.Lon,a.Lat).lat:a.Lat},getMapObjectLonLatFromLonLat:function(f,c){var a;if(this.sphericalMercator){var b=this.inverseMercator(f,c);a=new YGeoPoint(b.lat,b.lon)}else{a=new YGeoPoint(c,f)}return a},getXFromMapObjectPixel:function(a){return a.x},getYFromMapObjectPixel:function(a){return a.y},getMapObjectPixelFromXY:function(a,b){return new YCoordPoint(a,b)},getMapObjectSizeFromOLSize:function(a){return new YSize(a.w,a.h)},CLASS_NAME:"OpenLayers.Layer.Yahoo"});OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:false,initialize:function(f,c,g,b){var a=arguments;a=[f,b];OpenLayers.Layer.prototype.initialize.apply(this,a);this.url=c;this.params=OpenLayers.Util.extend({},g)},destroy:function(){this.url=null;this.params=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(a){if(a==null){a=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.options)}a=OpenLayers.Layer.prototype.clone.apply(this,[a]);return a},setUrl:function(a){this.url=a},mergeNewParams:function(a){this.params=OpenLayers.Util.extend(this.params,a);return this.redraw()},redraw:function(a){if(a){return this.mergeNewParams({_olSalt:Math.random()})}else{return OpenLayers.Layer.prototype.redraw.apply(this,[])}},selectUrl:function(g,f){var c=1;for(var b=0,a=g.length;b<a;b++){c*=g.charCodeAt(b)*this.URL_HASH_FACTOR;c-=Math.floor(c)}return f[Math.floor(c*f.length)]},getFullRequestString:function(k,g){var b=g||this.url;var l=OpenLayers.Util.extend({},this.params);l=OpenLayers.Util.extend(l,k);var a=OpenLayers.Util.getParameterString(l);if(b instanceof Array){b=this.selectUrl(a,b)}var f=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(b));for(var m in l){if(m.toUpperCase() in f){delete l[m]}}a=OpenLayers.Util.getParameterString(l);var o=b;if(a!=""){var c=b.charAt(b.length-1);if((c=="&")||(c=="?")){o+=a}else{if(b.indexOf("?")==-1){o+="?"+a}else{o+="&"+a}}}return o},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"});OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,grid:null,singleTile:false,ratio:1.5,buffer:2,numLoadingTiles:0,initialize:function(c,b,f,a){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments);this.events.addEventType("tileloaded");this.grid=[]},destroy:function(){this.clearGrid();this.grid=null;this.tileSize=null;OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.grid){for(var k=0,b=this.grid.length;k<b;k++){var g=this.grid[k];for(var c=0,a=g.length;c<a;c++){var f=g[c];this.removeTileMonitoringHooks(f);f.destroy()}}this.grid=[]}},clone:function(a){if(a==null){a=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.options)}a=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[a]);if(this.tileSize!=null){a.tileSize=this.tileSize.clone()}a.grid=[];return a},moveTo:function(f,a,g){OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments);f=f||this.map.getExtent();if(f!=null){var c=!this.grid.length||a;var b=this.getTilesBounds();if(this.singleTile){if(c||(!g&&!b.containsBounds(f))){this.initSingleTile(f)}}else{if(c||!b.containsBounds(f,true)){this.initGriddedTiles(f)}else{this.moveGriddedTiles(f)}}}},setTileSize:function(a){if(this.singleTile){a=this.map.getSize().clone();a.h=parseInt(a.h*this.ratio);a.w=parseInt(a.w*this.ratio)}OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[a])},getGridBounds:function(){var a="The getGridBounds() function is deprecated. It will be removed in 3.0. Please use getTilesBounds() instead.";OpenLayers.Console.warn(a);return this.getTilesBounds()},getTilesBounds:function(){var g=null;if(this.grid.length){var a=this.grid.length-1;var f=this.grid[a][0];var b=this.grid[0].length-1;var c=this.grid[0][b];g=new OpenLayers.Bounds(f.bounds.left,f.bounds.bottom,c.bounds.right,c.bounds.top)}return g},initSingleTile:function(k){var a=k.getCenterLonLat();var m=k.getWidth()*this.ratio;var b=k.getHeight()*this.ratio;var l=new OpenLayers.Bounds(a.lon-(m/2),a.lat-(b/2),a.lon+(m/2),a.lat+(b/2));var f=new OpenLayers.LonLat(l.left,l.top);var c=this.map.getLayerPxFromLonLat(f);if(!this.grid.length){this.grid[0]=[]}var g=this.grid[0][0];if(!g){g=this.addTile(l,c);this.addTileMonitoringHooks(g);g.draw();this.grid[0][0]=g}else{g.moveTo(l,c)}this.removeExcessTiles(1,1)},calculateGridLayout:function(a,A,g){var q=g*this.tileSize.w;var c=g*this.tileSize.h;var o=a.left-A.left;var r=Math.floor(o/q)-this.buffer;var p=o/q-r;var k=-p*this.tileSize.w;var u=A.left+r*q;var b=a.top-(A.bottom+c);var m=Math.ceil(b/c)+this.buffer;var v=m-b/c;var f=-v*this.tileSize.h;var l=A.bottom+m*c;return{tilelon:q,tilelat:c,tileoffsetlon:u,tileoffsetlat:l,tileoffsetx:k,tileoffsety:f}},initGriddedTiles:function(o){var l=this.map.getSize();var H=Math.ceil(l.h/this.tileSize.h)+Math.max(1,2*this.buffer);var J=Math.ceil(l.w/this.tileSize.w)+Math.max(1,2*this.buffer);var A=this.maxExtent;var D=this.map.getResolution();var C=this.calculateGridLayout(o,A,D);var k=Math.round(C.tileoffsetx);var c=Math.round(C.tileoffsety);var q=C.tileoffsetlon;var v=C.tileoffsetlat;var g=C.tilelon;var p=C.tilelat;this.origin=new OpenLayers.Pixel(k,c);var G=k;var I=q;var F=0;var a=parseInt(this.map.layerContainerDiv.style.left);var E=parseInt(this.map.layerContainerDiv.style.top);do{var m=this.grid[F++];if(!m){m=[];this.grid.push(m)}q=I;k=G;var f=0;do{var b=new OpenLayers.Bounds(q,v,q+g,v+p);var u=k;u-=a;var r=c;r-=E;var B=new OpenLayers.Pixel(u,r);var K=m[f++];if(!K){K=this.addTile(b,B);this.addTileMonitoringHooks(K);m.push(K)}else{K.moveTo(b,B,false)}q+=g;k+=this.tileSize.w}while((q<=o.right+g*this.buffer)||f<J);v-=p;c+=this.tileSize.h}while((v>=o.bottom-p*this.buffer)||F<H);this.removeExcessTiles(F,f);this.spiralTileLoad()},spiralTileLoad:function(){var b=[];var m=["right","down","left","up"];var l=0;var a=-1;var p=OpenLayers.Util.indexOf(m,"right");var q=0;while(q<m.length){var o=l;var c=a;switch(m[p]){case"right":c++;break;case"down":o++;break;case"left":c--;break;case"up":o--;break}var k=null;if((o<this.grid.length)&&(o>=0)&&(c<this.grid[0].length)&&(c>=0)){k=this.grid[o][c]}if((k!=null)&&(!k.queued)){b.unshift(k);k.queued=true;q=0;l=o;a=c}else{p=(p+1)%4;q++}}for(var f=0,g=b.length;f<g;f++){var k=b[f];k.draw();k.queued=false}},addTile:function(b,a){},addTileMonitoringHooks:function(a){a.onLoadStart=function(){if(this.numLoadingTiles==0){this.events.triggerEvent("loadstart")}this.numLoadingTiles++};a.events.register("loadstart",this,a.onLoadStart);a.onLoadEnd=function(){this.numLoadingTiles--;this.events.triggerEvent("tileloaded");if(this.numLoadingTiles==0){this.events.triggerEvent("loadend")}};a.events.register("loadend",this,a.onLoadEnd);a.events.register("unload",this,a.onLoadEnd)},removeTileMonitoringHooks:function(a){a.unload();a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,scope:this})},moveGriddedTiles:function(c){var b=this.buffer||1;while(true){var a=this.grid[0][0].position;var f=this.map.getViewPortPxFromLayerPx(a);if(f.x>-this.tileSize.w*(b-1)){this.shiftColumn(true)}else{if(f.x<-this.tileSize.w*b){this.shiftColumn(false)}else{if(f.y>-this.tileSize.h*(b-1)){this.shiftRow(true)}else{if(f.y<-this.tileSize.h*b){this.shiftRow(false)}else{break}}}}}},shiftRow:function(u){var c=(u)?0:(this.grid.length-1);var b=this.grid;var k=b[c];var g=this.map.getResolution();var m=(u)?-this.tileSize.h:this.tileSize.h;var l=g*-m;var r=(u)?b.pop():b.shift();for(var o=0,q=k.length;o<q;o++){var f=k[o];var a=f.bounds.clone();var p=f.position.clone();a.bottom=a.bottom+l;a.top=a.top+l;p.y=p.y+m;r[o].moveTo(a,p)}if(u){b.unshift(r)}else{b.push(r)}},shiftColumn:function(r){var f=(r)?-this.tileSize.w:this.tileSize.w;var c=this.map.getResolution();var p=c*f;for(var g=0,l=this.grid.length;g<l;g++){var q=this.grid[g];var o=(r)?0:(q.length-1);var b=q[o];var a=b.bounds.clone();var k=b.position.clone();a.left=a.left+p;a.right=a.right+p;k.x=k.x+f;var m=r?this.grid[g].pop():this.grid[g].shift();m.moveTo(a,k);if(r){q.unshift(m)}else{q.push(m)}}},removeExcessTiles:function(g,c){while(this.grid.length>g){var k=this.grid.pop();for(var b=0,a=k.length;b<a;b++){var f=k[b];this.removeTileMonitoringHooks(f);f.destroy()}}while(this.grid[0].length>c){for(var b=0,a=this.grid.length;b<a;b++){var k=this.grid[b];var f=k.pop();this.removeTileMonitoringHooks(f);f.destroy()}}},onMapResize:function(){if(this.singleTile){this.clearGrid();this.setTileSize()}},getTileBounds:function(f){var c=this.maxExtent;var k=this.getResolution();var g=k*this.tileSize.w;var b=k*this.tileSize.h;var m=this.getLonLatFromViewPortPx(f);var a=c.left+(g*Math.floor((m.lon-c.left)/g));var l=c.bottom+(b*Math.floor((m.lat-c.bottom)/b));return new OpenLayers.Bounds(a,l,a+g,l+b)},CLASS_NAME:"OpenLayers.Layer.Grid"});OpenLayers.Layer.MapGuide=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,useHttpTile:false,singleTile:false,useOverlay:false,useAsyncOverlay:true,TILE_PARAMS:{operation:"GETTILEIMAGE",version:"1.2.0"},SINGLE_TILE_PARAMS:{operation:"GETMAPIMAGE",format:"PNG",locale:"en",clip:"1",version:"1.0.0"},OVERLAY_PARAMS:{operation:"GETDYNAMICMAPOVERLAYIMAGE",format:"PNG",locale:"en",clip:"1",version:"2.0.0"},FOLDER_PARAMS:{tileColumnsPerFolder:30,tileRowsPerFolder:30,format:"png",querystring:null},defaultSize:new OpenLayers.Size(300,300),initialize:function(c,b,f,a){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments);if(a==null||a.isBaseLayer==null){this.isBaseLayer=((this.transparent!="true")&&(this.transparent!=true))}if(a&&a.useOverlay!=null){this.useOverlay=a.useOverlay}if(this.singleTile){if(this.useOverlay){OpenLayers.Util.applyDefaults(this.params,this.OVERLAY_PARAMS);if(!this.useAsyncOverlay){this.params.version="1.0.0"}}else{OpenLayers.Util.applyDefaults(this.params,this.SINGLE_TILE_PARAMS)}}else{if(this.useHttpTile){OpenLayers.Util.applyDefaults(this.params,this.FOLDER_PARAMS)}else{OpenLayers.Util.applyDefaults(this.params,this.TILE_PARAMS)}this.setTileSize(this.defaultSize)}},clone:function(a){if(a==null){a=new OpenLayers.Layer.MapGuide(this.name,this.url,this.params,this.options)}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},addTile:function(b,a){return new OpenLayers.Tile.Image(this,a,b,null,this.tileSize)},getURL:function(a){var f;var b=a.getCenterLonLat();var m=this.map.getCurrentSize();if(this.singleTile){var g={setdisplaydpi:OpenLayers.DOTS_PER_INCH,setdisplayheight:m.h*this.ratio,setdisplaywidth:m.w*this.ratio,setviewcenterx:b.lon,setviewcentery:b.lat,setviewscale:this.map.getScale()};if(this.useOverlay&&!this.useAsyncOverlay){var o={};o=OpenLayers.Util.extend(o,g);o.operation="GETVISIBLEMAPEXTENT";o.version="1.0.0";o.session=this.params.session;o.mapName=this.params.mapName;o.format="text/xml";f=this.getFullRequestString(o);OpenLayers.Request.GET({url:f,async:false})}f=this.getFullRequestString(g)}else{var l=this.map.getResolution();var k=Math.floor((a.left-this.maxExtent.left)/l);k=Math.round(k/this.tileSize.w);var c=Math.floor((this.maxExtent.top-a.top)/l);c=Math.round(c/this.tileSize.h);if(this.useHttpTile){f=this.getImageFilePath({tilecol:k,tilerow:c,scaleindex:this.resolutions.length-this.map.zoom-1})}else{f=this.getFullRequestString({tilecol:k,tilerow:c,scaleindex:this.resolutions.length-this.map.zoom-1})}}return f},getFullRequestString:function(k,g){var b=(g==null)?this.url:g;if(typeof b=="object"){b=b[Math.floor(Math.random()*b.length)]}var o=b;var l=OpenLayers.Util.extend({},this.params);l=OpenLayers.Util.extend(l,k);var f=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getArgs(b));for(var m in l){if(m.toUpperCase() in f){delete l[m]}}var a=OpenLayers.Util.getParameterString(l);a=a.replace(/,/g,"+");if(a!=""){var c=b.charAt(b.length-1);if((c=="&")||(c=="?")){o+=a}else{if(b.indexOf("?")==-1){o+="?"+a}else{o+="&"+a}}}return o},getImageFilePath:function(l,g){var c=(g==null)?this.url:g;if(typeof c=="object"){c=c[Math.floor(Math.random()*c.length)]}var b=c;var f="";var k="";if(l.tilerow<0){f="-"}if(l.tilerow==0){f+="0"}else{f+=Math.floor(Math.abs(l.tilerow/this.params.tileRowsPerFolder))*this.params.tileRowsPerFolder}if(l.tilecol<0){k="-"}if(l.tilecol==0){k+="0"}else{k+=Math.floor(Math.abs(l.tilecol/this.params.tileColumnsPerFolder))*this.params.tileColumnsPerFolder}var a="/S"+Math.floor(l.scaleindex)+"/"+this.params.basemaplayergroupname+"/R"+f+"/C"+k+"/"+(l.tilerow%this.params.tileRowsPerFolder)+"_"+(l.tilecol%this.params.tileColumnsPerFolder)+"."+this.params.format;if(this.params.querystring){a+="?"+this.params.querystring}b+=a;return b},calculateGridLayout:function(a,A,g){var q=g*this.tileSize.w;var c=g*this.tileSize.h;var o=a.left-A.left;var r=Math.floor(o/q)-this.buffer;var p=o/q-r;var k=-p*this.tileSize.w;var u=A.left+r*q;var b=A.top-a.top+c;var m=Math.floor(b/c)-this.buffer;var v=m-b/c;var f=v*this.tileSize.h;var l=A.top-c*m;return{tilelon:q,tilelat:c,tileoffsetlon:u,tileoffsetlat:l,tileoffsetx:k,tileoffsety:f}},CLASS_NAME:"OpenLayers.Layer.MapGuide"});OpenLayers.Layer.MapServer=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{mode:"map",map_imagetype:"png"},initialize:function(f,c,g,b){var a=[];a.push(f,c,g,b);OpenLayers.Layer.Grid.prototype.initialize.apply(this,a);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS);if(b==null||b.isBaseLayer==null){this.isBaseLayer=((this.params.transparent!="true")&&(this.params.transparent!=true))}},clone:function(a){if(a==null){a=new OpenLayers.Layer.MapServer(this.name,this.url,this.params,this.options)}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},addTile:function(b,a){return new OpenLayers.Tile.Image(this,a,b,null,this.tileSize)},getURL:function(c){c=this.adjustBounds(c);var b=[c.left,c.bottom,c.right,c.top];var f=this.getImageSize();var a=this.getFullRequestString({mapext:b,imgext:b,map_size:[f.w,f.h],imgx:f.w/2,imgy:f.h/2,imgxy:[f.w,f.h]});return a},getFullRequestString:function(k,g){var b=(g==null)?this.url:g;var l=OpenLayers.Util.extend({},this.params);l=OpenLayers.Util.extend(l,k);var a=OpenLayers.Util.getParameterString(l);if(b instanceof Array){b=this.selectUrl(a,b)}var f=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(b));for(var m in l){if(m.toUpperCase() in f){delete l[m]}}a=OpenLayers.Util.getParameterString(l);var o=b;a=a.replace(/,/g,"+");if(a!=""){var c=b.charAt(b.length-1);if((c=="&")||(c=="?")){o+=a}else{if(b.indexOf("?")==-1){o+="?"+a}else{o+="&"+a}}}return o},CLASS_NAME:"OpenLayers.Layer.MapServer"});OpenLayers.Layer.MapServer.Untiled=OpenLayers.Class(OpenLayers.Layer.MapServer,{singleTile:true,initialize:function(c,b,g,a){OpenLayers.Layer.MapServer.prototype.initialize.apply(this,arguments);var f="The OpenLayers.Layer.MapServer.Untiled class is deprecated and will be removed in 3.0. Instead, you should use the normal OpenLayers.Layer.MapServer class, passing it the option 'singleTile' as true.";OpenLayers.Console.warn(f)},clone:function(a){if(a==null){a=new OpenLayers.Layer.MapServer.Untiled(this.name,this.url,this.params,this.options)}a=OpenLayers.Layer.MapServer.prototype.clone.apply(this,[a]);return a},CLASS_NAME:"OpenLayers.Layer.MapServer.Untiled"});OpenLayers.Layer.KaMap=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,units:null,resolution:OpenLayers.DOTS_PER_INCH,DEFAULT_PARAMS:{i:"jpeg",map:""},initialize:function(f,c,g,b){var a=[];a.push(f,c,g,b);OpenLayers.Layer.Grid.prototype.initialize.apply(this,a);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getURL:function(c){c=this.adjustBounds(c);var f=this.map.getResolution();var g=Math.round((this.map.getScale()*10000))/10000;var b=Math.round(c.left/f);var a=-Math.round(c.top/f);return this.getFullRequestString({t:a,l:b,s:g})},addTile:function(c,a){var b=this.getURL(c);return new OpenLayers.Tile.Image(this,a,c,b,this.tileSize)},calculateGridLayout:function(a,A,g){var q=g*this.tileSize.w;var c=g*this.tileSize.h;var o=a.left;var r=Math.floor(o/q)-this.buffer;var p=o/q-r;var k=-p*this.tileSize.w;var u=r*q;var b=a.top;var m=Math.ceil(b/c)+this.buffer;var v=m-b/c;var f=-(v+1)*this.tileSize.h;var l=m*c;return{tilelon:q,tilelat:c,tileoffsetlon:u,tileoffsetlat:l,tileoffsetx:k,tileoffsety:f}},clone:function(a){if(a==null){a=new OpenLayers.Layer.KaMap(this.name,this.url,this.params,this.options)}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);if(this.tileSize!=null){a.tileSize=this.tileSize.clone()}a.grid=[];return a},getTileBounds:function(c){var g=this.getResolution();var f=g*this.tileSize.w;var b=g*this.tileSize.h;var l=this.getLonLatFromViewPortPx(c);var a=f*Math.floor(l.lon/f);var k=b*Math.floor(l.lat/b);return new OpenLayers.Bounds(a,k,a+f,k+b)},CLASS_NAME:"OpenLayers.Layer.KaMap"});OpenLayers.Layer.KaMapCache=OpenLayers.Class(OpenLayers.Layer.KaMap,{IMAGE_EXTENSIONS:{jpeg:"jpg",gif:"gif",png:"png",png8:"png",png24:"png",dithered:"png"},DEFAULT_FORMAT:"jpeg",initialize:function(c,b,f,a){OpenLayers.Layer.KaMap.prototype.initialize.apply(this,arguments);this.extension=this.IMAGE_EXTENSIONS[this.params.i.toLowerCase()||DEFAULT_FORMAT]},getURL:function(a){a=this.adjustBounds(a);var k=this.map.getResolution();var g=Math.round((this.map.getScale()*10000))/10000;var f=Math.round(a.left/k);var c=-Math.round(a.top/k);var o=Math.floor(f/this.tileSize.w/this.params.metaTileSize.w)*this.tileSize.w*this.params.metaTileSize.w;var m=Math.floor(c/this.tileSize.h/this.params.metaTileSize.h)*this.tileSize.h*this.params.metaTileSize.h;var b=this.url;if(b instanceof Array){b=this.selectUrl(paramsString,b)}var l=[b,"/",this.params.map,"/",g,"/",this.params.g.replace(/\s/g,"_"),"/def/t",m,"/l",o,"/t",c,"l",f,".",this.extension];return l.join("")},CLASS_NAME:"OpenLayers.Layer.KaMapCache"});OpenLayers.Layer.MultiMap=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:1,MAX_ZOOM_LEVEL:17,RESOLUTIONS:[9,1.40625,0.703125,0.3515625,0.17578125,0.087890625,0.0439453125,0.02197265625,0.010986328125,0.0054931640625,0.00274658203125,0.001373291015625,0.0006866455078125,0.00034332275390625,0.000171661376953125,0.0000858306884765625,0.00004291534423828125],type:null,initialize:function(b,a){OpenLayers.Layer.EventPane.prototype.initialize.apply(this,arguments);OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,arguments);if(this.sphericalMercator){OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator);this.initMercatorParameters();this.RESOLUTIONS.unshift(10)}},loadMapObject:function(){try{this.mapObject=new MultimapViewer(this.div)}catch(a){}},getWarningHTML:function(){return OpenLayers.i18n("getLayerWarning",{layerType:"MM",layerLib:"MultiMap"})},setMapObjectCenter:function(a,b){this.mapObject.goToPosition(a,b)},getMapObjectCenter:function(){return this.mapObject.getCurrentPosition()},getMapObjectZoom:function(){return this.mapObject.getZoomFactor()},getMapObjectLonLatFromMapObjectPixel:function(a){a.x=a.x-(this.map.getSize().w/2);a.y=a.y-(this.map.getSize().h/2);return this.mapObject.getMapPositionAt(a)},getMapObjectPixelFromMapObjectLonLat:function(a){return this.mapObject.geoPosToContainerPixels(a)},getLongitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.lon,a.lat).lon:a.lon},getLatitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.lon,a.lat).lat:a.lat},getMapObjectLonLatFromLonLat:function(f,c){var a;if(this.sphericalMercator){var b=this.inverseMercator(f,c);a=new MMLatLon(b.lat,b.lon)}else{a=new MMLatLon(c,f)}return a},getXFromMapObjectPixel:function(a){return a.x},getYFromMapObjectPixel:function(a){return a.y},getMapObjectPixelFromXY:function(a,b){return new MMPoint(a,b)},CLASS_NAME:"OpenLayers.Layer.MultiMap"});OpenLayers.Layer.Markers=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:false,markers:null,drawn:false,initialize:function(b,a){OpenLayers.Layer.prototype.initialize.apply(this,arguments);this.markers=[]},destroy:function(){this.clearMarkers();this.markers=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setOpacity:function(b){if(b!=this.opacity){this.opacity=b;for(var c=0,a=this.markers.length;c<a;c++){this.markers[c].setOpacity(this.opacity)}}},moveTo:function(f,b,g){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);if(b||!this.drawn){for(var c=0,a=this.markers.length;c<a;c++){this.drawMarker(this.markers[c])}this.drawn=true}},addMarker:function(a){this.markers.push(a);if(this.opacity!=null){a.setOpacity(this.opacity)}if(this.map&&this.map.getExtent()){a.map=this.map;this.drawMarker(a)}},removeMarker:function(a){if(this.markers&&this.markers.length){OpenLayers.Util.removeItem(this.markers,a);a.erase()}},clearMarkers:function(){if(this.markers!=null){while(this.markers.length>0){this.removeMarker(this.markers[0])}}},drawMarker:function(a){var b=this.map.getLayerPxFromLonLat(a.lonlat);if(b==null){a.display(false)}else{if(!a.isDrawn()){var c=a.draw(b);this.div.appendChild(c)}else{if(a.icon){a.icon.moveTo(b)}}}},getDataExtent:function(){var b=null;if(this.markers&&(this.markers.length>0)){var b=new OpenLayers.Bounds();for(var f=0,a=this.markers.length;f<a;f++){var c=this.markers[f];b.extend(c.lonlat)}}return b},CLASS_NAME:"OpenLayers.Layer.Markers"});OpenLayers.Layer.Text=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,initialize:function(b,a){OpenLayers.Layer.Markers.prototype.initialize.apply(this,arguments);this.features=new Array()},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments);this.clearFeatures();this.features=null},loadText:function(){if(!this.loaded){if(this.location!=null){var a=function(b){this.events.triggerEvent("loadend")};this.events.triggerEvent("loadstart");OpenLayers.Request.GET({url:this.location,success:this.parseData,failure:a,scope:this});this.loaded=true}}},moveTo:function(c,a,b){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments);if(this.visibility&&!this.loaded){this.loadText()}},parseData:function(p){var r=p.responseText;var v={};OpenLayers.Util.extend(v,this.formatOptions);if(this.map&&!this.projection.equals(this.map.getProjectionObject())){v.externalProjection=this.projection;v.internalProjection=this.map.getProjectionObject()}var b=new OpenLayers.Format.Text(v);var c=b.read(r);for(var l=0,m=c.length;l<m;l++){var k={};var u=c[l];var q;var o,f;q=new OpenLayers.LonLat(u.geometry.x,u.geometry.y);if(u.style.graphicWidth&&u.style.graphicHeight){o=new OpenLayers.Size(u.style.graphicWidth,u.style.graphicHeight)}if(u.style.graphicXOffset!==undefined&&u.style.graphicYOffset!==undefined){f=new OpenLayers.Pixel(u.style.graphicXOffset,u.style.graphicYOffset)}if(u.style.externalGraphic!=null){k.icon=new OpenLayers.Icon(u.style.externalGraphic,o,f)}else{k.icon=OpenLayers.Marker.defaultIcon();if(o!=null){k.icon.setSize(o)}}if((u.attributes.title!=null)&&(u.attributes.description!=null)){k.popupContentHTML="<h2>"+u.attributes.title+"</h2><p>"+u.attributes.description+"</p>"}k.overflow=u.attributes.overflow||"auto";var a=new OpenLayers.Feature(this,q,k);this.features.push(a);var g=a.createMarker();if((u.attributes.title!=null)&&(u.attributes.description!=null)){g.events.register("click",a,this.markerClick)}this.addMarker(g)}this.events.triggerEvent("loadend")},markerClick:function(b){var f=(this==this.layer.selectedFeature);this.layer.selectedFeature=(!f)?this:null;for(var c=0,a=this.layer.map.popups.length;c<a;c++){this.layer.map.removePopup(this.layer.map.popups[c])}if(!f){this.layer.map.addPopup(this.createPopup())}OpenLayers.Event.stop(b)},clearFeatures:function(){if(this.features!=null){while(this.features.length>0){var a=this.features[0];OpenLayers.Util.removeItem(this.features,a);a.destroy()}}},CLASS_NAME:"OpenLayers.Layer.Text"});OpenLayers.Layer.WorldWind=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{},isBaseLayer:true,lzd:null,zoomLevels:null,initialize:function(f,c,g,l,k,b){this.lzd=g;this.zoomLevels=l;var a=[];a.push(f,c,k,b);OpenLayers.Layer.Grid.prototype.initialize.apply(this,a);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},addTile:function(b,a){return new OpenLayers.Tile.Image(this,a,b,null,this.tileSize)},getZoom:function(){var b=this.map.getZoom();var a=this.map.getMaxExtent();b=b-Math.log(this.maxResolution/(this.lzd/512))/Math.log(2);return b},getURL:function(g){g=this.adjustBounds(g);var f=this.getZoom();var b=this.map.getMaxExtent();var c=this.lzd/Math.pow(2,this.getZoom());var a=Math.floor((g.left-b.left)/c);var k=Math.floor((g.bottom-b.bottom)/c);if(this.map.getResolution()<=(this.lzd/512)&&this.getZoom()<=this.zoomLevels){return this.getFullRequestString({L:f,X:a,Y:k})}else{return OpenLayers.Util.getImagesLocation()+"blank.gif"}},CLASS_NAME:"OpenLayers.Layer.WorldWind"});OpenLayers.Layer.ArcGIS93Rest=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{format:"png"},isBaseLayer:true,initialize:function(f,c,g,b){var a=[];g=OpenLayers.Util.upperCaseObject(g);a.push(f,c,g,b);OpenLayers.Layer.Grid.prototype.initialize.apply(this,a);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));if(this.params.TRANSPARENT&&this.params.TRANSPARENT.toString().toLowerCase()=="true"){if((b==null)||(!b.isBaseLayer)){this.isBaseLayer=false}if(this.params.FORMAT=="jpg"){this.params.FORMAT=OpenLayers.Util.alphaHack()?"gif":"png"}}},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments)},clone:function(a){if(a==null){a=new OpenLayers.Layer.ArcGIS93Rest(this.name,this.url,this.params,this.options)}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},getURL:function(g){g=this.adjustBounds(g);var f=this.projection.getCode().split(":");var c=f[f.length-1];var l=this.getImageSize();var m={BBOX:g.toBBOX(),SIZE:l.w+","+l.h,F:"image",BBOXSR:c,IMAGESR:c};if(this.layerDefs){var k=[];var a;for(a in this.layerDefs){if(this.layerDefs.hasOwnProperty(a)){if(this.layerDefs[a]){k.push(a);k.push(":");k.push(this.layerDefs[a]);k.push(";")}}}if(k.length>0){m.LAYERDEFS=k.join("")}}var b=this.getFullRequestString(m);return b},setLayerFilter:function(b,a){if(!this.layerDefs){this.layerDefs={}}if(a){this.layerDefs[b]=a}else{delete this.layerDefs[b]}},clearLayerFilter:function(a){if(a){delete this.layerDefs[a]}else{delete this.layerDefs}},mergeNewParams:function(c){var b=OpenLayers.Util.upperCaseObject(c);var a=[b];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,a)},addTile:function(b,a){return new OpenLayers.Tile.Image(this,a,b,null,this.tileSize)},CLASS_NAME:"OpenLayers.Layer.ArcGIS93Rest"});OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",exceptions:"application/vnd.ogc.se_inimage",format:"image/jpeg"},reproject:false,isBaseLayer:true,encodeBBOX:false,noMagic:false,initialize:function(f,c,g,b){var a=[];g=OpenLayers.Util.upperCaseObject(g);a.push(f,c,g,b);OpenLayers.Layer.Grid.prototype.initialize.apply(this,a);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));if(!this.noMagic&&this.params.TRANSPARENT&&this.params.TRANSPARENT.toString().toLowerCase()=="true"){if((b==null)||(!b.isBaseLayer)){this.isBaseLayer=false}if(this.params.FORMAT=="image/jpeg"){this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png"}}},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments)},clone:function(a){if(a==null){a=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.options)}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},getURL:function(b){b=this.adjustBounds(b);var c=this.getImageSize();var f={BBOX:this.encodeBBOX?b.toBBOX():b.toArray(),WIDTH:c.w,HEIGHT:c.h};var a=this.getFullRequestString(f);return a},addTile:function(b,a){return new OpenLayers.Tile.Image(this,a,b,null,this.tileSize)},mergeNewParams:function(c){var b=OpenLayers.Util.upperCaseObject(c);var a=[b];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,a)},getFullRequestString:function(c,b){var a=this.map.getProjection();this.params.SRS=(a=="none")?null:a;return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.WMS"});OpenLayers.Layer.WMS.Untiled=OpenLayers.Class(OpenLayers.Layer.WMS,{singleTile:true,initialize:function(c,b,g,a){OpenLayers.Layer.WMS.prototype.initialize.apply(this,arguments);var f="The OpenLayers.Layer.WMS.Untiled class is deprecated and will be removed in 3.0. Instead, you should use the normal OpenLayers.Layer.WMS class, passing it the option 'singleTile' as true.";OpenLayers.Console.warn(f)},clone:function(a){if(a==null){a=new OpenLayers.Layer.WMS.Untiled(this.name,this.url,this.params,this.options)}a=OpenLayers.Layer.WMS.prototype.clone.apply(this,[a]);return a},CLASS_NAME:"OpenLayers.Layer.WMS.Untiled"});OpenLayers.Layer.ArcIMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{ClientVersion:"9.2",ServiceName:""},tileSize:null,featureCoordSys:"4326",filterCoordSys:"4326",layers:null,async:true,name:"ArcIMS",isBaseLayer:true,DEFAULT_OPTIONS:{tileSize:new OpenLayers.Size(512,512),featureCoordSys:"4326",filterCoordSys:"4326",layers:null,isBaseLayer:true,async:true,name:"ArcIMS"},initialize:function(c,b,a){this.tileSize=new OpenLayers.Size(512,512);this.params=OpenLayers.Util.applyDefaults({ServiceName:a.serviceName},this.DEFAULT_PARAMS);this.options=OpenLayers.Util.applyDefaults(a,this.DEFAULT_OPTIONS);OpenLayers.Layer.Grid.prototype.initialize.apply(this,[c,b,this.params,a]);if(this.transparent){if(!this.isBaseLayer){this.isBaseLayer=false}if(this.format=="image/jpeg"){this.format=OpenLayers.Util.alphaHack()?"image/gif":"image/png"}}if(this.options.layers===null){this.options.layers=[]}},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments)},getURL:function(f){var a="";f=this.adjustBounds(f);var c=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:"image",envelope:f.toArray(),tileSize:this.tileSize}));var b=new OpenLayers.Request.POST({url:this.getFullRequestString(),data:c.write(),async:false});if(b!=null){var k=b.responseXML;if(!k||!k.documentElement){k=b.responseText}var g=new OpenLayers.Format.ArcXML();var l=g.read(k);a=this.getUrlOrImage(l.image.output)}return a},getURLasync:function(c,a,g,f){c=this.adjustBounds(c);var b=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:"image",envelope:c.toArray(),tileSize:this.tileSize}));OpenLayers.Request.POST({url:this.getFullRequestString(),async:true,data:b.write(),callback:function(k){var m=k.responseXML;if(!m||!m.documentElement){m=k.responseText}var l=new OpenLayers.Format.ArcXML();var o=l.read(m);a[g]=this.getUrlOrImage(o.image.output);f.apply(a)},scope:this})},getUrlOrImage:function(a){var b="";if(a.url){b=a.url}else{if(a.data){b="data:image/"+a.type+";base64,"+a.data}}return b},setLayerQuery:function(c,a){for(var b=0;b<this.options.layers.length;b++){if(c==this.options.layers[b].id){this.options.layers[b].query=a;return}}this.options.layers.push({id:c,visible:true,query:a})},getFeatureInfo:function(m,k,q){var b=q.buffer||1;var o=q.callback||function(){};var p=q.scope||window;var a={};OpenLayers.Util.extend(a,this.options);a.requesttype="feature";if(m instanceof OpenLayers.LonLat){a.polygon=null;a.envelope=[m.lon-b,m.lat-b,m.lon+b,m.lat+b]}else{if(m instanceof OpenLayers.Geometry.Polygon){a.envelope=null;a.polygon=m}}var g=new OpenLayers.Format.ArcXML(a);OpenLayers.Util.extend(g.request.get_feature,q);g.request.get_feature.layer=k.id;if(typeof k.query.accuracy=="number"){g.request.get_feature.query.accuracy=k.query.accuracy}else{var l=this.map.getCenter();var f=this.map.getViewPortPxFromLonLat(l);f.x++;var c=this.map.getLonLatFromPixel(f);g.request.get_feature.query.accuracy=c.lon-l.lon}g.request.get_feature.query.where=k.query.where;g.request.get_feature.query.spatialfilter.relation="area_intersection";OpenLayers.Request.POST({url:this.getFullRequestString({CustomService:"Query"}),data:g.write(),callback:function(u){var r=g.parseResponse(u.responseText);if(!g.iserror()){o.call(p,r.features)}else{o.call(p,null)}}})},addTile:function(b,a){return new OpenLayers.Tile.Image(this,a,b,null,this.tileSize)},CLASS_NAME:"OpenLayers.Layer.ArcIMS"});OpenLayers.Layer.GeoRSS=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,icon:null,popupSize:null,useFeedTitle:true,initialize:function(c,a,b){OpenLayers.Layer.Markers.prototype.initialize.apply(this,[c,b]);this.location=a;this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments);this.clearFeatures();this.features=null},loadRSS:function(){if(!this.loaded){this.events.triggerEvent("loadstart");OpenLayers.Request.GET({url:this.location,success:this.parseData,scope:this});this.loaded=true}},moveTo:function(c,a,b){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments);if(this.visibility&&!this.loaded){this.loadRSS()}},parseData:function(o){var u=o.responseXML;if(!u||!u.documentElement){u=OpenLayers.Format.XML.prototype.read(o.responseText)}if(this.useFeedTitle){var a=null;try{a=u.getElementsByTagNameNS("*","title")[0].firstChild.nodeValue}catch(m){a=u.getElementsByTagName("title")[0].firstChild.nodeValue}if(a){this.setName(a)}}var C={};OpenLayers.Util.extend(C,this.formatOptions);if(this.map&&!this.projection.equals(this.map.getProjectionObject())){C.externalProjection=this.projection;C.internalProjection=this.map.getProjectionObject()}var v=new OpenLayers.Format.GeoRSS(C);var b=v.read(u);for(var k=0,l=b.length;k<l;k++){var g={};var B=b[k];if(!B.geometry){continue}var q=B.attributes.title?B.attributes.title:"Untitled";var A=B.attributes.description?B.attributes.description:"No description.";var p=B.attributes.link?B.attributes.link:"";var r=B.geometry.getBounds().getCenterLonLat();g.icon=this.icon==null?OpenLayers.Marker.defaultIcon():this.icon.clone();g.popupSize=this.popupSize?this.popupSize.clone():new OpenLayers.Size(250,120);if(q||A){g.title=q;g.description=A;var c='<div class="olLayerGeoRSSClose">[x]</div>';c+='<div class="olLayerGeoRSSTitle">';if(p){c+='<a class="link" href="'+p+'" target="_blank">'}c+=q;if(p){c+="</a>"}c+="</div>";c+='<div style="" class="olLayerGeoRSSDescription">';c+=A;c+="</div>";g.popupContentHTML=c}var B=new OpenLayers.Feature(this,r,g);this.features.push(B);var f=B.createMarker();f.events.register("click",B,this.markerClick);this.addMarker(f)}this.events.triggerEvent("loadend")},markerClick:function(c){var g=(this==this.layer.selectedFeature);this.layer.selectedFeature=(!g)?this:null;for(var f=0,a=this.layer.map.popups.length;f<a;f++){this.layer.map.removePopup(this.layer.map.popups[f])}if(!g){var b=this.createPopup();OpenLayers.Event.observe(b.div,"click",OpenLayers.Function.bind(function(){for(var l=0,k=this.layer.map.popups.length;l<k;l++){this.layer.map.removePopup(this.layer.map.popups[l])}},this));this.layer.map.addPopup(b)}OpenLayers.Event.stop(c)},clearFeatures:function(){if(this.features!=null){while(this.features.length>0){var a=this.features[0];OpenLayers.Util.removeItem(this.features,a);a.destroy()}}},CLASS_NAME:"OpenLayers.Layer.GeoRSS"});OpenLayers.Layer.Boxes=OpenLayers.Class(OpenLayers.Layer.Markers,{initialize:function(b,a){OpenLayers.Layer.Markers.prototype.initialize.apply(this,arguments)},drawMarker:function(a){var f=a.bounds;var k=this.map.getLayerPxFromLonLat(new OpenLayers.LonLat(f.left,f.top));var c=this.map.getLayerPxFromLonLat(new OpenLayers.LonLat(f.right,f.bottom));if(c==null||k==null){a.display(false)}else{var g=new OpenLayers.Size(Math.max(1,c.x-k.x),Math.max(1,c.y-k.y));var b=a.draw(k,g);if(!a.drawn){this.div.appendChild(b);a.drawn=true}}},removeMarker:function(a){OpenLayers.Util.removeItem(this.markers,a);if((a.div!=null)&&(a.div.parentNode==this.div)){this.div.removeChild(a.div)}},CLASS_NAME:"OpenLayers.Layer.Boxes"});OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,sphericalMercator:false,initialize:function(f,c,b){if(b&&b.sphericalMercator||this.sphericalMercator){b=OpenLayers.Util.extend({maxExtent:new OpenLayers.Bounds(-128*156543.0339,-128*156543.0339,128*156543.0339,128*156543.0339),maxResolution:156543.0339,numZoomLevels:19,units:"m",projection:"EPSG:900913"},b)}c=c||this.url;f=f||this.name;var a=[f,c,{},b];OpenLayers.Layer.Grid.prototype.initialize.apply(this,a)},clone:function(a){if(a==null){a=new OpenLayers.Layer.XYZ(this.name,this.url,this.options)}a=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[a]);if(this.tileSize!=null){a.tileSize=this.tileSize.clone()}a.grid=[];return a},getURL:function(a){var f=this.map.getResolution();var l=Math.round((a.left-this.maxExtent.left)/(f*this.tileSize.w));var k=Math.round((this.maxExtent.top-a.top)/(f*this.tileSize.h));var g=this.map.getZoom();var c=Math.pow(2,g);var b=this.url;var o=""+l+k+g;if(b instanceof Array){b=this.selectUrl(o,b)}var m=OpenLayers.String.format(b,{x:l,y:k,z:g});return m},addTile:function(b,a){return new OpenLayers.Tile.Image(this,a,b,null,this.tileSize)},setMap:function(a){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);if(!this.tileOrigin){this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom)}},CLASS_NAME:"OpenLayers.Layer.XYZ"});OpenLayers.Layer.OSM=OpenLayers.Class(OpenLayers.Layer.XYZ,{name:"OpenStreetMap",attribution:"Data CC-By-SA by <a href='http://openstreetmap.org/'>OpenStreetMap</a>",sphericalMercator:true,url:"http://tile.openstreetmap.org/${z}/${x}/${y}.png",CLASS_NAME:"OpenLayers.Layer.OSM"});OpenLayers.Layer.TMS=OpenLayers.Class(OpenLayers.Layer.Grid,{serviceVersion:"1.0.0",isBaseLayer:true,tileOrigin:null,serverResolutions:null,initialize:function(f,c,b){var a=[];a.push(f,c,{},b);OpenLayers.Layer.Grid.prototype.initialize.apply(this,a)},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments)},clone:function(a){if(a==null){a=new OpenLayers.Layer.TMS(this.name,this.url,this.options)}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},getURL:function(f){f=this.adjustBounds(f);var c=this.map.getResolution();var a=Math.round((f.left-this.tileOrigin.lon)/(c*this.tileSize.w));var l=Math.round((f.bottom-this.tileOrigin.lat)/(c*this.tileSize.h));var k=this.serverResolutions!=null?OpenLayers.Util.indexOf(this.serverResolutions,c):this.map.getZoom();var g=this.serviceVersion+"/"+this.layername+"/"+k+"/"+a+"/"+l+"."+this.type;var b=this.url;if(b instanceof Array){b=this.selectUrl(g,b)}return b+g},addTile:function(b,a){return new OpenLayers.Tile.Image(this,a,b,null,this.tileSize)},setMap:function(a){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);if(!this.tileOrigin){this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.bottom)}},CLASS_NAME:"OpenLayers.Layer.TMS"});OpenLayers.Layer.TileCache=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,format:"image/png",serverResolutions:null,initialize:function(c,b,f,a){this.layername=f;OpenLayers.Layer.Grid.prototype.initialize.apply(this,[c,b,{},a]);this.extension=this.format.split("/")[1].toLowerCase();this.extension=(this.extension=="jpg")?"jpeg":this.extension},clone:function(a){if(a==null){a=new OpenLayers.Layer.TileCache(this.name,this.url,this.layername,this.options)}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},getURL:function(b){var k=this.map.getResolution();var l=this.maxExtent;var q=this.tileSize;var a=Math.round((b.left-l.left)/(k*q.w));var p=Math.round((b.bottom-l.bottom)/(k*q.h));var m=this.serverResolutions!=null?OpenLayers.Util.indexOf(this.serverResolutions,k):this.map.getZoom();function g(A,v){A=String(A);var r=[];for(var u=0;u<v;++u){r.push("0")}return r.join("").substring(0,v-A.length)+A}var f=[this.layername,g(m,2),g(parseInt(a/1000000),3),g((parseInt(a/1000)%1000),3),g((parseInt(a)%1000),3),g(parseInt(p/1000000),3),g((parseInt(p/1000)%1000),3),g((parseInt(p)%1000),3)+"."+this.extension];var o=f.join("/");var c=this.url;if(c instanceof Array){c=this.selectUrl(o,c)}c=(c.charAt(c.length-1)=="/")?c:c+"/";return c+o},addTile:function(c,a){var b=this.getURL(c);return new OpenLayers.Tile.Image(this,a,c,b,this.tileSize)},CLASS_NAME:"OpenLayers.Layer.TileCache"});OpenLayers.Popup.Anchored=OpenLayers.Class(OpenLayers.Popup,{relativePosition:null,keepInMap:true,anchor:null,initialize:function(m,f,l,c,b,k,g){var a=[m,f,l,c,k,g];OpenLayers.Popup.prototype.initialize.apply(this,a);this.anchor=(b!=null)?b:{size:new OpenLayers.Size(0,0),offset:new OpenLayers.Pixel(0,0)}},destroy:function(){this.anchor=null;this.relativePosition=null;OpenLayers.Popup.prototype.destroy.apply(this,arguments)},show:function(){this.updatePosition();OpenLayers.Popup.prototype.show.apply(this,arguments)},moveTo:function(c){var b=this.relativePosition;this.relativePosition=this.calculateRelativePosition(c);var f=this.calculateNewPx(c);var a=new Array(f);OpenLayers.Popup.prototype.moveTo.apply(this,a);if(this.relativePosition!=b){this.updateRelativePosition()}},setSize:function(b){OpenLayers.Popup.prototype.setSize.apply(this,arguments);if((this.lonlat)&&(this.map)){var a=this.map.getLayerPxFromLonLat(this.lonlat);this.moveTo(a)}},calculateRelativePosition:function(b){var f=this.map.getLonLatFromLayerPx(b);var c=this.map.getExtent();var a=c.determineQuadrant(f);return OpenLayers.Bounds.oppositeQuadrant(a)},updateRelativePosition:function(){},calculateNewPx:function(b){var g=b.offset(this.anchor.offset);var a=this.size||this.contentSize;var f=(this.relativePosition.charAt(0)=="t");g.y+=(f)?-a.h:this.anchor.size.h;var c=(this.relativePosition.charAt(1)=="l");g.x+=(c)?-a.w:this.anchor.size.w;return g},CLASS_NAME:"OpenLayers.Popup.Anchored"});OpenLayers.Popup.AnchoredBubble=OpenLayers.Class(OpenLayers.Popup.Anchored,{rounded:false,initialize:function(l,c,k,b,a,g,f){this.padding=new OpenLayers.Bounds(0,OpenLayers.Popup.AnchoredBubble.CORNER_SIZE,0,OpenLayers.Popup.AnchoredBubble.CORNER_SIZE);OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments)},draw:function(a){OpenLayers.Popup.Anchored.prototype.draw.apply(this,arguments);this.setContentHTML();this.setBackgroundColor();this.setOpacity();return this.div},updateRelativePosition:function(){this.setRicoCorners()},setSize:function(a){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments);this.setRicoCorners()},setBackgroundColor:function(a){if(a!=undefined){this.backgroundColor=a}if(this.div!=null){if(this.contentDiv!=null){this.div.style.background="transparent";OpenLayers.Rico.Corner.changeColor(this.groupDiv,this.backgroundColor)}}},setOpacity:function(a){OpenLayers.Popup.Anchored.prototype.setOpacity.call(this,a);if(this.div!=null){if(this.groupDiv!=null){OpenLayers.Rico.Corner.changeOpacity(this.groupDiv,this.opacity)}}},setBorder:function(a){this.border=0},setRicoCorners:function(){var a=this.getCornersToRound(this.relativePosition);var b={corners:a,color:this.backgroundColor,bgColor:"transparent",blend:false};if(!this.rounded){OpenLayers.Rico.Corner.round(this.div,b);this.rounded=true}else{OpenLayers.Rico.Corner.reRound(this.groupDiv,b);this.setBackgroundColor();this.setOpacity()}},getCornersToRound:function(){var a=["tl","tr","bl","br"];var b=OpenLayers.Bounds.oppositeQuadrant(this.relativePosition);OpenLayers.Util.removeItem(a,b);return a.join(" ")},CLASS_NAME:"OpenLayers.Popup.AnchoredBubble"});OpenLayers.Popup.AnchoredBubble.CORNER_SIZE=5;OpenLayers.Popup.Framed=OpenLayers.Class(OpenLayers.Popup.Anchored,{imageSrc:null,imageSize:null,isAlphaImage:false,positionBlocks:null,blocks:null,fixedRelativePosition:false,initialize:function(l,c,k,b,a,g,f){OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments);if(this.fixedRelativePosition){this.updateRelativePosition();this.calculateRelativePosition=function(m){return this.relativePosition}}this.contentDiv.style.position="absolute";this.contentDiv.style.zIndex=1;if(g){this.closeDiv.style.zIndex=1}this.groupDiv.style.position="absolute";this.groupDiv.style.top="0px";this.groupDiv.style.left="0px";this.groupDiv.style.height="100%";this.groupDiv.style.width="100%"},destroy:function(){this.imageSrc=null;this.imageSize=null;this.isAlphaImage=null;this.fixedRelativePosition=false;this.positionBlocks=null;for(var a=0;a<this.blocks.length;a++){var b=this.blocks[a];if(b.image){b.div.removeChild(b.image)}b.image=null;if(b.div){this.groupDiv.removeChild(b.div)}b.div=null}this.blocks=null;OpenLayers.Popup.Anchored.prototype.destroy.apply(this,arguments)},setBackgroundColor:function(a){},setBorder:function(){},setOpacity:function(a){},setSize:function(a){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments);this.updateBlocks()},updateRelativePosition:function(){this.padding=this.positionBlocks[this.relativePosition].padding;if(this.closeDiv){var a=this.getContentDivPadding();this.closeDiv.style.right=a.right+this.padding.right+"px";this.closeDiv.style.top=a.top+this.padding.top+"px"}this.updateBlocks()},calculateNewPx:function(a){var b=OpenLayers.Popup.Anchored.prototype.calculateNewPx.apply(this,arguments);b=b.offset(this.positionBlocks[this.relativePosition].offset);return b},createBlocks:function(){this.blocks=[];var k=null;for(var g in this.positionBlocks){k=g;break}var a=this.positionBlocks[k];for(var f=0;f<a.blocks.length;f++){var m={};this.blocks.push(m);var b=this.id+"_FrameDecorationDiv_"+f;m.div=OpenLayers.Util.createDiv(b,null,null,null,"absolute",null,"hidden",null);var c=this.id+"_FrameDecorationImg_"+f;var l=(this.isAlphaImage)?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage;m.image=l(c,null,this.imageSize,this.imageSrc,"absolute",null,null,null);m.div.appendChild(m.image);this.groupDiv.appendChild(m.div)}},updateBlocks:function(){if(!this.blocks){this.createBlocks()}if(this.size&&this.relativePosition){var o=this.positionBlocks[this.relativePosition];for(var k=0;k<o.blocks.length;k++){var c=o.blocks[k];var g=this.blocks[k];var f=c.anchor.left;var p=c.anchor.bottom;var a=c.anchor.right;var u=c.anchor.top;var q=(isNaN(c.size.w))?this.size.w-(a+f):c.size.w;var m=(isNaN(c.size.h))?this.size.h-(p+u):c.size.h;g.div.style.width=(q<0?0:q)+"px";g.div.style.height=(m<0?0:m)+"px";g.div.style.left=(f!=null)?f+"px":"";g.div.style.bottom=(p!=null)?p+"px":"";g.div.style.right=(a!=null)?a+"px":"";g.div.style.top=(u!=null)?u+"px":"";g.image.style.left=c.position.x+"px";g.image.style.top=c.position.y+"px"}this.contentDiv.style.left=this.padding.left+"px";this.contentDiv.style.top=this.padding.top+"px"}},CLASS_NAME:"OpenLayers.Popup.Framed"});OpenLayers.Popup.FramedCloud=OpenLayers.Class(OpenLayers.Popup.Framed,{contentDisplayClass:"olFramedCloudPopupContent",autoSize:true,panMapIfOutOfView:true,imageSize:new OpenLayers.Size(676,736),isAlphaImage:false,fixedRelativePosition:false,positionBlocks:{tl:{offset:new OpenLayers.Pixel(44,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-638,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,18),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-638,-632)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(0,-688)}]},tr:{offset:new OpenLayers.Pixel(-45,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-638,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,19),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-638,-631)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(0,0,null,null),position:new OpenLayers.Pixel(-215,-687)}]},bl:{offset:new OpenLayers.Pixel(45,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-638,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-638,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(null,null,0,0),position:new OpenLayers.Pixel(-101,-674)}]},br:{offset:new OpenLayers.Pixel(-44,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-638,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-638,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(0,null,null,0),position:new OpenLayers.Pixel(-311,-674)}]}},minSize:new OpenLayers.Size(105,10),maxSize:new OpenLayers.Size(600,660),initialize:function(l,c,k,b,a,g,f){this.imageSrc=OpenLayers.Util.getImagesLocation()+"cloud-popup-relative.png";OpenLayers.Popup.Framed.prototype.initialize.apply(this,arguments);this.contentDiv.className=this.contentDisplayClass},destroy:function(){OpenLayers.Popup.Framed.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Popup.FramedCloud"});OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:OpenLayers.Popup.AnchoredBubble,popup:null,initialize:function(a,c,b){this.layer=a;this.lonlat=c;this.data=(b!=null)?b:{};this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){if((this.layer!=null)&&(this.layer.map!=null)){if(this.popup!=null){this.layer.map.removePopup(this.popup)}}this.layer=null;this.id=null;this.lonlat=null;this.data=null;if(this.marker!=null){this.destroyMarker(this.marker);this.marker=null}if(this.popup!=null){this.destroyPopup(this.popup);this.popup=null}},onScreen:function(){var b=false;if((this.layer!=null)&&(this.layer.map!=null)){var a=this.layer.map.getExtent();b=a.containsLonLat(this.lonlat)}return b},createMarker:function(){if(this.lonlat!=null){this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon)}return this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(b){if(this.lonlat!=null){var c=this.id+"_popup";var a=(this.marker)?this.marker.icon:null;if(!this.popup){this.popup=new this.popupClass(c,this.lonlat,this.data.popupSize,this.data.popupContentHTML,a,b)}if(this.data.overflow!=null){this.popup.contentDiv.style.overflow=this.data.overflow}this.popup.feature=this}return this.popup},destroyPopup:function(){if(this.popup){this.popup.feature=null;this.popup.destroy();this.popup=null}},CLASS_NAME:"OpenLayers.Feature"});OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"};OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,renderIntent:"default",initialize:function(c,a,b){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,a]);this.lonlat=null;this.geometry=c?c:null;this.state=null;this.attributes={};if(a){this.attributes=OpenLayers.Util.extend(this.attributes,a)}this.style=b?b:null},destroy:function(){if(this.layer){this.layer.removeFeatures(this);this.layer=null}this.geometry=null;OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(f){var c=false;if(this.layer&&this.layer.map){var a=this.layer.map.getExtent();if(f){var b=this.geometry.getBounds();c=a.intersectsBounds(b)}else{var g=a.toGeometry();c=g.intersects(this.geometry)}}return c},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(b,f,c){var a=false;if(this.geometry){a=this.geometry.atPoint(b,f,c)}return a},destroyPopup:function(){},move:function(a){if(!this.layer||!this.geometry.move){return}var b;if(a.CLASS_NAME=="OpenLayers.LonLat"){b=this.layer.getViewPortPxFromLonLat(a)}else{b=a}var f=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat());var c=this.layer.map.getResolution();this.geometry.move(c*(b.x-f.x),c*(f.y-b.y));this.layer.drawFeature(this);return f},toState:function(a){if(a==OpenLayers.State.UPDATE){switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=a;break;case OpenLayers.State.UPDATE:case OpenLayers.State.INSERT:break}}else{if(a==OpenLayers.State.INSERT){switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=a;break}}else{if(a==OpenLayers.State.DELETE){switch(this.state){case OpenLayers.State.INSERT:break;case OpenLayers.State.DELETE:break;case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=a;break}}else{if(a==OpenLayers.State.UNKNOWN){this.state=a}}}}},CLASS_NAME:"OpenLayers.Feature.Vector"});OpenLayers.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit"},select:{fillColor:"blue",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer"},temporary:{fillColor:"#66cccc",fillOpacity:0.2,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit"},"delete":{display:"none"}};OpenLayers.Feature.WFS=OpenLayers.Class(OpenLayers.Feature,{initialize:function(c,b){var a=arguments;var f=this.processXMLNode(b);a=new Array(c,f.lonlat,f);OpenLayers.Feature.prototype.initialize.apply(this,a);this.createMarker();this.layer.addMarker(this.marker)},destroy:function(){if(this.marker!=null){this.layer.removeMarker(this.marker)}OpenLayers.Feature.prototype.destroy.apply(this,arguments)},processXMLNode:function(b){var a=OpenLayers.Ajax.getElementsByTagNameNS(b,"http://www.opengis.net/gml","gml","Point");var f=OpenLayers.Util.getXmlNodeValue(OpenLayers.Ajax.getElementsByTagNameNS(a[0],"http://www.opengis.net/gml","gml","coordinates")[0]);var c=f.split(",");return{lonlat:new OpenLayers.LonLat(parseFloat(c[0]),parseFloat(c[1])),id:null}},CLASS_NAME:"OpenLayers.Feature.WFS"});OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:false,evt:null,initialize:function(c,b,a){OpenLayers.Util.extend(this,a);this.control=c;this.callbacks=b;if(c.map){this.setMap(c.map)}OpenLayers.Util.extend(this,a);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(a){this.map=a},checkModifiers:function(a){if(this.keyMask==null){return true}var b=(a.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(a.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(a.altKey?OpenLayers.Handler.MOD_ALT:0);return(b==this.keyMask)},activate:function(){if(this.active){return false}var c=OpenLayers.Events.prototype.BROWSER_EVENTS;for(var b=0,a=c.length;b<a;b++){if(this[c[b]]){this.register(c[b],this[c[b]])}}this.active=true;return true},deactivate:function(){if(!this.active){return false}var c=OpenLayers.Events.prototype.BROWSER_EVENTS;for(var b=0,a=c.length;b<a;b++){if(this[c[b]]){this.unregister(c[b],this[c[b]])}}this.active=false;return true},callback:function(b,a){if(b&&this.callbacks[b]){this.callbacks[b].apply(this.control,a)}},register:function(a,b){this.map.events.registerPriority(a,this,b);this.map.events.registerPriority(a,this,this.setEvent)},unregister:function(a,b){this.map.events.unregister(a,this,b);this.map.events.unregister(a,this,this.setEvent)},setEvent:function(a){this.evt=a;return true},destroy:function(){this.deactivate();this.control=this.map=null},CLASS_NAME:"OpenLayers.Handler"});OpenLayers.Handler.MOD_NONE=0;OpenLayers.Handler.MOD_SHIFT=1;OpenLayers.Handler.MOD_CTRL=2;OpenLayers.Handler.MOD_ALT=4;OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:true,"double":false,pixelTolerance:0,stopSingle:false,stopDouble:false,timerId:null,down:null,rightclickTimerId:null,initialize:function(c,b,a){OpenLayers.Handler.prototype.initialize.apply(this,arguments);if(this.pixelTolerance!=null){this.mousedown=function(f){this.down=f.xy;return true}}},mousedown:null,mouseup:function(b){var a=true;if(this.checkModifiers(b)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(b)){a=this.rightclick(b)}return a},rightclick:function(b){if(this.passesTolerance(b)){if(this.rightclickTimerId!=null){this.clearTimer();this.callback("dblrightclick",[b]);return !this.stopDouble}else{var a=this["double"]?OpenLayers.Util.extend({},b):this.callback("rightclick",[b]);var c=OpenLayers.Function.bind(this.delayedRightCall,this,a);this.rightclickTimerId=window.setTimeout(c,this.delay)}}return !this.stopSingle},delayedRightCall:function(a){this.rightclickTimerId=null;if(a){this.callback("rightclick",[a])}return !this.stopSingle},dblclick:function(a){if(this.passesTolerance(a)){if(this["double"]){this.callback("dblclick",[a])}this.clearTimer()}return !this.stopDouble},click:function(b){if(this.passesTolerance(b)){if(this.timerId!=null){this.clearTimer()}else{var a=this.single?OpenLayers.Util.extend({},b):null;this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,a),this.delay)}}return !this.stopSingle},passesTolerance:function(b){var c=true;if(this.pixelTolerance!=null&&this.down){var a=Math.sqrt(Math.pow(this.down.x-b.xy.x,2)+Math.pow(this.down.y-b.xy.y,2));if(a>this.pixelTolerance){c=false}}return c},clearTimer:function(){if(this.timerId!=null){window.clearTimeout(this.timerId);this.timerId=null}if(this.rightclickTimerId!=null){window.clearTimeout(this.rightclickTimerId);this.rightclickTimerId=null}},delayedCall:function(a){this.timerId=null;if(a){this.callback("click",[a])}},deactivate:function(){var a=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();this.down=null;a=true}return a},CLASS_NAME:"OpenLayers.Handler.Click"});OpenLayers.Handler.Hover=OpenLayers.Class(OpenLayers.Handler,{delay:500,pixelTolerance:null,stopMove:false,px:null,timerId:null,initialize:function(c,b,a){OpenLayers.Handler.prototype.initialize.apply(this,arguments)},mousemove:function(a){if(this.passesTolerance(a.xy)){this.clearTimer();this.callback("move",[a]);this.px=a.xy;a=OpenLayers.Util.extend({},a);this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,a),this.delay)}return !this.stopMove},mouseout:function(a){if(OpenLayers.Util.mouseLeft(a,this.map.div)){this.clearTimer();this.callback("move",[a])}return true},passesTolerance:function(b){var c=true;if(this.pixelTolerance&&this.px){var a=Math.sqrt(Math.pow(this.px.x-b.x,2)+Math.pow(this.px.y-b.y,2));if(a<this.pixelTolerance){c=false}}return c},clearTimer:function(){if(this.timerId!=null){window.clearTimeout(this.timerId);this.timerId=null}},delayedCall:function(a){this.callback("pause",[a])},deactivate:function(){var a=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();a=true}return a},CLASS_NAME:"OpenLayers.Handler.Hover"});OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:false,drawing:false,mouseDown:false,lastDown:null,lastUp:null,persist:false,layerOptions:null,initialize:function(c,b,a){if(!(a&&a.layerOptions&&a.layerOptions.styleMap)){this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})}OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments)){return false}var a=OpenLayers.Util.extend({displayInLayerSwitcher:false,calculateInRange:function(){return true}},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,a);this.map.addLayer(this.layer);return true},createFeature:function(a){var b=this.map.getLonLatFromPixel(a);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat));this.callback("create",[this.point.geometry,this.point]);this.point.geometry.clearBounds();this.layer.addFeatures([this.point],{silent:true})},deactivate:function(){if(!OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){return false}if(this.drawing){this.cancel()}this.destroyFeature();if(this.layer.map!=null){this.layer.destroy(false)}this.layer=null;return true},destroyFeature:function(){if(this.layer){this.layer.destroyFeatures()}this.point=null},finalize:function(b){var a=b?"cancel":"done";this.drawing=false;this.mouseDown=false;this.lastDown=null;this.lastUp=null;this.callback(a,[this.geometryClone()]);if(b||!this.persist){this.destroyFeature()}},cancel:function(){this.finalize(true)},click:function(a){OpenLayers.Event.stop(a);return false},dblclick:function(a){OpenLayers.Event.stop(a);return false},modifyFeature:function(a){var b=this.map.getLonLatFromPixel(a);this.point.geometry.x=b.lon;this.point.geometry.y=b.lat;this.callback("modify",[this.point.geometry,this.point]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var a=this.point&&this.point.geometry;if(a&&this.multi){a=new OpenLayers.Geometry.MultiPoint([a])}return a},geometryClone:function(){var a=this.getGeometry();return a&&a.clone()},mousedown:function(a){if(!this.checkModifiers(a)){return true}if(this.lastDown&&this.lastDown.equals(a.xy)){return true}this.drawing=true;if(this.lastDown==null){if(this.persist){this.destroyFeature()}this.createFeature(a.xy)}else{this.modifyFeature(a.xy)}this.lastDown=a.xy;return false},mousemove:function(a){if(this.drawing){this.modifyFeature(a.xy)}return true},mouseup:function(a){if(this.drawing){this.finalize();return false}else{return true}},CLASS_NAME:"OpenLayers.Handler.Point"});OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,freehand:false,freehandToggle:"shiftKey",initialize:function(c,b,a){OpenLayers.Handler.Point.prototype.initialize.apply(this,arguments)},createFeature:function(a){var b=this.control.map.getLonLatFromPixel(a);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat));this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.line,this.point],{silent:true})},destroyFeature:function(){OpenLayers.Handler.Point.prototype.destroyFeature.apply(this);this.line=null},removePoint:function(){if(this.point){this.layer.removeFeatures([this.point])}},addPoint:function(a){this.layer.removeFeatures([this.point]);var b=this.control.map.getLonLatFromPixel(a);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat));this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length);this.callback("point",[this.point.geometry,this.getGeometry()]);this.callback("modify",[this.point.geometry,this.getSketch()]);this.drawFeature()},freehandMode:function(a){return(this.freehandToggle&&a[this.freehandToggle])?!this.freehand:this.freehand},modifyFeature:function(a){var b=this.control.map.getLonLatFromPixel(a);this.point.geometry.x=b.lon;this.point.geometry.y=b.lat;this.callback("modify",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var a=this.line&&this.line.geometry;if(a&&this.multi){a=new OpenLayers.Geometry.MultiLineString([a])}return a},mousedown:function(a){if(this.lastDown&&this.lastDown.equals(a.xy)){return false}if(this.lastDown==null){if(this.persist){this.destroyFeature()}this.createFeature(a.xy)}else{if((this.lastUp==null)||!this.lastUp.equals(a.xy)){this.addPoint(a.xy)}}this.mouseDown=true;this.lastDown=a.xy;this.drawing=true;return false},mousemove:function(a){if(this.drawing){if(this.mouseDown&&this.freehandMode(a)){this.addPoint(a.xy)}else{this.modifyFeature(a.xy)}}return true},mouseup:function(a){this.mouseDown=false;if(this.drawing){if(this.freehandMode(a)){this.removePoint();this.finalize()}else{if(this.lastUp==null){this.addPoint(a.xy)}this.lastUp=a.xy}return false}return true},dblclick:function(a){if(!this.freehandMode(a)){var b=this.line.geometry.components.length-1;this.line.geometry.removeComponent(this.line.geometry.components[b]);this.removePoint();this.finalize()}return false},CLASS_NAME:"OpenLayers.Handler.Path"});OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{polygon:null,initialize:function(c,b,a){OpenLayers.Handler.Path.prototype.initialize.apply(this,arguments)},createFeature:function(a){var b=this.control.map.getLonLatFromPixel(a);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat));this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry]));this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.polygon,this.point],{silent:true})},destroyFeature:function(){OpenLayers.Handler.Path.prototype.destroyFeature.apply(this);this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.polygon},getGeometry:function(){var a=this.polygon&&this.polygon.geometry;if(a&&this.multi){a=new OpenLayers.Geometry.MultiPolygon([a])}return a},dblclick:function(a){if(!this.freehandMode(a)){var b=this.line.geometry.components.length-2;this.line.geometry.removeComponent(this.line.geometry.components[b]);this.removePoint();this.finalize()}return false},CLASS_NAME:"OpenLayers.Handler.Polygon"});OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{"in":"click",out:"clickout"},mousemove:{"in":"over",out:"out"},dblclick:{"in":"dblclick",out:null},mousedown:{"in":null,out:null},mouseup:{"in":null,out:null}},feature:null,lastFeature:null,down:null,up:null,clickTolerance:4,geometryTypes:null,stopClick:true,stopDown:true,stopUp:false,initialize:function(f,b,c,a){OpenLayers.Handler.prototype.initialize.apply(this,[f,c,a]);this.layer=b},mousedown:function(a){this.down=a.xy;return this.handle(a)?!this.stopDown:true},mouseup:function(a){this.up=a.xy;return this.handle(a)?!this.stopUp:true},click:function(a){return this.handle(a)?!this.stopClick:true},mousemove:function(a){if(!this.callbacks.over&&!this.callbacks.out){return true}this.handle(a);return true},dblclick:function(a){return !this.handle(a)},geometryTypeMatches:function(a){return this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,a.geometry.CLASS_NAME)>-1},handle:function(a){if(this.feature&&!this.feature.layer){this.feature=null}var c=a.type;var k=false;var g=!!(this.feature);var f=(c=="click"||c=="dblclick");this.feature=this.layer.getFeatureFromEvent(a);if(this.feature&&!this.feature.layer){this.feature=null}if(this.lastFeature&&!this.lastFeature.layer){this.lastFeature=null}if(this.feature){var b=(this.feature!=this.lastFeature);if(this.geometryTypeMatches(this.feature)){if(g&&b){if(this.lastFeature){this.triggerCallback(c,"out",[this.lastFeature])}this.triggerCallback(c,"in",[this.feature])}else{if(!g||f){this.triggerCallback(c,"in",[this.feature])}}this.lastFeature=this.feature;k=true}else{if(this.lastFeature&&(g&&b||f)){this.triggerCallback(c,"out",[this.lastFeature])}this.feature=null}}else{if(this.lastFeature&&(g||f)){this.triggerCallback(c,"out",[this.lastFeature])}}return k},triggerCallback:function(f,g,b){var c=this.EVENTMAP[f][g];if(c){if(f=="click"&&this.up&&this.down){var a=Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2));if(a<=this.clickTolerance){this.callback(c,b)}}else{this.callback(c,b)}}},activate:function(){var a=false;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.moveLayerToTop();this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});a=true}return a},deactivate:function(){var a=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.moveLayerBack();this.feature=null;this.lastFeature=null;this.down=null;this.up=null;this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});a=true}return a},handleMapEvents:function(a){if(!a.property||a.property=="order"){this.moveLayerToTop()}},moveLayerToTop:function(){var a=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(a)},moveLayerBack:function(){var a=this.layer.getZIndex()-1;if(a>=this.map.Z_INDEX_BASE.Feature){this.layer.setZIndex(a)}else{this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))}},CLASS_NAME:"OpenLayers.Handler.Feature"});OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:false,stopDown:true,dragging:false,last:null,start:null,oldOnselectstart:null,interval:0,timeoutId:null,initialize:function(c,b,a){OpenLayers.Handler.prototype.initialize.apply(this,arguments)},down:function(a){},move:function(a){},up:function(a){},out:function(a){},mousedown:function(b){var a=true;this.dragging=false;if(this.checkModifiers(b)&&OpenLayers.Event.isLeftClick(b)){this.started=true;this.start=b.xy;this.last=b.xy;OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown");this.down(b);this.callback("down",[b.xy]);OpenLayers.Event.stop(b);if(!this.oldOnselectstart){this.oldOnselectstart=(document.onselectstart)?document.onselectstart:function(){return true};document.onselectstart=function(){return false}}a=!this.stopDown}else{this.started=false;this.start=null;this.last=null}return a},mousemove:function(a){if(this.started&&!this.timeoutId&&(a.xy.x!=this.last.x||a.xy.y!=this.last.y)){if(this.interval>0){this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)}this.dragging=true;this.move(a);this.callback("move",[a.xy]);if(!this.oldOnselectstart){this.oldOnselectstart=document.onselectstart;document.onselectstart=function(){return false}}this.last=this.evt.xy}return true},removeTimeout:function(){this.timeoutId=null},mouseup:function(b){if(this.started){var a=(this.start!=this.last);this.started=false;this.dragging=false;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.up(b);this.callback("up",[b.xy]);if(a){this.callback("done",[b.xy])}document.onselectstart=this.oldOnselectstart}return true},mouseout:function(b){if(this.started&&OpenLayers.Util.mouseLeft(b,this.map.div)){var a=(this.start!=this.last);this.started=false;this.dragging=false;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.out(b);this.callback("out",[]);if(a){this.callback("done",[b.xy])}if(document.onselectstart){document.onselectstart=this.oldOnselectstart}}return true},click:function(a){return(this.start==this.last)},activate:function(){var a=false;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.dragging=false;a=true}return a},deactivate:function(){var a=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.started=false;this.dragging=false;this.start=null;this.last=null;a=true;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown")}return a},CLASS_NAME:"OpenLayers.Handler.Drag"});OpenLayers.Handler.RegularPolygon=OpenLayers.Class(OpenLayers.Handler.Drag,{sides:4,radius:null,snapAngle:null,snapToggle:"shiftKey",persist:false,irregular:false,angle:null,fixedRadius:false,feature:null,layer:null,origin:null,initialize:function(c,b,a){this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{});OpenLayers.Handler.prototype.initialize.apply(this,[c,b,a]);this.options=(a)?a:new Object()},setOptions:function(a){OpenLayers.Util.extend(this.options,a);OpenLayers.Util.extend(this,a)},activate:function(){var a=false;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var b={displayInLayerSwitcher:false,calculateInRange:function(){return true}};this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,b);this.map.addLayer(this.layer);a=true}return a},deactivate:function(){var a=false;if(OpenLayers.Handler.Drag.prototype.deactivate.apply(this,arguments)){if(this.dragging){this.cancel()}if(this.layer.map!=null){this.layer.destroy(false);if(this.feature){this.feature.destroy()}}this.layer=null;this.feature=null;a=true}return a},down:function(a){this.fixedRadius=!!(this.radius);var b=this.map.getLonLatFromPixel(a.xy);this.origin=new OpenLayers.Geometry.Point(b.lon,b.lat);if(!this.fixedRadius||this.irregular){this.radius=this.map.getResolution()}if(this.persist){this.clear()}this.feature=new OpenLayers.Feature.Vector();this.createGeometry();this.callback("create",[this.origin,this.feature]);this.layer.addFeatures([this.feature],{silent:true});this.layer.drawFeature(this.feature,this.style)},move:function(c){var k=this.map.getLonLatFromPixel(c.xy);var a=new OpenLayers.Geometry.Point(k.lon,k.lat);if(this.irregular){var l=Math.sqrt(2)*Math.abs(a.y-this.origin.y)/2;this.radius=Math.max(this.map.getResolution()/2,l)}else{if(this.fixedRadius){this.origin=a}else{this.calculateAngle(a,c);this.radius=Math.max(this.map.getResolution()/2,a.distanceTo(this.origin))}}this.modifyGeometry();if(this.irregular){var f=a.x-this.origin.x;var b=a.y-this.origin.y;var g;if(b==0){g=f/(this.radius*Math.sqrt(2))}else{g=f/b}this.feature.geometry.resize(1,this.origin,g);this.feature.geometry.move(f/2,b/2)}this.layer.drawFeature(this.feature,this.style)},up:function(a){this.finalize();if(this.start==this.last){this.callback("done",[a.xy])}},out:function(a){this.finalize()},createGeometry:function(){this.angle=Math.PI*((1/this.sides)-(1/2));if(this.snapAngle){this.angle+=this.snapAngle*(Math.PI/180)}this.feature.geometry=OpenLayers.Geometry.Polygon.createRegularPolygon(this.origin,this.radius,this.sides,this.snapAngle)},modifyGeometry:function(){var k,c,b,a;var f=this.feature.geometry.components[0];if(f.components.length!=(this.sides+1)){this.createGeometry();f=this.feature.geometry.components[0]}for(var g=0;g<this.sides;++g){a=f.components[g];k=this.angle+(g*2*Math.PI/this.sides);a.x=this.origin.x+(this.radius*Math.cos(k));a.y=this.origin.y+(this.radius*Math.sin(k));a.clearBounds()}},calculateAngle:function(a,b){var f=Math.atan2(a.y-this.origin.y,a.x-this.origin.x);if(this.snapAngle&&(this.snapToggle&&!b[this.snapToggle])){var c=(Math.PI/180)*this.snapAngle;this.angle=Math.round(f/c)*c}else{this.angle=f}},cancel:function(){this.callback("cancel",null);this.finalize()},finalize:function(){this.origin=null;this.radius=this.options.radius},clear:function(){this.layer.renderer.clear();this.layer.destroyFeatures()},callback:function(b,a){if(this.callbacks[b]){this.callbacks[b].apply(this.control,[this.feature.geometry.clone()])}if(!this.persist&&(b=="done"||b=="cancel")){this.clear()}},CLASS_NAME:"OpenLayers.Handler.RegularPolygon"});OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxCharacteristics:null,initialize:function(c,b,a){OpenLayers.Handler.prototype.initialize.apply(this,arguments);var b={down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox};this.dragHandler=new OpenLayers.Handler.Drag(this,b,{keyMask:this.keyMask})},setMap:function(a){OpenLayers.Handler.prototype.setMap.apply(this,arguments);if(this.dragHandler){this.dragHandler.setMap(a)}},startBox:function(a){this.zoomBox=OpenLayers.Util.createDiv("zoomBox",this.dragHandler.start);this.zoomBox.className=this.boxDivClassName;this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.viewPortDiv.appendChild(this.zoomBox);OpenLayers.Element.addClass(this.map.viewPortDiv,"olDrawBox")},moveBox:function(k){var f=this.dragHandler.start.x;var b=this.dragHandler.start.y;var c=Math.abs(f-k.x);var a=Math.abs(b-k.y);this.zoomBox.style.width=Math.max(1,c)+"px";this.zoomBox.style.height=Math.max(1,a)+"px";this.zoomBox.style.left=k.x<f?k.x+"px":f+"px";this.zoomBox.style.top=k.y<b?k.y+"px":b+"px";var g=this.getBoxCharacteristics();if(g.newBoxModel){if(k.x>f){this.zoomBox.style.width=Math.max(1,c-g.xOffset)+"px"}if(k.y>b){this.zoomBox.style.height=Math.max(1,a-g.yOffset)+"px"}}},endBox:function(b){var a;if(Math.abs(this.dragHandler.start.x-b.x)>5||Math.abs(this.dragHandler.start.y-b.y)>5){var l=this.dragHandler.start;var k=Math.min(l.y,b.y);var c=Math.max(l.y,b.y);var g=Math.min(l.x,b.x);var f=Math.max(l.x,b.x);a=new OpenLayers.Bounds(g,c,f,k)}else{a=this.dragHandler.start.clone()}this.removeBox();this.callback("done",[a])},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox);this.zoomBox=null;this.boxCharacteristics=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDrawBox")},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.dragHandler.activate();return true}else{return false}},deactivate:function(){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.dragHandler.deactivate();return true}else{return false}},getBoxCharacteristics:function(){if(!this.boxCharacteristics){var a=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width"))+1;var c=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"))+1;var b=OpenLayers.Util.getBrowserName()=="msie"?document.compatMode!="BackCompat":true;this.boxCharacteristics={xOffset:a,yOffset:c,newBoxModel:b}}return this.boxCharacteristics},CLASS_NAME:"OpenLayers.Handler.Box"});OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,mousePosition:null,initialize:function(c,b,a){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this)},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);this.wheelListener=null},onWheelEvent:function(o){if(!this.map||!this.checkModifiers(o)){return}var k=false;var p=false;var g=false;var b=OpenLayers.Event.element(o);while((b!=null)&&!g&&!k){if(!k){try{if(b.currentStyle){c=b.currentStyle.overflow}else{var a=document.defaultView.getComputedStyle(b,null);var c=a.getPropertyValue("overflow")}k=(c&&(c=="auto")||(c=="scroll"))}catch(f){}}if(!p){for(var l=0,m=this.map.layers.length;l<m;l++){if(b==this.map.layers[l].div||b==this.map.layers[l].pane){p=true;break}}}g=(b==this.map.div);b=b.parentNode}if(!k&&g){if(p){this.wheelZoom(o)}OpenLayers.Event.stop(o)}},wheelZoom:function(a){var b=0;if(!a){a=window.event}if(a.wheelDelta){b=a.wheelDelta/120;if(window.opera&&window.opera.version()<9.2){b=-b}}else{if(a.detail){b=-a.detail/3}}if(b){if(this.mousePosition){a.xy=this.mousePosition}if(!a.xy){a.xy=this.map.getPixelFromLonLat(this.map.getCenter())}if(b<0){this.callback("down",[a,b])}else{this.callback("up",[a,b])}}},mousemove:function(a){this.mousePosition=a.xy},activate:function(a){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var b=this.wheelListener;OpenLayers.Event.observe(window,"DOMMouseScroll",b);OpenLayers.Event.observe(window,"mousewheel",b);OpenLayers.Event.observe(document,"mousewheel",b);return true}else{return false}},deactivate:function(a){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var b=this.wheelListener;OpenLayers.Event.stopObserving(window,"DOMMouseScroll",b);OpenLayers.Event.stopObserving(window,"mousewheel",b);OpenLayers.Event.stopObserving(document,"mousewheel",b);return true}else{return false}},CLASS_NAME:"OpenLayers.Handler.MouseWheel"});OpenLayers.Handler.Keyboard=OpenLayers.Class(OpenLayers.Handler,{KEY_EVENTS:["keydown","keyup"],eventListener:null,initialize:function(c,b,a){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.eventListener=OpenLayers.Function.bindAsEventListener(this.handleKeyEvent,this)},destroy:function(){this.deactivate();this.eventListener=null;OpenLayers.Handler.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){for(var b=0,a=this.KEY_EVENTS.length;b<a;b++){OpenLayers.Event.observe(document,this.KEY_EVENTS[b],this.eventListener)}return true}else{return false}},deactivate:function(){var c=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){for(var b=0,a=this.KEY_EVENTS.length;b<a;b++){OpenLayers.Event.stopObserving(document,this.KEY_EVENTS[b],this.eventListener)}c=true}return c},handleKeyEvent:function(a){if(this.checkModifiers(a)){this.callback(a.type,[a])}},CLASS_NAME:"OpenLayers.Handler.Keyboard"});OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:false,displayClass:"",title:"",active:null,handler:null,eventListeners:null,events:null,EVENT_TYPES:["activate","deactivate"],initialize:function(a){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,"");OpenLayers.Util.extend(this,a);this.events=new OpenLayers.Events(this,null,this.EVENT_TYPES);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}if(this.id==null){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")}},destroy:function(){if(this.events){if(this.eventListeners){this.events.un(this.eventListeners)}this.events.destroy();this.events=null}this.eventListeners=null;if(this.handler){this.handler.destroy();this.handler=null}if(this.handlers){for(var a in this.handlers){if(this.handlers.hasOwnProperty(a)&&typeof this.handlers[a].destroy=="function"){this.handlers[a].destroy()}}this.handlers=null}if(this.map){this.map.removeControl(this);this.map=null}},setMap:function(a){this.map=a;if(this.handler){this.handler.setMap(a)}},draw:function(a){if(this.div==null){this.div=OpenLayers.Util.createDiv(this.id);this.div.className=this.displayClass;if(!this.allowSelection){this.div.className+=" olControlNoSelect";this.div.setAttribute("unselectable","on",0);this.div.onselectstart=function(){return(false)}}if(this.title!=""){this.div.title=this.title}}if(a!=null){this.position=a.clone()}this.moveTo(this.position);return this.div},moveTo:function(a){if((a!=null)&&(this.div!=null)){this.div.style.left=a.x+"px";this.div.style.top=a.y+"px"}},activate:function(){if(this.active){return false}if(this.handler){this.handler.activate()}this.active=true;if(this.map){OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active")}this.events.triggerEvent("activate");return true},deactivate:function(){if(this.active){if(this.handler){this.handler.deactivate()}this.active=false;if(this.map){OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active")}this.events.triggerEvent("deactivate");return true}return false},CLASS_NAME:"OpenLayers.Control"});OpenLayers.Control.TYPE_BUTTON=1;OpenLayers.Control.TYPE_TOGGLE=2;OpenLayers.Control.TYPE_TOOL=3;OpenLayers.Control.Attribution=OpenLayers.Class(OpenLayers.Control,{separator:", ",initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.map.events.un({removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.map.events.on({changebaselayer:this.updateAttribution,changelayer:this.updateAttribution,addlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this});this.updateAttribution();return this.div},updateAttribution:function(){var f=[];if(this.map&&this.map.layers){for(var c=0,a=this.map.layers.length;c<a;c++){var b=this.map.layers[c];if(b.attribution&&b.getVisibility()){f.push(b.attribution)}}this.div.innerHTML=f.join(this.separator)}},CLASS_NAME:"OpenLayers.Control.Attribution"});OpenLayers.Control.Button=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:"OpenLayers.Control.Button"});OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:false,alwaysZoom:false,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})},zoomBox:function(m){if(m instanceof OpenLayers.Bounds){if(!this.out){var o=this.map.getLonLatFromPixel(new OpenLayers.Pixel(m.left,m.bottom));var u=this.map.getLonLatFromPixel(new OpenLayers.Pixel(m.right,m.top));var b=new OpenLayers.Bounds(o.lon,o.lat,u.lon,u.lat)}else{var l=Math.abs(m.right-m.left);var p=Math.abs(m.top-m.bottom);var g=Math.min((this.map.size.h/p),(this.map.size.w/l));var v=this.map.getExtent();var a=this.map.getLonLatFromPixel(m.getCenterPixel());var c=a.lon-(v.getWidth()/2)*g;var k=a.lon+(v.getWidth()/2)*g;var r=a.lat-(v.getHeight()/2)*g;var f=a.lat+(v.getHeight()/2)*g;var b=new OpenLayers.Bounds(c,r,k,f)}var q=this.map.getZoom();this.map.zoomToExtent(b);if(q==this.map.getZoom()&&this.alwaysZoom==true){this.map.zoomTo(q+(this.out?-1:1))}}else{if(!this.out){this.map.setCenter(this.map.getLonLatFromPixel(m),this.map.getZoom()+1)}else{this.map.setCenter(this.map.getLonLatFromPixel(m),this.map.getZoom()-1)}}},CLASS_NAME:"OpenLayers.Control.ZoomBox"});OpenLayers.Control.ZoomToMaxExtent=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){if(this.map){this.map.zoomToMaxExtent()}},CLASS_NAME:"OpenLayers.Control.ZoomToMaxExtent"});OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:false,interval:25,draw:function(){this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone},{interval:this.interval})},panMap:function(a){this.panned=true;this.map.pan(this.handler.last.x-a.x,this.handler.last.y-a.y,{dragging:this.handler.dragging,animate:false})},panMapDone:function(a){if(this.panned){this.panMap(a);this.panned=false}},CLASS_NAME:"OpenLayers.Control.DragPan"});OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,zoomBox:null,zoomWheelEnabled:true,handleRightClicks:false,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,initialize:function(a){this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate();if(this.dragPan){this.dragPan.destroy()}this.dragPan=null;if(this.zoomBox){this.zoomBox.destroy()}this.zoomBox=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){this.dragPan.activate();if(this.zoomWheelEnabled){this.handlers.wheel.activate()}this.handlers.click.activate();this.zoomBox.activate();return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){this.zoomBox.deactivate();this.dragPan.deactivate();this.handlers.click.deactivate();this.handlers.wheel.deactivate();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){if(this.handleRightClicks){this.map.viewPortDiv.oncontextmenu=function(){return false}}var a={dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick};var b={"double":true,stopDouble:true};this.handlers.click=new OpenLayers.Handler.Click(this,a,b);this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map},this.dragPanOptions));this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask});this.dragPan.draw();this.zoomBox.draw();this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown});this.activate()},defaultDblClick:function(b){var a=this.map.getLonLatFromViewPortPx(b.xy);this.map.setCenter(a,this.map.zoom+1)},defaultDblRightClick:function(b){var a=this.map.getLonLatFromViewPortPx(b.xy);this.map.setCenter(a,this.map.zoom-1)},wheelChange:function(m,c){var k=this.map.getZoom()+c;if(!this.map.isValidZoomLevel(k)){return}var o=this.map.getSize();var g=o.w/2-m.xy.x;var f=m.xy.y-o.h/2;var l=this.map.baseLayer.getResolutionForZoom(k);var a=this.map.getLonLatFromPixel(m.xy);var b=new OpenLayers.LonLat(a.lon+g*l,a.lat+f*l);this.map.setCenter(b,k)},wheelUp:function(a){this.wheelChange(a,1)},wheelDown:function(a){this.wheelChange(a,-1)},disableZoomWheel:function(){this.zoomWheelEnabled=false;this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=true;if(this.active){this.handlers.wheel.activate()}},CLASS_NAME:"OpenLayers.Control.Navigation"});OpenLayers.Control.MouseDefaults=OpenLayers.Class(OpenLayers.Control,{performedDrag:false,wheelObserver:null,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){if(this.handler){this.handler.destroy()}this.handler=null;this.map.events.un({click:this.defaultClick,dblclick:this.defaultDblClick,mousedown:this.defaultMouseDown,mouseup:this.defaultMouseUp,mousemove:this.defaultMouseMove,mouseout:this.defaultMouseOut,scope:this});OpenLayers.Event.stopObserving(window,"DOMMouseScroll",this.wheelObserver);OpenLayers.Event.stopObserving(window,"mousewheel",this.wheelObserver);OpenLayers.Event.stopObserving(document,"mousewheel",this.wheelObserver);this.wheelObserver=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){this.map.events.on({click:this.defaultClick,dblclick:this.defaultDblClick,mousedown:this.defaultMouseDown,mouseup:this.defaultMouseUp,mousemove:this.defaultMouseMove,mouseout:this.defaultMouseOut,scope:this});this.registerWheelEvents()},registerWheelEvents:function(){this.wheelObserver=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this);OpenLayers.Event.observe(window,"DOMMouseScroll",this.wheelObserver);OpenLayers.Event.observe(window,"mousewheel",this.wheelObserver);OpenLayers.Event.observe(document,"mousewheel",this.wheelObserver)},defaultClick:function(b){if(!OpenLayers.Event.isLeftClick(b)){return}var a=!this.performedDrag;this.performedDrag=false;return a},defaultDblClick:function(b){var a=this.map.getLonLatFromViewPortPx(b.xy);this.map.setCenter(a,this.map.zoom+1);OpenLayers.Event.stop(b);return false},defaultMouseDown:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}this.mouseDragStart=a.xy.clone();this.performedDrag=false;if(a.shiftKey){this.map.div.style.cursor="crosshair";this.zoomBox=OpenLayers.Util.createDiv("zoomBox",this.mouseDragStart,null,null,"absolute","2px solid red");this.zoomBox.style.backgroundColor="white";this.zoomBox.style.filter="alpha(opacity=50)";this.zoomBox.style.opacity="0.50";this.zoomBox.style.fontSize="1px";this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.viewPortDiv.appendChild(this.zoomBox)}document.onselectstart=function(){return false};OpenLayers.Event.stop(a)},defaultMouseMove:function(g){this.mousePosition=g.xy.clone();if(this.mouseDragStart!=null){if(this.zoomBox){var f=Math.abs(this.mouseDragStart.x-g.xy.x);var b=Math.abs(this.mouseDragStart.y-g.xy.y);this.zoomBox.style.width=Math.max(1,f)+"px";this.zoomBox.style.height=Math.max(1,b)+"px";if(g.xy.x<this.mouseDragStart.x){this.zoomBox.style.left=g.xy.x+"px"}if(g.xy.y<this.mouseDragStart.y){this.zoomBox.style.top=g.xy.y+"px"}}else{var f=this.mouseDragStart.x-g.xy.x;var b=this.mouseDragStart.y-g.xy.y;var k=this.map.getSize();var a=new OpenLayers.Pixel(k.w/2+f,k.h/2+b);var c=this.map.getLonLatFromViewPortPx(a);this.map.setCenter(c,null,true);this.mouseDragStart=g.xy.clone();this.map.div.style.cursor="move"}this.performedDrag=true}},defaultMouseUp:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}if(this.zoomBox){this.zoomBoxEnd(a)}else{if(this.performedDrag){this.map.setCenter(this.map.center)}}document.onselectstart=null;this.mouseDragStart=null;this.map.div.style.cursor=""},defaultMouseOut:function(a){if(this.mouseDragStart!=null&&OpenLayers.Util.mouseLeft(a,this.map.div)){if(this.zoomBox){this.removeZoomBox()}this.mouseDragStart=null}},defaultWheelUp:function(a){if(this.map.getZoom()<=this.map.getNumZoomLevels()){this.map.setCenter(this.map.getLonLatFromPixel(a.xy),this.map.getZoom()+1)}},defaultWheelDown:function(a){if(this.map.getZoom()>0){this.map.setCenter(this.map.getLonLatFromPixel(a.xy),this.map.getZoom()-1)}},zoomBoxEnd:function(b){if(this.mouseDragStart!=null){if(Math.abs(this.mouseDragStart.x-b.xy.x)>5||Math.abs(this.mouseDragStart.y-b.xy.y)>5){var m=this.map.getLonLatFromViewPortPx(this.mouseDragStart);var a=this.map.getLonLatFromViewPortPx(b.xy);var l=Math.max(m.lat,a.lat);var c=Math.min(m.lat,a.lat);var k=Math.min(m.lon,a.lon);var f=Math.max(m.lon,a.lon);var g=new OpenLayers.Bounds(k,c,f,l);this.map.zoomToExtent(g)}else{var a=this.map.getLonLatFromViewPortPx(b.xy);this.map.setCenter(new OpenLayers.LonLat((a.lon),(a.lat)),this.map.getZoom()+1)}this.removeZoomBox()}},removeZoomBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox);this.zoomBox=null},onWheelEvent:function(c){var b=false;var a=OpenLayers.Event.element(c);while(a!=null){if(this.map&&a==this.map.div){b=true;break}a=a.parentNode}if(b){var f=0;if(!c){c=window.event}if(c.wheelDelta){f=c.wheelDelta/120;if(window.opera&&window.opera.version()<9.2){f=-f}}else{if(c.detail){f=-c.detail/3}}if(f){c.xy=this.mousePosition;if(f<0){this.defaultWheelDown(c)}else{this.defaultWheelUp(c)}}OpenLayers.Event.stop(c)}},CLASS_NAME:"OpenLayers.Control.MouseDefaults"});OpenLayers.Control.MousePosition=OpenLayers.Class(OpenLayers.Control,{element:null,prefix:"",separator:", ",suffix:"",numDigits:5,granularity:10,lastXy:null,displayProjection:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){if(this.map){this.map.events.unregister("mousemove",this,this.redraw)}OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.element){this.div.left="";this.div.top="";this.element=this.div}this.redraw();return this.div},redraw:function(a){var c;if(a==null){c=new OpenLayers.LonLat(0,0)}else{if(this.lastXy==null||Math.abs(a.xy.x-this.lastXy.x)>this.granularity||Math.abs(a.xy.y-this.lastXy.y)>this.granularity){this.lastXy=a.xy;return}c=this.map.getLonLatFromPixel(a.xy);if(!c){return}if(this.displayProjection){c.transform(this.map.getProjectionObject(),this.displayProjection)}this.lastXy=a.xy}var b=this.formatOutput(c);if(b!=this.element.innerHTML){this.element.innerHTML=b}},formatOutput:function(b){var c=parseInt(this.numDigits);var a=this.prefix+b.lon.toFixed(c)+this.separator+b.lat.toFixed(c)+this.suffix;return a},setMap:function(){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.register("mousemove",this,this.redraw)},CLASS_NAME:"OpenLayers.Control.MousePosition"});OpenLayers.Control.OverviewMap=OpenLayers.Class(OpenLayers.Control,{element:null,ovmap:null,size:new OpenLayers.Size(180,90),layers:null,minRectSize:15,minRectDisplayClass:"RectReplacement",minRatio:8,maxRatio:32,mapOptions:null,autoPan:false,handlers:null,resolutionFactor:1,initialize:function(a){this.layers=[];this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,[a])},destroy:function(){if(!this.mapDiv){return}this.handlers.click.destroy();this.mapDiv.removeChild(this.extentRectangle);this.extentRectangle=null;this.rectEvents.destroy();this.rectEvents=null;this.ovmap.destroy();this.ovmap=null;this.element.removeChild(this.mapDiv);this.mapDiv=null;this.div.removeChild(this.element);this.element=null;if(this.maximizeDiv){OpenLayers.Event.stopObservingElement(this.maximizeDiv);this.div.removeChild(this.maximizeDiv);this.maximizeDiv=null}if(this.minimizeDiv){OpenLayers.Event.stopObservingElement(this.minimizeDiv);this.div.removeChild(this.minimizeDiv);this.minimizeDiv=null}this.map.events.un({moveend:this.update,changebaselayer:this.baseLayerDraw,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!(this.layers.length>0)){if(this.map.baseLayer){var f=this.map.baseLayer.clone();this.layers=[f]}else{this.map.events.register("changebaselayer",this,this.baseLayerDraw);return this.div}}this.element=document.createElement("div");this.element.className=this.displayClass+"Element";this.element.style.display="none";this.mapDiv=document.createElement("div");this.mapDiv.style.width=this.size.w+"px";this.mapDiv.style.height=this.size.h+"px";this.mapDiv.style.position="relative";this.mapDiv.style.overflow="hidden";this.mapDiv.id=OpenLayers.Util.createUniqueID("overviewMap");this.extentRectangle=document.createElement("div");this.extentRectangle.style.position="absolute";this.extentRectangle.style.zIndex=1000;this.extentRectangle.className=this.displayClass+"ExtentRectangle";this.mapDiv.appendChild(this.extentRectangle);this.element.appendChild(this.mapDiv);this.div.appendChild(this.element);if(!this.outsideViewport){this.div.className+=" "+this.displayClass+"Container";var g=OpenLayers.Util.getImagesLocation();var b=g+"layer-switcher-maximize.png";this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,new OpenLayers.Size(18,18),b,"absolute");this.maximizeDiv.style.display="none";this.maximizeDiv.className=this.displayClass+"MaximizeButton";OpenLayers.Event.observe(this.maximizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.maximizeControl,this));this.div.appendChild(this.maximizeDiv);var b=g+"layer-switcher-minimize.png";this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_minimizeDiv",null,new OpenLayers.Size(18,18),b,"absolute");this.minimizeDiv.style.display="none";this.minimizeDiv.className=this.displayClass+"MinimizeButton";OpenLayers.Event.observe(this.minimizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.minimizeControl,this));this.div.appendChild(this.minimizeDiv);var k=["dblclick","mousedown"];for(var c=0,a=k.length;c<a;c++){OpenLayers.Event.observe(this.maximizeDiv,k[c],OpenLayers.Event.stop);OpenLayers.Event.observe(this.minimizeDiv,k[c],OpenLayers.Event.stop)}this.minimizeControl()}else{this.element.style.display=""}if(this.map.getExtent()){this.update()}this.map.events.register("moveend",this,this.update);return this.div},baseLayerDraw:function(){this.draw();this.map.events.unregister("changebaselayer",this,this.baseLayerDraw)},rectDrag:function(o){var f=this.handlers.drag.last.x-o.x;var b=this.handlers.drag.last.y-o.y;if(f!=0||b!=0){var l=this.rectPxBounds.top;var a=this.rectPxBounds.left;var g=Math.abs(this.rectPxBounds.getHeight());var c=this.rectPxBounds.getWidth();var k=Math.max(0,(l-b));k=Math.min(k,this.ovmap.size.h-this.hComp-g);var m=Math.max(0,(a-f));m=Math.min(m,this.ovmap.size.w-this.wComp-c);this.setRectPxBounds(new OpenLayers.Bounds(m,k+g,m+c,k))}},mapDivClick:function(o){var b=this.rectPxBounds.getCenterPixel();var g=o.xy.x-b.x;var f=o.xy.y-b.y;var l=this.rectPxBounds.top;var c=this.rectPxBounds.left;var p=Math.abs(this.rectPxBounds.getHeight());var a=this.rectPxBounds.getWidth();var k=Math.max(0,(l+f));k=Math.min(k,this.ovmap.size.h-p);var m=Math.max(0,(c+g));m=Math.min(m,this.ovmap.size.w-a);this.setRectPxBounds(new OpenLayers.Bounds(m,k+p,m+a,k));this.updateMapToRect()},maximizeControl:function(a){this.element.style.display="";this.showToggle(false);if(a!=null){OpenLayers.Event.stop(a)}},minimizeControl:function(a){this.element.style.display="none";this.showToggle(true);if(a!=null){OpenLayers.Event.stop(a)}},showToggle:function(a){this.maximizeDiv.style.display=a?"":"none";this.minimizeDiv.style.display=a?"none":""},update:function(){if(this.ovmap==null){this.createMap()}if(this.autoPan||!this.isSuitableOverview()){this.updateOverview()}this.updateRectToMap()},isSuitableOverview:function(){var b=this.map.getExtent();var a=this.map.maxExtent;var c=new OpenLayers.Bounds(Math.max(b.left,a.left),Math.max(b.bottom,a.bottom),Math.min(b.right,a.right),Math.min(b.top,a.top));if(this.ovmap.getProjection()!=this.map.getProjection()){c=c.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())}var f=this.ovmap.getResolution()/this.map.getResolution();return((f>this.minRatio)&&(f<=this.maxRatio)&&(this.ovmap.getExtent().containsBounds(c)))},updateOverview:function(){var c=this.map.getResolution();var b=this.ovmap.getResolution();var f=b/c;if(f>this.maxRatio){b=this.minRatio*c}else{if(f<=this.minRatio){b=this.maxRatio*c}}var a;if(this.ovmap.getProjection()!=this.map.getProjection()){a=this.map.center.clone();a.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())}else{a=this.map.center}this.ovmap.setCenter(a,this.ovmap.getZoomForResolution(b*this.resolutionFactor));this.updateRectToMap()},createMap:function(){var b=OpenLayers.Util.extend({controls:[],maxResolution:"auto",fallThrough:false},this.mapOptions);this.ovmap=new OpenLayers.Map(this.mapDiv,b);OpenLayers.Event.stopObserving(window,"unload",this.ovmap.unloadDestroy);this.ovmap.addLayers(this.layers);this.ovmap.zoomToMaxExtent();this.wComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-right-width"));this.wComp=(this.wComp)?this.wComp:2;this.hComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-bottom-width"));this.hComp=(this.hComp)?this.hComp:2;this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.rectDrag,done:this.updateMapToRect},{map:this.ovmap});this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.mapDivClick},{single:true,"double":false,stopSingle:true,stopDouble:true,pixelTolerance:1,map:this.ovmap});this.handlers.click.activate();this.rectEvents=new OpenLayers.Events(this,this.extentRectangle,null,true);this.rectEvents.register("mouseover",this,function(f){if(!this.handlers.drag.active&&!this.map.dragging){this.handlers.drag.activate()}});this.rectEvents.register("mouseout",this,function(f){if(!this.handlers.drag.dragging){this.handlers.drag.deactivate()}});if(this.ovmap.getProjection()!=this.map.getProjection()){var c=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units;var a=this.ovmap.getProjectionObject().getUnits()||this.ovmap.units||this.ovmap.baseLayer.units;this.resolutionFactor=c&&a?OpenLayers.INCHES_PER_UNIT[c]/OpenLayers.INCHES_PER_UNIT[a]:1}},updateRectToMap:function(){var b;if(this.ovmap.getProjection()!=this.map.getProjection()){b=this.map.getExtent().transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())}else{b=this.map.getExtent()}var a=this.getRectBoundsFromMapBounds(b);if(a){this.setRectPxBounds(a)}},updateMapToRect:function(){var a=this.getMapBoundsFromRectBounds(this.rectPxBounds);if(this.ovmap.getProjection()!=this.map.getProjection()){a=a.transform(this.ovmap.getProjectionObject(),this.map.getProjectionObject())}this.map.panTo(a.getCenterLonLat())},setRectPxBounds:function(f){var l=Math.max(f.top,0);var g=Math.max(f.left,0);var b=Math.min(f.top+Math.abs(f.getHeight()),this.ovmap.size.h-this.hComp);var m=Math.min(f.left+f.getWidth(),this.ovmap.size.w-this.wComp);var c=Math.max(m-g,0);var o=Math.max(b-l,0);if(c<this.minRectSize||o<this.minRectSize){this.extentRectangle.className=this.displayClass+this.minRectDisplayClass;var k=g+(c/2)-(this.minRectSize/2);var a=l+(o/2)-(this.minRectSize/2);this.extentRectangle.style.top=Math.round(a)+"px";this.extentRectangle.style.left=Math.round(k)+"px";this.extentRectangle.style.height=this.minRectSize+"px";this.extentRectangle.style.width=this.minRectSize+"px"}else{this.extentRectangle.className=this.displayClass+"ExtentRectangle";this.extentRectangle.style.top=Math.round(l)+"px";this.extentRectangle.style.left=Math.round(g)+"px";this.extentRectangle.style.height=Math.round(o)+"px";this.extentRectangle.style.width=Math.round(c)+"px"}this.rectPxBounds=new OpenLayers.Bounds(Math.round(g),Math.round(b),Math.round(m),Math.round(l))},getRectBoundsFromMapBounds:function(f){var a=new OpenLayers.LonLat(f.left,f.bottom);var k=new OpenLayers.LonLat(f.right,f.top);var c=this.getOverviewPxFromLonLat(a);var b=this.getOverviewPxFromLonLat(k);var g=null;if(c&&b){g=new OpenLayers.Bounds(c.x,c.y,b.x,b.y)}return g},getMapBoundsFromRectBounds:function(f){var c=new OpenLayers.Pixel(f.left,f.bottom);var b=new OpenLayers.Pixel(f.right,f.top);var a=this.getLonLatFromOverviewPx(c);var g=this.getLonLatFromOverviewPx(b);return new OpenLayers.Bounds(a.lon,a.lat,g.lon,g.lat)},getLonLatFromOverviewPx:function(k){var c=this.ovmap.size;var b=this.ovmap.getResolution();var a=this.ovmap.getExtent().getCenterLonLat();var g=k.x-(c.w/2);var f=k.y-(c.h/2);return new OpenLayers.LonLat(a.lon+g*b,a.lat-f*b)},getOverviewPxFromLonLat:function(f){var b=this.ovmap.getResolution();var c=this.ovmap.getExtent();var a=null;if(c){a=new OpenLayers.Pixel(Math.round(1/b*(f.lon-c.left)),Math.round(1/b*(c.top-f.lat)))}return a},CLASS_NAME:"OpenLayers.Control.OverviewMap"});OpenLayers.Control.KeyboardDefaults=OpenLayers.Class(OpenLayers.Control,{slideFactor:75,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){if(this.handler){this.handler.destroy()}this.handler=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){this.handler=new OpenLayers.Handler.Keyboard(this,{keydown:this.defaultKeyPress});this.activate()},defaultKeyPress:function(a){switch(a.keyCode){case OpenLayers.Event.KEY_LEFT:this.map.pan(-this.slideFactor,0);break;case OpenLayers.Event.KEY_RIGHT:this.map.pan(this.slideFactor,0);break;case OpenLayers.Event.KEY_UP:this.map.pan(0,-this.slideFactor);break;case OpenLayers.Event.KEY_DOWN:this.map.pan(0,this.slideFactor);break;case 33:var b=this.map.getSize();this.map.pan(0,-0.75*b.h);break;case 34:var b=this.map.getSize();this.map.pan(0,0.75*b.h);break;case 35:var b=this.map.getSize();this.map.pan(0.75*b.w,0);break;case 36:var b=this.map.getSize();this.map.pan(-0.75*b.w,0);break;case 43:case 61:case 187:case 107:this.map.zoomIn();break;case 45:case 109:case 189:case 95:this.map.zoomOut();break}},CLASS_NAME:"OpenLayers.Control.KeyboardDefaults"});OpenLayers.Control.PanZoom=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,buttons:null,position:null,initialize:function(a){this.position=new OpenLayers.Pixel(OpenLayers.Control.PanZoom.X,OpenLayers.Control.PanZoom.Y);OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this,arguments);this.removeButtons();this.buttons=null;this.position=null},draw:function(b){OpenLayers.Control.prototype.draw.apply(this,arguments);b=this.position;this.buttons=[];var c=new OpenLayers.Size(18,18);var a=new OpenLayers.Pixel(b.x+c.w/2,b.y);this._addButton("panup","north-mini.png",a,c);b.y=a.y+c.h;this._addButton("panleft","west-mini.png",b,c);this._addButton("panright","east-mini.png",b.add(c.w,0),c);this._addButton("pandown","south-mini.png",a.add(0,c.h*2),c);this._addButton("zoomin","zoom-plus-mini.png",a.add(0,c.h*3+5),c);this._addButton("zoomworld","zoom-world-mini.png",a.add(0,c.h*4+5),c);this._addButton("zoomout","zoom-minus-mini.png",a.add(0,c.h*5+5),c);return this.div},_addButton:function(a,f,o,l){var k=OpenLayers.Util.getImagesLocation()+f;var b=OpenLayers.Util.createAlphaImageDiv(this.id+"_"+a,o,l,k,"absolute");this.div.appendChild(b);OpenLayers.Event.observe(b,"mousedown",OpenLayers.Function.bindAsEventListener(this.buttonDown,b));OpenLayers.Event.observe(b,"dblclick",OpenLayers.Function.bindAsEventListener(this.doubleClick,b));OpenLayers.Event.observe(b,"click",OpenLayers.Function.bindAsEventListener(this.doubleClick,b));b.action=a;b.map=this.map;if(!this.slideRatio){var c=this.slideFactor;var g=function(){return c}}else{var m=this.slideRatio;var g=function(p){return this.map.getSize()[p]*m}}b.getSlideFactor=g;this.buttons.push(b);return b},_removeButton:function(a){OpenLayers.Event.stopObservingElement(a);a.map=null;this.div.removeChild(a);OpenLayers.Util.removeItem(this.buttons,a)},removeButtons:function(){for(var a=this.buttons.length-1;a>=0;--a){this._removeButton(this.buttons[a])}},doubleClick:function(a){OpenLayers.Event.stop(a);return false},buttonDown:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}switch(this.action){case"panup":this.map.pan(0,-this.getSlideFactor("h"));break;case"pandown":this.map.pan(0,this.getSlideFactor("h"));break;case"panleft":this.map.pan(-this.getSlideFactor("w"),0);break;case"panright":this.map.pan(this.getSlideFactor("w"),0);break;case"zoomin":this.map.zoomIn();break;case"zoomout":this.map.zoomOut();break;case"zoomworld":this.map.zoomToMaxExtent();break}OpenLayers.Event.stop(a)},CLASS_NAME:"OpenLayers.Control.PanZoom"});OpenLayers.Control.PanZoom.X=4;OpenLayers.Control.PanZoom.Y=4;OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,sliderEvents:null,zoomBarDiv:null,divEvents:null,zoomWorldIcon:false,initialize:function(){OpenLayers.Control.PanZoom.prototype.initialize.apply(this,arguments)},destroy:function(){this._removeZoomBar();this.map.events.un({changebaselayer:this.redraw,scope:this});OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments)},setMap:function(a){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments);this.map.events.register("changebaselayer",this,this.redraw)},redraw:function(){if(this.div!=null){this.removeButtons();this._removeZoomBar()}this.draw()},draw:function(b){OpenLayers.Control.prototype.draw.apply(this,arguments);b=this.position.clone();this.buttons=[];var f=new OpenLayers.Size(18,18);var a=new OpenLayers.Pixel(b.x+f.w/2,b.y);var c=f.w;if(this.zoomWorldIcon){a=new OpenLayers.Pixel(b.x+f.w,b.y)}this._addButton("panup","north-mini.png",a,f);b.y=a.y+f.h;this._addButton("panleft","west-mini.png",b,f);if(this.zoomWorldIcon){this._addButton("zoomworld","zoom-world-mini.png",b.add(f.w,0),f);c*=2}this._addButton("panright","east-mini.png",b.add(c,0),f);this._addButton("pandown","south-mini.png",a.add(0,f.h*2),f);this._addButton("zoomin","zoom-plus-mini.png",a.add(0,f.h*3+5),f);a=this._addZoomBar(a.add(0,f.h*4+5));this._addButton("zoomout","zoom-minus-mini.png",a,f);return this.div},_addZoomBar:function(a){var g=OpenLayers.Util.getImagesLocation();var l=this.id+"_"+this.map.id;var b=this.map.getNumZoomLevels()-1-this.map.getZoom();var c=OpenLayers.Util.createAlphaImageDiv(l,a.add(-1,b*this.zoomStopHeight),new OpenLayers.Size(20,9),g+"slider.png","absolute");this.slider=c;this.sliderEvents=new OpenLayers.Events(this,c,null,true,{includeXY:true});this.sliderEvents.on({mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp,dblclick:this.doubleClick,click:this.doubleClick});var f=new OpenLayers.Size();f.h=this.zoomStopHeight*this.map.getNumZoomLevels();f.w=this.zoomStopWidth;var k=null;if(OpenLayers.Util.alphaHack()){var l=this.id+"_"+this.map.id;k=OpenLayers.Util.createAlphaImageDiv(l,a,new OpenLayers.Size(f.w,this.zoomStopHeight),g+"zoombar.png","absolute",null,"crop");k.style.height=f.h+"px"}else{k=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,a,f,g+"zoombar.png")}this.zoombarDiv=k;this.divEvents=new OpenLayers.Events(this,k,null,true,{includeXY:true});this.divEvents.on({mousedown:this.divClick,mousemove:this.passEventToSlider,dblclick:this.doubleClick,click:this.doubleClick});this.div.appendChild(k);this.startTop=parseInt(k.style.top);this.div.appendChild(c);this.map.events.register("zoomend",this,this.moveZoomBar);a=a.add(0,this.zoomStopHeight*this.map.getNumZoomLevels());return a},_removeZoomBar:function(){this.sliderEvents.un({mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp,dblclick:this.doubleClick,click:this.doubleClick});this.sliderEvents.destroy();this.divEvents.un({mousedown:this.divClick,mousemove:this.passEventToSlider,dblclick:this.doubleClick,click:this.doubleClick});this.divEvents.destroy();this.div.removeChild(this.zoombarDiv);this.zoombarDiv=null;this.div.removeChild(this.slider);this.slider=null;this.map.events.unregister("zoomend",this,this.moveZoomBar)},passEventToSlider:function(a){this.sliderEvents.handleBrowserEvent(a)},divClick:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}var g=a.xy.y;var f=OpenLayers.Util.pagePosition(a.object)[1];var c=(g-f)/this.zoomStopHeight;if(!this.map.fractionalZoom){c=Math.floor(c)}var b=(this.map.getNumZoomLevels()-1)-c;b=Math.min(Math.max(b,0),this.map.getNumZoomLevels()-1);this.map.zoomTo(b);OpenLayers.Event.stop(a)},zoomBarDown:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}this.map.events.on({mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,scope:this});this.mouseDragStart=a.xy.clone();this.zoomStart=a.xy.clone();this.div.style.cursor="move";this.zoombarDiv.offsets=null;OpenLayers.Event.stop(a)},zoomBarDrag:function(b){if(this.mouseDragStart!=null){var a=this.mouseDragStart.y-b.xy.y;var f=OpenLayers.Util.pagePosition(this.zoombarDiv);if((b.clientY-f[1])>0&&(b.clientY-f[1])<parseInt(this.zoombarDiv.style.height)-2){var c=parseInt(this.slider.style.top)-a;this.slider.style.top=c+"px";this.mouseDragStart=b.xy.clone()}OpenLayers.Event.stop(b)}},zoomBarUp:function(b){if(!OpenLayers.Event.isLeftClick(b)){return}if(this.zoomStart){this.div.style.cursor="";this.map.events.un({mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this});var a=this.zoomStart.y-b.xy.y;var c=this.map.zoom;if(this.map.fractionalZoom){c+=a/this.zoomStopHeight;c=Math.min(Math.max(c,0),this.map.getNumZoomLevels()-1)}else{c+=Math.round(a/this.zoomStopHeight)}this.map.zoomTo(c);this.moveZoomBar();this.mouseDragStart=null;OpenLayers.Event.stop(b)}},moveZoomBar:function(){var a=((this.map.getNumZoomLevels()-1)-this.map.getZoom())*this.zoomStopHeight+this.startTop+1;this.slider.style.top=a+"px"},CLASS_NAME:"OpenLayers.Control.PanZoomBar"});OpenLayers.Control.ArgParser=OpenLayers.Class(OpenLayers.Control,{center:null,zoom:null,layers:null,displayProjection:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments)},setMap:function(g){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var c=0,a=this.map.controls.length;c<a;c++){var f=this.map.controls[c];if((f!=this)&&(f.CLASS_NAME=="OpenLayers.Control.ArgParser")){if(f.displayProjection!=this.displayProjection){this.displayProjection=f.displayProjection}break}}if(c==this.map.controls.length){var b=OpenLayers.Util.getParameters();if(b.layers){this.layers=b.layers;this.map.events.register("addlayer",this,this.configureLayers);this.configureLayers()}if(b.lat&&b.lon){this.center=new OpenLayers.LonLat(parseFloat(b.lon),parseFloat(b.lat));if(b.zoom){this.zoom=parseInt(b.zoom)}this.map.events.register("changebaselayer",this,this.setCenter);this.setCenter()}}},setCenter:function(){if(this.map.baseLayer){this.map.events.unregister("changebaselayer",this,this.setCenter);if(this.displayProjection){this.center.transform(this.displayProjection,this.map.getProjectionObject())}this.map.setCenter(this.center,this.zoom)}},configureLayers:function(){if(this.layers.length==this.map.layers.length){this.map.events.unregister("addlayer",this,this.configureLayers);for(var f=0,a=this.layers.length;f<a;f++){var b=this.map.layers[f];var g=this.layers.charAt(f);if(g=="B"){this.map.setBaseLayer(b)}else{if((g=="T")||(g=="F")){b.setVisibility(g=="T")}}}}},CLASS_NAME:"OpenLayers.Control.ArgParser"});OpenLayers.Control.Permalink=OpenLayers.Class(OpenLayers.Control,{argParserClass:OpenLayers.Control.ArgParser,element:null,base:"",displayProjection:null,initialize:function(b,c,a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.element=OpenLayers.Util.getElement(b);this.base=c||document.location.href},destroy:function(){if(this.element.parentNode==this.div){this.div.removeChild(this.element)}this.element=null;this.map.events.unregister("moveend",this,this.updateLink);OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(f){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var b=0,a=this.map.controls.length;b<a;b++){var c=this.map.controls[b];if(c.CLASS_NAME==this.argParserClass.CLASS_NAME){if(c.displayProjection!=this.displayProjection){this.displayProjection=c.displayProjection}break}}if(b==this.map.controls.length){this.map.addControl(new this.argParserClass({displayProjection:this.displayProjection}))}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.element){this.div.className=this.displayClass;this.element=document.createElement("a");this.element.innerHTML=OpenLayers.i18n("permalink");this.element.href="";this.div.appendChild(this.element)}this.map.events.on({moveend:this.updateLink,changelayer:this.updateLink,changebaselayer:this.updateLink,scope:this});this.updateLink();return this.div},updateLink:function(){var a=this.base;if(a.indexOf("?")!=-1){a=a.substring(0,a.indexOf("?"))}a+="?"+OpenLayers.Util.getParameterString(this.createParams());this.element.href=a},createParams:function(a,p,g){a=a||this.map.getCenter();var f=OpenLayers.Util.getParameters(this.base);if(a){f.zoom=p||this.map.getZoom();var o=a.lat;var b=a.lon;if(this.displayProjection){var c=OpenLayers.Projection.transform({x:b,y:o},this.map.getProjectionObject(),this.displayProjection);b=c.x;o=c.y}f.lat=Math.round(o*100000)/100000;f.lon=Math.round(b*100000)/100000;g=g||this.map.layers;f.layers="";for(var k=0,m=g.length;k<m;k++){var l=g[k];if(l.isBaseLayer){f.layers+=(l==this.map.baseLayer)?"B":"0"}else{f.layers+=(l.getVisibility())?"T":"F"}}}return f},CLASS_NAME:"OpenLayers.Control.Permalink"});OpenLayers.Control.Scale=OpenLayers.Class(OpenLayers.Control,{element:null,initialize:function(b,a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.element=OpenLayers.Util.getElement(b)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.element){this.element=document.createElement("div");this.div.appendChild(this.element)}this.map.events.register("moveend",this,this.updateScale);this.updateScale();return this.div},updateScale:function(){var a=this.map.getScale();if(!a){return}if(a>=9500&&a<=950000){a=Math.round(a/1000)+"K"}else{if(a>=950000){a=Math.round(a/1000000)+"M"}else{a=Math.round(a)}}this.element.innerHTML=OpenLayers.i18n("scale",{scaleDenom:a})},CLASS_NAME:"OpenLayers.Control.Scale"});OpenLayers.Control.ScaleBar=OpenLayers.Class(OpenLayers.Control,{element:null,scale:1,displaySystem:"metric",minWidth:100,maxWidth:200,divisions:2,subdivisions:2,showMinorMeasures:false,abbreviateLabel:true,singleLine:false,align:"left",measurementProperties:{english:{units:["miles","feet","inches"],abbr:["mi","ft","in"],inches:[63360,12,1]},metric:{units:["kilómetros","metros","centímetros"],abbr:["km","m","cm"],inches:[39370.07874,39.370079,0.393701]}},limitedStyle:false,customStyles:null,defaultStyles:{Bar:{height:11,top:12,borderLeftWidth:0,borderRightWidth:0},BarAlt:{height:11,top:12,borderLeftWidth:0,borderRightWidth:0},MarkerMajor:{height:13,width:13,top:12,borderLeftWidth:0,borderRightWidth:0},MarkerMinor:{height:13,width:13,top:12,borderLeftWidth:0,borderRightWidth:0},NumbersBox:{height:13,width:40,top:24},LabelBox:{height:15,top:-2},LabelBoxSingleLine:{height:15,width:35,top:5,left:10}},appliedStyles:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]);if(!document.styleSheets){this.limitedStyle=true}if(this.limitedStyle){this.appliedStyles=OpenLayers.Util.extend({},this.defaultStyles);OpenLayers.Util.extend(this.appliedStyles,this.customStyles)}this.element=document.createElement("div");this.element.style.position="relative";this.element.className=this.displayClass+"Wrapper";this.labelContainer=document.createElement("div");this.labelContainer.className=this.displayClass+"Units";this.labelContainer.style.position="absolute";this.graphicsContainer=document.createElement("div");this.graphicsContainer.style.position="absolute";this.graphicsContainer.className=this.displayClass+"Graphics";this.numbersContainer=document.createElement("div");this.numbersContainer.style.position="relative";this.numbersContainer.className=this.displayClass+"Numbers";this.element.appendChild(this.graphicsContainer);this.element.appendChild(this.labelContainer);this.element.appendChild(this.numbersContainer)},destroy:function(){this.map.events.unregister("moveend",this,this.onMoveend);this.div.innerHTML="";OpenLayers.Control.prototype.destroy.apply(this)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.xOffsetMarkerMajor=(this.styleValue("MarkerMajor","borderLeftWidth")+this.styleValue("MarkerMajor","width")+this.styleValue("MarkerMajor","borderRightWidth"))/2;this.xOffsetMarkerMinor=(this.styleValue("MarkerMinor","borderLeftWidth")+this.styleValue("MarkerMinor","width")+this.styleValue("MarkerMinor","borderRightWidth"))/2;this.xOffsetBar=(this.styleValue("Bar","borderLeftWidth")+this.styleValue("Bar","borderRightWidth"))/2;this.xOffsetBarAlt=(this.styleValue("BarAlt","borderLeftWidth")+this.styleValue("BarAlt","borderRightWidth"))/2;this.xOffsetNumbersBox=(this.styleValue("NumbersBox","width"))/2;var c=["Bar","BarAlt","MarkerMajor","MarkerMinor"];if(this.singleLine){c.push("LabelBoxSingleLine")}else{c.push("NumbersBox","LabelBox")}var a=0;for(classIndex=0;classIndex<c.length;++classIndex){var b=c[classIndex];a=Math.max(a,this.styleValue(b,"top")+this.styleValue(b,"height"))}this.element.style.height="30px";this.xOffsetSingleLine=this.styleValue("LabelBoxSingleLine","width")+this.styleValue("LabelBoxSingleLine","left");this.div.appendChild(this.element);this.map.events.register("moveend",this,this.onMoveend);this.update();return this.div},onMoveend:function(){this.update()},update:function(g){if(this.map.baseLayer==null||!this.map.getScale()){return}this.scale=(g!=undefined)?g:this.map.getScale();this.element.title="scale 1:"+this.formatNumber(this.scale);this.element.style.width=this.maxWidth+"px";var l=this.getComp();this.setSubProps(l);this.labelContainer.innerHTML="";this.graphicsContainer.innerHTML="";this.numbersContainer.innerHTML="";var k,p,v,q;var f=this.divisions*this.subdivisions;var m={left:0+(this.singleLine?0:this.xOffsetNumbersBox),center:(this.maxWidth/2)-(f*this.subProps.pixels/2)-(this.singleLine?this.xOffsetSingleLine/2:0),right:this.maxWidth-(f*this.subProps.pixels)-(this.singleLine?this.xOffsetSingleLine:this.xOffsetNumbersBox)};var a=0+m[this.align];var b=0;for(var r=0;r<this.divisions;++r){a=r*this.subdivisions*this.subProps.pixels;a+=m[this.align];b=(r==0)?0:((r*this.subdivisions)*this.subProps.length).toFixed(this.subProps.dec);k=document.createElement("div");k.className=this.displayClass+"MarkerMajor";k.style.position="absolute";k.style.overflow="hidden";k.style.left=Math.round(a-this.xOffsetMarkerMajor)+"px";k.appendChild(document.createTextNode(" "));this.graphicsContainer.appendChild(k);if(!this.singleLine){v=document.createElement("div");v.className=this.displayClass+"NumbersBox";v.style.position="absolute";v.style.overflow="visible";v.style.textAlign="center";try{if(this.showMinorMeasures){v.style.left=Math.round(a-this.xOffsetNumbersBox)-b.length-1+"px"}else{v.style.left=Math.round(a-this.xOffsetNumbersBox)-b.length-1+"px"}}catch(o){}v.appendChild(document.createTextNode(b));this.numbersContainer.appendChild(v)}for(var u=0;u<this.subdivisions;++u){p=document.createElement("div");p.style.position="absolute";p.style.overflow="hidden";p.style.width=Math.round(this.subProps.pixels)+"px";if((u%2)==0){p.className=this.displayClass+"Bar";p.style.left=Math.round(a-this.xOffsetBar)+"px"}else{p.className=this.displayClass+"BarAlt";p.style.left=Math.round(a-this.xOffsetBarAlt)+"px"}p.appendChild(document.createTextNode(" "));this.graphicsContainer.appendChild(p);if(u<(this.subdivisions-1)){a=((r*this.subdivisions)+(u+1))*this.subProps.pixels;a+=m[this.align];b=(r*this.subdivisions+u+1)*this.subProps.length;k=document.createElement("div");k.className=this.displayClass+"MarkerMinor";k.style.position="absolute";k.style.overflow="hidden";k.style.left=Math.round(a-this.xOffsetMarkerMinor)+"px";k.appendChild(document.createTextNode(" "));this.graphicsContainer.appendChild(k);if(this.showMinorMeasures&&!this.singleLine){v=document.createElement("div");v.className=this.displayClass+"NumbersBox";v.style.position="absolute";v.style.overflow="visible";v.style.textAlign="center";v.style.left=Math.round(a-this.xOffsetNumbersBox)+"px";v.appendChild(document.createTextNode(b));this.numbersContainer.appendChild(v)}}}}a=f*this.subProps.pixels;a+=m[this.align];b=(f*this.subProps.length).toFixed(this.subProps.dec);k=document.createElement("div");k.className=this.displayClass+"MarkerMajor";k.style.position="absolute";k.style.overflow="hidden";k.style.left=Math.round(a-this.xOffsetMarkerMajor)+"px";k.appendChild(document.createTextNode(" "));this.graphicsContainer.appendChild(k);if(!this.singleLine){v=document.createElement("div");v.className=this.displayClass+"NumbersBox";v.style.position="absolute";v.style.overflow="visible";v.style.textAlign="center";try{if(this.showMinorMeasures){v.style.left=Math.round(a-this.xOffsetNumbersBox)-b.length-1+"px"}else{v.style.left=Math.round(a-this.xOffsetNumbersBox)-b.length-1+"px"}}catch(o){}v.appendChild(document.createTextNode(b));this.numbersContainer.appendChild(v)}var A=document.createElement("div");A.style.position="absolute";var c;if(this.singleLine){c=b;c=parseInt(c);A.className=this.displayClass+"LabelBoxSingleLine";A.style.left=Math.round(a+this.styleValue("LabelBoxSingleLine","left"))+5+"px";A.style.width="100px"}else{c="";A.className=this.displayClass+"LabelBox";A.style.textAlign="right";A.style.width=Math.round(f*this.subProps.pixels)+"px";A.style.left=Math.round(m[this.align])+30+"px";A.style.overflow="hidden"}if(this.abbreviateLabel){c+=" "+this.subProps.abbr}else{c+=" "+this.subProps.units}A.appendChild(document.createTextNode(c));this.labelContainer.appendChild(A)},getComp:function(){var f=this.measurementProperties[this.displaySystem];var p=f.units.length;var B=new Array(p);var u=this.divisions*this.subdivisions;for(var r=0;r<p;++r){B[r]={};var A=OpenLayers.DOTS_PER_INCH*f.inches[r]/this.scale;var C=((this.minWidth-this.xOffsetNumbersBox)/A)/u;var a=((this.maxWidth-this.xOffsetNumbersBox)/A)/u;for(var g=0;g<u;++g){var k=C*(g+1);var c=a*(g+1);var m=this.getHandsomeNumber(k,c);var l={value:(m.value/(g+1)),score:0,tie:0,dec:0,displayed:0};for(var v=0;v<u;++v){var E=m.value*(v+1)/(g+1);var b=this.getHandsomeNumber(E,E);var q=((v+1)%this.subdivisions==0);var o=((v+1)==u);if((this.singleLine&&o)||(!this.singleLine&&(q||this.showMinorMeasures))){l.score+=b.score;l.tie+=b.tie;l.dec=Math.max(l.dec,b.dec);l.displayed+=1}else{l.score+=b.score/this.subdivisions;l.tie+=b.tie/this.subdivisions}}var D=(r+1)*l.tie/l.displayed;l.score*=D;B[r][g]=l}}return B},setSubProps:function(l){var a=this.measurementProperties[this.displaySystem];var b=null;var g=null;var o=null;var q=null;var c=Number.POSITIVE_INFINITY;var k=Number.POSITIVE_INFINITY;var f=0;for(var p=0;p<l.length;++p){for(valueIndex in l[p]){var m=l[p][valueIndex];if((m.score<c)||((m.score==c)&&(m.tie<k))){c=m.score;k=m.tie;b=m.value;f=m.dec;o=a.units[p];q=a.abbr[p];pixelsPerDisplayUnit=OpenLayers.DOTS_PER_INCH*a.inches[p]/this.scale;g=pixelsPerDisplayUnit*b}}}this.subProps={length:b,pixels:g,units:o,abbr:q,dec:f}},styleValue:function(a,m){var l=0;if(this.limitedStyle){l=this.appliedStyles[a][m]}else{a="."+this.displayClass+a;rules:for(var f=document.styleSheets.length-1;f>=0;--f){var g=document.styleSheets[f];if(!g.disabled){var o;try{if(typeof(g.cssRules)=="undefined"){if(typeof(g.rules)=="undefined"){break}else{o=g.rules}}else{o=g.cssRules}}catch(b){break}for(var c=0;c<o.length;++c){var k=o[c];if(k.selectorText&&(k.selectorText.toLowerCase()==a.toLowerCase())){if(k.style[m]!=""){l=parseInt(k.style[m]);break rules}}}}}}return l?l:0},formatNumber:function(f,m,g,a){m=(m!=undefined)?m:0;g=(g!=undefined)?g:",";a=(a!=undefined)?a:".";var k;var c=Math.round(f).toString();var b=/(-?[0-9]+)([0-9]{3})/;if(m>0){var l=Math.floor(Math.pow(10,m)*(f-Math.round(f)));if(l==0){k=c}else{k=c+dcep+l}}else{k=c}return k},getHandsomeNumber:function(o,l,f){f=(f==null)?10:f;var p={value:o,score:Number.POSITIVE_INFINITY,tie:Number.POSITIVE_INFINITY,dec:3};var r,q,k,m,u,c,g;for(var b=0;b<3;++b){r=Math.pow(2,(-1*b));q=Math.floor(Math.log(l/r)/Math.LN10);for(var a=q;a>(q-f+1);--a){k=Math.max(b-a,0);m=r*Math.pow(10,a);if((m*Math.floor(l/m))>=o){if(o%m==0){u=o/m}else{u=Math.floor(o/m)+1}c=u+(2*b);g=(a<0)?(Math.abs(a)+1):a;if((c<p.score)||((c==p.score)&&(g<p.tie))){p.value=parseFloat((m*u).toFixed(k));p.score=c;p.tie=g;p.dec=k}}}}return p},CLASS_NAME:"OpenLayers.Control.ScaleBar"});OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a])},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.eTop){this.div.style.display="block";this.div.style.position="absolute";this.eTop=document.createElement("div");this.eTop.className=this.displayClass+"Top";var a=this.topInUnits.length;this.div.appendChild(this.eTop);if((this.topOutUnits=="")||(this.topInUnits=="")){this.eTop.style.visibility="hidden"}else{this.eTop.style.visibility="visible"}this.eBottom=document.createElement("div");this.eBottom.className=this.displayClass+"Bottom";this.div.appendChild(this.eBottom);if((this.bottomOutUnits=="")||(this.bottomInUnits=="")){this.eBottom.style.visibility="hidden"}else{this.eBottom.style.visibility="visible"}}this.map.events.register("moveend",this,this.update);this.update();return this.div},getBarLen:function(b){var f=parseInt(Math.log(b)/Math.log(10));var a=Math.pow(10,f);var c=parseInt(b/a);var g;if(c>5){g=5}else{if(c>2){g=2}else{g=1}}return g*a},update:function(){var m=this.map.getResolution();if(!m){return}var r=this.map.getUnits();var c=OpenLayers.INCHES_PER_UNIT;var o=this.maxWidth*m*c[r];var a;var f;if(o>100000){a=this.topOutUnits;f=this.bottomOutUnits}else{a=this.topInUnits;f=this.bottomInUnits}var k=o/c[a];var p=o/c[f];var l=this.getBarLen(k);var g=this.getBarLen(p);k=l/c[r]*c[a];p=g/c[r]*c[f];var b=k/m;var q=p/m;if(this.eBottom.style.visibility=="visible"){this.eBottom.style.width=Math.round(q)+"px";this.eBottom.innerHTML=g+" "+f}if(this.eTop.style.visibility=="visible"){this.eTop.style.width=Math.round(b)+"px";this.eTop.innerHTML=l+" "+a}},CLASS_NAME:"OpenLayers.Control.ScaleLine"});OpenLayers.Control.Snapping=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["beforesnap","snap","unsnap"],DEFAULTS:{tolerance:10,node:true,edge:true,vertex:true},greedy:true,precedence:["node","vertex","edge"],resolution:null,geoToleranceCache:null,layer:null,feature:null,point:null,initialize:function(a){Array.prototype.push.apply(this.EVENT_TYPES,OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,[a]);this.options=a||{};if(this.options.layer){this.setLayer(this.options.layer)}var b=OpenLayers.Util.extend({},this.options.defaults);this.defaults=OpenLayers.Util.applyDefaults(b,this.DEFAULTS);this.setTargets(this.options.targets);if(this.targets.length===0&&this.layer){this.addTargetLayer(this.layer)}this.geoToleranceCache={}},setLayer:function(a){if(this.active){this.deactivate();this.layer=a;this.activate()}else{this.layer=a}},setTargets:function(b){this.targets=[];if(b&&b.length){var f;for(var c=0,a=b.length;c<a;++c){f=b[c];if(f instanceof OpenLayers.Layer.Vector){this.addTargetLayer(f)}else{this.addTarget(f)}}}},addTargetLayer:function(a){this.addTarget({layer:a})},addTarget:function(a){a=OpenLayers.Util.applyDefaults(a,this.defaults);a.nodeTolerance=a.nodeTolerance||a.tolerance;a.vertexTolerance=a.vertexTolerance||a.tolerance;a.edgeTolerance=a.edgeTolerance||a.tolerance;this.targets.push(a)},removeTargetLayer:function(b){var c;for(var a=this.targets.length-1;a>=0;--a){c=this.targets[a];if(c.layer===b){this.removeTarget(c)}}},removeTarget:function(a){return OpenLayers.Util.removeItem(this.targets,a)},activate:function(){var a=OpenLayers.Control.prototype.activate.call(this);if(a){if(this.layer&&this.layer.events){this.layer.events.on({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this})}}return a},deactivate:function(){var a=OpenLayers.Control.prototype.deactivate.call(this);if(a){if(this.layer&&this.layer.events){this.layer.events.un({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this})}}this.feature=null;this.point=null;return a},onSketchModified:function(a){this.feature=a.feature;this.considerSnapping(a.vertex,a.vertex)},onVertexModified:function(a){this.feature=a.feature;var b=this.layer.map.getLonLatFromViewPortPx(a.pixel);this.considerSnapping(a.vertex,new OpenLayers.Geometry.Point(b.lon,b.lat))},considerSnapping:function(m,f){var a={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY,x:null,y:null};var c=false;var o,k;for(var b=0,g=this.targets.length;b<g;++b){k=this.targets[b];o=this.testTarget(k,f);if(o){if(this.greedy){a=o;a.target=k;c=true;break}else{if((o.rank<a.rank)||(o.rank===a.rank&&o.dist<a.dist)){a=o;a.target=k;c=true}}}}if(c){var l=this.events.triggerEvent("beforesnap",{point:m,x:a.x,y:a.y,distance:a.dist,layer:a.target.layer,snapType:this.precedence[a.rank]});if(l!==false){m.x=a.x;m.y=a.y;this.point=m;this.events.triggerEvent("snap",{point:m,snapType:this.precedence[a.rank],layer:a.target.layer,distance:a.dist})}else{c=false}}if(this.point&&!c){m.x=f.x;m.y=f.y;this.point=null;this.events.triggerEvent("unsnap",{point:m})}},testTarget:function(I,l){var G={node:this.getGeoTolerance(I.nodeTolerance),vertex:this.getGeoTolerance(I.vertexTolerance),edge:this.getGeoTolerance(I.edgeTolerance)};var m=Math.max(G.node,G.vertex,G.edge);var o={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY};var g=false;var c=I.layer.features;var b,a,f,H,u,v,r;var q=this.precedence.length;var p=new OpenLayers.LonLat(l.x,l.y);for(var E=0,F=c.length;E<F;++E){b=c[E];if(b!==this.feature&&!b._sketch&&b.state!==OpenLayers.State.DELETE&&(!I.filter||I.filter.evaluate(b.attributes))){if(b.atPoint(p,m,m)){for(var D=0,A=Math.min(o.rank+1,q);D<A;++D){a=this.precedence[D];if(I[a]){if(a==="edge"){u=b.geometry.distanceTo(l,{details:true});v=u.distance;if(v<=G[a]&&v<o.dist){o={rank:D,dist:v,x:u.x0,y:u.y0};g=true;break}}else{f=b.geometry.getVertices(a==="node");r=false;for(var C=0,B=f.length;C<B;++C){H=f[C];v=H.distanceTo(l);if(v<=G[a]&&(D<o.rank||(D===o.rank&&v<o.dist))){o={rank:D,dist:v,x:H.x,y:H.y};g=true;r=true}}if(r){break}}}}}}}return g?o:null},getGeoTolerance:function(a){var b=this.layer.map.getResolution();if(b!==this.resolution){this.resolution=b;this.geoToleranceCache={}}var c=this.geoToleranceCache[a];if(c===undefined){c=a*b;this.geoToleranceCache[a]=c}return c},destroy:function(){if(this.active){this.deactivate()}delete this.layer;delete this.targets;OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Snapping"});OpenLayers.Control.Split=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["beforesplit","split","aftersplit"],layer:null,source:null,sourceOptions:null,tolerance:null,edge:true,deferDelete:false,mutual:true,targetFilter:null,sourceFilter:null,handler:null,initialize:function(a){Array.prototype.push.apply(this.EVENT_TYPES,OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,[a]);this.options=a||{};if(this.options.source){this.setSource(this.options.source)}},setSource:function(a){if(this.active){this.deactivate();if(this.handler){this.handler.destroy();delete this.handler}this.source=a;this.activate()}else{this.source=a}},activate:function(){var a=OpenLayers.Control.prototype.activate.call(this);if(a){if(!this.source){if(!this.handler){this.handler=new OpenLayers.Handler.Path(this,{done:function(b){this.onSketchComplete({feature:new OpenLayers.Feature.Vector(b)})}},{layerOptions:this.sourceOptions})}this.handler.activate()}else{if(this.source.events){this.source.events.on({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this})}}}return a},deactivate:function(){var a=OpenLayers.Control.prototype.deactivate.call(this);if(a){if(this.source&&this.source.events){this.layer.events.un({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this})}}return a},onSketchComplete:function(a){this.feature=null;return !this.considerSplit(a.feature)},afterFeatureModified:function(b){if(b.modified){var a=b.feature;if(a.geometry instanceof OpenLayers.Geometry.LineString||a.geometry instanceof OpenLayers.Geometry.MultiLineString){this.feature=b.feature;this.considerSplit(b.feature)}}},removeByGeometry:function(c,f){for(var b=0,a=c.length;b<a;++b){if(c[b].geometry===f){c.splice(b,1);break}}},isEligible:function(a){return(a.state!==OpenLayers.State.DELETE)&&(a.geometry instanceof OpenLayers.Geometry.LineString||a.geometry instanceof OpenLayers.Geometry.MultiLineString)&&(this.feature!==a)&&(!this.targetFilter||this.targetFilter.evaluate(a.attributes))},considerSplit:function(c){sourceSplit=false;targetSplit=false;if(!this.sourceFilter||this.sourceFilter.evaluate(c.attributes)){var l=this.layer&&this.layer.features||[];var H,u,m,a;var p=[],G=[];var f=(this.layer===this.source)&&this.mutual;var b={edge:this.edge,tolerance:this.tolerance,mutual:f};var o=[c.geometry];var r,g;var A,v;for(var E=0,F=l.length;E<F;++E){r=l[E];if(this.isEligible(r)){g=[r.geometry];for(var D=0;D<o.length;++D){A=o[D];for(var B=0;B<g.length;++B){H=g[B];if(A.getBounds().intersectsBounds(H.getBounds())){u=A.split(H,b);if(u){a=this.events.triggerEvent("beforesplit",{source:c,target:r});if(a!==false){if(f){v=u[0];if(v.length>1){v.unshift(D,1);Array.prototype.splice.apply(o,v);D+=v.length-3}u=u[1]}if(u.length>1){u.unshift(B,1);Array.prototype.splice.apply(g,u);B+=u.length-3}}}}}}if(g&&g.length>1){this.geomsToFeatures(r,g);this.events.triggerEvent("split",{original:r,features:g});Array.prototype.push.apply(p,g);G.push(r);targetSplit=true}}}if(o&&o.length>1){this.geomsToFeatures(c,o);this.events.triggerEvent("split",{original:c,features:o});Array.prototype.push.apply(p,o);G.push(c);sourceSplit=true}if(sourceSplit||targetSplit){if(this.deferDelete){var q,C=[];for(var E=0,F=G.length;E<F;++E){q=G[E];if(q.state===OpenLayers.State.INSERT){C.push(q)}else{q.state=OpenLayers.State.DELETE;this.layer.drawFeature(q)}}this.layer.destroyFeatures(C,{silent:true});for(var E=0,F=p.length;E<F;++E){p[E].state=OpenLayers.State.INSERT}}else{this.layer.destroyFeatures(G,{silent:true})}this.layer.addFeatures(p,{silent:true});this.events.triggerEvent("aftersplit",{source:c,features:p})}}return sourceSplit},geomsToFeatures:function(c,f){var k=c.clone();delete k.geometry;var g;for(var b=0,a=f.length;b<a;++b){g=k.clone();g.geometry=f[b];g.state=OpenLayers.State.INSERT;f[b]=g}},destroy:function(){if(this.active){this.deactivate()}OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Split"});OpenLayers.Control.LayerSwitcher=OpenLayers.Class(OpenLayers.Control,{activeColor:"darkblue",layerStates:null,layersDiv:null,baseLayersDiv:null,baseLayers:null,dataLbl:null,dataLayersDiv:null,dataLayers:null,minimizeDiv:null,maximizeDiv:null,ascending:true,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments);this.layerStates=[]},destroy:function(){OpenLayers.Event.stopObservingElement(this.div);OpenLayers.Event.stopObservingElement(this.minimizeDiv);OpenLayers.Event.stopObservingElement(this.maximizeDiv);this.clearLayersArray("base");this.clearLayersArray("data");this.map.events.un({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.on({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this})},draw:function(){OpenLayers.Control.prototype.draw.apply(this);this.loadContents();if(!this.outsideViewport){this.minimizeControl()}this.redraw();return this.div},clearLayersArray:function(f){var g=this[f+"Layers"];if(g){for(var c=0,a=g.length;c<a;c++){var b=g[c];OpenLayers.Event.stopObservingElement(b.inputElem);OpenLayers.Event.stopObservingElement(b.labelSpan)}}this[f+"LayersDiv"].innerHTML="";this[f+"Layers"]=[]},checkRedraw:function(){var g=false;if(!this.layerStates.length||(this.map.layers.length!=this.layerStates.length)){g=true}else{for(var c=0,a=this.layerStates.length;c<a;c++){var f=this.layerStates[c];var b=this.map.layers[c];if((f.name!=b.name)||(f.inRange!=b.inRange)||(f.id!=b.id)||(f.visibility!=b.visibility)){g=true;break}}}return g},redraw:function(){if(!this.checkRedraw()){return this.div}this.clearLayersArray("base");this.clearLayersArray("data");var f=false;var r=false;var m=this.map.layers.length;this.layerStates=new Array(m);for(var k=0;k<m;k++){var l=this.map.layers[k];this.layerStates[k]={name:l.name,visibility:l.visibility,inRange:l.inRange,id:l.id}}var g=this.map.layers.slice();if(!this.ascending){g.reverse()}for(var k=0,m=g.length;k<m;k++){var l=g[k];var o=l.isBaseLayer;if(l.displayInLayerSwitcher){if(o){r=true}else{f=true}var q=(o)?(l==this.map.baseLayer):l.getVisibility();var p=document.createElement("input");p.id=this.id+"_input_"+l.name;p.name=(o)?"baseLayers":l.name;p.type=(o)?"radio":"checkbox";p.value=l.name;p.checked=q;p.defaultChecked=q;if(!o&&!l.inRange){p.disabled=true}var a={inputElem:p,layer:l,layerSwitcher:this};OpenLayers.Event.observe(p,"mouseup",OpenLayers.Function.bindAsEventListener(this.onInputClick,a));var b=document.createElement("span");if(!o&&!l.inRange){b.style.color="gray"}b.innerHTML=l.name;b.style.verticalAlign=(o)?"bottom":"baseline";OpenLayers.Event.observe(b,"click",OpenLayers.Function.bindAsEventListener(this.onInputClick,a));var v=document.createElement("br");var u=(o)?this.baseLayers:this.dataLayers;u.push({layer:l,inputElem:p,labelSpan:b});var c=(o)?this.baseLayersDiv:this.dataLayersDiv;c.appendChild(p);c.appendChild(b);c.appendChild(v)}}this.dataLbl.style.display=(f)?"":"none";this.baseLbl.style.display=(r)?"":"none";return this.div},onInputClick:function(a){if(!this.inputElem.disabled){if(this.inputElem.type=="radio"){this.inputElem.checked=true;this.layer.map.setBaseLayer(this.layer)}else{this.inputElem.checked=!this.inputElem.checked;this.layerSwitcher.updateMap()}}OpenLayers.Event.stop(a)},onLayerClick:function(a){this.updateMap()},updateMap:function(){for(var b=0,a=this.baseLayers.length;b<a;b++){var c=this.baseLayers[b];if(c.inputElem.checked){this.map.setBaseLayer(c.layer,false)}}for(var b=0,a=this.dataLayers.length;b<a;b++){var c=this.dataLayers[b];c.layer.setVisibility(c.inputElem.checked)}},maximizeControl:function(a){this.div.style.width="20em";this.div.style.height="";this.showControls(false);if(a!=null){OpenLayers.Event.stop(a)}},minimizeControl:function(a){this.div.style.width="0px";this.div.style.height="0px";this.showControls(true);if(a!=null){OpenLayers.Event.stop(a)}},showControls:function(a){this.maximizeDiv.style.display=a?"":"none";this.minimizeDiv.style.display=a?"none":"";this.layersDiv.style.display=a?"none":""},loadContents:function(){this.div.style.position="absolute";this.div.style.top="25px";this.div.style.right="0px";this.div.style.left="";this.div.style.fontFamily="sans-serif";this.div.style.fontWeight="bold";this.div.style.marginTop="3px";this.div.style.marginLeft="3px";this.div.style.marginBottom="3px";this.div.style.fontSize="smaller";this.div.style.color="white";this.div.style.backgroundColor="transparent";OpenLayers.Event.observe(this.div,"mouseup",OpenLayers.Function.bindAsEventListener(this.mouseUp,this));OpenLayers.Event.observe(this.div,"click",this.ignoreEvent);OpenLayers.Event.observe(this.div,"mousedown",OpenLayers.Function.bindAsEventListener(this.mouseDown,this));OpenLayers.Event.observe(this.div,"dblclick",this.ignoreEvent);this.layersDiv=document.createElement("div");this.layersDiv.id=this.id+"_layersDiv";this.layersDiv.style.paddingTop="5px";this.layersDiv.style.paddingLeft="10px";this.layersDiv.style.paddingBottom="5px";this.layersDiv.style.paddingRight="75px";this.layersDiv.style.backgroundColor=this.activeColor;this.layersDiv.style.width="100%";this.layersDiv.style.height="100%";this.baseLbl=document.createElement("div");this.baseLbl.innerHTML=OpenLayers.i18n("baseLayer");this.baseLbl.style.marginTop="3px";this.baseLbl.style.marginLeft="3px";this.baseLbl.style.marginBottom="3px";this.baseLayersDiv=document.createElement("div");this.baseLayersDiv.style.paddingLeft="10px";this.dataLbl=document.createElement("div");this.dataLbl.innerHTML=OpenLayers.i18n("overlays");this.dataLbl.style.marginTop="3px";this.dataLbl.style.marginLeft="3px";this.dataLbl.style.marginBottom="3px";this.dataLayersDiv=document.createElement("div");this.dataLayersDiv.style.paddingLeft="10px";if(this.ascending){this.layersDiv.appendChild(this.baseLbl);this.layersDiv.appendChild(this.baseLayersDiv);this.layersDiv.appendChild(this.dataLbl);this.layersDiv.appendChild(this.dataLayersDiv)}else{this.layersDiv.appendChild(this.dataLbl);this.layersDiv.appendChild(this.dataLayersDiv);this.layersDiv.appendChild(this.baseLbl);this.layersDiv.appendChild(this.baseLayersDiv)}this.div.appendChild(this.layersDiv);OpenLayers.Rico.Corner.round(this.div,{corners:"tl bl",bgColor:"transparent",color:this.activeColor,blend:false});OpenLayers.Rico.Corner.changeOpacity(this.layersDiv,0.75);var c=OpenLayers.Util.getImagesLocation();var b=new OpenLayers.Size(18,18);var a=c+"layer-switcher-maximize.png";this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MaximizeDiv",null,b,a,"absolute");this.maximizeDiv.style.top="5px";this.maximizeDiv.style.right="0px";this.maximizeDiv.style.left="";this.maximizeDiv.style.display="none";OpenLayers.Event.observe(this.maximizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.maximizeControl,this));this.div.appendChild(this.maximizeDiv);var a=c+"layer-switcher-minimize.png";var b=new OpenLayers.Size(18,18);this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MinimizeDiv",null,b,a,"absolute");this.minimizeDiv.style.top="5px";this.minimizeDiv.style.right="0px";this.minimizeDiv.style.left="";this.minimizeDiv.style.display="none";OpenLayers.Event.observe(this.minimizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.minimizeControl,this));this.div.appendChild(this.minimizeDiv)},ignoreEvent:function(a){OpenLayers.Event.stop(a)},mouseDown:function(a){this.isMouseDown=true;this.ignoreEvent(a)},mouseUp:function(a){if(this.isMouseDown){this.isMouseDown=false;this.ignoreEvent(a)}},CLASS_NAME:"OpenLayers.Control.LayerSwitcher"});OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,{layer:null,callbacks:null,EVENT_TYPES:["featureadded"],featureAdded:function(){},handlerOptions:null,initialize:function(b,c,a){this.EVENT_TYPES=OpenLayers.Control.DrawFeature.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,[a]);this.callbacks=OpenLayers.Util.extend({done:this.drawFeature,modify:function(k,g){this.layer.events.triggerEvent("sketchmodified",{vertex:k,feature:g})},create:function(k,g){this.layer.events.triggerEvent("sketchstarted",{vertex:k,feature:g})}},this.callbacks);this.layer=b;var f=this.layer.styleMap&&this.layer.styleMap.styles.temporary;if(f){this.handlerOptions=this.handlerOptions||{};this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":f})})}this.handler=new c(this,this.callbacks,this.handlerOptions)},drawFeature:function(c){var a=new OpenLayers.Feature.Vector(c);var b=this.layer.events.triggerEvent("sketchcomplete",{feature:a});if(b!==false){a.state=OpenLayers.State.INSERT;this.layer.addFeatures([a]);this.featureAdded(a);this.events.triggerEvent("featureadded",{feature:a})}},CLASS_NAME:"OpenLayers.Control.DrawFeature"});OpenLayers.Control.DragFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,onStart:function(b,a){},onDrag:function(b,a){},onComplete:function(b,a){},layer:null,feature:null,dragCallbacks:{},featureCallbacks:{},lastPixel:null,initialize:function(b,a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.layer=b;this.handlers={drag:new OpenLayers.Handler.Drag(this,OpenLayers.Util.extend({down:this.downFeature,move:this.moveFeature,up:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks)),feature:new OpenLayers.Handler.Feature(this,this.layer,OpenLayers.Util.extend({over:this.overFeature,out:this.outFeature},this.featureCallbacks),{geometryTypes:this.geometryTypes})}},destroy:function(){this.layer=null;OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return(this.handlers.feature.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments))},deactivate:function(){this.handlers.drag.deactivate();this.handlers.feature.deactivate();this.feature=null;this.dragging=false;this.lastPixel=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over");return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},overFeature:function(a){if(!this.handlers.drag.dragging){this.feature=a;this.handlers.drag.activate();this.over=true;OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass+"Over")}else{if(this.feature.id==a.id){this.over=true}else{this.over=false}}},downFeature:function(a){this.lastPixel=a;this.onStart(this.feature,a)},moveFeature:function(a){var b=this.map.getResolution();this.feature.geometry.move(b*(a.x-this.lastPixel.x),b*(this.lastPixel.y-a.y));this.layer.drawFeature(this.feature);this.lastPixel=a;this.onDrag(this.feature,a)},upFeature:function(a){if(!this.over){this.handlers.drag.deactivate()}},doneDragging:function(a){this.onComplete(this.feature,a)},outFeature:function(a){if(!this.handlers.drag.dragging){this.over=false;this.handlers.drag.deactivate();OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over");this.feature=null}else{if(this.feature.id==a.id){this.over=false}}},cancel:function(){this.handlers.drag.deactivate();this.over=false},setMap:function(a){this.handlers.drag.setMap(a);this.handlers.feature.setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.DragFeature"});OpenLayers.Control.ModifyFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,clickout:true,toggle:true,layer:null,feature:null,vertices:null,virtualVertices:null,selectControl:null,dragControl:null,handlers:null,deleteCodes:null,virtualStyle:null,mode:null,modified:false,radiusHandle:null,dragHandle:null,onModificationStart:function(){},onModification:function(){},onModificationEnd:function(){},initialize:function(f,c){this.layer=f;this.vertices=[];this.virtualVertices=[];this.virtualStyle=OpenLayers.Util.extend({},this.layer.style||this.layer.styleMap.createSymbolizer());this.virtualStyle.fillOpacity=0.3;this.virtualStyle.strokeOpacity=0.3;this.deleteCodes=[46,68];this.mode=OpenLayers.Control.ModifyFeature.RESHAPE;OpenLayers.Control.prototype.initialize.apply(this,[c]);if(!(this.deleteCodes instanceof Array)){this.deleteCodes=[this.deleteCodes]}var k=this;var a={geometryTypes:this.geometryTypes,clickout:this.clickout,toggle:this.toggle,onBeforeSelect:this.beforeSelectFeature,onSelect:this.selectFeature,onUnselect:this.unselectFeature,scope:this};this.selectControl=new OpenLayers.Control.SelectFeature(f,a);var b={geometryTypes:["OpenLayers.Geometry.Point"],snappingOptions:this.snappingOptions,onStart:function(m,l){k.dragStart.apply(k,[m,l])},onDrag:function(m,l){k.dragVertex.apply(k,[m,l])},onComplete:function(l){k.dragComplete.apply(k,[l])}};this.dragControl=new OpenLayers.Control.DragFeature(f,b);var g={keydown:this.handleKeypress};this.handlers={keyboard:new OpenLayers.Handler.Keyboard(this,g)}},destroy:function(){this.layer=null;this.selectControl.destroy();this.dragControl.destroy();OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return(this.selectControl.activate()&&this.handlers.keyboard.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments))},deactivate:function(){var a=false;if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.layer.removeFeatures(this.vertices,{silent:true});this.layer.removeFeatures(this.virtualVertices,{silent:true});this.vertices=[];this.dragControl.deactivate();if(this.feature&&this.feature.geometry&&this.feature.layer){this.selectControl.unselect.apply(this.selectControl,[this.feature])}this.selectControl.deactivate();this.handlers.keyboard.deactivate();a=true}return a},beforeSelectFeature:function(a){return this.layer.events.triggerEvent("beforefeaturemodified",{feature:a})},selectFeature:function(a){this.feature=a;this.modified=false;this.resetVertices();this.dragControl.activate();this.onModificationStart(this.feature)},unselectFeature:function(a){this.layer.removeFeatures(this.vertices,{silent:true});this.vertices=[];this.layer.destroyFeatures(this.virtualVertices,{silent:true});this.virtualVertices=[];if(this.dragHandle){this.layer.destroyFeatures([this.dragHandle],{silent:true});delete this.dragHandle}if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],{silent:true});delete this.radiusHandle}this.feature=null;this.dragControl.deactivate();this.onModificationEnd(a);this.layer.events.triggerEvent("afterfeaturemodified",{feature:a,modified:this.modified});this.modified=false},dragStart:function(b,a){if(b!=this.feature&&!b.geometry.parent&&b!=this.dragHandle&&b!=this.radiusHandle){if(this.feature){this.selectControl.clickFeature.apply(this.selectControl,[this.feature])}if(this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,b.geometry.CLASS_NAME)!=-1){this.selectControl.clickFeature.apply(this.selectControl,[b]);this.dragControl.overFeature.apply(this.dragControl,[b]);this.dragControl.lastPixel=a;this.dragControl.handlers.drag.started=true;this.dragControl.handlers.drag.start=a;this.dragControl.handlers.drag.last=a}}},dragVertex:function(b,a){this.modified=true;if(this.feature.geometry.CLASS_NAME=="OpenLayers.Geometry.Point"){if(this.feature!=b){this.feature=b}this.layer.events.triggerEvent("vertexmodified",{vertex:b.geometry,feature:this.feature,pixel:a})}else{if(b._index){b.geometry.parent.addComponent(b.geometry,b._index);delete b._index;OpenLayers.Util.removeItem(this.virtualVertices,b);this.vertices.push(b)}else{if(b==this.dragHandle){this.layer.removeFeatures(this.vertices,{silent:true});this.vertices=[];if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],{silent:true});this.radiusHandle=null}}else{if(b!==this.radiusHandle){this.layer.events.triggerEvent("vertexmodified",{vertex:b.geometry,feature:this.feature,pixel:a})}}}if(this.virtualVertices.length>0){this.layer.destroyFeatures(this.virtualVertices,{silent:true});this.virtualVertices=[]}this.layer.drawFeature(this.feature,this.selectControl.renderIntent)}this.layer.drawFeature(b)},dragComplete:function(a){this.resetVertices();this.setFeatureState();this.onModification(this.feature);this.layer.events.triggerEvent("featuremodified",{feature:this.feature})},setFeatureState:function(){if(this.feature.state!=OpenLayers.State.INSERT&&this.feature.state!=OpenLayers.State.DELETE){this.feature.state=OpenLayers.State.UPDATE}},resetVertices:function(){if(this.dragControl.feature){this.dragControl.outFeature(this.dragControl.feature)}if(this.vertices.length>0){this.layer.removeFeatures(this.vertices,{silent:true});this.vertices=[]}if(this.virtualVertices.length>0){this.layer.removeFeatures(this.virtualVertices,{silent:true});this.virtualVertices=[]}if(this.dragHandle){this.layer.destroyFeatures([this.dragHandle],{silent:true});this.dragHandle=null}if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],{silent:true});this.radiusHandle=null}if(this.feature&&this.feature.geometry.CLASS_NAME!="OpenLayers.Geometry.Point"){if((this.mode&OpenLayers.Control.ModifyFeature.DRAG)){this.collectDragHandle()}if((this.mode&(OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE))){this.collectRadiusHandle()}if(this.mode&OpenLayers.Control.ModifyFeature.RESHAPE){if(!(this.mode&OpenLayers.Control.ModifyFeature.RESIZE)){this.collectVertices()}}}},handleKeypress:function(a){var b=a.keyCode;if(this.feature&&OpenLayers.Util.indexOf(this.deleteCodes,b)!=-1){var c=this.dragControl.feature;if(c&&OpenLayers.Util.indexOf(this.vertices,c)!=-1&&!this.dragControl.handlers.drag.dragging&&c.geometry.parent){c.geometry.parent.removeComponent(c.geometry);this.layer.drawFeature(this.feature,this.selectControl.renderIntent);this.resetVertices();this.setFeatureState();this.onModification(this.feature);this.layer.events.triggerEvent("featuremodified",{feature:this.feature})}}},collectVertices:function(){this.vertices=[];this.virtualVertices=[];var a=this;function b(m){var f,g,o,k;if(m.CLASS_NAME=="OpenLayers.Geometry.Point"){g=new OpenLayers.Feature.Vector(m);g._sketch=true;a.vertices.push(g)}else{var c=m.components.length;if(m.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){c-=1}for(f=0;f<c;++f){o=m.components[f];if(o.CLASS_NAME=="OpenLayers.Geometry.Point"){g=new OpenLayers.Feature.Vector(o);g._sketch=true;a.vertices.push(g)}else{b(o)}}if(m.CLASS_NAME!="OpenLayers.Geometry.MultiPoint"){for(f=0,k=m.components.length;f<k-1;++f){var r=m.components[f];var u=m.components[f+1];if(r.CLASS_NAME=="OpenLayers.Geometry.Point"&&u.CLASS_NAME=="OpenLayers.Geometry.Point"){var p=(r.x+u.x)/2;var l=(r.y+u.y)/2;var q=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(p,l),null,a.virtualStyle);q.geometry.parent=m;q._index=f+1;q._sketch=true;a.virtualVertices.push(q)}}}}}b.call(this,this.feature.geometry);this.layer.addFeatures(this.virtualVertices,{silent:true});this.layer.addFeatures(this.vertices,{silent:true})},collectDragHandle:function(){var f=this.feature.geometry;var a=f.getBounds().getCenterLonLat();var c=new OpenLayers.Geometry.Point(a.lon,a.lat);var b=new OpenLayers.Feature.Vector(c);c.move=function(g,k){OpenLayers.Geometry.Point.prototype.move.call(this,g,k);f.move(g,k)};b._sketch=true;this.dragHandle=b;this.layer.addFeatures([this.dragHandle],{silent:true})},collectRadiusHandle:function(){var m=this.feature.geometry;var a=m.getBounds();var b=a.getCenterLonLat();var o=new OpenLayers.Geometry.Point(b.lon,b.lat);var l=new OpenLayers.Geometry.Point(a.right,a.bottom);var k=new OpenLayers.Feature.Vector(l);var c=(this.mode&OpenLayers.Control.ModifyFeature.RESIZE);var g=(this.mode&OpenLayers.Control.ModifyFeature.RESHAPE);var f=(this.mode&OpenLayers.Control.ModifyFeature.ROTATE);l.move=function(F,E){OpenLayers.Geometry.Point.prototype.move.call(this,F,E);var G=this.x-o.x;var B=this.y-o.y;var H=G-F;var C=B-E;if(f){var q=Math.atan2(C,H);var p=Math.atan2(B,G);var v=p-q;v*=180/Math.PI;m.rotate(v,o)}if(c){var u,D;if(g){u=B/C;D=(G/H)/u}else{var A=Math.sqrt((H*H)+(C*C));var r=Math.sqrt((G*G)+(B*B));u=r/A}m.resize(u,o,D)}};k._sketch=true;this.radiusHandle=k;this.layer.addFeatures([this.radiusHandle],{silent:true})},setMap:function(a){this.selectControl.setMap(a);this.dragControl.setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.ModifyFeature"});OpenLayers.Control.ModifyFeature.RESHAPE=1;OpenLayers.Control.ModifyFeature.RESIZE=2;OpenLayers.Control.ModifyFeature.ROTATE=4;OpenLayers.Control.ModifyFeature.DRAG=8;OpenLayers.Control.Panel=OpenLayers.Class(OpenLayers.Control,{controls:null,defaultControl:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.controls=[]},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this,arguments);for(var a=this.controls.length-1;a>=0;a--){if(this.controls[a].events){this.controls[a].events.un({activate:this.redraw,deactivate:this.redraw,scope:this})}OpenLayers.Event.stopObservingElement(this.controls[a].panel_div);this.controls[a].panel_div=null}},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){for(var b=0,a=this.controls.length;b<a;b++){if(this.controls[b]==this.defaultControl){this.controls[b].activate()}}this.redraw();return true}else{return false}},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){for(var b=0,a=this.controls.length;b<a;b++){this.controls[b].deactivate()}return true}else{return false}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);for(var b=0,a=this.controls.length;b<a;b++){this.map.addControl(this.controls[b]);this.controls[b].deactivate();this.controls[b].events.on({activate:this.redraw,deactivate:this.redraw,scope:this})}this.activate();return this.div},redraw:function(){this.div.innerHTML="";if(this.active){for(var c=0,a=this.controls.length;c<a;c++){var b=this.controls[c].panel_div;if(this.controls[c].active){b.className=this.controls[c].displayClass+"ItemActive"}else{b.className=this.controls[c].displayClass+"ItemInactive"}this.div.appendChild(b)}}},activateControl:function(c){if(!this.active){return false}if(c.type==OpenLayers.Control.TYPE_BUTTON){c.trigger();this.redraw();return}if(c.type==OpenLayers.Control.TYPE_TOGGLE){if(c.active){c.deactivate()}else{c.activate()}this.redraw();return}for(var b=0,a=this.controls.length;b<a;b++){if(this.controls[b]!=c){if(this.controls[b].type!=OpenLayers.Control.TYPE_TOGGLE){this.controls[b].deactivate()}}}c.activate()},addControls:function(b){if(!(b instanceof Array)){b=[b]}this.controls=this.controls.concat(b);for(var f=0,a=b.length;f<a;f++){var c=document.createElement("div");var g=document.createTextNode(" ");b[f].panel_div=c;if(b[f].title!=""){b[f].panel_div.title=b[f].title}OpenLayers.Event.observe(b[f].panel_div,"click",OpenLayers.Function.bind(this.onClick,this,b[f]));OpenLayers.Event.observe(b[f].panel_div,"mousedown",OpenLayers.Function.bindAsEventListener(OpenLayers.Event.stop))}if(this.map){for(var f=0,a=b.length;f<a;f++){this.map.addControl(b[f]);b[f].deactivate();b[f].events.on({activate:this.redraw,deactivate:this.redraw,scope:this})}this.redraw()}},onClick:function(b,a){OpenLayers.Event.stop(a?a:window.event);this.activateControl(b)},getControlsBy:function(c,a){var f=(typeof a.test=="function");var b=OpenLayers.Array.filter(this.controls,function(g){return g[c]==a||(f&&a.test(g[c]))});return b},getControlsByName:function(a){return this.getControlsBy("name",a)},getControlsByClass:function(a){return this.getControlsBy("CLASS_NAME",a)},CLASS_NAME:"OpenLayers.Control.Panel"});OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["beforefeaturehighlighted","featurehighlighted","featureunhighlighted"],multipleKey:null,toggleKey:null,multiple:false,clickout:true,toggle:false,hover:false,highlightOnly:false,box:false,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(c,a){this.EVENT_TYPES=OpenLayers.Control.SelectFeature.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,[a]);if(this.scope===null){this.scope=this}if(c instanceof Array){this.layers=c;this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:c})}else{this.layer=c}var b={click:this.clickFeature,clickout:this.clickoutFeature};if(this.hover){b.over=this.overFeature;b.out=this.outFeature}this.callbacks=OpenLayers.Util.extend(b,this.callbacks);this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})};if(this.box){this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"})}},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this,arguments);if(this.layers){this.layer.destroy()}},activate:function(){if(!this.active){if(this.layers){this.map.addLayer(this.layer)}this.handlers.feature.activate();if(this.box&&this.handlers.box){this.handlers.box.activate()}}return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.active){this.handlers.feature.deactivate();if(this.handlers.box){this.handlers.box.deactivate()}if(this.layers){this.map.removeLayer(this.layer)}}return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(b){var k=this.layers||[this.layer];var g,f;for(var a=0;a<k.length;++a){g=k[a];for(var c=g.selectedFeatures.length-1;c>=0;--c){f=g.selectedFeatures[c];if(!b||b.except!=f){this.unselect(f)}}}},clickFeature:function(a){if(!this.hover){var b=(OpenLayers.Util.indexOf(a.layer.selectedFeatures,a)>-1);if(b){if(this.toggleSelect()){this.unselect(a)}else{if(!this.multipleSelect()){this.unselectAll({except:a})}}}else{if(!this.multipleSelect()){this.unselectAll({except:a})}this.select(a)}}},multipleSelect:function(){return this.multiple||(this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey])},toggleSelect:function(){return this.toggle||(this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey])},clickoutFeature:function(a){if(!this.hover&&this.clickout){this.unselectAll()}},overFeature:function(b){var a=b.layer;if(this.hover){if(this.highlightOnly){this.highlight(b)}else{if(OpenLayers.Util.indexOf(a.selectedFeatures,b)==-1){this.select(b)}}}},outFeature:function(a){if(this.hover){if(this.highlightOnly){if(a._lastHighlighter==this.id){if(a._prevHighlighter&&a._prevHighlighter!=this.id){delete a._lastHighlighter;var b=this.map.getControl(a._prevHighlighter);if(b){b.highlight(a)}}else{this.unhighlight(a)}}}else{this.unselect(a)}}},highlight:function(c){var b=c.layer;var a=this.events.triggerEvent("beforefeaturehighlighted",{feature:c});if(a!==false){c._prevHighlighter=c._lastHighlighter;c._lastHighlighter=this.id;var f=this.selectStyle||this.renderIntent;b.drawFeature(c,f);this.events.triggerEvent("featurehighlighted",{feature:c})}},unhighlight:function(b){var a=b.layer;b._lastHighlighter=b._prevHighlighter;delete b._prevHighlighter;a.drawFeature(b,b.style||b.layer.style||"default");this.events.triggerEvent("featureunhighlighted",{feature:b})},select:function(c){var a=this.onBeforeSelect.call(this.scope,c);var b=c.layer;if(a!==false){a=b.events.triggerEvent("beforefeatureselected",{feature:c});if(a!==false){b.selectedFeatures.push(c);this.highlight(c);b.events.triggerEvent("featureselected",{feature:c});this.onSelect.call(this.scope,c)}}},unselect:function(b){var a=b.layer;this.unhighlight(b);OpenLayers.Util.removeItem(a.selectedFeatures,b);a.events.triggerEvent("featureunselected",{feature:b});this.onUnselect.call(this.scope,b)},selectBox:function(g){if(g instanceof OpenLayers.Bounds){var o=this.map.getLonLatFromPixel(new OpenLayers.Pixel(g.left,g.bottom));var q=this.map.getLonLatFromPixel(new OpenLayers.Pixel(g.right,g.top));var a=new OpenLayers.Bounds(o.lon,o.lat,q.lon,q.lat);if(!this.multipleSelect()){this.unselectAll()}var p=this.multiple;this.multiple=true;var f=this.layers||[this.layer];var k;for(var b=0;b<f.length;++b){k=f[b];for(var c=0,m=k.features.length;c<m;++c){var r=k.features[c];if(this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,r.geometry.CLASS_NAME)>-1){if(a.toGeometry().intersects(r.geometry)){if(OpenLayers.Util.indexOf(k.selectedFeatures,r)==-1){this.select(r)}}}}}this.multiple=p}},setMap:function(a){this.handlers.feature.setMap(a);if(this.box){this.handlers.box.setMap(a)}OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.SelectFeature"});OpenLayers.Control.NavigationHistory=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOGGLE,previous:null,previousOptions:null,next:null,nextOptions:null,limit:50,activateOnDraw:true,clearOnDeactivate:false,registry:null,nextStack:null,previousStack:null,listeners:null,restoring:false,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.registry=OpenLayers.Util.extend({moveend:function(){return{center:this.map.getCenter(),resolution:this.map.getResolution()}}},this.registry);this.clear();var b={trigger:OpenLayers.Function.bind(this.previousTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Previous"};OpenLayers.Util.extend(b,this.previousOptions);this.previous=new OpenLayers.Control.Button(b);var c={trigger:OpenLayers.Function.bind(this.nextTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Next"};OpenLayers.Util.extend(c,this.nextOptions);this.next=new OpenLayers.Control.Button(c)},onPreviousChange:function(b,a){if(b&&!this.previous.active){this.previous.activate()}else{if(!b&&this.previous.active){this.previous.deactivate()}}},onNextChange:function(b,a){if(b&&!this.next.active){this.next.activate()}else{if(!b&&this.next.active){this.next.deactivate()}}},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this);this.previous.destroy();this.next.destroy();this.deactivate();for(var a in this){this[a]=null}},setMap:function(a){this.map=a;this.next.setMap(a);this.previous.setMap(a)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.next.draw();this.previous.draw();if(this.activateOnDraw){this.activate()}},previousTrigger:function(){var b=this.previousStack.shift();var a=this.previousStack.shift();if(a!=undefined){this.nextStack.unshift(b);this.previousStack.unshift(a);this.restoring=true;this.restore(a);this.restoring=false;this.onNextChange(this.nextStack[0],this.nextStack.length);this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}else{this.previousStack.unshift(b)}return a},nextTrigger:function(){var a=this.nextStack.shift();if(a!=undefined){this.previousStack.unshift(a);this.restoring=true;this.restore(a);this.restoring=false;this.onNextChange(this.nextStack[0],this.nextStack.length);this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}return a},clear:function(){this.previousStack=[];this.nextStack=[]},restore:function(b){var a=this.map.getZoomForResolution(b.resolution);this.map.setCenter(b.center,a)},setListeners:function(){this.listeners={};for(var a in this.registry){this.listeners[a]=OpenLayers.Function.bind(function(){if(!this.restoring){var b=this.registry[a].apply(this,arguments);this.previousStack.unshift(b);if(this.previousStack.length>1){this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}if(this.previousStack.length>(this.limit+1)){this.previousStack.pop()}if(this.nextStack.length>0){this.nextStack=[];this.onNextChange(null,0)}}return true},this)}},activate:function(){var a=false;if(this.map){if(OpenLayers.Control.prototype.activate.apply(this)){if(this.listeners==null){this.setListeners()}for(var b in this.listeners){this.map.events.register(b,this,this.listeners[b])}a=true;if(this.previousStack.length==0){this.initStack()}}}return a},initStack:function(){if(this.map.getCenter()){this.listeners.moveend()}},deactivate:function(){var b=false;if(this.map){if(OpenLayers.Control.prototype.deactivate.apply(this)){for(var a in this.listeners){this.map.events.unregister(a,this,this.listeners[a])}if(this.clearOnDeactivate){this.clear()}b=true}}return b},CLASS_NAME:"OpenLayers.Control.NavigationHistory"});OpenLayers.Control.Measure=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["measure","measurepartial"],handlerOptions:null,callbacks:null,displaySystem:"metric",geodesic:false,displaySystemUnits:{geographic:["dd"],english:["mi","ft","in"],metric:["km","m"]},partialDelay:300,delayedTrigger:null,persist:false,initialize:function(b,a){this.EVENT_TYPES=OpenLayers.Control.Measure.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,[a]);this.callbacks=OpenLayers.Util.extend({done:this.measureComplete,point:this.measurePartial},this.callbacks);this.handlerOptions=OpenLayers.Util.extend({persist:this.persist},this.handlerOptions);this.handler=new b(this,this.callbacks,this.handlerOptions)},cancel:function(){this.handler.cancel()},updateHandler:function(b,a){var c=this.active;if(c){this.deactivate()}this.handler=new b(this,this.callbacks,a);if(c){this.activate()}},measureComplete:function(a){if(this.delayedTrigger){window.clearTimeout(this.delayedTrigger)}this.measure(a,"measure")},measurePartial:function(a,b){this.delayedTrigger=window.setTimeout(OpenLayers.Function.bind(function(){this.measure(b,"measurepartial")},this),this.partialDelay)},measure:function(f,b){var c,a;if(f.CLASS_NAME.indexOf("LineString")>-1){c=this.getBestLength(f);a=1}else{c=this.getBestArea(f);a=2}this.events.triggerEvent(b,{measure:c[0],units:c[1],order:a,geometry:f})},getBestArea:function(k){var b=this.displaySystemUnits[this.displaySystem];var g,f;for(var c=0,a=b.length;c<a;++c){g=b[c];f=this.getArea(k,g);if(f>1){break}}return[f,g]},getArea:function(k,a){var b,c;if(this.geodesic){b=k.getGeodesicArea(this.map.getProjectionObject());c="m"}else{b=k.getArea();c=this.map.getUnits()}var g=OpenLayers.INCHES_PER_UNIT[a];if(g){var f=OpenLayers.INCHES_PER_UNIT[c];b*=Math.pow((f/g),2)}return b},getBestLength:function(k){var b=this.displaySystemUnits[this.displaySystem];var g,f;for(var c=0,a=b.length;c<a;++c){g=b[c];f=this.getLength(k,g);if(f>1){break}}return[f,g]},getLength:function(k,a){var b,c;if(this.geodesic){b=k.getGeodesicLength(this.map.getProjectionObject());c="m"}else{b=k.getLength();c=this.map.getUnits()}var g=OpenLayers.INCHES_PER_UNIT[a];if(g){var f=OpenLayers.INCHES_PER_UNIT[c];b*=(f/g)}return b},CLASS_NAME:"OpenLayers.Control.Measure"});OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:false,maxFeatures:10,layers:null,queryVisible:false,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handlerOptions:null,handler:null,hoverRequest:null,EVENT_TYPES:["getfeatureinfo"],initialize:function(a){this.EVENT_TYPES=OpenLayers.Control.WMSGetFeatureInfo.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);a=a||{};a.handlerOptions=a.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[a]);if(!this.format){this.format=new OpenLayers.Format.WMSGetFeatureInfo(a.formatOptions)}if(this.hover){this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}))}else{this.handler=new OpenLayers.Handler.Click(this,{click:this.getInfoForClick},this.handlerOptions.click||{})}},activate:function(){if(!this.active){this.handler.activate()}return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},getInfoForClick:function(a){OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");this.request(a.xy,{})},getInfoForHover:function(a){this.request(a.xy,{hover:true})},cancelHover:function(){if(this.hoverRequest){this.hoverRequest.abort();this.hoverRequest=null}},findLayers:function(){var k=[];var g=this.layers||this.map.layers;var f,b;for(var c=0,a=g.length;c<a;++c){f=g[c];if(f instanceof OpenLayers.Layer.WMS&&(!this.queryVisible||f.getVisibility())){b=f.url instanceof Array?f.url[0]:f.url;if(!this.url){this.url=b}if(this.urlMatches(b)){k.push(f)}}}return k},urlMatches:function(b){var f=OpenLayers.Util.isEquivalentUrl(this.url,b);if(!f&&this.layerUrls){for(var c=0,a=this.layerUrls.length;c<a;++c){if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[c],b)){f=true;break}}}return f},request:function(a,o){o=o||{};var k=[];var l=[];var c=this.findLayers();if(c.length>0){for(var f=0,g=c.length;f<g;f++){k=k.concat(c[f].params.LAYERS);if(c[f].params.STYLES){l=l.concat(c[f].params.STYLES)}else{if(c[f].params.LAYERS instanceof Array){l=l.concat(new Array(c[f].params.LAYERS.length))}else{l=l.concat(c[f].params.LAYERS.replace(/[^,]/g,""))}}}var m={url:this.url,params:OpenLayers.Util.applyDefaults({service:"WMS",version:"1.1.0",request:"GetFeatureInfo",layers:k,query_layers:k,styles:l,bbox:this.map.getExtent().toBBOX(),srs:this.map.getProjection(),feature_count:this.maxFeatures,x:a.x,y:a.y,height:this.map.getSize().h,width:this.map.getSize().w,info_format:this.infoFormat},this.vendorParams),callback:function(p){this.handleResponse(a,p)},scope:this};var b=OpenLayers.Request.GET(m);if(o.hover===true){this.hoverRequest=b.priv}}else{OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")}},handleResponse:function(f,b){var c=b.responseXML;if(!c||!c.documentElement){c=b.responseText}var a=this.format.read(c);this.events.triggerEvent("getfeatureinfo",{text:b.responseText,features:a,request:b,xy:f});OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},setMap:function(a){this.handler.setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.WMSGetFeatureInfo"});OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.id=null;this.bounds=null},clone:function(){return new OpenLayers.Geometry()},setBounds:function(a){if(a){this.bounds=a.clone()}},clearBounds:function(){this.bounds=null;if(this.parent){this.parent.clearBounds()}},extendBounds:function(b){var a=this.getBounds();if(!a){this.setBounds(b)}else{this.bounds.extend(b)}},getBounds:function(){if(this.bounds==null){this.calculateBounds()}return this.bounds},calculateBounds:function(){},distanceTo:function(b,a){},getVertices:function(a){},atPoint:function(g,m,k){var c=false;var f=this.getBounds();if((f!=null)&&(g!=null)){var b=(m!=null)?m:0;var a=(k!=null)?k:0;var l=new OpenLayers.Bounds(this.bounds.left-b,this.bounds.bottom-a,this.bounds.right+b,this.bounds.top+a);c=l.containsLonLat(g)}return c},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){return OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this))},CLASS_NAME:"OpenLayers.Geometry"});OpenLayers.Geometry.fromWKT=function(k){var l=arguments.callee.format;if(!l){l=new OpenLayers.Format.WKT();arguments.callee.format=l}var f;var b=l.read(k);if(b instanceof OpenLayers.Feature.Vector){f=b.geometry}else{if(b instanceof Array){var a=b.length;var g=new Array(a);for(var c=0;c<a;++c){g[c]=b[c].geometry}f=new OpenLayers.Geometry.Collection(g)}}return f};OpenLayers.Geometry.segmentsIntersect=function(a,R,b){var B=b&&b.point;var G=b&&b.tolerance;var g=false;var I=a.x1-R.x1;var O=a.y1-R.y1;var u=a.x2-a.x1;var F=a.y2-a.y1;var C=R.y2-R.y1;var o=R.x2-R.x1;var K=(C*u)-(o*F);var f=(o*O)-(C*I);var c=(u*O)-(F*I);if(K==0){if(f==0&&c==0){g=true}}else{var M=f/K;var J=c/K;if(M>=0&&M<=1&&J>=0&&J<=1){if(!B){g=true}else{var l=a.x1+(M*u);var k=a.y1+(M*F);g=new OpenLayers.Geometry.Point(l,k)}}}if(G){var A;if(g){if(B){var r=[a,R];var H,l,k;outer:for(var E=0;E<2;++E){H=r[E];for(var D=1;D<3;++D){l=H["x"+D];k=H["y"+D];A=Math.sqrt(Math.pow(l-g.x,2)+Math.pow(k-g.y,2));if(A<G){g.x=l;g.y=k;break outer}}}}}else{var r=[a,R];var v,Q,l,k,q,m;outer:for(var E=0;E<2;++E){v=r[E];Q=r[(E+1)%2];for(var D=1;D<3;++D){q={x:v["x"+D],y:v["y"+D]};m=OpenLayers.Geometry.distanceToSegment(q,Q);if(m.distance<G){if(B){g=new OpenLayers.Geometry.Point(q.x,q.y)}else{g=true}break outer}}}}}return g};OpenLayers.Geometry.distanceToSegment=function(q,f){var c=q.x;var p=q.y;var b=f.x1;var o=f.y1;var a=f.x2;var k=f.y2;var u=a-b;var r=k-o;var m=((u*(c-b))+(r*(p-o)))/(Math.pow(u,2)+Math.pow(r,2));var l,g;if(m<=0){l=b;g=o}else{if(m>=1){l=a;g=k}else{l=b+m*u;g=o+m*r}}return{distance:Math.sqrt(Math.pow(l-c,2)+Math.pow(g-p,2)),x:l,y:g}};OpenLayers.Geometry.Rectangle=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,width:null,height:null,initialize:function(b,f,c,a){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.x=b;this.y=f;this.width=c;this.height=a},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x+this.width,this.y+this.height)},getLength:function(){var a=(2*this.width)+(2*this.height);return a},getArea:function(){var a=this.width*this.height;return a},CLASS_NAME:"OpenLayers.Geometry.Rectangle"});OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(a){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.components=[];if(a!=null){this.addComponents(a)}},destroy:function(){this.components.length=0;this.components=null},clone:function(){var geometry=eval("new "+this.CLASS_NAME+"()");for(var i=0,len=this.components.length;i<len;i++){geometry.addComponent(this.components[i].clone())}OpenLayers.Util.applyDefaults(geometry,this);return geometry},getComponentsString:function(){var b=[];for(var c=0,a=this.components.length;c<a;c++){b.push(this.components[c].toShortString())}return b.join(",")},calculateBounds:function(){this.bounds=null;if(this.components&&this.components.length>0){this.setBounds(this.components[0].getBounds());for(var b=1,a=this.components.length;b<a;b++){this.extendBounds(this.components[b].getBounds())}}},addComponents:function(c){if(!(c instanceof Array)){c=[c]}for(var b=0,a=c.length;b<a;b++){this.addComponent(c[b])}},addComponent:function(b,a){var f=false;if(b){if(this.componentTypes==null||(OpenLayers.Util.indexOf(this.componentTypes,b.CLASS_NAME)>-1)){if(a!=null&&(a<this.components.length)){var g=this.components.slice(0,a);var c=this.components.slice(a,this.components.length);g.push(b);this.components=g.concat(c)}else{this.components.push(b)}b.parent=this;this.clearBounds();f=true}}return f},removeComponents:function(b){if(!(b instanceof Array)){b=[b]}for(var a=b.length-1;a>=0;--a){this.removeComponent(b[a])}},removeComponent:function(a){OpenLayers.Util.removeItem(this.components,a);this.clearBounds()},getLength:function(){var c=0;for(var b=0,a=this.components.length;b<a;b++){c+=this.components[b].getLength()}return c},getArea:function(){var c=0;for(var b=0,a=this.components.length;b<a;b++){c+=this.components[b].getArea()}return c},getGeodesicArea:function(b){var f=0;for(var c=0,a=this.components.length;c<a;c++){f+=this.components[c].getGeodesicArea(b)}return f},getCentroid:function(){return this.components.length&&this.components[0].getCentroid()},getGeodesicLength:function(b){var f=0;for(var c=0,a=this.components.length;c<a;c++){f+=this.components[c].getGeodesicLength(b)}return f},move:function(b,f){for(var c=0,a=this.components.length;c<a;c++){this.components[c].move(b,f)}},rotate:function(f,b){for(var c=0,a=this.components.length;c<a;++c){this.components[c].rotate(f,b)}},resize:function(f,a,c){for(var b=0;b<this.components.length;++b){this.components[b].resize(f,a,c)}return this},distanceTo:function(l,m){var b=!(m&&m.edge===false);var a=b&&m&&m.details;var o,c;var f=Number.POSITIVE_INFINITY;for(var g=0,k=this.components.length;g<k;++g){o=this.components[g].distanceTo(l,m);distance=a?o.distance:o;if(distance<f){f=distance;c=o;if(f==0){break}}}return c},equals:function(f){var b=true;if(!f||!f.CLASS_NAME||(this.CLASS_NAME!=f.CLASS_NAME)){b=false}else{if(!(f.components instanceof Array)||(f.components.length!=this.components.length)){b=false}else{for(var c=0,a=this.components.length;c<a;++c){if(!this.components[c].equals(f.components[c])){b=false;break}}}}return b},transform:function(g,c){if(g&&c){for(var f=0,a=this.components.length;f<a;f++){var b=this.components[f];b.transform(g,c)}this.bounds=null}return this},intersects:function(f){var b=false;for(var c=0,a=this.components.length;c<a;++c){b=f.intersects(this.components[c]);if(b){break}}return b},getVertices:function(b){var c=[];for(var f=0,a=this.components.length;f<a;++f){Array.prototype.push.apply(c,this.components[f].getVertices(b))}return c},CLASS_NAME:"OpenLayers.Geometry.Collection"});OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(a,b){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.x=parseFloat(a);this.y=parseFloat(b)},clone:function(a){if(a==null){a=new OpenLayers.Geometry.Point(this.x,this.y)}OpenLayers.Util.applyDefaults(a,this);return a},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(k,p){var f=!(p&&p.edge===false);var a=f&&p&&p.details;var b,g,m,c,l,o;if(k instanceof OpenLayers.Geometry.Point){g=this.x;m=this.y;c=k.x;l=k.y;b=Math.sqrt(Math.pow(g-c,2)+Math.pow(m-l,2));o=!a?b:{x0:g,y0:m,x1:c,y1:l,distance:b}}else{o=k.distanceTo(this,p);if(a){o={x0:o.x1,y0:o.y1,x1:o.x0,y1:o.y0,distance:o.distance}}}return o},equals:function(a){var b=false;if(a!=null){b=((this.x==a.x&&this.y==a.y)||(isNaN(this.x)&&isNaN(this.y)&&isNaN(a.x)&&isNaN(a.y)))}return b},toShortString:function(){return(this.x+", "+this.y)},move:function(a,b){this.x=this.x+a;this.y=this.y+b;this.clearBounds()},rotate:function(f,b){f*=Math.PI/180;var a=this.distanceTo(b);var c=f+Math.atan2(this.y-b.y,this.x-b.x);this.x=b.x+(a*Math.cos(c));this.y=b.y+(a*Math.sin(c));this.clearBounds()},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)},resize:function(c,a,b){b=(b==undefined)?1:b;this.x=a.x+(c*b*(this.x-a.x));this.y=a.y+(c*(this.y-a.y));this.clearBounds();return this},intersects:function(b){var a=false;if(b.CLASS_NAME=="OpenLayers.Geometry.Point"){a=this.equals(b)}else{a=b.intersects(this)}return a},transform:function(b,a){if((b&&a)){OpenLayers.Projection.transform(this,b,a);this.bounds=null}return this},getVertices:function(a){return[this]},CLASS_NAME:"OpenLayers.Geometry.Point"});OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(a){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)},addPoint:function(a,b){this.addComponent(a,b)},removePoint:function(a){this.removeComponent(a)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"});OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(a){OpenLayers.Geometry.MultiPoint.prototype.initialize.apply(this,arguments)},getLength:function(){var c=0;if(this.components&&(this.components.length>1)){for(var b=1,a=this.components.length;b<a;b++){c+=this.components[b-1].distanceTo(this.components[b])}}return c},getGeodesicLength:function(b){var g=this;if(b){var c=new OpenLayers.Projection("EPSG:4326");if(!c.equals(b)){g=this.clone().transform(b,c)}}var k=0;if(g.components&&(g.components.length>1)){var m,l;for(var f=1,a=g.components.length;f<a;f++){m=g.components[f-1];l=g.components[f];k+=OpenLayers.Util.distVincenty({lon:m.x,lat:m.y},{lon:l.x,lat:l.y})}}return k*1000},CLASS_NAME:"OpenLayers.Geometry.Curve"});OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{initialize:function(a){OpenLayers.Geometry.Curve.prototype.initialize.apply(this,arguments)},removeComponent:function(a){if(this.components&&(this.components.length>2)){OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments)}},intersects:function(q){var c=false;var p=q.CLASS_NAME;if(p=="OpenLayers.Geometry.LineString"||p=="OpenLayers.Geometry.LinearRing"||p=="OpenLayers.Geometry.Point"){var v=this.getSortedSegments();var r;if(p=="OpenLayers.Geometry.Point"){r=[{x1:q.x,y1:q.y,x2:q.x,y2:q.y}]}else{r=q.getSortedSegments()}var C,l,g,a,B,A,f,b;outer:for(var m=0,o=v.length;m<o;++m){C=v[m];l=C.x1;g=C.x2;a=C.y1;B=C.y2;inner:for(var k=0,u=r.length;k<u;++k){A=r[k];if(A.x1>g){break}if(A.x2<l){continue}f=A.y1;b=A.y2;if(Math.min(f,b)>Math.max(a,B)){continue}if(Math.max(f,b)<Math.min(a,B)){continue}if(OpenLayers.Geometry.segmentsIntersect(C,A)){c=true;break outer}}}}else{c=q.intersects(this)}return c},getSortedSegments:function(){var a=this.components.length-1;var b=new Array(a);for(var c=0;c<a;++c){point1=this.components[c];point2=this.components[c+1];if(point1.x<point2.x){b[c]={x1:point1.x,y1:point1.y,x2:point2.x,y2:point2.y}}else{b[c]={x1:point2.x,y1:point2.y,x2:point1.x,y2:point1.y}}}function f(k,g){return k.x1-g.x1}return b.sort(f)},splitWithSegment:function(C,b){var c=!(b&&b.edge===false);var v=b&&b.tolerance;var a=[];var E=this.getVertices();var u=[];var G=[];var m=false;var g,f,q;var o,B,F;var k={point:true,tolerance:v};var l=null;for(var r=0,p=E.length-2;r<=p;++r){g=E[r];u.push(g.clone());f=E[r+1];F={x1:g.x,y1:g.y,x2:f.x,y2:f.y};q=OpenLayers.Geometry.segmentsIntersect(C,F,k);if(q instanceof OpenLayers.Geometry.Point){if((q.x===C.x1&&q.y===C.y1)||(q.x===C.x2&&q.y===C.y2)||q.equals(g)||q.equals(f)){B=true}else{B=false}if(B||c){if(!q.equals(G[G.length-1])){G.push(q.clone())}if(r===0){if(q.equals(g)){continue}}if(q.equals(f)){continue}m=true;if(!q.equals(g)){u.push(q)}a.push(new OpenLayers.Geometry.LineString(u));u=[q.clone()]}}}if(m){u.push(f.clone());a.push(new OpenLayers.Geometry.LineString(u))}if(G.length>0){var A=C.x1<C.x2?1:-1;var D=C.y1<C.y2?1:-1;l={lines:a,points:G.sort(function(I,H){return(A*I.x-A*H.x)||(D*I.y-D*H.y)})}}return l},split:function(H,b){var r=null;var f=b&&b.mutual;var p,g,q,c;if(H instanceof OpenLayers.Geometry.LineString){var G=this.getVertices();var m,l,F,o,a,v;var C=[];q=[];for(var D=0,u=G.length-2;D<=u;++D){m=G[D];l=G[D+1];F={x1:m.x,y1:m.y,x2:l.x,y2:l.y};c=c||[H];if(f){C.push(m.clone())}for(var B=0;B<c.length;++B){o=c[B].splitWithSegment(F,b);if(o){a=o.lines;if(a.length>0){a.unshift(B,1);Array.prototype.splice.apply(c,a);B+=a.length-2}if(f){for(var A=0,E=o.points.length;A<E;++A){v=o.points[A];if(!v.equals(m)){C.push(v);q.push(new OpenLayers.Geometry.LineString(C));if(v.equals(l)){C=[]}else{C=[v.clone()]}}}}}}}if(f&&q.length>0&&C.length>0){C.push(l.clone());q.push(new OpenLayers.Geometry.LineString(C))}}else{r=H.splitWith(this,b)}if(c&&c.length>1){g=true}else{c=[]}if(q&&q.length>1){p=true}else{q=[]}if(g||p){if(f){r=[q,c]}else{r=c}}return r},splitWith:function(b,a){return b.split(this,a)},getVertices:function(a){var b;if(a===true){b=[this.components[0],this.components[this.components.length-1]]}else{if(a===false){b=this.components.slice(1,this.components.length-1)}else{b=this.components.slice()}}return b},distanceTo:function(m,l){var o=!(l&&l.edge===false);var J=o&&l&&l.details;var A,g={};var D=Number.POSITIVE_INFINITY;if(m instanceof OpenLayers.Geometry.Point){var B=this.getSortedSegments();var v=m.x;var u=m.y;var H;for(var F=0,G=B.length;F<G;++F){H=B[F];A=OpenLayers.Geometry.distanceToSegment(m,H);if(A.distance<D){D=A.distance;g=A;if(D===0){break}}else{if(H.x2>v&&((u>H.y1&&u<H.y2)||(u<H.y1&&u>H.y2))){break}}}if(J){g={distance:g.distance,x0:g.x,y0:g.y,x1:v,y1:u}}else{g=g.distance}}else{if(m instanceof OpenLayers.Geometry.LineString){var f=this.getSortedSegments();var c=m.getSortedSegments();var b,a,r,I,k;var q=c.length;var p={point:true};outer:for(var F=0,G=f.length;F<G;++F){b=f[F];I=b.x1;k=b.y1;for(var E=0;E<q;++E){a=c[E];r=OpenLayers.Geometry.segmentsIntersect(b,a,p);if(r){D=0;g={distance:0,x0:r.x,y0:r.y,x1:r.x,y1:r.y};break outer}else{A=OpenLayers.Geometry.distanceToSegment({x:I,y:k},a);if(A.distance<D){D=A.distance;g={distance:D,x0:I,y0:k,x1:A.x,y1:A.y}}}}}if(!J){g=g.distance}if(D!==0){if(b){A=m.distanceTo(new OpenLayers.Geometry.Point(b.x2,b.y2),l);var C=J?A.distance:A;if(C<D){if(J){g={distance:D,x0:A.x1,y0:A.y1,x1:A.x0,y1:A.y0}}else{g=C}}}}}else{g=m.distanceTo(this,l);if(J){g={distance:g.distance,x0:g.x1,y0:g.y1,x1:g.x0,y1:g.y0}}}}return g},CLASS_NAME:"OpenLayers.Geometry.LineString"});OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(a){OpenLayers.Geometry.LineString.prototype.initialize.apply(this,arguments)},addComponent:function(a,b){var c=false;var f=this.components.pop();if(b!=null||!a.equals(f)){c=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments)}var g=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[g]);return c},removeComponent:function(a){if(this.components.length>4){this.components.pop();OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);var b=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[b])}},move:function(b,f){for(var c=0,a=this.components.length;c<a-1;c++){this.components[c].move(b,f)}},rotate:function(f,b){for(var c=0,a=this.components.length;c<a-1;++c){this.components[c].rotate(f,b)}},resize:function(g,b,f){for(var c=0,a=this.components.length;c<a-1;++c){this.components[c].resize(g,b,f)}return this},transform:function(g,c){if(g&&c){for(var f=0,a=this.components.length;f<a-1;f++){var b=this.components[f];b.transform(g,c)}this.bounds=null}return this},getCentroid:function(){if(this.components&&(this.components.length>2)){var m=0;var l=0;for(var g=0;g<this.components.length-1;g++){var f=this.components[g];var p=this.components[g+1];m+=(f.x+p.x)*(f.x*p.y-p.x*f.y);l+=(f.y+p.y)*(f.x*p.y-p.x*f.y)}var k=-1*this.getArea();var a=m/(6*k);var o=l/(6*k)}return new OpenLayers.Geometry.Point(a,o)},getArea:function(){var l=0;if(this.components&&(this.components.length>2)){var k=0;for(var g=0,f=this.components.length;g<f-1;g++){var a=this.components[g];var m=this.components[g+1];k+=(a.x+m.x)*(m.y-a.y)}l=-k/2}return l},getGeodesicArea:function(b){var f=this;if(b){var c=new OpenLayers.Projection("EPSG:4326");if(!c.equals(b)){f=this.clone().transform(b,c)}}var k=0;var a=f.components&&f.components.length;if(a>2){var m,l;for(var g=0;g<a-1;g++){m=f.components[g];l=f.components[g+1];k+=OpenLayers.Util.rad(l.x-m.x)*(2+Math.sin(OpenLayers.Util.rad(m.y))+Math.sin(OpenLayers.Util.rad(l.y)))}k=k*6378137*6378137/2}return k},containsPoint:function(r){var D=OpenLayers.Number.limitSigDigs;var q=14;var p=D(r.x,q);var o=D(r.y,q);function C(I,F,H,E,G){return(((F-E)*I)+((E*H)-(F*G)))/(H-G)}var a=this.components.length-1;var l,k,B,f,v,b,g,c;var m=0;for(var u=0;u<a;++u){l=this.components[u];B=D(l.x,q);f=D(l.y,q);k=this.components[u+1];v=D(k.x,q);b=D(k.y,q);if(f==b){if(o==f){if(B<=v&&(p>=B&&p<=v)||B>=v&&(p<=B&&p>=v)){m=-1;break}}continue}g=D(C(o,B,f,v,b),q);if(g==p){if(f<b&&(o>=f&&o<=b)||f>b&&(o<=f&&o>=b)){m=-1;break}}if(g<=p){continue}if(B!=v&&(g<Math.min(B,v)||g>Math.max(B,v))){continue}if(f<b&&(o>=f&&o<b)||f>b&&(o<f&&o>=b)){++m}}var A=(m==-1)?1:!!(m&1);return A},intersects:function(f){var b=false;if(f.CLASS_NAME=="OpenLayers.Geometry.Point"){b=this.containsPoint(f)}else{if(f.CLASS_NAME=="OpenLayers.Geometry.LineString"){b=f.intersects(this)}else{if(f.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){b=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[f])}else{for(var c=0,a=f.components.length;c<a;++c){b=f.components[c].intersects(this);if(b){break}}}}}return b},getVertices:function(a){return(a===true)?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"});OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],initialize:function(a){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)},getArea:function(){var c=0;if(this.components&&(this.components.length>0)){c+=Math.abs(this.components[0].getArea());for(var b=1,a=this.components.length;b<a;b++){c-=Math.abs(this.components[b].getArea())}}return c},getGeodesicArea:function(b){var f=0;if(this.components&&(this.components.length>0)){f+=Math.abs(this.components[0].getGeodesicArea(b));for(var c=1,a=this.components.length;c<a;c++){f-=Math.abs(this.components[c].getGeodesicArea(b))}}return f},containsPoint:function(a){var g=this.components.length;var c=false;if(g>0){c=this.components[0].containsPoint(a);if(c!==1){if(c&&g>1){var f;for(var b=1;b<g;++b){f=this.components[b].containsPoint(a);if(f){if(f===1){c=1}else{c=false}break}}}}}return c},intersects:function(g){var b=false;var f,a;if(g.CLASS_NAME=="OpenLayers.Geometry.Point"){b=this.containsPoint(g)}else{if(g.CLASS_NAME=="OpenLayers.Geometry.LineString"||g.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){for(f=0,a=this.components.length;f<a;++f){b=g.intersects(this.components[f]);if(b){break}}if(!b){for(f=0,a=g.components.length;f<a;++f){b=this.containsPoint(g.components[f]);if(b){break}}}}else{for(f=0,a=g.components.length;f<a;++f){b=this.intersects(g.components[f]);if(b){break}}}}if(!b&&g.CLASS_NAME=="OpenLayers.Geometry.Polygon"){var c=this.components[0];for(f=0,a=c.components.length;f<a;++f){b=g.containsPoint(c.components[f]);if(b){break}}}return b},distanceTo:function(f,b){var c=!(b&&b.edge===false);var a;if(!c&&this.intersects(f)){a=0}else{a=OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[f,b])}return a},CLASS_NAME:"OpenLayers.Geometry.Polygon"});OpenLayers.Geometry.Polygon.createRegularPolygon=function(o,k,b,q){var c=Math.PI*((1/b)-(1/2));if(q){c+=(q/180)*Math.PI}var a,m,l;var p=[];for(var g=0;g<b;++g){a=c+(g*2*Math.PI/b);m=o.x+(k*Math.cos(a));l=o.y+(k*Math.sin(a));p.push(new OpenLayers.Geometry.Point(m,l))}var f=new OpenLayers.Geometry.LinearRing(p);return new OpenLayers.Geometry.Polygon([f])};OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],initialize:function(a){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)},split:function(r,C){var m=null;var B=C&&C.mutual;var u,a,A,q,b;var g=[];var v=[r];for(var l=0,o=this.components.length;l<o;++l){a=this.components[l];q=false;for(var f=0;f<v.length;++f){u=a.split(v[f],C);if(u){if(B){A=u[0];for(var c=0,p=A.length;c<p;++c){if(c===0&&g.length){g[g.length-1].addComponent(A[c])}else{g.push(new OpenLayers.Geometry.MultiLineString([A[c]]))}}q=true;u=u[1]}if(u.length){u.unshift(f,1);Array.prototype.splice.apply(v,u);break}}}if(!q){if(g.length){g[g.length-1].addComponent(a.clone())}else{g=[new OpenLayers.Geometry.MultiLineString(a.clone())]}}}if(g&&g.length>1){q=true}else{g=[]}if(v&&v.length>1){b=true}else{v=[]}if(q||b){if(B){m=[g,v]}else{m=v}}return m},splitWith:function(r,C){var m=null;var B=C&&C.mutual;var u,c,A,q,a,g,v;if(r instanceof OpenLayers.Geometry.LineString){v=[];g=[r];for(var l=0,o=this.components.length;l<o;++l){a=false;c=this.components[l];for(var f=0;f<g.length;++f){u=g[f].split(c,C);if(u){if(B){A=u[0];if(A.length){A.unshift(f,1);Array.prototype.splice.apply(g,A);f+=A.length-2}u=u[1];if(u.length===0){u=[c.clone()]}}for(var b=0,p=u.length;b<p;++b){if(b===0&&v.length){v[v.length-1].addComponent(u[b])}else{v.push(new OpenLayers.Geometry.MultiLineString([u[b]]))}}a=true}}if(!a){if(v.length){v[v.length-1].addComponent(c.clone())}else{v=[new OpenLayers.Geometry.MultiLineString([c.clone()])]}}}}else{m=r.split(this)}if(g&&g.length>1){q=true}else{g=[]}if(v&&v.length>1){a=true}else{v=[]}if(q||a){if(B){m=[g,v]}else{m=v}}return m},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"});OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],initialize:function(a){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"});OpenLayers.Geometry.Surface=OpenLayers.Class(OpenLayers.Geometry,{initialize:function(){OpenLayers.Geometry.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Geometry.Surface"});OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:false,size:null,resolution:null,map:null,initialize:function(a,b){this.container=OpenLayers.Util.getElement(a)},destroy:function(){this.container=null;this.extent=null;this.size=null;this.resolution=null;this.map=null},supported:function(){return false},setExtent:function(a,b){this.extent=a.clone();if(b){this.resolution=null}},setSize:function(a){this.size=a.clone();this.resolution=null},getResolution:function(){this.resolution=this.resolution||this.map.getResolution();return this.resolution},drawFeature:function(a,b){if(b==null){b=a.style}if(a.geometry){var c=a.geometry.getBounds();if(c){if(!c.intersectsBounds(this.extent)){b={display:"none"}}var f=this.drawGeometry(a.geometry,b,a.id);if(b.display!="none"&&b.label&&f!==false){this.drawText(a.id,b,a.geometry.getCentroid())}else{this.removeText(a.id)}return f}}},drawGeometry:function(c,a,b){},drawText:function(c,b,a){},removeText:function(a){},clear:function(){},getFeatureIdFromEvent:function(a){},eraseFeatures:function(c){if(!(c instanceof Array)){c=[c]}for(var b=0,a=c.length;b<a;++b){this.eraseGeometry(c[b].geometry);this.removeText(c[b].id)}},eraseGeometry:function(a){},moveRoot:function(a){},getRenderLayerId:function(){return this.container.id},CLASS_NAME:"OpenLayers.Renderer"});OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(a){this.compare=a?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER;this.order=[];this.indices={};this.maxZIndex=0},insert:function(c){if(this.exists(c)){this.remove(c)}var k=c.id;this.determineZIndex(c);var f=-1;var g=this.order.length;var a;while(g-f>1){a=parseInt((f+g)/2);var b=this.compare(this,c,OpenLayers.Util.getElement(this.order[a]));if(b>0){f=a}else{g=a}}this.order.splice(g,0,k);this.indices[k]=this.getZIndex(c);return this.getNextElement(g)},remove:function(b){var f=b.id;var a=OpenLayers.Util.indexOf(this.order,f);if(a>=0){this.order.splice(a,1);delete this.indices[f];if(this.order.length>0){var c=this.order[this.order.length-1];this.maxZIndex=this.indices[c]}else{this.maxZIndex=0}}},clear:function(){this.order=[];this.indices={};this.maxZIndex=0},exists:function(a){return(this.indices[a.id]!=null)},getZIndex:function(a){return a._style.graphicZIndex},determineZIndex:function(a){var b=a._style.graphicZIndex;if(b==null){b=this.maxZIndex;a._style.graphicZIndex=b}else{if(b>this.maxZIndex){this.maxZIndex=b}}},getNextElement:function(b){var a=b+1;if(a<this.order.length){var c=OpenLayers.Util.getElement(this.order[a]);if(c==undefined){c=this.getNextElement(a)}return c}else{return null}},CLASS_NAME:"OpenLayers.ElementsIndexer"});OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(g,f,b){var a=g.getZIndex(f);var k=0;if(b){var c=g.getZIndex(b);k=a-c}return k},Z_ORDER_DRAWING_ORDER:function(c,b,a){var f=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(c,b,a);if(a&&f==0){f=1}return f},Z_ORDER_Y_ORDER:function(k,g,b){var l=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(k,g,b);if(b&&l==0){var c=g._geometry.getBounds().bottom;var f=b._geometry.getBounds().bottom;var a=f-c;l=(a==0)?1:a}return l}};OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",minimumSymbolizer:{strokeLinecap:"round",strokeOpacity:1,strokeDashstyle:"solid",fillOpacity:1,pointRadius:0},initialize:function(a,b){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.rendererRoot=this.createRenderRoot();this.root=this.createRoot("_root");this.vectorRoot=this.createRoot("_vroot");this.textRoot=this.createRoot("_troot");this.root.appendChild(this.vectorRoot);this.root.appendChild(this.textRoot);this.rendererRoot.appendChild(this.root);this.container.appendChild(this.rendererRoot);if(b&&(b.zIndexing||b.yOrdering)){this.indexer=new OpenLayers.ElementsIndexer(b.yOrdering)}},destroy:function(){this.clear();this.rendererRoot=null;this.root=null;this.xmlns=null;OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){if(this.vectorRoot){while(this.vectorRoot.childNodes.length>0){this.vectorRoot.removeChild(this.vectorRoot.firstChild)}}if(this.textRoot){while(this.textRoot.childNodes.length>0){this.textRoot.removeChild(this.textRoot.firstChild)}}if(this.indexer){this.indexer.clear()}},getNodeType:function(b,a){},drawGeometry:function(l,f,k){var c=l.CLASS_NAME;var m=true;if((c=="OpenLayers.Geometry.Collection")||(c=="OpenLayers.Geometry.MultiPoint")||(c=="OpenLayers.Geometry.MultiLineString")||(c=="OpenLayers.Geometry.MultiPolygon")){for(var b=0,a=l.components.length;b<a;b++){m=this.drawGeometry(l.components[b],f,k)&&m}return m}m=false;if(f.display!="none"){if(f.backgroundGraphic){this.redrawBackgroundNode(l.id,l,f,k)}m=this.redrawNode(l.id,l,f,k)}if(m==false){var g=document.getElementById(l.id);if(g){if(g._style.backgroundGraphic){g.parentNode.removeChild(document.getElementById(l.id+this.BACKGROUND_ID_SUFFIX))}g.parentNode.removeChild(g)}}return m},redrawNode:function(l,k,b,g){var c=this.nodeFactory(l,this.getNodeType(k,b));c._featureId=g;c._geometry=k;c._geometryClass=k.CLASS_NAME;c._style=b;var a=this.drawGeometryNode(c,k,b);if(a===false){return false}c=a.node;if(this.indexer){var f=this.indexer.insert(c);if(f){this.vectorRoot.insertBefore(c,f)}else{this.vectorRoot.appendChild(c)}}else{if(c.parentNode!==this.vectorRoot){this.vectorRoot.appendChild(c)}}this.postDraw(c);return a.complete},redrawBackgroundNode:function(g,f,b,c){var a=OpenLayers.Util.extend({},b);a.externalGraphic=a.backgroundGraphic;a.graphicXOffset=a.backgroundXOffset;a.graphicYOffset=a.backgroundYOffset;a.graphicZIndex=a.backgroundGraphicZIndex;a.graphicWidth=a.backgroundWidth||a.graphicWidth;a.graphicHeight=a.backgroundHeight||a.graphicHeight;a.backgroundGraphic=null;a.backgroundXOffset=null;a.backgroundYOffset=null;a.backgroundGraphicZIndex=null;return this.redrawNode(g+this.BACKGROUND_ID_SUFFIX,f,a,null)},drawGeometryNode:function(c,g,b){b=b||c._style;OpenLayers.Util.applyDefaults(b,this.minimumSymbolizer);var a={isFilled:b.fill===undefined?true:b.fill,isStroked:b.stroke===undefined?!!b.strokeWidth:b.stroke};var f;switch(g.CLASS_NAME){case"OpenLayers.Geometry.Point":if(b.graphic===false){a.isFilled=false;a.isStroked=false}f=this.drawPoint(c,g);break;case"OpenLayers.Geometry.LineString":a.isFilled=false;f=this.drawLineString(c,g);break;case"OpenLayers.Geometry.LinearRing":f=this.drawLinearRing(c,g);break;case"OpenLayers.Geometry.Polygon":f=this.drawPolygon(c,g);break;case"OpenLayers.Geometry.Surface":f=this.drawSurface(c,g);break;case"OpenLayers.Geometry.Rectangle":f=this.drawRectangle(c,g);break;default:break}c._style=b;c._options=a;if(f!=false){return{node:this.setStyle(c,b,a,g),complete:f}}else{return false}},postDraw:function(a){},drawPoint:function(a,b){},drawLineString:function(a,b){},drawLinearRing:function(a,b){},drawPolygon:function(a,b){},drawRectangle:function(a,b){},drawCircle:function(a,b){},drawSurface:function(a,b){},removeText:function(b){var a=document.getElementById(b+this.LABEL_ID_SUFFIX);if(a){this.textRoot.removeChild(a)}},getFeatureIdFromEvent:function(a){var f=a.target;var b=f&&f.correspondingUseElement;var c=b?b:(f||a.srcElement);var g=c._featureId;return g},eraseGeometry:function(k){if((k.CLASS_NAME=="OpenLayers.Geometry.MultiPoint")||(k.CLASS_NAME=="OpenLayers.Geometry.MultiLineString")||(k.CLASS_NAME=="OpenLayers.Geometry.MultiPolygon")||(k.CLASS_NAME=="OpenLayers.Geometry.Collection")){for(var f=0,a=k.components.length;f<a;f++){this.eraseGeometry(k.components[f])}}else{var c=OpenLayers.Util.getElement(k.id);if(c&&c.parentNode){if(c.geometry){c.geometry.destroy();c.geometry=null}c.parentNode.removeChild(c);if(this.indexer){this.indexer.remove(c)}if(c._style.backgroundGraphic){var b=k.id+this.BACKGROUND_ID_SUFFIX;var g=OpenLayers.Util.getElement(b);if(g&&g.parentNode){g.parentNode.removeChild(g)}}}}},nodeFactory:function(c,a){var b=OpenLayers.Util.getElement(c);if(b){if(!this.nodeTypeCompare(b,a)){b.parentNode.removeChild(b);b=this.nodeFactory(c,a)}}else{b=this.createNode(a,c)}return b},nodeTypeCompare:function(b,a){},createNode:function(a,b){},moveRoot:function(b){var a=this.root;if(b.root.parentNode==this.rendererRoot){a=b.root}a.parentNode.removeChild(a);b.rendererRoot.appendChild(a)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(a){return(a!="circle")&&!!a},CLASS_NAME:"OpenLayers.Renderer.Elements"});OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]};OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15000,translationParameters:null,symbolSize:{},isGecko:null,initialize:function(a){if(!this.supported()){return}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments);this.translationParameters={x:0,y:0};this.isGecko=(navigator.userAgent.toLowerCase().indexOf("gecko/")!=-1)},destroy:function(){OpenLayers.Renderer.Elements.prototype.destroy.apply(this,arguments)},supported:function(){var a="http://www.w3.org/TR/SVG11/feature#";return(document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(a+"SVG","1.1")||document.implementation.hasFeature(a+"BasicStructure","1.1")))},inValidRange:function(a,g,b){var f=a+(b?0:this.translationParameters.x);var c=g+(b?0:this.translationParameters.y);return(f>=-this.MAX_PIXEL&&f<=this.MAX_PIXEL&&c>=-this.MAX_PIXEL&&c<=this.MAX_PIXEL)},setExtent:function(b,f){OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments);var a=this.getResolution();var k=-b.left/a;var g=b.top/a;if(f){this.left=k;this.top=g;var c="0 0 "+this.size.w+" "+this.size.h;this.rendererRoot.setAttributeNS(null,"viewBox",c);this.translate(0,0);return true}else{var l=this.translate(k-this.left,g-this.top);if(!l){this.setExtent(b,true)}return l}},translate:function(a,c){if(!this.inValidRange(a,c,true)){return false}else{var b="";if(a||c){b="translate("+a+","+c+")"}this.root.setAttributeNS(null,"transform",b);this.translationParameters={x:a,y:c};return true}},setSize:function(a){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);this.rendererRoot.setAttributeNS(null,"width",this.size.w);this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(c,b){var a=null;switch(c.CLASS_NAME){case"OpenLayers.Geometry.Point":if(b.externalGraphic){a="image"}else{if(this.isComplexSymbol(b.graphicName)){a="use"}else{a="circle"}}break;case"OpenLayers.Geometry.Rectangle":a="rect";break;case"OpenLayers.Geometry.LineString":a="polyline";break;case"OpenLayers.Geometry.LinearRing":a="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":case"OpenLayers.Geometry.Surface":a="path";break;default:break}return a},setStyle:function(A,D,b){D=D||A._style;b=b||A._options;var o=parseFloat(A.getAttributeNS(null,"r"));var m=1;var f;if(A._geometryClass=="OpenLayers.Geometry.Point"&&o){A.style.visibility="";if(D.graphic===false){A.style.visibility="hidden"}else{if(D.externalGraphic){f=this.getPosition(A);if(D.graphicTitle){A.setAttributeNS(null,"title",D.graphicTitle)}if(D.graphicWidth&&D.graphicHeight){A.setAttributeNS(null,"preserveAspectRatio","none")}var v=D.graphicWidth||D.graphicHeight;var q=D.graphicHeight||D.graphicWidth;v=v?v:D.pointRadius*2;q=q?q:D.pointRadius*2;var E=(D.graphicXOffset!=undefined)?D.graphicXOffset:-(0.5*v);var g=(D.graphicYOffset!=undefined)?D.graphicYOffset:-(0.5*q);var a=D.graphicOpacity||D.fillOpacity;A.setAttributeNS(null,"x",(f.x+E).toFixed());A.setAttributeNS(null,"y",(f.y+g).toFixed());A.setAttributeNS(null,"width",v);A.setAttributeNS(null,"height",q);A.setAttributeNS(this.xlinkns,"href",D.externalGraphic);A.setAttributeNS(null,"style","opacity: "+a)}else{if(this.isComplexSymbol(D.graphicName)){var c=D.pointRadius*3;var p=c*2;var u=this.importSymbol(D.graphicName);var C="#"+u;f=this.getPosition(A);m=this.symbolSize[u]/p;var k=A.parentNode;var l=A.nextSibling;if(k){k.removeChild(A)}A.setAttributeNS(this.xlinkns,"href",C);A.setAttributeNS(null,"width",p);A.setAttributeNS(null,"height",p);A.setAttributeNS(null,"x",f.x-c);A.setAttributeNS(null,"y",f.y-c);if(l){k.insertBefore(A,l)}else{if(k){k.appendChild(A)}}}else{A.setAttributeNS(null,"r",D.pointRadius)}}}if(typeof D.rotation!="undefined"&&f){var B=OpenLayers.String.format("rotate(${0} ${1} ${2})",[D.rotation,f.x,f.y]);A.setAttributeNS(null,"transform",B)}}if(b.isFilled){A.setAttributeNS(null,"fill",D.fillColor);A.setAttributeNS(null,"fill-opacity",D.fillOpacity)}else{A.setAttributeNS(null,"fill","none")}if(b.isStroked){A.setAttributeNS(null,"stroke",D.strokeColor);A.setAttributeNS(null,"stroke-opacity",D.strokeOpacity);A.setAttributeNS(null,"stroke-width",D.strokeWidth*m);A.setAttributeNS(null,"stroke-linecap",D.strokeLinecap);A.setAttributeNS(null,"stroke-linejoin","round");A.setAttributeNS(null,"stroke-dasharray",this.dashStyle(D,m))}else{A.setAttributeNS(null,"stroke","none")}if(D.pointerEvents){A.setAttributeNS(null,"pointer-events",D.pointerEvents)}if(D.cursor!=null){A.setAttributeNS(null,"cursor",D.cursor)}return A},dashStyle:function(c,b){var a=c.strokeWidth*b;switch(c.strokeDashstyle){case"solid":return"none";case"dot":return[1,4*a].join();case"dash":return[4*a,4*a].join();case"dashdot":return[4*a,4*a,1,4*a].join();case"longdash":return[8*a,4*a].join();case"longdashdot":return[8*a,4*a,1,4*a].join();default:return c.strokeDashstyle.replace(/ /g,",")}},createNode:function(a,c){var b=document.createElementNS(this.xmlns,a);if(c){b.setAttributeNS(null,"id",c)}return b},nodeTypeCompare:function(b,a){return(a==b.nodeName)},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_svgRoot","svg")},createRoot:function(a){return this.nodeFactory(this.container.id+a,"g")},createDefs:function(){var a=this.nodeFactory(this.container.id+"_defs","defs");this.rendererRoot.appendChild(a);return a},drawPoint:function(a,b){return this.drawCircle(a,b,1)},drawCircle:function(f,g,b){var c=this.getResolution();var a=(g.x/c+this.left);var k=(this.top-g.y/c);if(this.inValidRange(a,k)){f.setAttributeNS(null,"cx",a);f.setAttributeNS(null,"cy",k);f.setAttributeNS(null,"r",b);return f}else{return false}},drawLineString:function(b,c){var a=this.getComponentsString(c.components);if(a.path){b.setAttributeNS(null,"points",a.path);return(a.complete?b:null)}else{return false}},drawLinearRing:function(b,c){var a=this.getComponentsString(c.components);if(a.path){b.setAttributeNS(null,"points",a.path);return(a.complete?b:null)}else{return false}},drawPolygon:function(b,l){var k="";var m=true;var a=true;var c,o;for(var f=0,g=l.components.length;f<g;f++){k+=" M";c=this.getComponentsString(l.components[f].components," ");o=c.path;if(o){k+=" "+o;a=c.complete&&a}else{m=false}}k+=" z";if(m){b.setAttributeNS(null,"d",k);b.setAttributeNS(null,"fill-rule","evenodd");return a?b:null}else{return false}},drawRectangle:function(c,f){var b=this.getResolution();var a=(f.x/b+this.left);var g=(this.top-f.y/b);if(this.inValidRange(a,g)){c.setAttributeNS(null,"x",a);c.setAttributeNS(null,"y",g);c.setAttributeNS(null,"width",f.width/b);c.setAttributeNS(null,"height",f.height/b);return c}else{return false}},drawSurface:function(g,l){var k=null;var b=true;for(var f=0,a=l.components.length;f<a;f++){if((f%3)==0&&(f/3)==0){var c=this.getShortString(l.components[f]);if(!c){b=false}k="M "+c}else{if((f%3)==1){var c=this.getShortString(l.components[f]);if(!c){b=false}k+=" C "+c}else{var c=this.getShortString(l.components[f]);if(!c){b=false}k+=" "+c}}}k+=" Z";if(b){g.setAttributeNS(null,"d",k);return g}else{return false}},drawText:function(c,a,o){var b=this.getResolution();var m=(o.x/b+this.left);var g=(o.y/b-this.top);var l=this.nodeFactory(c+this.LABEL_ID_SUFFIX,"text");var k=this.nodeFactory(c+this.LABEL_ID_SUFFIX+"_tspan","tspan");l.setAttributeNS(null,"x",m);l.setAttributeNS(null,"y",-g);l.setAttributeNS(null,"pointer-events","none");if(a.fontColor){l.setAttributeNS(null,"fill",a.fontColor)}if(a.fontFamily){l.setAttributeNS(null,"font-family",a.fontFamily)}if(a.fontSize){l.setAttributeNS(null,"font-size",a.fontSize)}if(a.fontWeight){l.setAttributeNS(null,"font-weight",a.fontWeight)}var f=a.labelAlign||"cm";l.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[f[0]]||"middle");if(this.isGecko){l.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[f[1]]||"central")}else{k.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[f[1]]||"-35%")}k.textContent=a.label;if(!l.parentNode){l.appendChild(k);this.textRoot.appendChild(l)}},getComponentsString:function(g,f){var l=[];var a=true;var k=g.length;var p=[];var m,o,b;for(var c=0;c<k;c++){o=g[c];l.push(o);m=this.getShortString(o);if(m){p.push(m)}else{if(c>0){if(this.getShortString(g[c-1])){p.push(this.clipLine(g[c],g[c-1]))}}if(c<k-1){if(this.getShortString(g[c+1])){p.push(this.clipLine(g[c],g[c+1]))}}a=false}}return{path:p.join(f||","),complete:a}},clipLine:function(g,o){if(o.equals(g)){return""}var l=this.getResolution();var b=this.MAX_PIXEL-this.translationParameters.x;var a=this.MAX_PIXEL-this.translationParameters.y;var f=o.x/l+this.left;var q=this.top-o.y/l;var c=g.x/l+this.left;var p=this.top-g.y/l;var m;if(c<-b||c>b){m=(p-q)/(c-f);c=c<0?-b:b;p=q+(c-f)*m}if(p<-a||p>a){m=(c-f)/(p-q);p=p<0?-a:a;c=f+(p-q)*m}return c+","+p},getShortString:function(b){var c=this.getResolution();var a=(b.x/c+this.left);var f=(this.top-b.y/c);if(this.inValidRange(a,f)){return a+","+f}else{return false}},getPosition:function(a){return({x:parseFloat(a.getAttributeNS(null,"cx")),y:parseFloat(a.getAttributeNS(null,"cy"))})},importSymbol:function(g){if(!this.defs){this.defs=this.createDefs()}var b=this.container.id+"-"+g;if(document.getElementById(b)!=null){return b}var f=OpenLayers.Renderer.symbol[g];if(!f){throw new Error(g+" is not a valid symbol name");return}var l=this.nodeFactory(b,"symbol");var c=this.nodeFactory(null,"polygon");l.appendChild(c);var r=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);var p="";var o,m;for(var k=0;k<f.length;k=k+2){o=f[k];m=f[k+1];r.left=Math.min(r.left,o);r.bottom=Math.min(r.bottom,m);r.right=Math.max(r.right,o);r.top=Math.max(r.top,m);p+=" "+o+","+m}c.setAttributeNS(null,"points",p);var a=r.getWidth();var q=r.getHeight();var u=[r.left-a,r.bottom-q,a*3,q*3];l.setAttributeNS(null,"viewBox",u.join(" "));this.symbolSize[b]=Math.max(a,q)*3;this.defs.appendChild(l);return l.id},CLASS_NAME:"OpenLayers.Renderer.SVG"});OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"};OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"};OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{canvas:null,features:null,geometryMap:null,initialize:function(a){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.root=document.createElement("canvas");this.container.appendChild(this.root);this.canvas=this.root.getContext("2d");this.features={};this.geometryMap={}},eraseGeometry:function(a){this.eraseFeatures(this.features[this.geometryMap[a.id]][0])},supported:function(){var a=document.createElement("canvas");return !!a.getContext},setExtent:function(a){this.extent=a.clone();this.resolution=null;this.redraw()},setSize:function(a){this.size=a.clone();this.root.style.width=a.w+"px";this.root.style.height=a.h+"px";this.root.width=a.w;this.root.height=a.h;this.resolution=null},drawFeature:function(a,b){if(b==null){b=a.style}b=OpenLayers.Util.extend({fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1},b);this.features[a.id]=[a,b];if(a.geometry){this.geometryMap[a.geometry.id]=a.id}this.redraw()},drawGeometry:function(f,c){var b=f.CLASS_NAME;if((b=="OpenLayers.Geometry.Collection")||(b=="OpenLayers.Geometry.MultiPoint")||(b=="OpenLayers.Geometry.MultiLineString")||(b=="OpenLayers.Geometry.MultiPolygon")){for(var a=0;a<f.components.length;a++){this.drawGeometry(f.components[a],c)}return}switch(f.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(f,c);break;case"OpenLayers.Geometry.LineString":this.drawLineString(f,c);break;case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(f,c);break;case"OpenLayers.Geometry.Polygon":this.drawPolygon(f,c);break;default:break}},drawExternalGraphic:function(o,a){var g=new Image();g.src=a.externalGraphic;if(a.graphicTitle){g.title=a.graphicTitle}var c=a.graphicWidth||a.graphicHeight;var m=a.graphicHeight||a.graphicWidth;c=c?c:a.pointRadius*2;m=m?m:a.pointRadius*2;var l=(a.graphicXOffset!=undefined)?a.graphicXOffset:-(0.5*c);var f=(a.graphicYOffset!=undefined)?a.graphicYOffset:-(0.5*m);var k=a.graphicOpacity||a.fillOpacity;var b={img:g,x:(o[0]+l),y:(o[1]+f),width:c,height:m,canvas:this.canvas};g.onload=OpenLayers.Function.bind(function(){this.canvas.drawImage(this.img,this.x,this.y,this.width,this.height)},b)},setCanvasStyle:function(b,a){if(b=="fill"){this.canvas.globalAlpha=a.fillOpacity;this.canvas.fillStyle=a.fillColor}else{if(b=="stroke"){this.canvas.globalAlpha=a.strokeOpacity;this.canvas.strokeStyle=a.strokeColor;this.canvas.lineWidth=a.strokeWidth}else{this.canvas.globalAlpha=0;this.canvas.lineWidth=1}}},drawPoint:function(c,a){if(a.graphic!==false){var b=this.getLocalXY(c);if(a.externalGraphic){this.drawExternalGraphic(b,a)}else{if(a.fill!==false){this.setCanvasStyle("fill",a);this.canvas.beginPath();this.canvas.arc(b[0],b[1],6,0,Math.PI*2,true);this.canvas.fill()}if(a.stroke!==false){this.setCanvasStyle("stroke",a);this.canvas.beginPath();this.canvas.arc(b[0],b[1],6,0,Math.PI*2,true);this.canvas.stroke();this.setCanvasStyle("reset")}}}},drawLineString:function(f,b){if(b.stroke!==false){this.setCanvasStyle("stroke",b);this.canvas.beginPath();var g=this.getLocalXY(f.components[0]);this.canvas.moveTo(g[0],g[1]);for(var a=1;a<f.components.length;a++){var c=this.getLocalXY(f.components[a]);this.canvas.lineTo(c[0],c[1])}this.canvas.stroke()}this.setCanvasStyle("reset")},drawLinearRing:function(g,c){if(c.fill!==false){this.setCanvasStyle("fill",c);this.canvas.beginPath();var k=this.getLocalXY(g.components[0]);this.canvas.moveTo(k[0],k[1]);for(var b=1;b<g.components.length-1;b++){var f=this.getLocalXY(g.components[b]);this.canvas.lineTo(f[0],f[1])}this.canvas.fill()}if(c.stroke!==false){var a=this.canvas.lineWidth;this.setCanvasStyle("stroke",c);this.canvas.beginPath();var k=this.getLocalXY(g.components[0]);this.canvas.moveTo(k[0],k[1]);for(var b=1;b<g.components.length;b++){var f=this.getLocalXY(g.components[b]);this.canvas.lineTo(f[0],f[1])}this.canvas.stroke()}this.setCanvasStyle("reset")},drawPolygon:function(c,b){this.drawLinearRing(c.components[0],b);for(var a=1;a<c.components.length;a++){this.drawLinearRing(c.components[a],{fillOpacity:0,strokeWidth:0,strokeOpacity:0,strokeColor:"#000000",fillColor:"#000000"})}},drawText:function(b,f){f=OpenLayers.Util.extend({fontColor:"#000000",labelAlign:"cm"},f);var g=this.getLocalXY(b);this.setCanvasStyle("reset");this.canvas.fillStyle=f.fontColor;this.canvas.globalAlpha=1;var k=f.fontWeight+" "+f.fontSize+" "+f.fontFamily;if(this.canvas.fillText){var c=OpenLayers.Renderer.Canvas.LABEL_ALIGN[f.labelAlign[0]]||"middle";this.canvas.font=k;this.canvas.textAlign=c;this.canvas.fillText(f.label,g[0],g[1])}else{if(this.canvas.mozDrawText){this.canvas.mozTextStyle=k;var a=this.canvas.mozMeasureText(f.label);switch(f.labelAlign[0]){case"l":break;case"r":g[0]-=a;break;case"c":default:g[0]-=a/2}this.canvas.translate(g[0],g[1]);this.canvas.mozDrawText(f.label);this.canvas.translate(-1*g[0],-1*g[1])}}this.setCanvasStyle("reset")},getLocalXY:function(b){var c=this.getResolution();var f=this.extent;var a=(b.x/c+(-f.left/c));var g=((f.top/c)-b.y/c);return[a,g]},clear:function(){this.canvas.clearRect(0,0,this.root.width,this.root.height)},getFeatureIdFromEvent:function(a){var k=this.map.getLonLatFromPixel(a.xy);var b=this.getResolution();var g=new OpenLayers.Bounds(k.lon-b*5,k.lat-b*5,k.lon+b*5,k.lat+b*5);var c=g.toGeometry();for(var f in this.features){if(!this.features.hasOwnProperty(f)){continue}if(this.features[f][0].geometry.intersects(c)){return f}}return null},eraseFeatures:function(b){if(!(b instanceof Array)){b=[b]}for(var a=0;a<b.length;++a){delete this.features[b[a].id]}this.redraw()},redraw:function(){if(!this.locked){this.clear();var g=[];var b,c;for(var k in this.features){if(!this.features.hasOwnProperty(k)){continue}b=this.features[k][0];c=this.features[k][1];if(!b.geometry){continue}this.drawGeometry(b.geometry,c);if(c.label){g.push([b,c])}}var f;for(var a=0;len=g.length,a<len;++a){f=g[a];this.drawText(f[0].geometry.getCentroid(),f[1])}}},CLASS_NAME:"OpenLayers.Renderer.Canvas"});OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right"};OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(b){if(!this.supported()){return}if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);var g=document.createStyleSheet();var c=["shape","rect","oval","fill","stroke","imagedata","group","textbox"];for(var f=0,a=c.length;f<a;f++){g.addRule("olv\\:"+c[f],"behavior: url(#default#VML); position: absolute; display: inline-block;")}}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments);this.offset={x:0,y:0}},destroy:function(){OpenLayers.Renderer.Elements.prototype.destroy.apply(this,arguments)},supported:function(){return !!(document.namespaces)},setExtent:function(o,a){OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments);var c=this.getResolution();var b=o.left/c;var k=o.top/c-this.size.h;if(a){this.offset={x:b,y:k};b=0;k=0}else{b=b-this.offset.x;k=k-this.offset.y}var q=b+" "+k;this.root.coordorigin=q;var m=[this.root,this.vectorRoot,this.textRoot];var l;for(var f=0,g=m.length;f<g;++f){l=m[f];var p=this.size.w+" "+this.size.h;l.coordsize=p}this.root.style.flip="y";return true},setSize:function(k){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);var f=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot];var c=this.size.w+"px";var l=this.size.h+"px";var b;for(var g=0,a=f.length;g<a;++g){b=f[g];b.style.width=c;b.style.height=l}},getNodeType:function(c,b){var a=null;switch(c.CLASS_NAME){case"OpenLayers.Geometry.Point":if(b.externalGraphic){a="olv:rect"}else{if(this.isComplexSymbol(b.graphicName)){a="olv:shape"}else{a="olv:oval"}}break;case"OpenLayers.Geometry.Rectangle":a="olv:rect";break;case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.LinearRing":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":case"OpenLayers.Geometry.Surface":a="olv:shape";break;default:break}return a},setStyle:function(f,b,B,q){b=b||f._style;B=B||f._options;var o=1;if(f._geometryClass=="OpenLayers.Geometry.Point"){if(b.externalGraphic){if(b.graphicTitle){f.title=b.graphicTitle}var c=b.graphicWidth||b.graphicHeight;var r=b.graphicHeight||b.graphicWidth;c=c?c:b.pointRadius*2;r=r?r:b.pointRadius*2;var k=this.getResolution();var m=(b.graphicXOffset!=undefined)?b.graphicXOffset:-(0.5*c);var g=(b.graphicYOffset!=undefined)?b.graphicYOffset:-(0.5*r);f.style.left=((q.x/k-this.offset.x)+m).toFixed();f.style.top=((q.y/k-this.offset.y)-(g+r)).toFixed();f.style.width=c+"px";f.style.height=r+"px";f.style.flip="y";b.fillColor="none";B.isStroked=false}else{if(this.isComplexSymbol(b.graphicName)){var a=this.importSymbol(b.graphicName);f.path=a.path;f.coordorigin=a.left+","+a.bottom;var A=a.size;f.coordsize=A+","+A;this.drawCircle(f,q,b.pointRadius);f.style.flip="y"}else{this.drawCircle(f,q,b.pointRadius)}}}if(B.isFilled){f.fillcolor=b.fillColor}else{f.filled="false"}var p=f.getElementsByTagName("fill");var v=(p.length==0)?null:p[0];if(!B.isFilled){if(v){f.removeChild(v)}}else{if(!v){v=this.createNode("olv:fill",f.id+"_fill")}v.opacity=b.fillOpacity;if(f._geometryClass=="OpenLayers.Geometry.Point"&&b.externalGraphic){if(b.graphicOpacity){v.opacity=b.graphicOpacity}v.src=b.externalGraphic;v.type="frame";if(!(b.graphicWidth&&b.graphicHeight)){v.aspect="atmost"}}if(v.parentNode!=f){f.appendChild(v)}}if(typeof b.rotation!="undefined"){if(b.externalGraphic){this.graphicRotate(f,m,g);v.opacity=0}else{f.style.rotation=b.rotation}}if(B.isStroked){f.strokecolor=b.strokeColor;f.strokeweight=b.strokeWidth+"px"}else{f.stroked=false}var l=f.getElementsByTagName("stroke");var u=(l.length==0)?null:l[0];if(!B.isStroked){if(u){f.removeChild(u)}}else{if(!u){u=this.createNode("olv:stroke",f.id+"_stroke");f.appendChild(u)}u.opacity=b.strokeOpacity;u.endcap=!b.strokeLinecap||b.strokeLinecap=="butt"?"flat":b.strokeLinecap;u.dashstyle=this.dashStyle(b)}if(b.cursor!="inherit"&&b.cursor!=null){f.style.cursor=b.cursor}return f},graphicRotate:function(v,D,k){var C=C||v._style;var f=v._options;var a,p;if(!(C.graphicWidth&&C.graphicHeight)){var E=new Image();E.onreadystatechange=OpenLayers.Function.bind(function(){if(E.readyState=="complete"||E.readyState=="interactive"){a=E.width/E.height;p=Math.max(C.pointRadius*2,C.graphicWidth||0,C.graphicHeight||0);D=D*a;C.graphicWidth=p*a;C.graphicHeight=p;this.graphicRotate(v,D,k)}},this);E.src=C.externalGraphic;return}else{p=Math.max(C.graphicWidth,C.graphicHeight);a=C.graphicWidth/C.graphicHeight}var u=Math.round(C.graphicWidth||p*a);var q=Math.round(C.graphicHeight||p);v.style.width=u+"px";v.style.height=q+"px";var r=document.getElementById(v.id+"_image");if(!r){r=this.createNode("olv:imagedata",v.id+"_image");v.appendChild(r)}r.style.width=u+"px";r.style.height=q+"px";r.src=C.externalGraphic;r.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";var A=C.rotation*Math.PI/180;var m=Math.sin(A);var g=Math.cos(A);var l="progid:DXImageTransform.Microsoft.Matrix(M11="+g+",M12="+(-m)+",M21="+m+",M22="+g+",SizingMethod='auto expand')\n";var b=C.graphicOpacity||C.fillOpacity;if(b&&b!=1){l+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+b+")\n"}v.style.filter=l;var B=new OpenLayers.Geometry.Point(-D,-k);var c=new OpenLayers.Bounds(0,0,u,q).toGeometry();c.rotate(C.rotation,B);var o=c.getBounds();v.style.left=Math.round(parseInt(v.style.left)+o.left)+"px";v.style.top=Math.round(parseInt(v.style.top)-o.bottom)+"px"},postDraw:function(a){var c=a._style.fillColor;var b=a._style.strokeColor;if(c=="none"&&a.fillcolor!=c){a.fillcolor=c}if(b=="none"&&a.strokecolor!=b){a.strokecolor=b}},setNodeDimension:function(b,g){var f=g.getBounds();if(f){var a=this.getResolution();var c=new OpenLayers.Bounds((f.left/a-this.offset.x).toFixed(),(f.bottom/a-this.offset.y).toFixed(),(f.right/a-this.offset.x).toFixed(),(f.top/a-this.offset.y).toFixed());b.style.left=c.left+"px";b.style.top=c.top+"px";b.style.width=c.getWidth()+"px";b.style.height=c.getHeight()+"px";b.coordorigin=c.left+" "+c.top;b.coordsize=c.getWidth()+" "+c.getHeight()}},dashStyle:function(a){var c=a.strokeDashstyle;switch(c){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return c;default:var b=c.split(/[ ,]/);if(b.length==2){if(1*b[0]>=2*b[1]){return"longdash"}return(b[0]==1||b[1]==1)?"dot":"dash"}else{if(b.length==4){return(1*b[0]>=2*b[1])?"longdashdot":"dashdot"}}return"solid"}},createNode:function(a,c){var b=document.createElement(a);if(c){b.id=c}b.unselectable="on";b.onselectstart=function(){return(false)};return b},nodeTypeCompare:function(c,b){var f=b;var a=f.indexOf(":");if(a!=-1){f=f.substr(a+1)}var g=c.nodeName;a=g.indexOf(":");if(a!=-1){g=g.substr(a+1)}return(f==g)},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div")},createRoot:function(a){return this.nodeFactory(this.container.id+a,"olv:group")},drawPoint:function(a,b){return this.drawCircle(a,b,1)},drawCircle:function(f,g,a){if(!isNaN(g.x)&&!isNaN(g.y)){var b=this.getResolution();f.style.left=((g.x/b-this.offset.x).toFixed()-a)+"px";f.style.top=((g.y/b-this.offset.y).toFixed()-a)+"px";var c=a*2;f.style.width=c+"px";f.style.height=c+"px";return f}return false},drawLineString:function(a,b){return this.drawLine(a,b,false)},drawLinearRing:function(a,b){return this.drawLine(a,b,true)},drawLine:function(b,p,l){this.setNodeDimension(b,p);var c=this.getResolution();var a=p.components.length;var g=new Array(a);var m,q,o;for(var k=0;k<a;k++){m=p.components[k];q=(m.x/c-this.offset.x);o=(m.y/c-this.offset.y);g[k]=" "+q.toFixed()+","+o.toFixed()+" l "}var f=(l)?" x e":" e";b.path="m"+g.join("")+f;return b},drawPolygon:function(b,p){this.setNodeDimension(b,p);var c=this.getResolution();var r=[];var k,g,f,m,a,l,q,o;for(f=0,m=p.components.length;f<m;f++){k=p.components[f];r.push("m");for(g=0,a=k.components.length;g<a;g++){l=k.components[g];q=l.x/c-this.offset.x;o=l.y/c-this.offset.y;r.push(" "+q.toFixed()+","+o.toFixed());if(g==0){r.push(" l")}}r.push(" x ")}r.push("e");b.path=r.join("");return b},drawRectangle:function(b,c){var a=this.getResolution();b.style.left=(c.x/a-this.offset.x)+"px";b.style.top=(c.y/a-this.offset.y)+"px";b.style.width=c.width/a+"px";b.style.height=c.height/a+"px";return b},drawText:function(f,a,m){var l=this.nodeFactory(f+this.LABEL_ID_SUFFIX,"olv:rect");var k=this.nodeFactory(f+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox");var c=this.getResolution();l.style.left=(m.x/c-this.offset.x).toFixed()+"px";l.style.top=(m.y/c-this.offset.y).toFixed()+"px";l.style.flip="y";k.innerText=a.label;if(a.fillColor){k.style.color=a.fontColor}if(a.fontFamily){k.style.fontFamily=a.fontFamily}if(a.fontSize){k.style.fontSize=a.fontSize}if(a.fontWeight){k.style.fontWeight=a.fontWeight}k.style.whiteSpace="nowrap";k.inset="1px,0px,0px,0px";if(!l.parentNode){l.appendChild(k);this.textRoot.appendChild(l)}var g=a.labelAlign||"cm";var o=k.clientWidth*(OpenLayers.Renderer.VML.LABEL_SHIFT[g.substr(0,1)]);var b=k.clientHeight*(OpenLayers.Renderer.VML.LABEL_SHIFT[g.substr(1,1)]);l.style.left=parseInt(l.style.left)-o-1+"px";l.style.top=parseInt(l.style.top)+b+"px"},drawSurface:function(a,l){this.setNodeDimension(a,l);var b=this.getResolution();var o=[];var f,m,k;for(var c=0,g=l.components.length;c<g;c++){f=l.components[c];m=f.x/b-this.offset.x;k=f.y/b-this.offset.y;if((c%3)==0&&(c/3)==0){o.push("m")}else{if((c%3)==1){o.push(" c")}}o.push(" "+m+","+k)}o.push(" x e");a.path=o.join("");return a},moveRoot:function(b){var a=this.map.getLayer(b.container.id);if(a instanceof OpenLayers.Layer.Vector.RootContainer){a=this.map.getLayer(this.container.id)}a&&a.renderer.clear();OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments);a&&a.redraw()},importSymbol:function(f){var b=this.container.id+"-"+f;var a=this.symbolCache[b];if(a){return a}var c=OpenLayers.Renderer.symbol[f];if(!c){throw new Error(f+" is not a valid symbol name");return}var m=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);var g=["m"];for(var k=0;k<c.length;k=k+2){x=c[k];y=c[k+1];m.left=Math.min(m.left,x);m.bottom=Math.min(m.bottom,y);m.right=Math.max(m.right,x);m.top=Math.max(m.top,y);g.push(x);g.push(y);if(k==0){g.push("l")}}g.push("x e");var o=g.join(" ");var l=(m.getWidth()-m.getHeight())/2;if(l>0){m.bottom=m.bottom-l;m.top=m.top+l}else{m.left=m.left-l;m.right=m.right+l}a={path:o,size:m.getWidth(),left:m.left,bottom:m.bottom};this.symbolCache[b]=a;return a},CLASS_NAME:"OpenLayers.Renderer.VML"});OpenLayers.Renderer.VML.LABEL_SHIFT={l:0,c:0.5,r:1,t:0,m:0.5,b:1};OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{EVENT_TYPES:["beforefeatureadded","beforefeaturesadded","featureadded","featuresadded","beforefeatureremoved","featureremoved","featuresremoved","beforefeatureselected","featureselected","featureunselected","beforefeaturemodified","featuremodified","afterfeaturemodified","vertexmodified","sketchstarted","sketchmodified","sketchcomplete","refresh"],isBaseLayer:false,isFixed:false,isVector:true,features:null,selectedFeatures:null,unrenderedFeatures:null,reportError:true,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:false,initialize:function(c,b){this.EVENT_TYPES=OpenLayers.Layer.Vector.prototype.EVENT_TYPES.concat(OpenLayers.Layer.prototype.EVENT_TYPES);OpenLayers.Layer.prototype.initialize.apply(this,arguments);if(!this.renderer||!this.renderer.supported()){this.assignRenderer()}if(!this.renderer||!this.renderer.supported()){this.renderer=null;this.displayError()}if(!this.styleMap){this.styleMap=new OpenLayers.StyleMap()}this.features=[];this.selectedFeatures=[];this.unrenderedFeatures={};if(this.strategies){for(var f=0,a=this.strategies.length;f<a;f++){this.strategies[f].setLayer(this)}}},destroy:function(){if(this.strategies){var c,b,a;for(b=0,a=this.strategies.length;b<a;b++){c=this.strategies[b];if(c.autoDestroy){c.destroy()}}this.strategies=null}if(this.protocol){if(this.protocol.autoDestroy){this.protocol.destroy()}this.protocol=null}this.destroyFeatures();this.features=null;this.selectedFeatures=null;this.unrenderedFeatures=null;if(this.renderer){this.renderer.destroy()}this.renderer=null;this.geometryType=null;this.drawn=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},refresh:function(a){if(this.calculateInRange()&&this.visibility){this.events.triggerEvent("refresh",a)}},assignRenderer:function(){for(var c=0,a=this.renderers.length;c<a;c++){var b=OpenLayers.Renderer[this.renderers[c]];if(b&&b.prototype.supported()){this.renderer=new b(this.div,this.rendererOptions);break}}},displayError:function(){if(this.reportError){OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))}},setMap:function(a){OpenLayers.Layer.prototype.setMap.apply(this,arguments);if(!this.renderer){this.map.removeLayer(this)}else{this.renderer.map=this.map;this.renderer.setSize(this.map.getSize())}},afterAdd:function(){if(this.strategies){var c,b,a;for(b=0,a=this.strategies.length;b<a;b++){c=this.strategies[b];if(c.autoActivate){c.activate()}}}},removeMap:function(c){if(this.strategies){var f,b,a;for(b=0,a=this.strategies.length;b<a;b++){f=this.strategies[b];if(f.autoActivate){f.deactivate()}}}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);this.renderer.setSize(this.map.getSize())},moveTo:function(l,b,m){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var g=true;if(!m){this.renderer.root.style.visibility="hidden";this.div.style.left=-parseInt(this.map.layerContainerDiv.style.left)+"px";this.div.style.top=-parseInt(this.map.layerContainerDiv.style.top)+"px";var k=this.map.getExtent();g=this.renderer.setExtent(k,b);this.renderer.root.style.visibility="visible";if(navigator.userAgent.toLowerCase().indexOf("gecko")!=-1){this.div.scrollLeft=this.div.scrollLeft}if(!b&&g){for(var f in this.unrenderedFeatures){var c=this.unrenderedFeatures[f];this.drawFeature(c)}}}if(!this.drawn||b||!g){this.drawn=true;var c;for(var f=0,a=this.features.length;f<a;f++){this.renderer.locked=(f!==(a-1));c=this.features[f];this.drawFeature(c)}}},display:function(a){OpenLayers.Layer.prototype.display.apply(this,arguments);var b=this.div.style.display;if(b!=this.renderer.root.style.display){this.renderer.root.style.display=b}},addFeatures:function(b,o){if(!(b instanceof Array)){b=[b]}var l=!o||!o.silent;if(l){var a={features:b};var k=this.events.triggerEvent("beforefeaturesadded",a);if(k===false){return}b=a.features}for(var c=0,g=b.length;c<g;c++){if(c!=(b.length-1)){this.renderer.locked=true}else{this.renderer.locked=false}var m=b[c];if(this.geometryType&&!(m.geometry instanceof this.geometryType)){var f=OpenLayers.i18n("componentShouldBe",{geomType:this.geometryType.prototype.CLASS_NAME});throw f}this.features.push(m);m.layer=this;if(!m.style&&this.style){m.style=OpenLayers.Util.extend({},this.style)}if(l){if(this.events.triggerEvent("beforefeatureadded",{feature:m})===false){continue}this.preFeatureInsert(m)}this.drawFeature(m);if(l){this.events.triggerEvent("featureadded",{feature:m});this.onFeatureInsert(m)}}if(l){this.events.triggerEvent("featuresadded",{features:b})}},removeFeatures:function(g,a){if(!g||g.length===0){return}if(!(g instanceof Array)){g=[g]}if(g===this.features){g=g.slice()}var f=!a||!a.silent;for(var c=g.length-1;c>=0;c--){if(c!=0&&g[c-1].geometry){this.renderer.locked=true}else{this.renderer.locked=false}var b=g[c];delete this.unrenderedFeatures[b.id];if(f){this.events.triggerEvent("beforefeatureremoved",{feature:b})}this.features=OpenLayers.Util.removeItem(this.features,b);b.layer=null;if(b.geometry){this.renderer.eraseFeatures(b)}if(OpenLayers.Util.indexOf(this.selectedFeatures,b)!=-1){OpenLayers.Util.removeItem(this.selectedFeatures,b)}if(f){this.events.triggerEvent("featureremoved",{feature:b})}}if(f){this.events.triggerEvent("featuresremoved",{features:g})}},destroyFeatures:function(f,a){var c=(f==undefined);if(c){f=this.features}if(f){this.removeFeatures(f,a);for(var b=f.length-1;b>=0;b--){f[b].destroy()}}},drawFeature:function(a,b){if(!this.drawn){return}if(typeof b!="object"){if(!b&&a.state===OpenLayers.State.DELETE){b="delete"}var c=b||a.renderIntent;b=a.style||this.style;if(!b){b=this.styleMap.createSymbolizer(a,c)}}if(!this.renderer.drawFeature(a,b)){this.unrenderedFeatures[a.id]=a}else{delete this.unrenderedFeatures[a.id]}},eraseFeatures:function(a){this.renderer.eraseFeatures(a)},getFeatureFromEvent:function(a){if(!this.renderer){OpenLayers.Console.error(OpenLayers.i18n("getFeatureError"));return null}var b=this.renderer.getFeatureIdFromEvent(a);return this.getFeatureById(b)},getFeatureById:function(f){var c=null;for(var b=0,a=this.features.length;b<a;++b){if(this.features[b].id==f){c=this.features[b];break}}return c},onFeatureInsert:function(a){},preFeatureInsert:function(a){},getDataExtent:function(){var b=null;if(this.features&&(this.features.length>0)){b=new OpenLayers.Bounds();for(var c=0,a=this.features.length;c<a;c++){b.extend(this.features[c].geometry.getBounds())}}return b},CLASS_NAME:"OpenLayers.Layer.Vector"});OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,{displayInLayerSwitcher:false,layers:null,initialize:function(b,a){OpenLayers.Layer.Vector.prototype.initialize.apply(this,arguments)},display:function(){},getFeatureFromEvent:function(a){var f=this.layers;var c;for(var b=0;b<f.length;b++){c=f[b].getFeatureFromEvent(a);if(c){return c}}},setMap:function(a){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);this.collectRoots();a.events.register("changelayer",this,this.handleChangeLayer)},removeMap:function(a){a.events.unregister("changelayer",this,this.handleChangeLayer);this.resetRoots();OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},collectRoots:function(){var b;for(var a=0;a<this.map.layers.length;++a){b=this.map.layers[a];if(OpenLayers.Util.indexOf(this.layers,b)!=-1){b.renderer.moveRoot(this.renderer)}}},resetRoots:function(){var b;for(var a=0;a<this.layers.length;++a){b=this.layers[a];if(this.renderer&&b.renderer.getRenderLayerId()==this.id){this.renderer.moveRoot(b.renderer)}}},handleChangeLayer:function(a){var b=a.layer;if(a.property=="order"&&OpenLayers.Util.indexOf(this.layers,b)!=-1){this.resetRoots();this.collectRoots()}},CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"});OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:true,autoDestroy:true,initialize:function(a){OpenLayers.Util.extend(this,a);this.options=a;this.active=false},destroy:function(){this.deactivate();this.layer=null;this.options=null},setLayer:function(a){this.layer=a},activate:function(){if(!this.active){this.active=true;return true}return false},deactivate:function(){if(this.active){this.active=false;return true}return false},CLASS_NAME:"OpenLayers.Strategy"});OpenLayers.Strategy.Fixed=OpenLayers.Class(OpenLayers.Strategy,{preload:false,initialize:function(a){OpenLayers.Strategy.prototype.initialize.apply(this,[a])},destroy:function(){OpenLayers.Strategy.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Strategy.prototype.activate.apply(this,arguments)){this.layer.events.on({refresh:this.load,scope:this});if(this.layer.visibility==true||this.preload){this.load()}else{this.layer.events.on({visibilitychanged:this.load,scope:this})}return true}return false},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);if(a){this.layer.events.un({refresh:this.load,visibilitychanged:this.load,scope:this})}return a},load:function(a){this.layer.events.triggerEvent("loadstart");this.layer.protocol.read(OpenLayers.Util.applyDefaults({callback:this.merge,scope:this},a));this.layer.events.un({visibilitychanged:this.load,scope:this})},merge:function(l){this.layer.destroyFeatures();var g=l.features;if(g&&g.length>0){var k=this.layer.projection;var f=this.layer.map.getProjectionObject();if(!f.equals(k)){var c;for(var b=0,a=g.length;b<a;++b){c=g[b].geometry;if(c){c.transform(k,f)}}}this.layer.addFeatures(g)}this.layer.events.triggerEvent("loadend")},CLASS_NAME:"OpenLayers.Strategy.Fixed"});OpenLayers.Strategy.Cluster=OpenLayers.Class(OpenLayers.Strategy,{distance:20,threshold:null,features:null,clusters:null,clustering:false,resolution:null,initialize:function(a){OpenLayers.Strategy.prototype.initialize.apply(this,[a])},activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);if(a){this.layer.events.on({beforefeaturesadded:this.cacheFeatures,moveend:this.cluster,scope:this})}return a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);if(a){this.clearCache();this.layer.events.un({beforefeaturesadded:this.cacheFeatures,moveend:this.cluster,scope:this})}return a},cacheFeatures:function(b){var a=true;if(!this.clustering){this.clearCache();this.features=b.features;this.cluster();a=false}return a},clearCache:function(){this.features=null},cluster:function(a){if((!a||a.zoomChanged)&&this.features){var c=this.layer.map.getResolution();if(c!=this.resolution||!this.clustersExist()){this.resolution=c;var m=[];var q,b,o;for(var g=0;g<this.features.length;++g){q=this.features[g];if(q.geometry){b=false;for(var f=0;f<m.length;++f){o=m[f];if(this.shouldCluster(o,q)){this.addToCluster(o,q);b=true;break}}if(!b){m.push(this.createCluster(this.features[g]))}}}this.layer.destroyFeatures();if(m.length>0){if(this.threshold>1){var l=m.slice();m=[];var p;for(var g=0,k=l.length;g<k;++g){p=l[g];if(p.attributes.count<this.threshold){Array.prototype.push.apply(m,p.cluster)}else{m.push(p)}}}this.clustering=true;this.layer.addFeatures(m);this.clustering=false}this.clusters=m}}},clustersExist:function(){var b=false;if(this.clusters&&this.clusters.length>0&&this.clusters.length==this.layer.features.length){b=true;for(var a=0;a<this.clusters.length;++a){if(this.clusters[a]!=this.layer.features[a]){b=false;break}}}return b},shouldCluster:function(a,b){var g=a.geometry.getBounds().getCenterLonLat();var c=b.geometry.getBounds().getCenterLonLat();var f=(Math.sqrt(Math.pow((g.lon-c.lon),2)+Math.pow((g.lat-c.lat),2))/this.resolution);return(f<=this.distance)},addToCluster:function(a,b){a.cluster.push(b);a.attributes.count+=1},createCluster:function(c){var b=c.geometry.getBounds().getCenterLonLat();var a=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat),{count:1});a.cluster=[c];return a},CLASS_NAME:"OpenLayers.Strategy.Cluster"});OpenLayers.Strategy.Paging=OpenLayers.Class(OpenLayers.Strategy,{features:null,length:10,num:null,paging:false,initialize:function(a){OpenLayers.Strategy.prototype.initialize.apply(this,[a])},activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);if(a){this.layer.events.on({beforefeaturesadded:this.cacheFeatures,scope:this})}return a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);if(a){this.clearCache();this.layer.events.un({beforefeaturesadded:this.cacheFeatures,scope:this})}return a},cacheFeatures:function(a){if(!this.paging){this.clearCache();this.features=a.features;this.pageNext(a)}},clearCache:function(){if(this.features){for(var a=0;a<this.features.length;++a){this.features[a].destroy()}}this.features=null;this.num=null},pageCount:function(){var a=this.features?this.features.length:0;return Math.ceil(a/this.length)},pageNum:function(){return this.num},pageLength:function(a){if(a&&a>0){this.length=a}return this.length},pageNext:function(a){var b=false;if(this.features){if(this.num===null){this.num=-1}var c=(this.num+1)*this.length;b=this.page(c,a)}return b},pagePrevious:function(){var a=false;if(this.features){if(this.num===null){this.num=this.pageCount()}var b=(this.num-1)*this.length;a=this.page(b)}return a},page:function(g,c){var f=false;if(this.features){if(g>=0&&g<this.features.length){var a=Math.floor(g/this.length);if(a!=this.num){this.paging=true;var b=this.features.slice(g,g+this.length);this.layer.removeFeatures(this.layer.features);this.num=a;if(c&&c.features){c.features=b}else{this.layer.addFeatures(b)}this.paging=false;f=true}}}return f},CLASS_NAME:"OpenLayers.Strategy.Paging"});OpenLayers.Strategy.BBOX=OpenLayers.Class(OpenLayers.Strategy,{bounds:null,resolution:null,ratio:2,resFactor:null,response:null,initialize:function(a){OpenLayers.Strategy.prototype.initialize.apply(this,[a])},activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);if(a){this.layer.events.on({moveend:this.update,scope:this});this.layer.events.on({refresh:this.update,scope:this})}return a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);if(a){this.layer.events.un({moveend:this.update,scope:this});this.layer.events.un({refresh:this.update,scope:this})}return a},update:function(b){var a=this.getMapBounds();if((b&&b.force)||this.invalidBounds(a)){this.calculateBounds(a);this.resolution=this.layer.map.getResolution();this.triggerRead()}},getMapBounds:function(){var a=this.layer.map.getExtent();if(!this.layer.projection.equals(this.layer.map.getProjectionObject())){a=a.clone().transform(this.layer.map.getProjectionObject(),this.layer.projection)}return a},invalidBounds:function(a){if(!a){a=this.getMapBounds()}var c=!this.bounds||!this.bounds.containsBounds(a);if(!c&&this.resFactor){var b=this.resolution/this.layer.map.getResolution();c=(b>=this.resFactor||b<=(1/this.resFactor))}return c},calculateBounds:function(b){if(!b){b=this.getMapBounds()}var a=b.getCenterLonLat();var f=b.getWidth()*this.ratio;var c=b.getHeight()*this.ratio;this.bounds=new OpenLayers.Bounds(a.lon-(f/2),a.lat-(c/2),a.lon+(f/2),a.lat+(c/2))},triggerRead:function(){this.layer.protocol.abort(this.response);this.layer.events.triggerEvent("loadstart");this.response=this.layer.protocol.read({filter:this.createFilter(),callback:this.merge,scope:this})},createFilter:function(){var a=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:this.bounds,projection:this.layer.projection});if(this.layer.filter){a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.layer.filter,a]})}return a},merge:function(l){this.layer.destroyFeatures();var g=l.features;if(g&&g.length>0){var k=this.layer.projection;var f=this.layer.map.getProjectionObject();if(!f.equals(k)){var c;for(var b=0,a=g.length;b<a;++b){c=g[b].geometry;if(c){c.transform(k,f)}}}this.layer.addFeatures(g)}this.layer.events.triggerEvent("loadend")},CLASS_NAME:"OpenLayers.Strategy.BBOX"});OpenLayers.Strategy.Save=OpenLayers.Class(OpenLayers.Strategy,{auto:false,timer:null,initialize:function(a){OpenLayers.Strategy.prototype.initialize.apply(this,[a])},activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);if(a){if(this.auto){if(typeof this.auto==="number"){this.timer=window.setInterval(OpenLayers.Function.bind(this.save,this),this.auto*1000)}else{this.layer.events.on({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this})}}}return a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);if(a){if(this.auto){if(typeof this.auto==="number"){window.clearInterval(this.timer)}else{this.layer.events.un({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this})}}}return a},triggerSave:function(b){var a=b.feature;if(a.state===OpenLayers.State.INSERT||a.state===OpenLayers.State.UPDATE||a.state===OpenLayers.State.DELETE){this.save([b.feature])}},save:function(f){if(!f){f=this.layer.features}var k=this.layer.projection;var c=this.layer.map.getProjectionObject();if(!c.equals(k)){var a=f.length;var g=new Array(a);var m,l;for(var b=0;b<a;++b){m=f[b];l=m.clone();l.fid=m.fid;l.state=m.state;l._original=m;l.geometry.transform(c,k);g[b]=l}f=g}this.layer.protocol.commit(f,{callback:this.onCommit,scope:this})},onCommit:function(f){if(f.success()){var b=f.reqFeatures;var a,o;var c=[];var m=f.insertIds||[];var g=0;for(var k=0,l=b.length;k<l;++k){o=b[k];o=o._original||o;a=o.state;if(a){if(a==OpenLayers.State.DELETE){c.push(o)}else{if(a==OpenLayers.State.INSERT){o.fid=m[g];++g}}o.state=null}}if(c.length>0){this.layer.destroyFeatures(c)}}},CLASS_NAME:"OpenLayers.Strategy.Save"});OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:true,initialize:function(a){a=a||{};OpenLayers.Util.extend(this,a);this.options=a},destroy:function(){this.options=null;this.format=null},read:function(){},create:function(){},update:function(){},"delete":function(){},commit:function(){},abort:function(a){},CLASS_NAME:"OpenLayers.Protocol"});OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:true,features:null,reqFeatures:null,priv:null,initialize:function(a){OpenLayers.Util.extend(this,a)},success:function(){return this.code>0},CLASS_NAME:"OpenLayers.Protocol.Response"});OpenLayers.Protocol.Response.SUCCESS=1;OpenLayers.Protocol.Response.FAILURE=0;OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:false,initialize:function(a){this.params={};this.headers={};OpenLayers.Protocol.prototype.initialize.apply(this,arguments)},destroy:function(){this.params=null;this.headers=null;OpenLayers.Protocol.prototype.destroy.apply(this)},createCallback:function(c,a,b){return OpenLayers.Function.bind(function(){c.apply(this,[a,b])},this)},read:function(a){a=OpenLayers.Util.applyDefaults(a,this.options);var b=(a.readWithPOST!==undefined)?a.readWithPOST:this.readWithPOST;var c=new OpenLayers.Protocol.Response({requestType:"read"});if(a.filter&&a.filter instanceof OpenLayers.Filter.Spatial){if(a.filter.type==OpenLayers.Filter.Spatial.BBOX){a.params=OpenLayers.Util.extend(a.params,{bbox:a.filter.value.toArray()})}}if(b){c.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleRead,c,a),data:OpenLayers.Util.getParameterString(a.params),headers:{"Content-Type":"application/x-www-form-urlencoded"}})}else{c.priv=OpenLayers.Request.GET({url:a.url,callback:this.createCallback(this.handleRead,c,a),params:a.params,headers:a.headers})}return c},handleRead:function(b,a){this.handleResponse(b,a)},create:function(b,a){a=OpenLayers.Util.applyDefaults(a,this.options);var c=new OpenLayers.Protocol.Response({reqFeatures:b,requestType:"create"});c.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleCreate,c,a),headers:a.headers,data:this.format.write(b)});return c},handleCreate:function(b,a){this.handleResponse(b,a)},update:function(c,b){var a=b.url||c.url||this.options.url;b=OpenLayers.Util.applyDefaults(b,this.options);var f=new OpenLayers.Protocol.Response({reqFeatures:c,requestType:"update"});f.priv=OpenLayers.Request.PUT({url:a,callback:this.createCallback(this.handleUpdate,f,b),headers:b.headers,data:this.format.write(c)});return f},handleUpdate:function(b,a){this.handleResponse(b,a)},"delete":function(c,b){var a=b.url||c.url||this.options.url;b=OpenLayers.Util.applyDefaults(b,this.options);var f=new OpenLayers.Protocol.Response({reqFeatures:c,requestType:"delete"});f.priv=OpenLayers.Request.DELETE({url:a,callback:this.createCallback(this.handleDelete,f,b),headers:b.headers});return f},handleDelete:function(b,a){this.handleResponse(b,a)},handleResponse:function(c,a){var b=c.priv;if(a.callback){if(b.status>=200&&b.status<300){if(c.requestType!="delete"){c.features=this.parseFeatures(b)}c.code=OpenLayers.Protocol.Response.SUCCESS}else{c.code=OpenLayers.Protocol.Response.FAILURE}a.callback.call(a.scope,c)}},parseFeatures:function(a){var b=a.responseXML;if(!b||!b.documentElement){b=a.responseText}if(!b||b.length<=0){return null}return this.format.read(b)},commit:function(b,B){B=OpenLayers.Util.applyDefaults(B,this.options);var f=[],r=0;var p={};p[OpenLayers.State.INSERT]=[];p[OpenLayers.State.UPDATE]=[];p[OpenLayers.State.DELETE]=[];var A,q,c=[];for(var g=0,o=b.length;g<o;++g){A=b[g];q=p[A.state];if(q){q.push(A);c.push(A)}}var l=(p[OpenLayers.State.INSERT].length>0?1:0)+p[OpenLayers.State.UPDATE].length+p[OpenLayers.State.DELETE].length;var v=true;var a=new OpenLayers.Protocol.Response({reqFeatures:c});function m(D){var C=D.features?D.features.length:0;var F=new Array(C);for(var E=0;E<C;++E){F[E]=D.features[E].fid}a.insertIds=F;u.apply(this,[D])}function u(C){this.callUserCallback(C,B);v=v&&C.success();r++;if(r>=l){if(B.callback){a.code=v?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE;B.callback.apply(B.scope,[a])}}}var k=p[OpenLayers.State.INSERT];if(k.length>0){f.push(this.create(k,OpenLayers.Util.applyDefaults({callback:m,scope:this},B.create)))}k=p[OpenLayers.State.UPDATE];for(var g=k.length-1;g>=0;--g){f.push(this.update(k[g],OpenLayers.Util.applyDefaults({callback:u,scope:this},B.update)))}k=p[OpenLayers.State.DELETE];for(var g=k.length-1;g>=0;--g){f.push(this["delete"](k[g],OpenLayers.Util.applyDefaults({callback:u,scope:this},B["delete"])))}return f},abort:function(a){if(a){a.priv.abort()}},callUserCallback:function(c,a){var b=a[c.requestType];if(b&&b.callback){b.callback.call(b.scope,c)}},CLASS_NAME:"OpenLayers.Protocol.HTTP"});OpenLayers.Protocol.SQL=OpenLayers.Class(OpenLayers.Protocol,{databaseName:"ol",tableName:"ol_vector_features",postReadFiltering:true,initialize:function(a){OpenLayers.Protocol.prototype.initialize.apply(this,[a])},destroy:function(){OpenLayers.Protocol.prototype.destroy.apply(this)},supported:function(){return false},evaluateFilter:function(a,b){return b&&this.postReadFiltering?b.evaluate(a):true},CLASS_NAME:"OpenLayers.Protocol.SQL"});OpenLayers.Protocol.SQL.Gears=OpenLayers.Class(OpenLayers.Protocol.SQL,{FID_PREFIX:"__gears_fid__",NULL_GEOMETRY:"__gears_null_geometry__",NULL_FEATURE_STATE:"__gears_null_feature_state__",jsonParser:null,wktParser:null,fidRegExp:null,saveFeatureState:true,typeOfFid:"string",db:null,initialize:function(a){if(!this.supported()){return}OpenLayers.Protocol.SQL.prototype.initialize.apply(this,[a]);this.jsonParser=new OpenLayers.Format.JSON();this.wktParser=new OpenLayers.Format.WKT();this.fidRegExp=new RegExp("^"+this.FID_PREFIX);this.initializeDatabase()},initializeDatabase:function(){this.db=google.gears.factory.create("beta.database");this.db.open(this.databaseName);this.db.execute("CREATE TABLE IF NOT EXISTS "+this.tableName+" (fid TEXT UNIQUE, geometry TEXT, properties TEXT,  state TEXT)")},destroy:function(){this.db.close();this.db=null;this.jsonParser=null;this.wktParser=null;OpenLayers.Protocol.SQL.prototype.destroy.apply(this)},supported:function(){return !!(window.google&&google.gears)},read:function(b){b=OpenLayers.Util.applyDefaults(b,this.options);var c,f=[];var a=this.db.execute("SELECT * FROM "+this.tableName);while(a.isValidRow()){c=this.unfreezeFeature(a);if(this.evaluateFilter(c,b.filter)){if(!b.noFeatureStateReset){c.state=null}f.push(c)}a.next()}a.close();var g=new OpenLayers.Protocol.Response({code:OpenLayers.Protocol.Response.SUCCESS,requestType:"read",features:f});if(b&&b.callback){b.callback.call(b.scope,g)}return g},unfreezeFeature:function(f){var a;var b=f.fieldByName("geometry");if(b==this.NULL_GEOMETRY){a=new OpenLayers.Feature.Vector()}else{a=this.wktParser.read(b)}a.attributes=this.jsonParser.read(f.fieldByName("properties"));a.fid=this.extractFidFromField(f.fieldByName("fid"));var c=f.fieldByName("state");if(c==this.NULL_FEATURE_STATE){c=null}a.state=c;return a},extractFidFromField:function(a){if(!a.match(this.fidRegExp)&&this.typeOfFid=="number"){a=parseFloat(a)}return a},create:function(b,a){a=OpenLayers.Util.applyDefaults(a,this.options);var c=this.createOrUpdate(b);c.requestType="create";if(a&&a.callback){a.callback.call(a.scope,c)}return c},update:function(b,a){a=OpenLayers.Util.applyDefaults(a,this.options);var c=this.createOrUpdate(b);c.requestType="update";if(a&&a.callback){a.callback.call(a.scope,c)}return c},createOrUpdate:function(g){if(!(g instanceof Array)){g=[g]}var c,a=g.length,b;var f=new Array(a);for(c=0;c<a;c++){b=g[c];var k=this.freezeFeature(b);this.db.execute("REPLACE INTO "+this.tableName+" (fid, geometry, properties, state) VALUES (?, ?, ?, ?)",k);var l=b.clone();l.fid=this.extractFidFromField(k[0]);f[c]=l}return new OpenLayers.Protocol.Response({code:OpenLayers.Protocol.Response.SUCCESS,features:f,reqFeatures:g})},freezeFeature:function(b){b.fid=b.fid!=null?""+b.fid:OpenLayers.Util.createUniqueID(this.FID_PREFIX);var f=b.geometry!=null?b.geometry.toString():this.NULL_GEOMETRY;var a=this.jsonParser.write(b.attributes);var c=this.getFeatureStateForFreeze(b);return[b.fid,f,a,c]},getFeatureStateForFreeze:function(a){var b;if(!this.saveFeatureState){b=this.NULL_FEATURE_STATE}else{if(this.createdOffline(a)){b=OpenLayers.State.INSERT}else{b=a.state}}return b},"delete":function(k,c){if(!(k instanceof Array)){k=[k]}c=OpenLayers.Util.applyDefaults(c,this.options);var g,a,f;for(g=0,a=k.length;g<a;g++){f=k[g];if(this.saveFeatureState&&!this.createdOffline(f)){var b=f.clone();b.fid=f.fid;if(b.geometry){b.geometry.destroy();b.geometry=null}b.state=f.state;this.createOrUpdate(b)}else{this.db.execute("DELETE FROM "+this.tableName+" WHERE fid = ?",[f.fid])}}var l=new OpenLayers.Protocol.Response({code:OpenLayers.Protocol.Response.SUCCESS,requestType:"delete",reqFeatures:k});if(c&&c.callback){c.callback.call(c.scope,l)}return l},createdOffline:function(a){return(typeof a.fid=="string"&&!!(a.fid.match(this.fidRegExp)))},commit:function(c,r){var b,g=[],l=0,m=0;function p(u){if(++m<l){u.last=false}this.callUserCallback(r,u)}var q,o=[],a=[],f=[];for(var k=c.length-1;k>=0;k--){q=c[k];switch(q.state){case OpenLayers.State.INSERT:o.push(q);break;case OpenLayers.State.UPDATE:a.push(q);break;case OpenLayers.State.DELETE:f.push(q);break}}if(o.length>0){l++;b=OpenLayers.Util.applyDefaults({callback:p,scope:this},r.create);g.push(this.create(o,b))}if(a.length>0){l++;b=OpenLayers.Util.applyDefaults({callback:p,scope:this},r.update);g.push(this.update(a,b))}if(f.length>0){l++;b=OpenLayers.Util.applyDefaults({callback:p,scope:this},r["delete"]);g.push(this["delete"](f,b))}return g},clear:function(){this.db.execute("DELETE FROM "+this.tableName)},callUserCallback:function(a,c){var b=a[c.requestType];if(b&&b.callback){b.callback.call(b.scope,c)}if(c.last&&a.callback){a.callback.call(a.scope)}},CLASS_NAME:"OpenLayers.Protocol.SQL.Gears"});OpenLayers.Protocol.WFS=function(b){b=OpenLayers.Util.applyDefaults(b,OpenLayers.Protocol.WFS.DEFAULTS);var a=OpenLayers.Protocol.WFS["v"+b.version.replace(/\./g,"_")];if(!a){throw"Unsupported WFS version: "+b.version}return new a(b)};OpenLayers.Protocol.WFS.fromWMSLayer=function(f,c){var a,g;var l=f.params.LAYERS;var k=(l instanceof Array?l[0]:l).split(":");if(k.length>1){g=k[0]}a=k.pop();var b={url:f.url,featureType:a,featurePrefix:g,srsName:f.projection&&f.projection.getCode()||f.map&&f.map.getProjectionObject().getCode(),version:"1.1.0"};return new OpenLayers.Protocol.WFS(OpenLayers.Util.applyDefaults(c,b))};OpenLayers.Protocol.WFS.DEFAULTS={version:"1.0.0"};OpenLayers.Protocol.WFS.v1=OpenLayers.Class(OpenLayers.Protocol,{version:null,srsName:"EPSG:4326",featureType:null,featureNS:null,geometryName:"the_geom",schema:null,featurePrefix:"feature",formatOptions:null,initialize:function(b){OpenLayers.Protocol.prototype.initialize.apply(this,[b]);if(!b.format){this.format=OpenLayers.Format.WFST(OpenLayers.Util.extend({version:this.version,featureType:this.featureType,featureNS:this.featureNS,featurePrefix:this.featurePrefix,geometryName:this.geometryName,srsName:this.srsName,schema:this.schema},this.formatOptions))}if(!this.featureNS){var a=this.format.readNode;this.format.readNode=function(c,f){if(!this.featureNS&&c.prefix==this.featurePrefix){this.featureNS=c.namespaceURI;this.setNamespace("feature",this.featureNS)}return a.apply(this,arguments)}}},destroy:function(){if(this.options&&!this.options.format){this.format.destroy()}this.format=null;OpenLayers.Protocol.prototype.destroy.apply(this)},createCallback:function(c,a,b){return OpenLayers.Function.bind(function(){c.apply(this,[a,b])},this)},read:function(b){b=OpenLayers.Util.extend({},b);OpenLayers.Util.applyDefaults(b,this.options||{});var a=new OpenLayers.Protocol.Response({requestType:"read"});var c=OpenLayers.Format.XML.prototype.write.apply(this.format,[this.format.writeNode("wfs:GetFeature",b)]);a.priv=OpenLayers.Request.POST({url:b.url,callback:this.createCallback(this.handleRead,a,b),params:b.params,headers:b.headers,data:c});return a},handleRead:function(a,b){if(b.callback){var c=a.priv;if(c.status>=200&&c.status<300){a.features=this.parseFeatures(c);a.code=OpenLayers.Protocol.Response.SUCCESS}else{a.code=OpenLayers.Protocol.Response.FAILURE}b.callback.call(b.scope,a)}},parseFeatures:function(a){var b=a.responseXML;if(!b||!b.documentElement){b=a.responseText}if(!b||b.length<=0){return null}return this.format.read(b)},commit:function(c,b){b=OpenLayers.Util.extend({},b);OpenLayers.Util.applyDefaults(b,this.options);var a=new OpenLayers.Protocol.Response({requestType:"commit",reqFeatures:c});a.priv=OpenLayers.Request.POST({url:b.url,data:this.format.write(c,b),callback:this.createCallback(this.handleCommit,a,b)});return a},handleCommit:function(a,b){if(b.callback){var c=a.priv;var f=c.responseXML;if(!f||!f.documentElement){f=c.responseText}var g=this.format.read(f)||{};a.insertIds=g.insertIds||[];a.code=(g.success)?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE;b.callback.call(b.scope,a)}},filterDelete:function(g,c){c=OpenLayers.Util.extend({},c);OpenLayers.Util.applyDefaults(c,this.options);var b=new OpenLayers.Protocol.Response({requestType:"commit"});var a=this.format.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version}});var f=this.format.createElementNSPlus("wfs:Delete",{attributes:{typeName:(c.featureNS?this.featurePrefix+":":"")+c.featureType}});if(c.featureNS){f.setAttribute("xmlns:"+this.featurePrefix,c.featureNS)}var l=this.format.writeNode("ogc:Filter",g);f.appendChild(l);a.appendChild(f);var k=OpenLayers.Format.XML.prototype.write.apply(this.format,[a]);return OpenLayers.Request.POST({url:this.url,callback:c.callback||function(){},data:k})},abort:function(a){if(a){a.priv.abort()}},CLASS_NAME:"OpenLayers.Protocol.WFS.v1"});OpenLayers.Protocol.WFS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.0.0",CLASS_NAME:"OpenLayers.Protocol.WFS.v1_0_0"});OpenLayers.Protocol.WFS.v1_1_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.1.0",CLASS_NAME:"OpenLayers.Protocol.WFS.v1_1_0"});OpenLayers.Layer.PointTrack=OpenLayers.Class(OpenLayers.Layer.Vector,{dataFrom:null,initialize:function(b,a){OpenLayers.Layer.Vector.prototype.initialize.apply(this,arguments)},addNodes:function(k){if(k.length<2){OpenLayers.Console.error("At least two point features have to be added to createa line from");return}var p=new Array(k.length-1);var l,a,m;for(var c=0,g=k.length;c<g;c++){l=k[c];m=l.geometry;if(!m){var f=l.lonlat;m=new OpenLayers.Geometry.Point(f.lon,f.lat)}else{if(m.CLASS_NAME!="OpenLayers.Geometry.Point"){OpenLayers.Console.error("Only features with point geometries are supported.");return}}if(c>0){var b=(this.dataFrom!=null)?(k[c+this.dataFrom].data||k[c+this.dataFrom].attributes):null;var o=new OpenLayers.Geometry.LineString([a,m]);p[c-1]=new OpenLayers.Feature.Vector(o,b)}a=m}this.addFeatures(p)},CLASS_NAME:"OpenLayers.Layer.PointTrack"});OpenLayers.Layer.PointTrack.dataFrom={SOURCE_NODE:-1,TARGET_NODE:0};OpenLayers.Layer.GML=OpenLayers.Class(OpenLayers.Layer.Vector,{loaded:false,format:null,formatOptions:null,initialize:function(f,c,b){var a=[];a.push(f,b);OpenLayers.Layer.Vector.prototype.initialize.apply(this,a);this.url=c},setVisibility:function(a,b){OpenLayers.Layer.Vector.prototype.setVisibility.apply(this,arguments);if(this.visibility&&!this.loaded){this.loadGML()}},moveTo:function(c,a,b){OpenLayers.Layer.Vector.prototype.moveTo.apply(this,arguments);if(this.visibility&&!this.loaded){this.loadGML()}},loadGML:function(){if(!this.loaded){this.events.triggerEvent("loadstart");OpenLayers.Request.GET({url:this.url,success:this.requestSuccess,failure:this.requestFailure,scope:this});this.loaded=true}},setUrl:function(a){this.url=a;this.destroyFeatures();this.loaded=false;this.loadGML()},requestSuccess:function(c){var f=c.responseXML;if(!f||!f.documentElement){f=c.responseText}var a={};OpenLayers.Util.extend(a,this.formatOptions);if(this.map&&!this.projection.equals(this.map.getProjectionObject())){a.externalProjection=this.projection;a.internalProjection=this.map.getProjectionObject()}var b=this.format?new this.format(a):new OpenLayers.Format.GML(a);this.addFeatures(b.read(f));this.events.triggerEvent("loadend")},requestFailure:function(a){OpenLayers.Console.userError(OpenLayers.i18n("errorLoadingGML",{url:this.url}));this.events.triggerEvent("loadend")},CLASS_NAME:"OpenLayers.Layer.GML"});OpenLayers.Style=OpenLayers.Class({name:null,title:null,description:null,layerName:null,isDefault:false,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:false,propertyStyles:null,initialize:function(b,a){OpenLayers.Util.extend(this,a);this.rules=[];if(a&&a.rules){this.addRules(a.rules)}this.setDefaultStyle(b||OpenLayers.Feature.Vector.style["default"])},destroy:function(){for(var b=0,a=this.rules.length;b<a;b++){this.rules[b].destroy();this.rules[b]=null}this.rules=null;this.defaultStyle=null},createSymbolizer:function(p){var a=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),p);var o=this.rules;var m,b;var c=[];var k=false;for(var f=0,g=o.length;f<g;f++){m=o[f];var l=m.evaluate(p);if(l){if(m instanceof OpenLayers.Rule&&m.elseFilter){c.push(m)}else{k=true;this.applySymbolizer(m,a,p)}}}if(k==false&&c.length>0){k=true;for(var f=0,g=c.length;f<g;f++){this.applySymbolizer(c[f],a,p)}}if(o.length>0&&k==false){a.display="none"}return a},applySymbolizer:function(k,f,b){var a=b.geometry?this.getSymbolizerPrefix(b.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0];var c=k.symbolizer[a]||k.symbolizer;if(this.defaultsPerSymbolizer===true){var g=this.defaultStyle;OpenLayers.Util.applyDefaults(c,{pointRadius:g.pointRadius});if(c.stroke===true||c.graphic===true){OpenLayers.Util.applyDefaults(c,{strokeWidth:g.strokeWidth,strokeColor:g.strokeColor,strokeOpacity:g.strokeOpacity,strokeDashstyle:g.strokeDashstyle,strokeLinecap:g.strokeLinecap})}if(c.fill===true||c.graphic===true){OpenLayers.Util.applyDefaults(c,{fillColor:g.fillColor,fillOpacity:g.fillOpacity})}if(c.graphic===true){OpenLayers.Util.applyDefaults(c,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset})}}return this.createLiterals(OpenLayers.Util.extend(f,c),b)},createLiterals:function(f,c){var b=this.context||c.attributes||c.data;for(var a in this.propertyStyles){f[a]=OpenLayers.Style.createLiteral(f[a],b,c)}return f},findPropertyStyles:function(){var f={};var k=this.defaultStyle;this.addPropertyStyles(f,k);var m=this.rules;var g,l;for(var c=0,a=m.length;c<a;c++){g=m[c].symbolizer;for(var b in g){l=g[b];if(typeof l=="object"){this.addPropertyStyles(f,l)}else{this.addPropertyStyles(f,g);break}}}return f},addPropertyStyles:function(b,c){var f;for(var a in c){f=c[a];if(typeof f=="string"&&f.match(/\$\{\w+\}/)){b[a]=true}}return b},addRules:function(a){this.rules=this.rules.concat(a);this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(a){this.defaultStyle=a;this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(f){var c=OpenLayers.Style.SYMBOLIZER_PREFIXES;for(var b=0,a=c.length;b<a;b++){if(f.CLASS_NAME.indexOf(c[b])!=-1){return c[b]}}},CLASS_NAME:"OpenLayers.Style"});OpenLayers.Style.createLiteral=function(c,b,a){if(typeof c=="string"&&c.indexOf("${")!=-1){c=OpenLayers.String.format(c,b,[a]);c=(isNaN(c)||!c)?c:parseFloat(c)}return c};OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text"];OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:true,initialize:function(c,a){this.styles={"default":new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),"delete":new OpenLayers.Style(OpenLayers.Feature.Vector.style["delete"])};if(c instanceof OpenLayers.Style){this.styles["default"]=c;this.styles.select=c;this.styles.temporary=c;this.styles["delete"]=c}else{if(typeof c=="object"){for(var b in c){if(c[b] instanceof OpenLayers.Style){this.styles[b]=c[b]}else{if(typeof c[b]=="object"){this.styles[b]=new OpenLayers.Style(c[b])}else{this.styles["default"]=new OpenLayers.Style(c);this.styles.select=new OpenLayers.Style(c);this.styles.temporary=new OpenLayers.Style(c);this.styles["delete"]=new OpenLayers.Style(c);break}}}}}OpenLayers.Util.extend(this,a)},destroy:function(){for(var a in this.styles){this.styles[a].destroy()}this.styles=null},createSymbolizer:function(b,c){if(!b){b=new OpenLayers.Feature.Vector()}if(!this.styles[c]){c="default"}b.renderIntent=c;var a={};if(this.extendDefault&&c!="default"){a=this.styles["default"].createSymbolizer(b)}return OpenLayers.Util.extend(a,this.styles[c].createSymbolizer(b))},addUniqueValueRules:function(b,f,k,a){var g=[];for(var c in k){g.push(new OpenLayers.Rule({symbolizer:k[c],context:a,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:f,value:c})}))}this.styles[b].addRules(g)},CLASS_NAME:"OpenLayers.StyleMap"});OpenLayers.Rule=OpenLayers.Class({id:null,name:"default",title:null,description:null,context:null,filter:null,elseFilter:false,symbolizer:null,minScaleDenominator:null,maxScaleDenominator:null,initialize:function(a){this.symbolizer={};OpenLayers.Util.extend(this,a);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var a in this.symbolizer){this.symbolizer[a]=null}this.symbolizer=null},evaluate:function(c){var b=this.getContext(c);var a=true;if(this.minScaleDenominator||this.maxScaleDenominator){var f=c.layer.map.getScale()}if(this.minScaleDenominator){a=f>=OpenLayers.Style.createLiteral(this.minScaleDenominator,b)}if(a&&this.maxScaleDenominator){a=f<OpenLayers.Style.createLiteral(this.maxScaleDenominator,b)}if(a&&this.filter){if(this.filter.CLASS_NAME=="OpenLayers.Filter.FeatureId"){a=this.filter.evaluate(c)}else{a=this.filter.evaluate(b)}}return a},getContext:function(b){var a=this.context;if(!a){a=b.attributes||b.data}if(typeof this.context=="function"){a=this.context(b)}return a},clone:function(){var a=OpenLayers.Util.extend({},this);a.symbolizer={};for(var b in this.symbolizer){value=this.symbolizer[b];type=typeof value;if(type==="object"){a.symbolizer[b]=OpenLayers.Util.extend({},value)}else{if(type==="string"){a.symbolizer[b]=value}}}a.filter=this.filter&&this.filter.clone();a.context=this.context&&OpenLayers.Util.extend({},this.context);return new OpenLayers.Rule(a)},CLASS_NAME:"OpenLayers.Rule"});OpenLayers.Filter=OpenLayers.Class({initialize:function(a){OpenLayers.Util.extend(this,a)},destroy:function(){},evaluate:function(a){return true},clone:function(){return null},CLASS_NAME:"OpenLayers.Filter"});OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,initialize:function(a){this.fids=[];OpenLayers.Filter.prototype.initialize.apply(this,[a])},evaluate:function(c){for(var b=0,a=this.fids.length;b<a;b++){var f=c.fid||c.id;if(f==this.fids[b]){return true}}return false},clone:function(){var a=new OpenLayers.Filter.FeatureId();OpenLayers.Util.extend(a,this);a.fids=this.fids.slice();return a},CLASS_NAME:"OpenLayers.Filter.FeatureId"});OpenLayers.Filter.Logical=OpenLayers.Class(OpenLayers.Filter,{filters:null,type:null,initialize:function(a){this.filters=[];OpenLayers.Filter.prototype.initialize.apply(this,[a])},destroy:function(){this.filters=null;OpenLayers.Filter.prototype.destroy.apply(this)},evaluate:function(c){switch(this.type){case OpenLayers.Filter.Logical.AND:for(var b=0,a=this.filters.length;b<a;b++){if(this.filters[b].evaluate(c)==false){return false}}return true;case OpenLayers.Filter.Logical.OR:for(var b=0,a=this.filters.length;b<a;b++){if(this.filters[b].evaluate(c)==true){return true}}return false;case OpenLayers.Filter.Logical.NOT:return(!this.filters[0].evaluate(c))}},clone:function(){var c=[];for(var b=0,a=this.filters.length;b<a;++b){c.push(this.filters[b].clone())}return new OpenLayers.Filter.Logical({type:this.type,filters:c})},CLASS_NAME:"OpenLayers.Filter.Logical"});OpenLayers.Filter.Logical.AND="&&";OpenLayers.Filter.Logical.OR="||";OpenLayers.Filter.Logical.NOT="!";OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,matchCase:true,lowerBoundary:null,upperBoundary:null,initialize:function(a){OpenLayers.Filter.prototype.initialize.apply(this,[a])},evaluate:function(c){var a=false;switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:var b=c[this.property];var g=this.value;if(!this.matchCase&&typeof b=="string"&&typeof g=="string"){a=(b.toUpperCase()==g.toUpperCase())}else{a=(b==g)}break;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:var b=c[this.property];var g=this.value;if(!this.matchCase&&typeof b=="string"&&typeof g=="string"){a=(b.toUpperCase()!=g.toUpperCase())}else{a=(b!=g)}break;case OpenLayers.Filter.Comparison.LESS_THAN:a=c[this.property]<this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN:a=c[this.property]>this.value;break;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:a=c[this.property]<=this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:a=c[this.property]>=this.value;break;case OpenLayers.Filter.Comparison.BETWEEN:a=(c[this.property]>=this.lowerBoundary)&&(c[this.property]<=this.upperBoundary);break;case OpenLayers.Filter.Comparison.LIKE:var f=new RegExp(this.value,"gi");a=f.test(c[this.property]);break}return a},value2regex:function(f,b,a){if(f=="."){var c="'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison";OpenLayers.Console.error(c);return null}f=f?f:"*";b=b?b:".";a=a?a:"!";this.value=this.value.replace(new RegExp("\\"+a+"(.|$)","g"),"\\$1");this.value=this.value.replace(new RegExp("\\"+b,"g"),".");this.value=this.value.replace(new RegExp("\\"+f,"g"),".*");this.value=this.value.replace(new RegExp("\\\\.\\*","g"),"\\"+f);this.value=this.value.replace(new RegExp("\\\\\\.","g"),"\\"+b);return this.value},regex2value:function(){var a=this.value;a=a.replace(/!/g,"!!");a=a.replace(/(\\)?\\\./g,function(c,b){return b?c:"!."});a=a.replace(/(\\)?\\\*/g,function(c,b){return b?c:"!*"});a=a.replace(/\\\\/g,"\\");a=a.replace(/\.\*/g,"*");return a},clone:function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison(),this)},CLASS_NAME:"OpenLayers.Filter.Comparison"});OpenLayers.Filter.Comparison.EQUAL_TO="==";OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=";OpenLayers.Filter.Comparison.LESS_THAN="<";OpenLayers.Filter.Comparison.GREATER_THAN=">";OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=";OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=";OpenLayers.Filter.Comparison.BETWEEN="..";OpenLayers.Filter.Comparison.LIKE="~";OpenLayers.Filter.Spatial=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,distance:null,distanceUnits:null,initialize:function(a){OpenLayers.Filter.prototype.initialize.apply(this,[a])},evaluate:function(c){var a=false;switch(this.type){case OpenLayers.Filter.Spatial.BBOX:case OpenLayers.Filter.Spatial.INTERSECTS:if(c.geometry){var b=this.value;if(this.value.CLASS_NAME=="OpenLayers.Bounds"){b=this.value.toGeometry()}if(c.geometry.intersects(b)){a=true}}break;default:OpenLayers.Console.error(OpenLayers.i18n("filterEvaluateNotImplemented"));break}return a},clone:function(){var a=OpenLayers.Util.applyDefaults({value:this.value&&this.value.clone&&this.value.clone()},this);return new OpenLayers.Filter.Spatial(a)},CLASS_NAME:"OpenLayers.Filter.Spatial"});OpenLayers.Filter.Spatial.BBOX="BBOX";OpenLayers.Filter.Spatial.INTERSECTS="INTERSECTS";OpenLayers.Filter.Spatial.DWITHIN="DWITHIN";OpenLayers.Filter.Spatial.WITHIN="WITHIN";OpenLayers.Filter.Spatial.CONTAINS="CONTAINS";OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:false,initialize:function(a){OpenLayers.Util.extend(this,a);this.options=a},destroy:function(){},read:function(a){OpenLayers.Console.userError(OpenLayers.i18n("readNotImplemented"))},write:function(a){OpenLayers.Console.userError(OpenLayers.i18n("writeNotImplemented"))},CLASS_NAME:"OpenLayers.Format"});OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(a){if(window.ActiveXObject){this.xmldom=new ActiveXObject("Microsoft.XMLDOM")}OpenLayers.Format.prototype.initialize.apply(this,[a]);this.namespaces=OpenLayers.Util.extend({},this.namespaces);this.namespaceAlias={};for(var b in this.namespaces){this.namespaceAlias[this.namespaces[b]]=b}},destroy:function(){this.xmldom=null;OpenLayers.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(a,b){this.namespaces[a]=b;this.namespaceAlias[b]=a},read:function(c){var a=c.indexOf("<");if(a>0){c=c.substring(a)}var b=OpenLayers.Util.Try(OpenLayers.Function.bind((function(){var f;if(window.ActiveXObject&&!this.xmldom){f=new ActiveXObject("Microsoft.XMLDOM")}else{f=this.xmldom}f.loadXML(c);return f}),this),function(){return new DOMParser().parseFromString(c,"text/xml")},function(){var f=new XMLHttpRequest();f.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(c),false);if(f.overrideMimeType){f.overrideMimeType("text/xml")}f.send(null);return f.responseXML});if(this.keepData){this.data=b}return b},write:function(b){var c;if(this.xmldom){c=b.xml}else{var a=new XMLSerializer();if(b.nodeType==1){var f=document.implementation.createDocument("","",null);if(f.importNode){b=f.importNode(b,true)}f.appendChild(b);c=a.serializeToString(f)}else{c=a.serializeToString(b)}}return c},createElementNS:function(c,a){var b;if(this.xmldom){if(typeof c=="string"){b=this.xmldom.createNode(1,a,c)}else{b=this.xmldom.createNode(1,a,"")}}else{b=document.createElementNS(c,a)}return b},createTextNode:function(b){var a;if(this.xmldom){a=this.xmldom.createTextNode(b)}else{a=document.createTextNode(b)}return a},getElementsByTagNameNS:function(g,f,c){var a=[];if(g.getElementsByTagNameNS){a=g.getElementsByTagNameNS(f,c)}else{var b=g.getElementsByTagName("*");var o,k;for(var l=0,m=b.length;l<m;++l){o=b[l];k=(o.prefix)?(o.prefix+":"+c):c;if((c=="*")||(k==o.nodeName)){if((f=="*")||(f==o.namespaceURI)){a.push(o)}}}}return a},getAttributeNodeNS:function(c,b,a){var o=null;if(c.getAttributeNodeNS){o=c.getAttributeNodeNS(b,a)}else{var g=c.attributes;var m,f;for(var k=0,l=g.length;k<l;++k){m=g[k];if(m.namespaceURI==b){f=(m.prefix)?(m.prefix+":"+a):a;if(f==m.nodeName){o=m;break}}}}return o},getAttributeNS:function(g,f,a){var b="";if(g.getAttributeNS){b=g.getAttributeNS(f,a)||""}else{var c=this.getAttributeNodeNS(g,f,a);if(c){b=c.nodeValue}}return b},getChildValue:function(a,c){var b=c||"";if(a){for(var f=a.firstChild;f;f=f.nextSibling){switch(f.nodeType){case 3:case 4:b+=f.nodeValue}}}return b},concatChildValues:function(b,f){var c="";var g=b.firstChild;var a;while(g){a=g.nodeValue;if(a){c+=a}g=g.nextSibling}if(c==""&&f!=undefined){c=f}return c},isSimpleContent:function(a){var c=true;for(var b=a.firstChild;b;b=b.nextSibling){if(b.nodeType===1){c=false;break}}return c},contentType:function(c){var g=false,b=false;var a=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY;for(var f=c.firstChild;f;f=f.nextSibling){switch(f.nodeType){case 1:b=true;break;case 8:break;default:g=true}if(b&&g){break}}if(b&&g){a=OpenLayers.Format.XML.CONTENT_TYPE.MIXED}else{if(b){return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX}else{if(g){return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE}}}return a},hasAttributeNS:function(c,b,a){var f=false;if(c.hasAttributeNS){f=c.hasAttributeNS(b,a)}else{f=!!this.getAttributeNodeNS(c,b,a)}return f},setAttributeNS:function(f,c,a,g){if(f.setAttributeNS){f.setAttributeNS(c,a,g)}else{if(this.xmldom){if(c){var b=f.ownerDocument.createNode(2,a,c);b.nodeValue=g;f.setAttributeNode(b)}else{f.setAttribute(a,g)}}else{throw"setAttributeNS not implemented"}}},createElementNSPlus:function(b,a){a=a||{};var f=a.uri||this.namespaces[a.prefix];if(!f){var k=b.indexOf(":");f=this.namespaces[b.substring(0,k)]}if(!f){f=this.namespaces[this.defaultPrefix]}var c=this.createElementNS(f,b);if(a.attributes){this.setAttributes(c,a.attributes)}var g=a.value;if(g!=null){if(typeof g=="boolean"){g=String(g)}c.appendChild(this.createTextNode(g))}return c},setAttributes:function(c,g){var f,b;for(var a in g){if(g[a]!=null&&g[a].toString){f=g[a].toString();b=this.namespaces[a.substring(0,a.indexOf(":"))]||null;this.setAttributeNS(c,b,a,f)}}},readNode:function(c,g){if(!g){g={}}var f=this.readers[this.namespaceAlias[c.namespaceURI]];if(f){var b=c.localName||c.nodeName.split(":").pop();var a=f[b]||f["*"];if(a){a.apply(this,[c,g])}}return g},readChildNodes:function(f,g){if(!g){g={}}var c=f.childNodes;var k;for(var b=0,a=c.length;b<a;++b){k=c[b];if(k.nodeType==1){this.readNode(k,g)}}return g},writeNode:function(a,k,f){var g,c;var b=a.indexOf(":");if(b>0){g=a.substring(0,b);c=a.substring(b+1)}else{if(f){g=this.namespaceAlias[f.namespaceURI]}else{g=this.defaultPrefix}c=a}var l=this.writers[g][c].apply(this,[k]);if(f){f.appendChild(l)}return l},getChildEl:function(c,a,b){return c&&this.getThisOrNextEl(c.firstChild,a,b)},getNextEl:function(c,a,b){return c&&this.getThisOrNextEl(c.nextSibling,a,b)},getThisOrNextEl:function(f,a,c){outer:for(var b=f;b;b=b.nextSibling){switch(b.nodeType){case 1:if((!a||a===(b.localName||b.nodeName.split(":").pop()))&&(!c||c===b.namespaceURI)){break outer}b=null;break outer;case 3:if(/^\s*$/.test(b.nodeValue)){break}case 4:case 6:case 12:case 10:case 11:b=null;break outer}}return b||null},lookupNamespaceURI:function(g,k){var f=null;if(g){if(g.lookupNamespaceURI){f=g.lookupNamespaceURI(k)}else{outer:switch(g.nodeType){case 1:if(g.namespaceURI!==null&&g.prefix===k){f=g.namespaceURI;break outer}var b=g.attributes.length;if(b){var a;for(var c=0;c<b;++c){a=g.attributes[c];if(a.prefix==="xmlns"&&a.name==="xmlns:"+k){f=a.value||null;break outer}else{if(a.name==="xmlns"&&k===null){f=a.value||null;break outer}}}}f=this.lookupNamespaceURI(g.parentNode,k);break outer;case 2:f=this.lookupNamespaceURI(g.ownerElement,k);break outer;case 9:f=this.lookupNamespaceURI(g.documentElement,k);break outer;case 6:case 12:case 10:case 11:break outer;default:f=this.lookupNamespaceURI(g.parentNode,k);break outer}}}return f},CLASS_NAME:"OpenLayers.Format.XML"});OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3};OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype);OpenLayers.Format.ArcXML=OpenLayers.Class(OpenLayers.Format.XML,{fontStyleKeys:["antialiasing","blockout","font","fontcolor","fontsize","fontstyle","glowing","interval","outline","printmode","shadow","transparency"],request:null,response:null,initialize:function(a){this.request=new OpenLayers.Format.ArcXML.Request();this.response=new OpenLayers.Format.ArcXML.Response();if(a){if(a.requesttype=="feature"){this.request.get_image=null;var c=this.request.get_feature.query;this.addCoordSys(c.featurecoordsys,a.featureCoordSys);this.addCoordSys(c.filtercoordsys,a.filterCoordSys);if(a.polygon){c.isspatial=true;c.spatialfilter.polygon=a.polygon}else{if(a.envelope){c.isspatial=true;c.spatialfilter.envelope={minx:0,miny:0,maxx:0,maxy:0};this.parseEnvelope(c.spatialfilter.envelope,a.envelope)}}}else{if(a.requesttype=="image"){this.request.get_feature=null;var b=this.request.get_image.properties;this.parseEnvelope(b.envelope,a.envelope);this.addLayers(b.layerlist,a.layers);this.addImageSize(b.imagesize,a.tileSize);this.addCoordSys(b.featurecoordsys,a.featureCoordSys);this.addCoordSys(b.filtercoordsys,a.filterCoordSys)}else{this.request=null}}}OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},parseEnvelope:function(b,a){if(a&&a.length==4){b.minx=a[0];b.miny=a[1];b.maxx=a[2];b.maxy=a[3]}},addLayers:function(f,c){for(var b=0,a=c.length;b<a;b++){f.push(c[b])}},addImageSize:function(b,a){if(a!==null){b.width=a.w;b.height=a.h;b.printwidth=a.w;b.printheight=a.h}},addCoordSys:function(a,b){if(typeof b=="string"){a.id=parseInt(b);a.string=b}else{if(typeof b=="object"&&b.proj!==null){a.id=b.proj.srsProjNumber;a.string=b.proj.srsCode}else{a=b}}},iserror:function(c){var a=null;if(!c){a=(this.response.error!=="")}else{c=OpenLayers.Format.XML.prototype.read.apply(this,[c]);var b=c.documentElement.getElementsByTagName("ERROR");a=(b!==null&&b.length>0)}return a},read:function(k){if(typeof k=="string"){k=OpenLayers.Format.XML.prototype.read.apply(this,[k])}var a=null;if(k&&k.documentElement){if(k.documentElement.nodeName=="ARCXML"){a=k.documentElement}else{a=k.documentElement.getElementsByTagName("ARCXML")[0]}}if(!a){var c,g;try{c=k.firstChild.nodeValue;g=k.firstChild.childNodes[1].firstChild.nodeValue}catch(f){}throw {message:"Error parsing the ArcXML request",error:c,source:g}}var b=this.parseResponse(a);return b},write:function(c){if(!c){c=this.request}var C=this.createElementNS("","ARCXML");C.setAttribute("version","1.1");var m=this.createElementNS("","REQUEST");if(c.get_image!=null){var q=this.createElementNS("","GET_IMAGE");m.appendChild(q);var p=this.createElementNS("","PROPERTIES");q.appendChild(p);var b=c.get_image.properties;if(b.featurecoordsys!=null){var A=this.createElementNS("","FEATURECOORDSYS");p.appendChild(A);if(b.featurecoordsys.id===0){A.setAttribute("string",b.featurecoordsys.string)}else{A.setAttribute("id",b.featurecoordsys.id)}}if(b.filtercoordsys!=null){var u=this.createElementNS("","FILTERCOORDSYS");p.appendChild(u);if(b.filtercoordsys.id===0){u.setAttribute("string",b.filtercoordsys.string)}else{u.setAttribute("id",b.filtercoordsys.id)}}if(b.envelope!=null){var G=this.createElementNS("","ENVELOPE");p.appendChild(G);G.setAttribute("minx",b.envelope.minx);G.setAttribute("miny",b.envelope.miny);G.setAttribute("maxx",b.envelope.maxx);G.setAttribute("maxy",b.envelope.maxy)}var E=this.createElementNS("","IMAGESIZE");p.appendChild(E);E.setAttribute("height",b.imagesize.height);E.setAttribute("width",b.imagesize.width);if(b.imagesize.height!=b.imagesize.printheight||b.imagesize.width!=b.imagesize.printwidth){E.setAttribute("printheight",b.imagesize.printheight);E.setArrtibute("printwidth",b.imagesize.printwidth)}if(b.background!=null){var a=this.createElementNS("","BACKGROUND");p.appendChild(a);a.setAttribute("color",b.background.color.r+","+b.background.color.g+","+b.background.color.b);if(b.background.transcolor!==null){a.setAttribute("transcolor",b.background.transcolor.r+","+b.background.transcolor.g+","+b.background.transcolor.b)}}if(b.layerlist!=null&&b.layerlist.length>0){var l=this.createElementNS("","LAYERLIST");p.appendChild(l);for(var B=0;B<b.layerlist.length;B++){var v=this.createElementNS("","LAYERDEF");l.appendChild(v);v.setAttribute("id",b.layerlist[B].id);v.setAttribute("visible",b.layerlist[B].visible);if(typeof b.layerlist[B].query=="object"){var k=b.layerlist[B].query;if(k.where.length<0){continue}var J=null;if(typeof k.spatialfilter=="boolean"&&k.spatialfilter){J=this.createElementNS("","SPATIALQUERY")}else{J=this.createElementNS("","QUERY")}J.setAttribute("where",k.where);if(typeof k.accuracy=="number"&&k.accuracy>0){J.setAttribute("accuracy",k.accuracy)}if(typeof k.featurelimit=="number"&&k.featurelimit<2000){J.setAttribute("featurelimit",k.featurelimit)}if(typeof k.subfields=="string"&&k.subfields!="#ALL#"){J.setAttribute("subfields",k.subfields)}if(typeof k.joinexpression=="string"&&k.joinexpression.length>0){J.setAttribute("joinexpression",k.joinexpression)}if(typeof k.jointables=="string"&&k.jointables.length>0){J.setAttribute("jointables",k.jointables)}v.appendChild(J)}if(typeof b.layerlist[B].renderer=="object"){this.addRenderer(v,b.layerlist[B].renderer)}}}}else{if(c.get_feature!=null){var q=this.createElementNS("","GET_FEATURES");q.setAttribute("outputmode","newxml");q.setAttribute("checkesc","true");if(c.get_feature.geometry){q.setAttribute("geometry",c.get_feature.geometry)}else{q.setAttribute("geometry","false")}if(c.get_feature.compact){q.setAttribute("compact",c.get_feature.compact)}if(c.get_feature.featurelimit=="number"){q.setAttribute("featurelimit",c.get_feature.featurelimit)}q.setAttribute("globalenvelope","true");m.appendChild(q);if(c.get_feature.layer!=null&&c.get_feature.layer.length>0){var H=this.createElementNS("","LAYER");H.setAttribute("id",c.get_feature.layer);q.appendChild(H)}var D=c.get_feature.query;if(D!=null){var F=null;if(D.isspatial){F=this.createElementNS("","SPATIALQUERY")}else{F=this.createElementNS("","QUERY")}q.appendChild(F);if(typeof D.accuracy=="number"){F.setAttribute("accuracy",D.accuracy)}if(D.featurecoordsys!=null){var g=this.createElementNS("","FEATURECOORDSYS");if(D.featurecoordsys.id==0){g.setAttribute("string",D.featurecoordsys.string)}else{g.setAttribute("id",D.featurecoordsys.id)}F.appendChild(g)}if(D.filtercoordsys!=null){var f=this.createElementNS("","FILTERCOORDSYS");if(D.filtercoordsys.id===0){f.setAttribute("string",D.filtercoordsys.string)}else{f.setAttribute("id",D.filtercoordsys.id)}F.appendChild(f)}if(D.buffer>0){var r=this.createElementNS("","BUFFER");r.setAttribute("distance",D.buffer);F.appendChild(r)}if(D.isspatial){var o=this.createElementNS("","SPATIALFILTER");o.setAttribute("relation",D.spatialfilter.relation);F.appendChild(o);if(D.spatialfilter.envelope){var I=this.createElementNS("","ENVELOPE");I.setAttribute("minx",D.spatialfilter.envelope.minx);I.setAttribute("miny",D.spatialfilter.envelope.miny);I.setAttribute("maxx",D.spatialfilter.envelope.maxx);I.setAttribute("maxy",D.spatialfilter.envelope.maxy);o.appendChild(I)}else{if(typeof D.spatialfilter.polygon=="object"){o.appendChild(this.writePolygonGeometry(D.spatialfilter.polygon))}}}if(D.where!=null&&D.where.length>0){F.setAttribute("where",D.where)}}}}C.appendChild(m);return OpenLayers.Format.XML.prototype.write.apply(this,[C])},addGroupRenderer:function(b,a){var g=this.createElementNS("","GROUPRENDERER");b.appendChild(g);for(var c=0;c<a.length;c++){var f=a[c];this.addRenderer(g,f)}},addRenderer:function(c,b){if(b instanceof Array){this.addGroupRenderer(c,b)}else{var a=this.createElementNS("",b.type.toUpperCase()+"RENDERER");c.appendChild(a);if(a.tagName=="VALUEMAPRENDERER"){this.addValueMapRenderer(a,b)}else{if(a.tagName=="VALUEMAPLABELRENDERER"){this.addValueMapLabelRenderer(a,b)}else{if(a.tagName=="SIMPLELABELRENDERER"){this.addSimpleLabelRenderer(a,b)}else{if(a.tagName=="SCALEDEPENDENTRENDERER"){this.addScaleDependentRenderer(a,b)}}}}}},addScaleDependentRenderer:function(a,b){if(typeof b.lower=="string"||typeof b.lower=="number"){a.setAttribute("lower",b.lower)}if(typeof b.upper=="string"||typeof b.upper=="number"){a.setAttribute("upper",b.upper)}this.addRenderer(a,b.renderer)},addValueMapLabelRenderer:function(m,l){m.setAttribute("lookupfield",l.lookupfield);m.setAttribute("labelfield",l.labelfield);if(typeof l.exacts=="object"){for(var a=0,p=l.exacts.length;a<p;a++){var g=l.exacts[a];var f=this.createElementNS("","EXACT");if(typeof g.value=="string"){f.setAttribute("value",g.value)}if(typeof g.label=="string"){f.setAttribute("label",g.label)}if(typeof g.method=="string"){f.setAttribute("method",g.method)}m.appendChild(f);if(typeof g.symbol=="object"){var b=null;if(g.symbol.type=="text"){b=this.createElementNS("","TEXTSYMBOL")}if(b!=null){var q=this.fontStyleKeys;for(var c=0,k=q.length;c<k;c++){var o=q[c];if(g.symbol[o]){b.setAttribute(o,g.symbol[o])}}f.appendChild(b)}}}}},addValueMapRenderer:function(p,o){p.setAttribute("lookupfield",o.lookupfield);if(typeof o.ranges=="object"){for(var a=0,b=o.ranges.length;a<b;a++){var l=o.ranges[a];var g=this.createElementNS("","RANGE");g.setAttribute("lower",l.lower);g.setAttribute("upper",l.upper);p.appendChild(g);if(typeof l.symbol=="object"){var f=null;if(l.symbol.type=="simplepolygon"){f=this.createElementNS("","SIMPLEPOLYGONSYMBOL")}if(f!=null){if(typeof l.symbol.boundarycolor=="string"){f.setAttribute("boundarycolor",l.symbol.boundarycolor)}if(typeof l.symbol.fillcolor=="string"){f.setAttribute("fillcolor",l.symbol.fillcolor)}if(typeof l.symbol.filltransparency=="number"){f.setAttribute("filltransparency",l.symbol.filltransparency)}g.appendChild(f)}}}}else{if(typeof o.exacts=="object"){for(var c=0,q=o.exacts.length;c<q;c++){var m=o.exacts[c];var k=this.createElementNS("","EXACT");if(typeof m.value=="string"){k.setAttribute("value",m.value)}if(typeof m.label=="string"){k.setAttribute("label",m.label)}if(typeof m.method=="string"){k.setAttribute("method",m.method)}p.appendChild(k);if(typeof m.symbol=="object"){var f=null;if(m.symbol.type=="simplemarker"){f=this.createElementNS("","SIMPLEMARKERSYMBOL")}if(f!=null){if(typeof m.symbol.antialiasing=="string"){f.setAttribute("antialiasing",m.symbol.antialiasing)}if(typeof m.symbol.color=="string"){f.setAttribute("color",m.symbol.color)}if(typeof m.symbol.outline=="string"){f.setAttribute("outline",m.symbol.outline)}if(typeof m.symbol.overlap=="string"){f.setAttribute("overlap",m.symbol.overlap)}if(typeof m.symbol.shadow=="string"){f.setAttribute("shadow",m.symbol.shadow)}if(typeof m.symbol.transparency=="number"){f.setAttribute("transparency",m.symbol.transparency)}if(typeof m.symbol.usecentroid=="string"){f.setAttribute("usecentroid",m.symbol.usecentroid)}if(typeof m.symbol.width=="number"){f.setAttribute("width",m.symbol.width)}k.appendChild(f)}}}}}},addSimpleLabelRenderer:function(k,m){k.setAttribute("field",m.field);var g=["featureweight","howmanylabels","labelbufferratio","labelpriorities","labelweight","linelabelposition","rotationalangles"];for(var f=0,a=g.length;f<a;f++){var c=g[f];if(m[c]){k.setAttribute(c,m[c])}}if(m.symbol.type=="text"){var l=m.symbol;var b=this.createElementNS("","TEXTSYMBOL");k.appendChild(b);var g=this.fontStyleKeys;for(var f=0,a=g.length;f<a;f++){var c=g[f];if(l[c]){b.setAttribute(c,m[c])}}}},writePolygonGeometry:function(l){if(!(l instanceof OpenLayers.Geometry.Polygon)){throw {message:"Cannot write polygon geometry to ArcXML with an "+l.CLASS_NAME+" object.",geometry:l}}var b=this.createElementNS("","POLYGON");for(var g=0,c=l.components.length;g<c;g++){var a=l.components[g];var o=this.createElementNS("","RING");for(var f=0,p=a.components.length;f<p;f++){var m=a.components[f];var k=this.createElementNS("","POINT");k.setAttribute("x",m.x);k.setAttribute("y",m.y);o.appendChild(k)}b.appendChild(o)}return b},parseResponse:function(M){if(typeof M=="string"){var v=new OpenLayers.Format.XML();M=v.read(M)}var a=new OpenLayers.Format.ArcXML.Response();var O=M.getElementsByTagName("ERROR");if(O!=null&&O.length>0){a.error=this.getChildValue(O,"Unknown error.")}else{var D=M.getElementsByTagName("RESPONSE");if(D==null||D.length==0){a.error="No RESPONSE tag found in ArcXML response.";return a}var C=D[0].firstChild.nodeName;if(C=="#text"){C=D[0].firstChild.nextSibling.nodeName}if(C=="IMAGE"){var c=M.getElementsByTagName("ENVELOPE");var I=M.getElementsByTagName("OUTPUT");if(c==null||c.length==0){a.error="No ENVELOPE tag found in ArcXML response."}else{if(I==null||I.length==0){a.error="No OUTPUT tag found in ArcXML response."}else{var G=this.parseAttributes(c[0]);var H=this.parseAttributes(I[0]);if(typeof H.type=="string"){a.image={envelope:G,output:{type:H.type,data:this.getChildValue(I[0])}}}else{a.image={envelope:G,output:H}}}}}else{if(C=="FEATURES"){var o=D[0].getElementsByTagName("FEATURES");var B=o[0].getElementsByTagName("FEATURECOUNT");a.features.featurecount=B[0].getAttribute("count");if(a.features.featurecount>0){var f=o[0].getElementsByTagName("ENVELOPE");a.features.envelope=this.parseAttributes(f[0],typeof(0));var J=o[0].getElementsByTagName("FEATURE");for(var u=0;u<J.length;u++){var m=new OpenLayers.Feature.Vector();var E=J[u].getElementsByTagName("FIELD");for(var k=0;k<E.length;k++){var l=E[k].getAttribute("name");var q=E[k].getAttribute("value");m.attributes[l]=q}var F=J[u].getElementsByTagName("POLYGON");if(F.length>0){var p=F[0].getElementsByTagName("RING");var g=[];for(var A=0;A<p.length;A++){var K=[];K.push(this.parsePointGeometry(p[A]));var r=p[A].getElementsByTagName("HOLE");for(var b=0;b<r.length;b++){K.push(this.parsePointGeometry(r[b]))}r=null;g.push(new OpenLayers.Geometry.Polygon(K));K=null}p=null;if(g.length==1){m.geometry=g[0]}else{m.geometry=new OpenLayers.Geometry.MultiPolygon(g)}}a.features.feature.push(m)}}}else{a.error="Unidentified response type."}}}return a},parseAttributes:function(f,c){var b={};for(var a=0;a<f.attributes.length;a++){if(c=="number"){b[f.attributes[a].nodeName]=parseFloat(f.attributes[a].nodeValue)}else{b[f.attributes[a].nodeName]=f.attributes[a].nodeValue}}return b},parsePointGeometry:function(f){var b=[];var g=f.getElementsByTagName("COORDS");if(g.length>0){var k=this.getChildValue(g[0]);k=k.split(/;/);for(var m=0;m<k.length;m++){var l=k[m].split(/ /);b.push(new OpenLayers.Geometry.Point(parseFloat(l[0]),parseFloat(l[1])))}g=null}else{var a=f.getElementsByTagName("POINT");if(a.length>0){for(var c=0;c<a.length;c++){b.push(new OpenLayers.Geometry.Point(parseFloat(a[c].getAttribute("x")),parseFloat(a[c].getAttribute("y"))))}}a=null}return new OpenLayers.Geometry.LinearRing(b)},CLASS_NAME:"OpenLayers.Format.ArcXML"});OpenLayers.Format.ArcXML.Request=OpenLayers.Class({initialize:function(b){var a={get_image:{properties:{background:null,draw:true,envelope:{minx:0,miny:0,maxx:0,maxy:0},featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},imagesize:{height:0,width:0,dpi:96,printheight:0,printwidth:0,scalesymbols:false},layerlist:[],output:{baseurl:"",legendbaseurl:"",legendname:"",legendpath:"",legendurl:"",name:"",path:"",type:"jpg",url:""}}},get_feature:{layer:"",query:{isspatial:false,featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},buffer:0,where:"",spatialfilter:{relation:"envelope_intersection",envelope:null}}},environment:{separators:{cs:" ",ts:";"}},layer:[],workspaces:[]};return OpenLayers.Util.extend(this,a)},CLASS_NAME:"OpenLayers.Format.ArcXML.Request"});OpenLayers.Format.ArcXML.Response=OpenLayers.Class({initialize:function(b){var a={image:{envelope:null,output:""},features:{featurecount:0,envelope:null,feature:[]},error:""};return OpenLayers.Util.extend(this,a)},CLASS_NAME:"OpenLayers.Format.ArcXML.Response"});OpenLayers.Format.ArcXML.Features=OpenLayers.Class(OpenLayers.Format.XML,{initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(c){var b=new OpenLayers.Format.ArcXML();var a=b.read(c);return a.features.feature}});OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:true,xy:true,initialize:function(a){this.regExes={trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)};OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(f){if(typeof f=="string"){f=OpenLayers.Format.XML.prototype.read.apply(this,[f])}var g=this.getElementsByTagNameNS(f.documentElement,this.gmlns,this.featureName);var c=[];for(var b=0;b<g.length;b++){var a=this.parseFeature(g[b]);if(a){c.push(a)}}return c},parseFeature:function(c){var f=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope","Box"];var o,k,p,b;for(var m=0;m<f.length;++m){o=f[m];k=this.getElementsByTagNameNS(c,this.gmlns,o);if(k.length>0){var b=this.parseGeometry[o.toLowerCase()];if(b){p=b.apply(this,[k[0]]);if(this.internalProjection&&this.externalProjection){p.transform(this.externalProjection,this.internalProjection)}}else{OpenLayers.Console.error(OpenLayers.i18n("unsupportedGeometryType",{geomType:o}))}break}}var l;if(this.extractAttributes){l=this.parseAttributes(c)}var q=new OpenLayers.Feature.Vector(p,l);q.gml={featureType:c.firstChild.nodeName.split(":")[1],featureNS:c.firstChild.namespaceURI,featureNSPrefix:c.firstChild.prefix};var a=c.firstChild;var g;while(a){if(a.nodeType==1){g=a.getAttribute("fid")||a.getAttribute("id");if(g){break}}a=a.nextSibling}q.fid=g;return q},parseGeometry:{point:function(f){var b,a;var g=[];var b=this.getElementsByTagNameNS(f,this.gmlns,"pos");if(b.length>0){a=b[0].firstChild.nodeValue;a=a.replace(this.regExes.trimSpace,"");g=a.split(this.regExes.splitSpace)}if(g.length==0){b=this.getElementsByTagNameNS(f,this.gmlns,"coordinates");if(b.length>0){a=b[0].firstChild.nodeValue;a=a.replace(this.regExes.removeSpace,"");g=a.split(",")}}if(g.length==0){b=this.getElementsByTagNameNS(f,this.gmlns,"coord");if(b.length>0){var k=this.getElementsByTagNameNS(b[0],this.gmlns,"X");var c=this.getElementsByTagNameNS(b[0],this.gmlns,"Y");if(k.length>0&&c.length>0){g=[k[0].firstChild.nodeValue,c[0].firstChild.nodeValue]}}}if(g.length==2){g[2]=null}if(this.xy){return new OpenLayers.Geometry.Point(g[0],g[1],g[2])}else{return new OpenLayers.Geometry.Point(g[1],g[0],g[2])}},multipoint:function(g){var b=this.getElementsByTagNameNS(g,this.gmlns,"Point");var f=[];if(b.length>0){var a;for(var c=0;c<b.length;++c){a=this.parseGeometry.point.apply(this,[b[c]]);if(a){f.push(a)}}}return new OpenLayers.Geometry.MultiPoint(f)},linestring:function(c,g){var f,b;var r=[];var u=[];f=this.getElementsByTagNameNS(c,this.gmlns,"posList");if(f.length>0){b=this.getChildValue(f[0]);b=b.replace(this.regExes.trimSpace,"");r=b.split(this.regExes.splitSpace);var m=parseInt(f[0].getAttribute("dimension"));var k,q,p,o;for(var l=0;l<r.length/m;++l){k=l*m;q=r[k];p=r[k+1];o=(m==2)?null:r[k+2];if(this.xy){u.push(new OpenLayers.Geometry.Point(q,p,o))}else{u.push(new OpenLayers.Geometry.Point(p,q,o))}}}if(r.length==0){f=this.getElementsByTagNameNS(c,this.gmlns,"coordinates");if(f.length>0){b=this.getChildValue(f[0]);b=b.replace(this.regExes.trimSpace,"");b=b.replace(this.regExes.trimComma,",");var a=b.split(this.regExes.splitSpace);for(var l=0;l<a.length;++l){r=a[l].split(",");if(r.length==2){r[2]=null}if(this.xy){u.push(new OpenLayers.Geometry.Point(r[0],r[1],r[2]))}else{u.push(new OpenLayers.Geometry.Point(r[1],r[0],r[2]))}}}}var v=null;if(u.length!=0){if(g){v=new OpenLayers.Geometry.LinearRing(u)}else{v=new OpenLayers.Geometry.LineString(u)}}return v},multilinestring:function(g){var b=this.getElementsByTagNameNS(g,this.gmlns,"LineString");var f=[];if(b.length>0){var a;for(var c=0;c<b.length;++c){a=this.parseGeometry.linestring.apply(this,[b[c]]);if(a){f.push(a)}}}return new OpenLayers.Geometry.MultiLineString(f)},polygon:function(g){var b=this.getElementsByTagNameNS(g,this.gmlns,"LinearRing");var f=[];if(b.length>0){var a;for(var c=0;c<b.length;++c){a=this.parseGeometry.linestring.apply(this,[b[c],true]);if(a){f.push(a)}}}return new OpenLayers.Geometry.Polygon(f)},multipolygon:function(g){var a=this.getElementsByTagNameNS(g,this.gmlns,"Polygon");var f=[];if(a.length>0){var c;for(var b=0;b<a.length;++b){c=this.parseGeometry.polygon.apply(this,[a[b]]);if(c){f.push(c)}}}return new OpenLayers.Geometry.MultiPolygon(f)},envelope:function(b){var g=[];var a;var k;var p=this.getElementsByTagNameNS(b,this.gmlns,"lowerCorner");if(p.length>0){var m=[];if(p.length>0){a=p[0].firstChild.nodeValue;a=a.replace(this.regExes.trimSpace,"");m=a.split(this.regExes.splitSpace)}if(m.length==2){m[2]=null}if(this.xy){var f=new OpenLayers.Geometry.Point(m[0],m[1],m[2])}else{var f=new OpenLayers.Geometry.Point(m[1],m[0],m[2])}}var l=this.getElementsByTagNameNS(b,this.gmlns,"upperCorner");if(l.length>0){var m=[];if(l.length>0){a=l[0].firstChild.nodeValue;a=a.replace(this.regExes.trimSpace,"");m=a.split(this.regExes.splitSpace)}if(m.length==2){m[2]=null}if(this.xy){var o=new OpenLayers.Geometry.Point(m[0],m[1],m[2])}else{var o=new OpenLayers.Geometry.Point(m[1],m[0],m[2])}}if(f&&o){g.push(new OpenLayers.Geometry.Point(f.x,f.y));g.push(new OpenLayers.Geometry.Point(o.x,f.y));g.push(new OpenLayers.Geometry.Point(o.x,o.y));g.push(new OpenLayers.Geometry.Point(f.x,o.y));g.push(new OpenLayers.Geometry.Point(f.x,f.y));var c=new OpenLayers.Geometry.LinearRing(g);k=new OpenLayers.Geometry.Polygon([c])}return k}},parseAttributes:function(g){var k={};var a=g.firstChild;var f,l,c,p,o,b,m;while(a){if(a.nodeType==1){f=a.childNodes;for(l=0;l<f.length;++l){c=f[l];if(c.nodeType==1){p=c.childNodes;if(p.length==1){o=p[0];if(o.nodeType==3||o.nodeType==4){b=(c.prefix)?c.nodeName.split(":")[1]:c.nodeName;m=o.nodeValue.replace(this.regExes.trimSpace,"");k[b]=m}}else{k[c.nodeName.split(":").pop()]=null}}}break}a=a.nextSibling}return k},write:function(c){if(!(c instanceof Array)){c=[c]}var b=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName);for(var a=0;a<c.length;a++){b.appendChild(this.createFeatureXML(c[a]))}return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFeatureXML:function(p){var m=p.geometry;var g=this.buildGeometryNode(m);var o=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);o.appendChild(g);var a=this.createElementNS(this.gmlns,"gml:"+this.featureName);var q=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName);var c=p.fid||p.id;q.setAttribute("fid",c);q.appendChild(o);for(var l in p.attributes){var k=this.createTextNode(p.attributes[l]);var f=l.substring(l.lastIndexOf(":")+1);var b=this.createElementNS(this.featureNS,this.featurePrefix+":"+f);b.appendChild(k);q.appendChild(b)}a.appendChild(q);return a},buildGeometryNode:function(f){if(this.externalProjection&&this.internalProjection){f=f.clone();f.transform(this.internalProjection,this.externalProjection)}var c=f.CLASS_NAME;var b=c.substring(c.lastIndexOf(".")+1);var a=this.buildGeometry[b.toLowerCase()];return a.apply(this,[f])},buildGeometry:{point:function(b){var a=this.createElementNS(this.gmlns,"gml:Point");a.appendChild(this.buildCoordinatesNode(b));return a},multipoint:function(k){var f=this.createElementNS(this.gmlns,"gml:MultiPoint");var c=k.components;var b,g;for(var a=0;a<c.length;a++){b=this.createElementNS(this.gmlns,"gml:pointMember");g=this.buildGeometry.point.apply(this,[c[a]]);b.appendChild(g);f.appendChild(b)}return f},linestring:function(b){var a=this.createElementNS(this.gmlns,"gml:LineString");a.appendChild(this.buildCoordinatesNode(b));return a},multilinestring:function(k){var f=this.createElementNS(this.gmlns,"gml:MultiLineString");var a=k.components;var c,g;for(var b=0;b<a.length;++b){c=this.createElementNS(this.gmlns,"gml:lineStringMember");g=this.buildGeometry.linestring.apply(this,[a[b]]);c.appendChild(g);f.appendChild(c)}return f},linearring:function(b){var a=this.createElementNS(this.gmlns,"gml:LinearRing");a.appendChild(this.buildCoordinatesNode(b));return a},polygon:function(l){var f=this.createElementNS(this.gmlns,"gml:Polygon");var k=l.components;var c,g,b;for(var a=0;a<k.length;++a){b=(a==0)?"outerBoundaryIs":"innerBoundaryIs";c=this.createElementNS(this.gmlns,"gml:"+b);g=this.buildGeometry.linearring.apply(this,[k[a]]);c.appendChild(g);f.appendChild(c)}return f},multipolygon:function(k){var f=this.createElementNS(this.gmlns,"gml:MultiPolygon");var a=k.components;var g,b;for(var c=0;c<a.length;++c){g=this.createElementNS(this.gmlns,"gml:polygonMember");b=this.buildGeometry.polygon.apply(this,[a[c]]);g.appendChild(b);f.appendChild(g)}return f},bounds:function(b){var a=this.createElementNS(this.gmlns,"gml:Box");a.appendChild(this.buildCoordinatesNode(b));return a}},buildCoordinatesNode:function(k){var a=this.createElementNS(this.gmlns,"gml:coordinates");a.setAttribute("decimal",".");a.setAttribute("cs",",");a.setAttribute("ts"," ");var g=[];if(k instanceof OpenLayers.Bounds){g.push(k.left+","+k.bottom);g.push(k.right+","+k.top)}else{var c=(k.components)?k.components:[k];for(var b=0;b<c.length;b++){g.push(c[b].x+","+c[b].y)}}var f=this.createTextNode(g.join(" "));a.appendChild(f);return a},CLASS_NAME:"OpenLayers.Format.GML"});if(!OpenLayers.Format.GML){OpenLayers.Format.GML={}}OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:true,srsName:null,xy:true,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);this.setGeometryTypes();if(a&&a.featureNS){this.setNamespace("feature",a.featureNS)}this.singleFeatureType=!a||(typeof a.featureType==="string")},read:function(g){if(typeof g=="string"){g=OpenLayers.Format.XML.prototype.read.apply(this,[g])}if(g&&g.nodeType==9){g=g.documentElement}var c=[];this.readNode(g,{features:c});if(c.length==0){var f=this.getElementsByTagNameNS(g,this.namespaces.gml,"featureMember");if(f.length){for(var b=0,a=f.length;b<a;++b){this.readNode(f[b],{features:c})}}else{var f=this.getElementsByTagNameNS(g,this.namespaces.gml,"featureMembers");if(f.length){this.readNode(f[0],{features:c})}}}return c},readers:{gml:{featureMember:function(a,b){this.readChildNodes(a,b)},featureMembers:function(a,b){this.readChildNodes(a,b)},name:function(a,b){b.name=this.getChildValue(a)},boundedBy:function(b,c){var a={};this.readChildNodes(b,a);if(a.components&&a.components.length>0){c.bounds=a.components[0]}},Point:function(b,a){var c={points:[]};this.readChildNodes(b,c);if(!a.components){a.components=[]}a.components.push(c.points[0])},coordinates:function(g,l){var m=this.getChildValue(g).replace(this.regExes.trimSpace,"");m=m.replace(this.regExes.trimComma,",");var a=m.split(this.regExes.splitSpace);var k;var f=a.length;var c=new Array(f);for(var b=0;b<f;++b){k=a[b].split(",");if(this.xy){c[b]=new OpenLayers.Geometry.Point(k[0],k[1],k[2])}else{c[b]=new OpenLayers.Geometry.Point(k[1],k[0],k[2])}}l.points=c},coord:function(a,b){var c={};this.readChildNodes(a,c);if(!b.points){b.points=[]}b.points.push(new OpenLayers.Geometry.Point(c.x,c.y,c.z))},X:function(a,b){b.x=this.getChildValue(a)},Y:function(a,b){b.y=this.getChildValue(a)},Z:function(a,b){b.z=this.getChildValue(a)},MultiPoint:function(b,a){var c={components:[]};this.readChildNodes(b,c);a.components=[new OpenLayers.Geometry.MultiPoint(c.components)]},pointMember:function(a,b){this.readChildNodes(a,b)},LineString:function(b,a){var c={};this.readChildNodes(b,c);if(!a.components){a.components=[]}a.components.push(new OpenLayers.Geometry.LineString(c.points))},MultiLineString:function(b,a){var c={components:[]};this.readChildNodes(b,c);a.components=[new OpenLayers.Geometry.MultiLineString(c.components)]},lineStringMember:function(a,b){this.readChildNodes(a,b)},Polygon:function(b,a){var c={outer:null,inner:[]};this.readChildNodes(b,c);c.inner.unshift(c.outer);if(!a.components){a.components=[]}a.components.push(new OpenLayers.Geometry.Polygon(c.inner))},LinearRing:function(b,c){var a={};this.readChildNodes(b,a);c.components=[new OpenLayers.Geometry.LinearRing(a.points)]},MultiPolygon:function(b,a){var c={components:[]};this.readChildNodes(b,c);a.components=[new OpenLayers.Geometry.MultiPolygon(c.components)]},polygonMember:function(a,b){this.readChildNodes(a,b)},GeometryCollection:function(b,a){var c={components:[]};this.readChildNodes(b,c);a.components=[new OpenLayers.Geometry.Collection(c.components)]},geometryMember:function(a,b){this.readChildNodes(a,b)}},feature:{"*":function(c,f){var a;var b=c.localName||c.nodeName.split(":").pop();if(!this.singleFeatureType&&(OpenLayers.Util.indexOf(this.featureType,b)!=-1)){a="_typeName"}else{if(b==this.featureType){a="_typeName"}else{if(c.childNodes.length==0||(c.childNodes.length==1&&c.firstChild.nodeType==3)){if(this.extractAttributes){a="_attribute"}}else{a="_geometry"}}}if(a){this.readers.feature[a].apply(this,[c,f])}},_typeName:function(c,f){var a={components:[],attributes:{}};this.readChildNodes(c,a);if(a.name){a.attributes.name=a.name}var b=new OpenLayers.Feature.Vector(a.components[0],a.attributes);if(!this.singleFeatureType){b.type=c.nodeName.split(":").pop();b.namespace=c.namespaceURI}var g=c.getAttribute("fid")||this.getAttributeNS(c,this.namespaces.gml,"id");if(g){b.fid=g}if(this.internalProjection&&this.externalProjection&&b.geometry){b.geometry.transform(this.externalProjection,this.internalProjection)}if(a.bounds){b.geometry.bounds=a.bounds}f.features.push(b)},_geometry:function(a,b){this.readChildNodes(a,b)},_attribute:function(b,f){var a=b.localName||b.nodeName.split(":").pop();var c=this.getChildValue(b);f.attributes[a]=c}},wfs:{FeatureCollection:function(a,b){this.readChildNodes(a,b)}}},write:function(c){var b;if(c instanceof Array){b="featureMembers"}else{b="featureMember"}var a=this.writeNode("gml:"+b,c);this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[a])},writers:{gml:{featureMember:function(a){var b=this.createElementNSPlus("gml:featureMember");this.writeNode("feature:_typeName",a,b);return b},MultiPoint:function(c){var b=this.createElementNSPlus("gml:MultiPoint");for(var a=0;a<c.components.length;++a){this.writeNode("pointMember",c.components[a],b)}return b},pointMember:function(b){var a=this.createElementNSPlus("gml:pointMember");this.writeNode("Point",b,a);return a},MultiLineString:function(c){var b=this.createElementNSPlus("gml:MultiLineString");for(var a=0;a<c.components.length;++a){this.writeNode("lineStringMember",c.components[a],b)}return b},lineStringMember:function(b){var a=this.createElementNSPlus("gml:lineStringMember");this.writeNode("LineString",b,a);return a},MultiPolygon:function(c){var b=this.createElementNSPlus("gml:MultiPolygon");for(var a=0;a<c.components.length;++a){this.writeNode("polygonMember",c.components[a],b)}return b},polygonMember:function(b){var a=this.createElementNSPlus("gml:polygonMember");this.writeNode("Polygon",b,a);return a},GeometryCollection:function(f){var c=this.createElementNSPlus("gml:GeometryCollection");for(var b=0,a=f.components.length;b<a;++b){this.writeNode("geometryMember",f.components[b],c)}return c},geometryMember:function(b){var a=this.createElementNSPlus("gml:geometryMember");var c=this.writeNode("feature:_geometry",b);a.appendChild(c.firstChild);return a}},feature:{_typeName:function(b){var c=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:b.fid}});if(b.geometry){this.writeNode("feature:_geometry",b.geometry,c)}for(var a in b.attributes){var f=b.attributes[a];if(f!=null){this.writeNode("feature:_attribute",{name:a,value:f},c)}}return c},_geometry:function(c){if(this.externalProjection&&this.internalProjection){c=c.clone().transform(this.internalProjection,this.externalProjection)}var b=this.createElementNSPlus("feature:"+this.geometryName);var a=this.geometryTypes[c.CLASS_NAME];var f=this.writeNode("gml:"+a,c,b);if(this.srsName){f.setAttribute("srsName",this.srsName)}return b},_attribute:function(a){return this.createElementNSPlus("feature:"+a.name,{value:a.value})}},wfs:{FeatureCollection:function(c){var f=this.createElementNSPlus("wfs:FeatureCollection");for(var b=0,a=c.length;b<a;++b){this.writeNode("gml:featureMember",c[b],f)}return f}}},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.Base"});OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(a){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[a])},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(b,a){var c={};this.readChildNodes(b,c);a.outer=c.components[0]},innerBoundaryIs:function(b,a){var c={};this.readChildNodes(b,c);a.inner.push(c.components[0])},Box:function(f,b){var g={};this.readChildNodes(f,g);if(!b.components){b.components=[]}var c=g.points[0];var a=g.points[1];b.components.push(new OpenLayers.Bounds(c.x,c.y,a.x,a.y))}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(c){var b;if(c instanceof Array){b="wfs:FeatureCollection"}else{b="gml:featureMember"}var a=this.writeNode(b,c);this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[a])},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(b){var a=this.createElementNSPlus("gml:Point");this.writeNode("coordinates",[b],a);return a},coordinates:function(f){var c=f.length;var g=new Array(c);var a;for(var b=0;b<c;++b){a=f[b];if(this.xy){g[b]=a.x+","+a.y}else{g[b]=a.y+","+a.x}if(a.z!=undefined){g[b]+=","+a.z}}return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:(c==1)?g[0]:g.join(" ")})},LineString:function(b){var a=this.createElementNSPlus("gml:LineString");this.writeNode("coordinates",b.components,a);return a},Polygon:function(c){var b=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",c.components[0],b);for(var a=1;a<c.components.length;++a){this.writeNode("innerBoundaryIs",c.components[a],b)}return b},outerBoundaryIs:function(a){var b=this.createElementNSPlus("gml:outerBoundaryIs");this.writeNode("LinearRing",a,b);return b},innerBoundaryIs:function(a){var b=this.createElementNSPlus("gml:innerBoundaryIs");this.writeNode("LinearRing",a,b);return b},LinearRing:function(a){var b=this.createElementNSPlus("gml:LinearRing");this.writeNode("coordinates",a.components,b);return b},Box:function(b){var a=this.createElementNSPlus("gml:Box");this.writeNode("coordinates",[{x:b.left,y:b.bottom},{x:b.right,y:b.top}],a);if(this.srsName){a.setAttribute("srsName",this.srsName)}return a}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"OpenLayers.Format.GML.v2"});OpenLayers.Format.GML.v3=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:false,multiCurve:true,surface:false,multiSurface:true,initialize:function(a){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[a])},readers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(a,b){this.readChildNodes(a,b)},Curve:function(b,a){var c={points:[]};this.readChildNodes(b,c);if(!a.components){a.components=[]}a.components.push(new OpenLayers.Geometry.LineString(c.points))},segments:function(a,b){this.readChildNodes(a,b)},LineStringSegment:function(b,a){var c={};this.readChildNodes(b,c);if(c.points){Array.prototype.push.apply(a.points,c.points)}},pos:function(b,f){var g=this.getChildValue(b).replace(this.regExes.trimSpace,"");var c=g.split(this.regExes.splitSpace);var a;if(this.xy){a=new OpenLayers.Geometry.Point(c[0],c[1],c[2])}else{a=new OpenLayers.Geometry.Point(c[1],c[0],c[2])}f.points=[a]},posList:function(a,f){var m=this.getChildValue(a).replace(this.regExes.trimSpace,"");var q=m.split(this.regExes.splitSpace);var g=parseInt(a.getAttribute("dimension"))||2;var b,r,p,l;var o=q.length/g;var u=new Array(o);for(var c=0,k=q.length;c<k;c+=g){r=q[c];p=q[c+1];l=(g==2)?undefined:q[c+2];if(this.xy){u[c/g]=new OpenLayers.Geometry.Point(r,p,l)}else{u[c/g]=new OpenLayers.Geometry.Point(p,r,l)}}f.points=u},Surface:function(a,b){this.readChildNodes(a,b)},patches:function(a,b){this.readChildNodes(a,b)},PolygonPatch:function(a,b){this.readers.gml.Polygon.apply(this,[a,b])},exterior:function(b,a){var c={};this.readChildNodes(b,c);a.outer=c.components[0]},interior:function(b,a){var c={};this.readChildNodes(b,c);a.inner.push(c.components[0])},MultiCurve:function(b,a){var c={components:[]};this.readChildNodes(b,c);if(c.components.length>0){a.components=[new OpenLayers.Geometry.MultiLineString(c.components)]}},curveMember:function(a,b){this.readChildNodes(a,b)},MultiSurface:function(b,a){var c={components:[]};this.readChildNodes(b,c);if(c.components.length>0){a.components=[new OpenLayers.Geometry.MultiPolygon(c.components)]}},surfaceMember:function(a,b){this.readChildNodes(a,b)},surfaceMembers:function(a,b){this.readChildNodes(a,b)},pointMembers:function(a,b){this.readChildNodes(a,b)},lineStringMembers:function(a,b){this.readChildNodes(a,b)},polygonMembers:function(a,b){this.readChildNodes(a,b)},geometryMembers:function(a,b){this.readChildNodes(a,b)},Envelope:function(f,b){var g={points:new Array(2)};this.readChildNodes(f,g);if(!b.components){b.components=[]}var c=g.points[0];var a=g.points[1];b.components.push(new OpenLayers.Bounds(c.x,c.y,a.x,a.y))},lowerCorner:function(b,a){var c={};this.readers.gml.pos.apply(this,[b,c]);a.points[0]=c.points[0]},upperCorner:function(b,a){var c={};this.readers.gml.pos.apply(this,[b,c]);a.points[1]=c.points[0]}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(c){var b;if(c instanceof Array){b="featureMembers"}else{b="featureMember"}var a=this.writeNode("gml:"+b,c);this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[a])},writers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(c){var f=this.createElementNSPlus("gml:featureMembers");for(var b=0,a=c.length;b<a;++b){this.writeNode("feature:_typeName",c[b],f)}return f},Point:function(b){var a=this.createElementNSPlus("gml:Point");this.writeNode("pos",b,a);return a},pos:function(a){var b=(this.xy)?(a.x+" "+a.y):(a.y+" "+a.x);return this.createElementNSPlus("gml:pos",{value:b})},LineString:function(b){var a=this.createElementNSPlus("gml:LineString");this.writeNode("posList",b.components,a);return a},Curve:function(b){var a=this.createElementNSPlus("gml:Curve");this.writeNode("segments",b,a);return a},segments:function(b){var a=this.createElementNSPlus("gml:segments");this.writeNode("LineStringSegment",b,a);return a},LineStringSegment:function(b){var a=this.createElementNSPlus("gml:LineStringSegment");this.writeNode("posList",b.components,a);return a},posList:function(f){var b=f.length;var g=new Array(b);var a;for(var c=0;c<b;++c){a=f[c];if(this.xy){g[c]=a.x+" "+a.y}else{g[c]=a.y+" "+a.x}}return this.createElementNSPlus("gml:posList",{value:g.join(" ")})},Surface:function(b){var a=this.createElementNSPlus("gml:Surface");this.writeNode("patches",b,a);return a},patches:function(b){var a=this.createElementNSPlus("gml:patches");this.writeNode("PolygonPatch",b,a);return a},PolygonPatch:function(f){var c=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}});this.writeNode("exterior",f.components[0],c);for(var b=1,a=f.components.length;b<a;++b){this.writeNode("interior",f.components[b],c)}return c},Polygon:function(f){var c=this.createElementNSPlus("gml:Polygon");this.writeNode("exterior",f.components[0],c);for(var b=1,a=f.components.length;b<a;++b){this.writeNode("interior",f.components[b],c)}return c},exterior:function(a){var b=this.createElementNSPlus("gml:exterior");this.writeNode("LinearRing",a,b);return b},interior:function(a){var b=this.createElementNSPlus("gml:interior");this.writeNode("LinearRing",a,b);return b},LinearRing:function(a){var b=this.createElementNSPlus("gml:LinearRing");this.writeNode("posList",a.components,b);return b},MultiCurve:function(f){var c=this.createElementNSPlus("gml:MultiCurve");for(var b=0,a=f.components.length;b<a;++b){this.writeNode("curveMember",f.components[b],c)}return c},curveMember:function(b){var a=this.createElementNSPlus("gml:curveMember");if(this.curve){this.writeNode("Curve",b,a)}else{this.writeNode("LineString",b,a)}return a},MultiSurface:function(f){var c=this.createElementNSPlus("gml:MultiSurface");for(var b=0,a=f.components.length;b<a;++b){this.writeNode("surfaceMember",f.components[b],c)}return c},surfaceMember:function(a){var b=this.createElementNSPlus("gml:surfaceMember");if(this.surface){this.writeNode("Surface",a,b)}else{this.writeNode("Polygon",a,b)}return b},Envelope:function(b){var a=this.createElementNSPlus("gml:Envelope");this.writeNode("lowerCorner",b,a);this.writeNode("upperCorner",b,a);if(this.srsName){a.setAttribute("srsName",this.srsName)}return a},lowerCorner:function(a){var b=(this.xy)?(a.left+" "+a.bottom):(a.bottom+" "+a.left);return this.createElementNSPlus("gml:lowerCorner",{value:b})},upperCorner:function(a){var b=(this.xy)?(a.right+" "+a.top):(a.top+" "+a.right);return this.createElementNSPlus("gml:upperCorner",{value:b})}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":(this.curve===true)?"Curve":"LineString","OpenLayers.Geometry.MultiLineString":(this.multiCurve===false)?"MultiLineString":"MultiCurve","OpenLayers.Geometry.Polygon":(this.surface===true)?"Surface":"Polygon","OpenLayers.Geometry.MultiPolygon":(this.multiSurface===false)?"MultiPolygon":"MultiSurface","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.v3"});OpenLayers.Format.KML=OpenLayers.Class(OpenLayers.Format.XML,{kmlns:"http://earth.google.com/kml/2.0",placemarksDesc:"No description available",foldersName:"OpenLayers export",foldersDesc:"Exported on "+new Date(),extractAttributes:true,extractStyles:false,internalns:null,features:null,styles:null,styleBaseUrl:"",fetched:null,maxDepth:0,initialize:function(a){this.regExes={trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g),kmlColor:(/(\w{2})(\w{2})(\w{2})(\w{2})/),kmlIconPalette:(/root:\/\/icons\/palette-(\d+)(\.\w+)/),straightBracket:(/\$\[(.*?)\]/g)};OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(b){this.features=[];this.styles={};this.fetched={};var a={depth:0,styleBaseUrl:this.styleBaseUrl};return this.parseData(b,a)},parseData:function(l,c){if(typeof l=="string"){l=OpenLayers.Format.XML.prototype.read.apply(this,[l])}var g=["Link","NetworkLink","Style","StyleMap","Placemark"];for(var f=0,a=g.length;f<a;++f){var k=g[f];var b=this.getElementsByTagNameNS(l,"*",k);if(b.length==0){continue}switch(k.toLowerCase()){case"link":case"networklink":this.parseLinks(b,c);break;case"style":if(this.extractStyles){this.parseStyles(b,c)}break;case"stylemap":if(this.extractStyles){this.parseStyleMaps(b,c)}break;case"placemark":this.parseFeatures(b,c);break}}return this.features},parseLinks:function(c,f){if(f.depth>=this.maxDepth){return false}var l=OpenLayers.Util.extend({},f);l.depth++;for(var g=0,a=c.length;g<a;g++){var b=this.parseProperty(c[g],"*","href");if(b&&!this.fetched[b]){this.fetched[b]=true;var k=this.fetchLink(b);if(k){this.parseData(k,l)}}}},fetchLink:function(a){var b=OpenLayers.Request.GET({url:a,async:false});if(b){return b.responseText}},parseStyles:function(b,c){for(var f=0,a=b.length;f<a;f++){var g=this.parseStyle(b[f]);if(g){styleName=(c.styleBaseUrl||"")+"#"+g.id;this.styles[styleName]=g}}},parseStyle:function(F){var T={};var R=["LineStyle","PolyStyle","IconStyle","BalloonStyle"];var ac,o,p,C;for(var X=0,u=R.length;X<u;++X){ac=R[X];styleTypeNode=this.getElementsByTagNameNS(F,"*",ac)[0];if(!styleTypeNode){continue}switch(ac.toLowerCase()){case"linestyle":var B=this.parseProperty(styleTypeNode,"*","color");if(B){var c=(B.toString()).match(this.regExes.kmlColor);var U=c[1];T.strokeOpacity=parseInt(U,16)/255;var ab=c[2];var Z=c[3];var S=c[4];T.strokeColor="#"+S+Z+ab}var a=this.parseProperty(styleTypeNode,"*","width");if(a){T.strokeWidth=a}case"polystyle":var B=this.parseProperty(styleTypeNode,"*","color");if(B){var c=(B.toString()).match(this.regExes.kmlColor);var U=c[1];T.fillOpacity=parseInt(U,16)/255;var ab=c[2];var Z=c[3];var S=c[4];T.fillColor="#"+S+Z+ab}var q=this.parseProperty(styleTypeNode,"*","fill");if(q=="0"){T.fillColor="none"}break;case"iconstyle":var G=parseFloat(this.parseProperty(styleTypeNode,"*","scale")||1);var a=32*G;var f=32*G;var k=this.getElementsByTagNameNS(styleTypeNode,"*","Icon")[0];if(k){var A=this.parseProperty(k,"*","href");if(A){var Q=this.parseProperty(k,"*","w");var Y=this.parseProperty(k,"*","h");var m="http://maps.google.com/mapfiles/kml";if(OpenLayers.String.startsWith(A,m)&&!Q&&!Y){Q=64;Y=64;G=G/2}Q=Q||Y;Y=Y||Q;if(Q){a=parseInt(Q)*G}if(Y){f=parseInt(Y)*G}var c=A.match(this.regExes.kmlIconPalette);if(c){var V=c[1];var v=c[2];var O=this.parseProperty(k,"*","x");var M=this.parseProperty(k,"*","y");var I=O?O/32:0;var H=M?(7-M/32):7;var E=H*8+I;A="http://maps.google.com/mapfiles/kml/pal"+V+"/icon"+E+v}T.graphicOpacity=1;T.externalGraphic=A}}var K=this.getElementsByTagNameNS(styleTypeNode,"*","hotSpot")[0];if(K){var O=parseFloat(K.getAttribute("x"));var M=parseFloat(K.getAttribute("y"));var D=K.getAttribute("xunits");if(D=="pixels"){T.graphicXOffset=-O*G}else{if(D=="insetPixels"){T.graphicXOffset=-a+(O*G)}else{if(D=="fraction"){T.graphicXOffset=-a*O}}}var l=K.getAttribute("yunits");if(l=="pixels"){T.graphicYOffset=-f+(M*G)+1}else{if(l=="insetPixels"){T.graphicYOffset=-(M*G)+1}else{if(l=="fraction"){T.graphicYOffset=-f*(1-M)+1}}}}T.graphicWidth=a;T.graphicHeight=f;break;case"balloonstyle":var aa=OpenLayers.Util.getXmlNodeValue(styleTypeNode);if(aa){T.balloonStyle=aa.replace(this.regExes.straightBracket,"${$1}")}break;default:}}if(!T.strokeColor&&T.fillColor){T.strokeColor=T.fillColor}var J=F.getAttribute("id");if(J&&T){T.id=J}return T},parseStyleMaps:function(a,r){for(var l=0,m=a.length;l<m;l++){var f=a[l];var c=this.getElementsByTagNameNS(f,"*","Pair");var b=f.getAttribute("id");for(var k=0,q=c.length;k<q;k++){var g=c[k];var p=this.parseProperty(g,"*","key");var o=this.parseProperty(g,"*","styleUrl");if(o&&p=="normal"){this.styles[(r.styleBaseUrl||"")+"#"+b]=this.styles[(r.styleBaseUrl||"")+o]}if(o&&p=="highlight"){}}}},parseFeatures:function(a,o){var f=new Array(a.length);for(var g=0,k=a.length;g<k;g++){var b=a[g];var m=this.parseFeature.apply(this,[b]);if(m){if(this.extractStyles&&m.attributes&&m.attributes.styleUrl){m.style=this.getStyle(m.attributes.styleUrl,o)}if(this.extractStyles){var l=this.getElementsByTagNameNS(b,"*","Style")[0];if(l){var c=this.parseStyle(l);if(c){m.style=OpenLayers.Util.extend(m.style,c)}}}f[g]=m}else{throw"Bad Placemark: "+g}}this.features=this.features.concat(f)},parseFeature:function(b){var c=["MultiGeometry","Polygon","LineString","Point"];var o,g,p,a;for(var l=0,m=c.length;l<m;++l){o=c[l];this.internalns=b.namespaceURI?b.namespaceURI:this.kmlns;g=this.getElementsByTagNameNS(b,this.internalns,o);if(g.length>0){var a=this.parseGeometry[o.toLowerCase()];if(a){p=a.apply(this,[g[0]]);if(this.internalProjection&&this.externalProjection){p.transform(this.externalProjection,this.internalProjection)}}else{OpenLayers.Console.error(OpenLayers.i18n("unsupportedGeometryType",{geomType:o}))}break}}var k;if(this.extractAttributes){k=this.parseAttributes(b)}var q=new OpenLayers.Feature.Vector(p,k);var f=b.getAttribute("id")||b.getAttribute("name");if(f!=null){q.fid=f}return q},getStyle:function(b,a){var c=OpenLayers.Util.removeTail(b);var k=OpenLayers.Util.extend({},a);k.depth++;k.styleBaseUrl=c;if(!this.styles[b]&&!OpenLayers.String.startsWith(b,"#")&&k.depth<=this.maxDepth&&!this.fetched[c]){var g=this.fetchLink(c);if(g){this.parseData(g,k)}}var f=OpenLayers.Util.extend({},this.styles[b]);return f},parseGeometry:{point:function(f){var c=this.getElementsByTagNameNS(f,this.internalns,"coordinates");var g=[];if(c.length>0){var b=c[0].firstChild.nodeValue;b=b.replace(this.regExes.removeSpace,"");g=b.split(",")}var a=null;if(g.length>1){if(g.length==2){g[2]=null}a=new OpenLayers.Geometry.Point(g[0],g[1],g[2])}else{throw"Bad coordinate string: "+b}return a},linestring:function(c,g){var f=this.getElementsByTagNameNS(c,this.internalns,"coordinates");var q=null;if(f.length>0){var b=this.getChildValue(f[0]);b=b.replace(this.regExes.trimSpace,"");b=b.replace(this.regExes.trimComma,",");var a=b.split(this.regExes.splitSpace);var m=a.length;var p=new Array(m);var o,l;for(var k=0;k<m;++k){o=a[k].split(",");l=o.length;if(l>1){if(o.length==2){o[2]=null}p[k]=new OpenLayers.Geometry.Point(o[0],o[1],o[2])}else{throw"Bad LineString point coordinates: "+a[k]}}if(m){if(g){q=new OpenLayers.Geometry.LinearRing(p)}else{q=new OpenLayers.Geometry.LineString(p)}}else{throw"Bad LineString coordinates: "+b}}return q},polygon:function(k){var c=this.getElementsByTagNameNS(k,this.internalns,"LinearRing");var l=c.length;var g=new Array(l);if(l>0){var b;for(var f=0,a=c.length;f<a;++f){b=this.parseGeometry.linestring.apply(this,[c[f],true]);if(b){g[f]=b}else{throw"Bad LinearRing geometry: "+f}}}return new OpenLayers.Geometry.Polygon(g)},multigeometry:function(g){var m,l;var k=[];var c=g.childNodes;for(var b=0,a=c.length;b<a;++b){m=c[b];if(m.nodeType==1){var f=(m.prefix)?m.nodeName.split(":")[1]:m.nodeName;var l=this.parseGeometry[f.toLowerCase()];if(l){k.push(l.apply(this,[m]))}}}return new OpenLayers.Geometry.Collection(k)}},parseAttributes:function(f){var g={};var k=f.getElementsByTagName("ExtendedData");if(k.length){g=this.parseExtendedData(k[0])}var b,q,p;var c=f.childNodes;for(var l=0,m=c.length;l<m;++l){b=c[l];if(b.nodeType==1){q=b.childNodes;if(q.length==1||q.length==3){var p;switch(q.length){case 1:p=q[0];break;case 3:default:p=q[1];break}if(p.nodeType==3||p.nodeType==4){var a=(b.prefix)?b.nodeName.split(":")[1]:b.nodeName;var o=OpenLayers.Util.getXmlNodeValue(p);if(o){o=o.replace(this.regExes.trimSpace,"");g[a]=o}}}}}return g},parseExtendedData:function(b){var f={};var c=b.getElementsByTagName("Data");for(var k=0,m=c.length;k<m;k++){var g=c[k];var o=g.getAttribute("name");var l={};var p=g.getElementsByTagName("value");if(p.length){l.value=this.getChildValue(p[0])}var a=g.getElementsByTagName("displayName");if(a.length){l.displayName=this.getChildValue(a[0])}f[o]=l}return f},parseProperty:function(c,f,b){var g;var a=this.getElementsByTagNameNS(c,f,b);try{g=OpenLayers.Util.getXmlNodeValue(a[0])}catch(k){g=null}return g},write:function(f){if(!(f instanceof Array)){f=[f]}var b=this.createElementNS(this.kmlns,"kml");var g=this.createFolderXML();for(var c=0,a=f.length;c<a;++c){g.appendChild(this.createPlacemarkXML(f[c]))}b.appendChild(g);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFolderXML:function(){var g=this.createElementNS(this.kmlns,"name");var f=this.createTextNode(this.foldersName);g.appendChild(f);var a=this.createElementNS(this.kmlns,"description");var b=this.createTextNode(this.foldersDesc);a.appendChild(b);var c=this.createElementNS(this.kmlns,"Folder");c.appendChild(g);c.appendChild(a);return c},createPlacemarkXML:function(g){var l=this.createElementNS(this.kmlns,"name");var c=(g.attributes.name)?g.attributes.name:g.id;l.appendChild(this.createTextNode(c));var f=this.createElementNS(this.kmlns,"description");var k=(g.attributes.description)?g.attributes.description:this.placemarksDesc;f.appendChild(this.createTextNode(k));var b=this.createElementNS(this.kmlns,"Placemark");if(g.fid!=null){b.setAttribute("id",g.fid)}b.appendChild(l);b.appendChild(f);var a=this.buildGeometryNode(g.geometry);b.appendChild(a);return b},buildGeometryNode:function(g){if(this.internalProjection&&this.externalProjection){g=g.clone();g.transform(this.internalProjection,this.externalProjection)}var c=g.CLASS_NAME;var b=c.substring(c.lastIndexOf(".")+1);var a=this.buildGeometry[b.toLowerCase()];var f=null;if(a){f=a.apply(this,[g])}return f},buildGeometry:{point:function(b){var a=this.createElementNS(this.kmlns,"Point");a.appendChild(this.buildCoordinatesNode(b));return a},multipoint:function(a){return this.buildGeometry.collection.apply(this,[a])},linestring:function(b){var a=this.createElementNS(this.kmlns,"LineString");a.appendChild(this.buildCoordinatesNode(b));return a},multilinestring:function(a){return this.buildGeometry.collection.apply(this,[a])},linearring:function(b){var a=this.createElementNS(this.kmlns,"LinearRing");a.appendChild(this.buildCoordinatesNode(b));return a},polygon:function(m){var b=this.createElementNS(this.kmlns,"Polygon");var l=m.components;var g,k,f;for(var c=0,a=l.length;c<a;++c){f=(c==0)?"outerBoundaryIs":"innerBoundaryIs";g=this.createElementNS(this.kmlns,f);k=this.buildGeometry.linearring.apply(this,[l[c]]);g.appendChild(k);b.appendChild(g)}return b},multipolygon:function(a){return this.buildGeometry.collection.apply(this,[a])},collection:function(f){var b=this.createElementNS(this.kmlns,"MultiGeometry");var g;for(var c=0,a=f.components.length;c<a;++c){g=this.buildGeometryNode.apply(this,[f.components[c]]);if(g){b.appendChild(g)}}return b}},buildCoordinatesNode:function(g){var a=this.createElementNS(this.kmlns,"coordinates");var o;var m=g.components;if(m){var l;var k=m.length;var c=new Array(k);for(var f=0;f<k;++f){l=m[f];c[f]=l.x+","+l.y}o=c.join(" ")}else{o=g.x+","+g.y}var b=this.createTextNode(o);a.appendChild(b);return a},CLASS_NAME:"OpenLayers.Format.KML"});OpenLayers.Format.GeoRSS=OpenLayers.Class(OpenLayers.Format.XML,{rssns:"http://backend.userland.com/rss2",featureNS:"http://mapserver.gis.umn.edu/mapserver",georssns:"http://www.georss.org/georss",geons:"http://www.w3.org/2003/01/geo/wgs84_pos#",featureTitle:"Untitled",featureDescription:"No Description",gmlParser:null,xy:false,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},createGeometryFromItem:function(u){var r=this.getElementsByTagNameNS(u,this.georssns,"point");var l=this.getElementsByTagNameNS(u,this.geons,"lat");var a=this.getElementsByTagNameNS(u,this.geons,"long");var A=this.getElementsByTagNameNS(u,this.georssns,"line");var p=this.getElementsByTagNameNS(u,this.georssns,"polygon");var c=this.getElementsByTagNameNS(u,this.georssns,"where");var f=this.getElementsByTagNameNS(u,this.georssns,"box");if(r.length>0||(l.length>0&&a.length>0)){var q;if(r.length>0){q=OpenLayers.String.trim(r[0].firstChild.nodeValue).split(/\s+/);if(q.length!=2){q=OpenLayers.String.trim(r[0].firstChild.nodeValue).split(/\s*,\s*/)}}else{q=[parseFloat(l[0].firstChild.nodeValue),parseFloat(a[0].firstChild.nodeValue)]}var m=new OpenLayers.Geometry.Point(parseFloat(q[1]),parseFloat(q[0]))}else{if(A.length>0){var o=OpenLayers.String.trim(this.concatChildValues(A[0])).split(/\s+/);var g=[];var r;for(var b=0,k=o.length;b<k;b+=2){r=new OpenLayers.Geometry.Point(parseFloat(o[b+1]),parseFloat(o[b]));g.push(r)}m=new OpenLayers.Geometry.LineString(g)}else{if(p.length>0){var o=OpenLayers.String.trim(this.concatChildValues(p[0])).split(/\s+/);var g=[];var r;for(var b=0,k=o.length;b<k;b+=2){r=new OpenLayers.Geometry.Point(parseFloat(o[b+1]),parseFloat(o[b]));g.push(r)}m=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(g)])}else{if(c.length>0){if(!this.gmlParser){this.gmlParser=new OpenLayers.Format.GML({xy:this.xy})}var v=this.gmlParser.parseFeature(c[0]);m=v.geometry}else{if(f.length>0){var o=OpenLayers.String.trim(f[0].firstChild.nodeValue).split(/\s+/);var g=[];var r;if(o.length>3){r=new OpenLayers.Geometry.Point(parseFloat(o[1]),parseFloat(o[0]));g.push(r);r=new OpenLayers.Geometry.Point(parseFloat(o[1]),parseFloat(o[2]));g.push(r);r=new OpenLayers.Geometry.Point(parseFloat(o[3]),parseFloat(o[2]));g.push(r);r=new OpenLayers.Geometry.Point(parseFloat(o[3]),parseFloat(o[0]));g.push(r);r=new OpenLayers.Geometry.Point(parseFloat(o[1]),parseFloat(o[0]));g.push(r)}m=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(g)])}}}}}if(m&&this.internalProjection&&this.externalProjection){m.transform(this.externalProjection,this.internalProjection)}return m},createFeatureFromItem:function(m){var f=this.createGeometryFromItem(m);var k=this.getChildValue(m,"*","title",this.featureTitle);var l=this.getChildValue(m,"*","description",this.getChildValue(m,"*","content",this.getChildValue(m,"*","summary",this.featureDescription)));var g=this.getChildValue(m,"*","link");if(!g){try{g=this.getElementsByTagNameNS(m,"*","link")[0].getAttribute("href")}catch(c){g=null}}var a=this.getChildValue(m,"*","id",null);var b={title:k,description:l,link:g};var o=new OpenLayers.Feature.Vector(f,b);o.fid=a;return o},getChildValue:function(f,b,c,k){var g;var a=this.getElementsByTagNameNS(f,b,c);if(a&&a[0]&&a[0].firstChild&&a[0].firstChild.nodeValue){g=a[0].firstChild.nodeValue}else{g=(k==undefined)?"":k}return g},read:function(g){if(typeof g=="string"){g=OpenLayers.Format.XML.prototype.read.apply(this,[g])}var a=null;a=this.getElementsByTagNameNS(g,"*","item");if(a.length==0){a=this.getElementsByTagNameNS(g,"*","entry")}var c=a.length;var f=new Array(c);for(var b=0;b<c;b++){f[b]=this.createFeatureFromItem(a[b])}return f},write:function(c){var f;if(c instanceof Array){f=this.createElementNS(this.rssns,"rss");for(var b=0,a=c.length;b<a;b++){f.appendChild(this.createFeatureXML(c[b]))}}else{f=this.createFeatureXML(c)}return OpenLayers.Format.XML.prototype.write.apply(this,[f])},createFeatureXML:function(p){var k=this.buildGeometryNode(p.geometry);var a=this.createElementNS(this.rssns,"item");var f=this.createElementNS(this.rssns,"title");f.appendChild(this.createTextNode(p.attributes.title?p.attributes.title:""));var b=this.createElementNS(this.rssns,"description");b.appendChild(this.createTextNode(p.attributes.description?p.attributes.description:""));a.appendChild(f);a.appendChild(b);if(p.attributes.link){var m=this.createElementNS(this.rssns,"link");m.appendChild(this.createTextNode(p.attributes.link));a.appendChild(m)}for(var o in p.attributes){if(o=="link"||o=="title"||o=="description"){continue}var l=this.createTextNode(p.attributes[o]);var g=o;if(o.search(":")!=-1){g=o.split(":")[1]}var c=this.createElementNS(this.featureNS,"feature:"+g);c.appendChild(l);a.appendChild(c)}a.appendChild(k);return a},buildGeometryNode:function(b){if(this.internalProjection&&this.externalProjection){b=b.clone();b.transform(this.internalProjection,this.externalProjection)}var a;if(b.CLASS_NAME=="OpenLayers.Geometry.Polygon"){a=this.createElementNS(this.georssns,"georss:polygon");a.appendChild(this.buildCoordinatesNode(b.components[0]))}else{if(b.CLASS_NAME=="OpenLayers.Geometry.LineString"){a=this.createElementNS(this.georssns,"georss:line");a.appendChild(this.buildCoordinatesNode(b))}else{if(b.CLASS_NAME=="OpenLayers.Geometry.Point"){a=this.createElementNS(this.georssns,"georss:point");a.appendChild(this.buildCoordinatesNode(b))}else{throw"Couldn't parse "+b.CLASS_NAME}}}return a},buildCoordinatesNode:function(k){var c=null;if(k.components){c=k.components}var g;if(c){var b=c.length;var f=new Array(b);for(var a=0;a<b;a++){f[a]=c[a].y+" "+c[a].x}g=f.join(" ")}else{g=k.y+" "+k.x}return this.createTextNode(g)},CLASS_NAME:"OpenLayers.Format.GeoRSS"});OpenLayers.Format.WFS=OpenLayers.Class(OpenLayers.Format.GML,{layer:null,wfsns:"http://www.opengis.net/wfs",ogcns:"http://www.opengis.net/ogc",initialize:function(a,b){OpenLayers.Format.GML.prototype.initialize.apply(this,[a]);this.layer=b;if(this.layer.featureNS){this.featureNS=this.layer.featureNS}if(this.layer.options.geometry_column){this.geometryName=this.layer.options.geometry_column}if(this.layer.options.typename){this.featureName=this.layer.options.typename}},write:function(b){var c=this.createElementNS(this.wfsns,"wfs:Transaction");c.setAttribute("version","1.0.0");c.setAttribute("service","WFS");for(var a=0;a<b.length;a++){switch(b[a].state){case OpenLayers.State.INSERT:c.appendChild(this.insert(b[a]));break;case OpenLayers.State.UPDATE:c.appendChild(this.update(b[a]));break;case OpenLayers.State.DELETE:c.appendChild(this.remove(b[a]));break}}return OpenLayers.Format.XML.prototype.write.apply(this,[c])},createFeatureXML:function(k){var c=this.buildGeometryNode(k.geometry);var l=this.createElementNS(this.featureNS,"feature:"+this.geometryName);l.appendChild(c);var b=this.createElementNS(this.featureNS,"feature:"+this.featureName);b.appendChild(l);for(var a in k.attributes){var m=this.createTextNode(k.attributes[a]);var f=a;if(a.search(":")!=-1){f=a.split(":")[1]}var g=this.createElementNS(this.featureNS,"feature:"+f);g.appendChild(m);b.appendChild(g)}return b},insert:function(b){var a=this.createElementNS(this.wfsns,"wfs:Insert");a.appendChild(this.createFeatureXML(b));return a},update:function(p){if(!p.fid){OpenLayers.Console.userError(OpenLayers.i18n("noFID"))}var k=this.createElementNS(this.wfsns,"wfs:Update");k.setAttribute("typeName",this.featurePrefix+":"+this.featureName);k.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var m=this.createElementNS(this.wfsns,"wfs:Property");var a=this.createElementNS(this.wfsns,"wfs:Name");var c=this.createTextNode(this.geometryName);a.appendChild(c);m.appendChild(a);var o=this.createElementNS(this.wfsns,"wfs:Value");var f=this.buildGeometryNode(p.geometry);if(p.layer){f.setAttribute("srsName",p.layer.projection.getCode())}o.appendChild(f);m.appendChild(o);k.appendChild(m);for(var g in p.attributes){m=this.createElementNS(this.wfsns,"wfs:Property");a=this.createElementNS(this.wfsns,"wfs:Name");a.appendChild(this.createTextNode(g));m.appendChild(a);o=this.createElementNS(this.wfsns,"wfs:Value");o.appendChild(this.createTextNode(p.attributes[g]));m.appendChild(o);k.appendChild(m)}var l=this.createElementNS(this.ogcns,"ogc:Filter");var b=this.createElementNS(this.ogcns,"ogc:FeatureId");b.setAttribute("fid",p.fid);l.appendChild(b);k.appendChild(l);return k},remove:function(b){if(!b.fid){OpenLayers.Console.userError(OpenLayers.i18n("noFID"));return false}var a=this.createElementNS(this.wfsns,"wfs:Delete");a.setAttribute("typeName",this.featurePrefix+":"+this.featureName);a.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var c=this.createElementNS(this.ogcns,"ogc:Filter");var f=this.createElementNS(this.ogcns,"ogc:FeatureId");f.setAttribute("fid",b.fid);c.appendChild(f);a.appendChild(c);return a},destroy:function(){this.layer=null},CLASS_NAME:"OpenLayers.Format.WFS"});OpenLayers.Format.WFSCapabilities=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:"1.1.0",version:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);this.options=a},read:function(g){if(typeof g=="string"){g=OpenLayers.Format.XML.prototype.read.apply(this,[g])}var c=g.documentElement;var b=this.version;if(!b){b=c.getAttribute("version");if(!b){b=this.defaultVersion}}var f=OpenLayers.Format.WFSCapabilities["v"+b.replace(/\./g,"_")];if(!f){throw"Can't find a WFS capabilities parser for version "+b}var k=new f(this.options);var a=k.read(g);a.version=b;return a},CLASS_NAME:"OpenLayers.Format.WFSCapabilities"});OpenLayers.Format.WFSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.WFSCapabilities,{initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);this.options=a},read:function(c){if(typeof c=="string"){c=OpenLayers.Format.XML.prototype.read.apply(this,[c])}var a={};var b=c.documentElement;this.runChildNodes(a,b);return a},runChildNodes:function(k,g){var c=g.childNodes;var b,f;for(var a=0;a<c.length;++a){b=c[a];if(b.nodeType==1){f=this["read_cap_"+b.nodeName];if(f){f.apply(this,[k,b])}}}},read_cap_FeatureTypeList:function(c,b){var a={featureTypes:[]};this.runChildNodes(a,b);c.featureTypeList=a},read_cap_FeatureType:function(a,f,b){var c={};this.runChildNodes(c,f);a.featureTypes.push(c)},read_cap_Name:function(c,b){var a=this.getChildValue(b);if(a){c.name=a}},read_cap_Title:function(b,a){var c=this.getChildValue(a);if(c){b.title=c}},read_cap_Abstract:function(c,b){var a=this.getChildValue(b);if(a){c["abstract"]=a}},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1"});OpenLayers.Format.WFSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{initialize:function(a){OpenLayers.Format.WFSCapabilities.v1.prototype.initialize.apply(this,[a])},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_0_0"});OpenLayers.Format.WFSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{initialize:function(a){OpenLayers.Format.WFSCapabilities.v1.prototype.initialize.apply(this,[a])},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_1_0"});OpenLayers.Format.WFSDescribeFeatureType=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xsd:"http://www.w3.org/2001/XMLSchema"},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},readers:{xsd:{schema:function(f,o){var g=[];var b={};var k={complexTypes:g,customTypes:b};this.readChildNodes(f,k);var l=f.attributes;var q,a;for(var m=0,p=l.length;m<p;++m){q=l[m];a=q.name;if(a.indexOf("xmlns")==0){this.setNamespace(a.split(":")[1]||"",q.value)}else{o[a]=q.value}}o.featureTypes=g;o.targetPrefix=this.namespaceAlias[o.targetNamespace];var r,c;for(var m=0,p=g.length;m<p;++m){r=g[m];c=b[r.typeName];if(b[r.typeName]){r.typeName=c.name}}},complexType:function(b,c){var a={typeName:b.getAttribute("name")};this.readChildNodes(b,a);c.complexTypes.push(a)},complexContent:function(a,b){this.readChildNodes(a,b)},extension:function(a,b){this.readChildNodes(a,b)},sequence:function(a,b){var c={elements:[]};this.readChildNodes(a,c);b.properties=c.elements},element:function(a,c){if(c.elements){var f={};var b=a.attributes;var l;for(var g=0,k=b.length;g<k;++g){l=b[g];f[l.name]=l.value}var m=f.type;if(!m){m={};this.readChildNodes(a,m);f.restriction=m;f.type=m.base}var p=m.base||m;f.localType=p.split(":").pop();c.elements.push(f)}if(c.complexTypes){var m=a.getAttribute("type");var o=m.split(":").pop();c.customTypes[o]={name:a.getAttribute("name"),type:m}}},simpleType:function(a,b){this.readChildNodes(a,b)},restriction:function(a,b){b.base=a.getAttribute("base");this.readRestriction(a,b)}}},readRestriction:function(f,k){var c=f.childNodes;var m,l,g;for(var b=0,a=c.length;b<a;++b){m=c[b];if(m.nodeType==1){l=m.nodeName.split(":").pop();g=m.getAttribute("value");if(!k[l]){k[l]=g}else{if(typeof k[l]=="string"){k[l]=[k[l]]}k[l].push(g)}}}},read:function(b){if(typeof b=="string"){b=OpenLayers.Format.XML.prototype.read.apply(this,[b])}if(b&&b.nodeType==9){b=b.documentElement}var a={};this.readNode(b,a);return a},CLASS_NAME:"OpenLayers.Format.WFSDescribeFeatureType"});OpenLayers.Format.WMSDescribeLayer=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:"1.1.1",version:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);this.options=a},read:function(g){if(typeof g=="string"){g=OpenLayers.Format.XML.prototype.read.apply(this,[g])}var c=g.documentElement;var b=this.version;if(!b){b=c.getAttribute("version");if(!b){b=this.defaultVersion}}if(b=="1.1.1"||b=="1.1.0"){b="1.1"}var f=OpenLayers.Format.WMSDescribeLayer["v"+b.replace(/\./g,"_")];if(!f){throw"Can't find a WMS DescribeLayer parser for version "+b}var k=new f(this.options);var a=k.read(g);a.version=b;return a},CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer"});OpenLayers.Format.WMSDescribeLayer.v1_1=OpenLayers.Class(OpenLayers.Format.WMSDescribeLayer,{initialize:function(a){OpenLayers.Format.WMSDescribeLayer.prototype.initialize.apply(this,[a])},read:function(l){if(typeof l=="string"){l=OpenLayers.Format.XML.prototype.read.apply(this,[l])}var b=l.documentElement;var g=b.childNodes;var a=[];for(var f=0;f<g.length;++f){childNode=g[f];nodeName=childNode.nodeName;if(nodeName=="LayerDescription"){var m="";var k="";var c="";if(childNode.getAttribute("owsType")){m=childNode.getAttribute("owsType");k=childNode.getAttribute("owsURL")}else{if(childNode.getAttribute("wfs")!=""){m="WFS";k=childNode.getAttribute("wfs")}else{if(childNode.getAttribute("wcs")!=""){m="WCS";k=childNode.getAttribute("wcs")}}}query=childNode.getElementsByTagName("Query");if(query.length>0){c=query[0].getAttribute("typeName");if(!c){c=query[0].getAttribute("typename")}}a.push({owsType:m,owsURL:k,typeName:c})}}return a},CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer.v1_1"});OpenLayers.Format.WKT=OpenLayers.Class(OpenLayers.Format,{initialize:function(a){this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/};OpenLayers.Format.prototype.initialize.apply(this,[a])},read:function(k){var g,f,m;var l=this.regExes.typeStr.exec(k);if(l){f=l[1].toLowerCase();m=l[2];if(this.parse[f]){g=this.parse[f].apply(this,[m])}if(this.internalProjection&&this.externalProjection){if(g&&g.CLASS_NAME=="OpenLayers.Feature.Vector"){g.geometry.transform(this.externalProjection,this.internalProjection)}else{if(g&&f!="geometrycollection"&&typeof g=="object"){for(var c=0,a=g.length;c<a;c++){var b=g[c];b.geometry.transform(this.externalProjection,this.internalProjection)}}}}}return g},write:function(a){var k,o,m,f,b;if(a.constructor==Array){k=a;b=true}else{k=[a];b=false}var c=[];if(b){c.push("GEOMETRYCOLLECTION(")}for(var g=0,l=k.length;g<l;++g){if(b&&g>0){c.push(",")}o=k[g].geometry;m=o.CLASS_NAME.split(".")[2].toLowerCase();if(!this.extract[m]){return null}if(this.internalProjection&&this.externalProjection){o=o.clone();o.transform(this.internalProjection,this.externalProjection)}f=this.extract[m].apply(this,[o]);c.push(m.toUpperCase()+"("+f+")")}if(b){c.push(")")}return c.join("")},extract:{point:function(a){return a.x+" "+a.y},multipoint:function(c){var f=[];for(var b=0,a=c.components.length;b<a;++b){f.push(this.extract.point.apply(this,[c.components[b]]))}return f.join(",")},linestring:function(b){var f=[];for(var c=0,a=b.components.length;c<a;++c){f.push(this.extract.point.apply(this,[b.components[c]]))}return f.join(",")},multilinestring:function(c){var f=[];for(var b=0,a=c.components.length;b<a;++b){f.push("("+this.extract.linestring.apply(this,[c.components[b]])+")")}return f.join(",")},polygon:function(c){var f=[];for(var b=0,a=c.components.length;b<a;++b){f.push("("+this.extract.linestring.apply(this,[c.components[b]])+")")}return f.join(",")},multipolygon:function(f){var c=[];for(var b=0,a=f.components.length;b<a;++b){c.push("("+this.extract.polygon.apply(this,[f.components[b]])+")")}return c.join(",")}},parse:{point:function(b){var a=OpenLayers.String.trim(b).split(this.regExes.spaces);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(a[0],a[1]))},multipoint:function(g){var c=OpenLayers.String.trim(g).split(",");var f=[];for(var b=0,a=c.length;b<a;++b){f.push(this.parse.point.apply(this,[c[b]]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPoint(f))},linestring:function(g){var c=OpenLayers.String.trim(g).split(",");var f=[];for(var b=0,a=c.length;b<a;++b){f.push(this.parse.point.apply(this,[c[b]]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(f))},multilinestring:function(k){var c;var b=OpenLayers.String.trim(k).split(this.regExes.parenComma);var g=[];for(var f=0,a=b.length;f<a;++f){c=b[f].replace(this.regExes.trimParens,"$1");g.push(this.parse.linestring.apply(this,[c]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiLineString(g))},polygon:function(m){var c,b,k;var l=OpenLayers.String.trim(m).split(this.regExes.parenComma);var g=[];for(var f=0,a=l.length;f<a;++f){c=l[f].replace(this.regExes.trimParens,"$1");b=this.parse.linestring.apply(this,[c]).geometry;k=new OpenLayers.Geometry.LinearRing(b.components);g.push(k)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(g))},multipolygon:function(k){var f;var b=OpenLayers.String.trim(k).split(this.regExes.doubleParenComma);var g=[];for(var c=0,a=b.length;c<a;++c){f=b[c].replace(this.regExes.trimParens,"$1");g.push(this.parse.polygon.apply(this,[f]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(g))},geometrycollection:function(g){g=g.replace(/,\s*([A-Za-z])/g,"|$1");var f=OpenLayers.String.trim(g).split("|");var c=[];for(var b=0,a=f.length;b<a;++b){c.push(OpenLayers.Format.WKT.prototype.read.apply(this,[f[b]]))}return c}},CLASS_NAME:"OpenLayers.Format.WKT"});OpenLayers.Format.OSM=OpenLayers.Class(OpenLayers.Format.XML,{checkTags:false,interestingTagsExclude:null,areaTags:null,initialize:function(a){var f={interestingTagsExclude:["source","source_ref","source:ref","history","attribution","created_by"],areaTags:["area","building","leisure","tourism","ruins","historic","landuse","military","natural","sport"]};f=OpenLayers.Util.extend(f,a);var g={};for(var b=0;b<f.interestingTagsExclude.length;b++){g[f.interestingTagsExclude[b]]=true}f.interestingTagsExclude=g;var c={};for(var b=0;b<f.areaTags.length;b++){c[f.areaTags[b]]=true}f.areaTags=c;OpenLayers.Format.XML.prototype.initialize.apply(this,[f])},read:function(r){if(typeof r=="string"){r=OpenLayers.Format.XML.prototype.read.apply(this,[r])}var b=this.getNodes(r);var u=this.getWays(r);var l=new Array(u.length);for(var k=0;k<u.length;k++){var p=new Array(u[k].nodes.length);var a=this.isWayArea(u[k])?1:0;for(var g=0;g<u[k].nodes.length;g++){var c=b[u[k].nodes[g]];var q=new OpenLayers.Geometry.Point(c.lon,c.lat);q.osm_id=parseInt(u[k].nodes[g]);p[g]=q;c.used=true}var o=null;if(a){o=new OpenLayers.Geometry.Polygon(new OpenLayers.Geometry.LinearRing(p))}else{o=new OpenLayers.Geometry.LineString(p)}if(this.internalProjection&&this.externalProjection){o.transform(this.externalProjection,this.internalProjection)}var m=new OpenLayers.Feature.Vector(o,u[k].tags);m.osm_id=parseInt(u[k].id);m.fid="way."+m.osm_id;l[k]=m}for(var f in b){var c=b[f];if(!c.used||this.checkTags){var A=null;if(this.checkTags){var v=this.getTags(c.node,true);if(c.used&&!v[1]){continue}A=v[0]}else{A=this.getTags(c.node)}var m=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(c.lon,c.lat),A);if(this.internalProjection&&this.externalProjection){m.geometry.transform(this.externalProjection,this.internalProjection)}m.osm_id=parseInt(f);m.fid="node."+m.osm_id;l.push(m)}c.node=null}return l},getNodes:function(g){var f=g.getElementsByTagName("node");var a={};for(var b=0;b<f.length;b++){var c=f[b];var k=c.getAttribute("id");a[k]={lat:c.getAttribute("lat"),lon:c.getAttribute("lon"),node:c}}return a},getWays:function(l){var k=l.getElementsByTagName("way");var m=[];for(var f=0;f<k.length;f++){var b=k[f];var c={id:b.getAttribute("id")};c.tags=this.getTags(b);var g=b.getElementsByTagName("nd");c.nodes=new Array(g.length);for(var a=0;a<g.length;a++){c.nodes[a]=g[a].getAttribute("ref")}m.push(c)}return m},getTags:function(g,l){var a=g.getElementsByTagName("tag");var c={};var k=false;for(var b=0;b<a.length;b++){var f=a[b].getAttribute("k");c[f]=a[b].getAttribute("v");if(l){if(!this.interestingTagsExclude[f]){k=true}}}return l?[c,k]:c},isWayArea:function(b){var a=false;var f=false;if(b.nodes[0]==b.nodes[b.nodes.length-1]){a=true}if(this.checkTags){for(var c in b.tags){if(this.areaTags[c]){f=true;break}}}return a&&(this.checkTags?f:true)},write:function(f){if(!(f instanceof Array)){f=[f]}this.osm_id=1;this.created_nodes={};var g=this.createElementNS(null,"osm");g.setAttribute("version","0.5");g.setAttribute("generator","OpenLayers "+OpenLayers.VERSION_NUMBER);for(var c=f.length-1;c>=0;c--){var a=this.createFeatureNodes(f[c]);for(var b=0;b<a.length;b++){g.appendChild(a[b])}}return OpenLayers.Format.XML.prototype.write.apply(this,[g])},createFeatureNodes:function(c){var b=[];var g=c.geometry.CLASS_NAME;var f=g.substring(g.lastIndexOf(".")+1);f=f.toLowerCase();var a=this.createXML[f];if(a){b=a.apply(this,[c])}return b},createXML:{point:function(a){var g=null;var c=a.geometry?a.geometry:a;var f=false;if(a.osm_id){g=a.osm_id;if(this.created_nodes[g]){f=true}}else{g=-this.osm_id;this.osm_id++}if(f){b=this.created_nodes[g]}else{var b=this.createElementNS(null,"node")}this.created_nodes[g]=b;b.setAttribute("id",g);b.setAttribute("lon",c.x);b.setAttribute("lat",c.y);if(a.attributes){this.serializeTags(a,b)}this.setState(a,b);return f?[]:[b]},linestring:function(f){var a=[];var m=f.geometry;if(f.osm_id){id=f.osm_id}else{id=-this.osm_id;this.osm_id++}var b=this.createElementNS(null,"way");b.setAttribute("id",id);for(var c=0;c<m.components.length;c++){var k=this.createXML.point.apply(this,[m.components[c]]);if(k.length){k=k[0];var g=k.getAttribute("id");a.push(k)}else{g=m.components[c].osm_id;k=this.created_nodes[g]}this.setState(f,k);var l=this.createElementNS(null,"nd");l.setAttribute("ref",g);b.appendChild(l)}this.serializeTags(f,b);a.push(b);return a},polygon:function(b){var a=OpenLayers.Util.extend({area:"yes"},b.attributes);var c=new OpenLayers.Feature.Vector(b.geometry.components[0],a);c.osm_id=b.osm_id;return this.createXML.linestring.apply(this,[c])}},serializeTags:function(c,f){for(var b in c.attributes){var a=this.createElementNS(null,"tag");a.setAttribute("k",b);a.setAttribute("v",c.attributes[b]);f.appendChild(a)}},setState:function(a,b){if(a.state){var c=null;switch(a.state){case OpenLayers.State.UPDATE:c="modify";case OpenLayers.State.DELETE:c="delete"}if(c){b.setAttribute("action",c)}}},CLASS_NAME:"OpenLayers.Format.OSM"});OpenLayers.Format.GPX=OpenLayers.Class(OpenLayers.Format.XML,{extractWaypoints:true,extractTracks:true,extractRoutes:true,extractAttributes:true,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(H){if(typeof H=="string"){H=OpenLayers.Format.XML.prototype.read.apply(this,[H])}var c=[];if(this.extractTracks){var D=H.getElementsByTagName("trk");for(var C=0,E=D.length;C<E;C++){var r={};if(this.extractAttributes){r=this.parseAttributes(D[C])}var p=this.getElementsByTagNameNS(D[C],D[C].namespaceURI,"trkseg");for(var B=0,o=p.length;B<o;B++){var q=this.extractSegment(p[B],"trkpt");c.push(new OpenLayers.Feature.Vector(q,r))}}}if(this.extractRoutes){var a=H.getElementsByTagName("rte");for(var A=0,v=a.length;A<v;A++){var r={};if(this.extractAttributes){r=this.parseAttributes(a[A])}var G=this.extractSegment(a[A],"rtept");c.push(new OpenLayers.Feature.Vector(G,r))}}if(this.extractWaypoints){var b=H.getElementsByTagName("wpt");for(var u=0,E=b.length;u<E;u++){var r={};if(this.extractAttributes){r=this.parseAttributes(b[u])}var m=new OpenLayers.Geometry.Point(b[u].getAttribute("lon"),b[u].getAttribute("lat"));c.push(new OpenLayers.Feature.Vector(m,r))}}if(this.internalProjection&&this.externalProjection){for(var F=0,f=c.length;F<f;F++){c[F].geometry.transform(this.externalProjection,this.internalProjection)}}return c},extractSegment:function(g,k){var f=this.getElementsByTagNameNS(g,g.namespaceURI,k);var b=[];for(var c=0,a=f.length;c<a;c++){b.push(new OpenLayers.Geometry.Point(f[c].getAttribute("lon"),f[c].getAttribute("lat")))}return new OpenLayers.Geometry.LineString(b)},parseAttributes:function(b){var a={};var f=b.firstChild;while(f){if(f.nodeType==1){var c=f.firstChild;if(c.nodeType==3||c.nodeType==4){name=(f.prefix)?f.nodeName.split(":")[1]:f.nodeName;if(name!="trkseg"&&name!="rtept"){a[name]=c.nodeValue}}}f=f.nextSibling}return a},CLASS_NAME:"OpenLayers.Format.GPX"});OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:"1.0.0",version:null,parser:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},write:function(c,b){var a=(b&&b.version)||this.version||this.defaultVersion;if(!this.parser||this.parser.VERSION!=a){var f=OpenLayers.Format.Filter["v"+a.replace(/\./g,"_")];if(!f){throw"Can't find a Filter parser for version "+a}this.parser=new f(this.options)}return this.parser.write(c)},read:function(c){if(typeof c=="string"){c=OpenLayers.Format.XML.prototype.read.apply(this,[c])}var a=this.version;if(!a){a=this.defaultVersion}if(!this.parser||this.parser.VERSION!=a){var f=OpenLayers.Format.Filter["v"+a.replace(/\./g,"_")];if(!f){throw"Can't find a Filter parser for version "+a}this.parser=new f(this.options)}var b=this.parser.read(c);return b},CLASS_NAME:"OpenLayers.Format.Filter"});OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){var b={};this.readers.ogc.Filter.apply(this,[a,b]);return b.filter},readers:{ogc:{Filter:function(b,a){var c={fids:[],filters:[]};this.readChildNodes(b,c);if(c.fids.length>0){a.filter=new OpenLayers.Filter.FeatureId({fids:c.fids})}else{if(c.filters.length>0){a.filter=c.filters[0]}}},FeatureId:function(a,b){var c=a.getAttribute("fid");if(c){b.fids.push(c)}},And:function(b,c){var a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});this.readChildNodes(b,a);c.filters.push(a)},Or:function(b,c){var a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});this.readChildNodes(b,a);c.filters.push(a)},Not:function(b,c){var a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});this.readChildNodes(b,a);c.filters.push(a)},PropertyIsLessThan:function(b,c){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});this.readChildNodes(b,a);c.filters.push(a)},PropertyIsGreaterThan:function(b,c){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});this.readChildNodes(b,a);c.filters.push(a)},PropertyIsLessThanOrEqualTo:function(b,c){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(b,a);c.filters.push(a)},PropertyIsGreaterThanOrEqualTo:function(b,c){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(b,a);c.filters.push(a)},PropertyIsBetween:function(b,c){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});this.readChildNodes(b,a);c.filters.push(a)},PropertyIsLike:function(f,g){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(f,c);var k=f.getAttribute("wildCard");var b=f.getAttribute("singleChar");var a=f.getAttribute("escape");c.value2regex(k,b,a);g.filters.push(c)},Literal:function(a,b){b.value=OpenLayers.String.numericIf(this.getChildValue(a))},PropertyName:function(b,a){a.property=this.getChildValue(b)},LowerBoundary:function(b,a){a.lowerBoundary=OpenLayers.String.numericIf(this.readOgcExpression(b))},UpperBoundary:function(b,a){a.upperBoundary=OpenLayers.String.numericIf(this.readOgcExpression(b))},Intersects:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.INTERSECTS)},Within:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.WITHIN)},Contains:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.CONTAINS)},DWithin:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.DWITHIN)},Distance:function(a,b){b.distance=parseInt(this.getChildValue(a));b.distanceUnits=a.getAttribute("units")}}},readSpatial:function(c,f,b){var a=new OpenLayers.Filter.Spatial({type:b});this.readChildNodes(c,a);a.value=a.components[0];delete a.components;f.filters.push(a)},readOgcExpression:function(a){var c={};this.readChildNodes(a,c);var b=c.value;if(!b){b=this.getChildValue(a)}return b},write:function(a){return this.writers.ogc.Filter.apply(this,[a])},writers:{ogc:{Filter:function(c){var f=this.createElementNSPlus("ogc:Filter");var b=c.CLASS_NAME.split(".").pop();if(b=="FeatureId"){for(var a=0;a<c.fids.length;++a){this.writeNode("FeatureId",c.fids[a],f)}}else{this.writeNode(this.getFilterType(c),c,f)}return f},FeatureId:function(a){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:a}})},And:function(c){var f=this.createElementNSPlus("ogc:And");var b;for(var a=0;a<c.filters.length;++a){b=c.filters[a];this.writeNode(this.getFilterType(b),b,f)}return f},Or:function(c){var f=this.createElementNSPlus("ogc:Or");var b;for(var a=0;a<c.filters.length;++a){b=c.filters[a];this.writeNode(this.getFilterType(b),b,f)}return f},Not:function(b){var c=this.createElementNSPlus("ogc:Not");var a=b.filters[0];this.writeNode(this.getFilterType(a),a,c);return c},PropertyIsLessThan:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLessThan");this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b},PropertyIsGreaterThan:function(a){var b=this.createElementNSPlus("ogc:PropertyIsGreaterThan");this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b},PropertyIsLessThanOrEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b},PropertyIsGreaterThanOrEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b},PropertyIsBetween:function(a){var b=this.createElementNSPlus("ogc:PropertyIsBetween");this.writeNode("PropertyName",a,b);this.writeNode("LowerBoundary",a,b);this.writeNode("UpperBoundary",a,b);return b},PropertyIsLike:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.regex2value(),b);return b},PropertyName:function(a){return this.createElementNSPlus("ogc:PropertyName",{value:a.property})},Literal:function(a){return this.createElementNSPlus("ogc:Literal",{value:a})},LowerBoundary:function(a){var b=this.createElementNSPlus("ogc:LowerBoundary");this.writeNode("Literal",a.lowerBoundary,b);return b},UpperBoundary:function(a){var b=this.createElementNSPlus("ogc:UpperBoundary");this.writeNode("Literal",a.upperBoundary,b);return b},INTERSECTS:function(a){return this.writeSpatial(a,"Intersects")},WITHIN:function(a){return this.writeSpatial(a,"Within")},CONTAINS:function(a){return this.writeSpatial(a,"Contains")},DWITHIN:function(a){var b=this.writeSpatial(a,"DWithin");this.writeNode("Distance",a,b);return b},Distance:function(a){return this.createElementNSPlus("ogc:Distance",{attributes:{units:a.distanceUnits},value:a.distance})}}},getFilterType:function(a){var b=this.filterMap[a.type];if(!b){throw"Filter writing not supported for rule type: "+a.type}return b},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS"},CLASS_NAME:"OpenLayers.Format.Filter.v1"});OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(a){OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[a])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(b,c){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});this.readChildNodes(b,a);c.filters.push(a)},PropertyIsNotEqualTo:function(b,c){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(b,a);c.filters.push(a)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsEqualTo");this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b},PropertyIsNotEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b},BBOX:function(a){var c=this.createElementNSPlus("ogc:BBOX");this.writeNode("PropertyName",a,c);var b=this.writeNode("gml:Box",a.value,c);if(a.projection){b.setAttribute("srsName",a.projection)}return c}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},writeSpatial:function(b,a){var c=this.createElementNSPlus("ogc:"+a);this.writeNode("PropertyName",b,c);var f;if(b.value instanceof OpenLayers.Geometry){f=this.writeNode("feature:_geometry",b.value).firstChild}else{f=this.writeNode("gml:Box",b.value)}if(b.projection){f.setAttribute("srsName",b.projection)}c.appendChild(f);return c},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"});OpenLayers.Format.Filter.v1_1_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(a){OpenLayers.Format.GML.v3.prototype.initialize.apply(this,[a])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(b,f){var c=b.getAttribute("matchCase");var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,matchCase:!(c==="false"||c==="0")});this.readChildNodes(b,a);f.filters.push(a)},PropertyIsNotEqualTo:function(b,f){var c=b.getAttribute("matchCase");var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,matchCase:!(c==="false"||c==="0")});this.readChildNodes(b,a);f.filters.push(a)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:a.matchCase}});this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b},PropertyIsNotEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",{attributes:{matchCase:a.matchCase}});this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b},BBOX:function(a){var c=this.createElementNSPlus("ogc:BBOX");this.writeNode("PropertyName",a,c);var b=this.writeNode("gml:Envelope",a.value);if(a.projection){b.setAttribute("srsName",a.projection)}c.appendChild(b);return c}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature},writeSpatial:function(b,a){var c=this.createElementNSPlus("ogc:"+a);this.writeNode("PropertyName",b,c);var f;if(b.value instanceof OpenLayers.Geometry){f=this.writeNode("feature:_geometry",b.value).firstChild}else{f=this.writeNode("gml:Envelope",b.value)}if(b.projection){f.setAttribute("srsName",b.projection)}c.appendChild(f);return c},CLASS_NAME:"OpenLayers.Format.Filter.v1_1_0"});OpenLayers.Format.SLD=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:"1.0.0",version:null,namedLayersAsArray:false,parser:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},write:function(f,c){var b=(c&&c.version)||this.version||this.defaultVersion;if(!this.parser||this.parser.VERSION!=b){var g=OpenLayers.Format.SLD["v"+b.replace(/\./g,"_")];if(!g){throw"Can't find a SLD parser for version "+b}this.parser=new g(this.options)}var a=this.parser.write(f);return OpenLayers.Format.XML.prototype.write.apply(this,[a])},read:function(g,c){if(typeof g=="string"){g=OpenLayers.Format.XML.prototype.read.apply(this,[g])}var b=g.documentElement;var a=this.version;if(!a){a=b.getAttribute("version");if(!a){a=this.defaultVersion}}if(!this.parser||this.parser.VERSION!=a){var k=OpenLayers.Format.SLD["v"+a.replace(/\./g,"_")];if(!k){throw"Can't find a SLD parser for version "+a}this.parser=new k(this.options)}var f=this.parser.read(g,c);return f},CLASS_NAME:"OpenLayers.Format.SLD"});OpenLayers.Format.SLD.v1=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,{namespaces:{sld:"http://www.opengis.net/sld",ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"sld",schemaLocation:null,defaultSymbolizer:{fillColor:"#808080",fillOpacity:1,strokeColor:"#000000",strokeOpacity:1,strokeWidth:1,strokeDashstyle:"solid",pointRadius:3,graphicName:"square"},initialize:function(a){OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[a])},read:function(c,a){a=OpenLayers.Util.applyDefaults(a,this.options);var b={namedLayers:a.namedLayersAsArray===true?[]:{}};this.readChildNodes(c,b);return b},readers:OpenLayers.Util.applyDefaults({sld:{StyledLayerDescriptor:function(a,b){b.version=a.getAttribute("version");this.readChildNodes(a,b)},Name:function(a,b){b.name=this.getChildValue(a)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b.description=this.getChildValue(a)},NamedLayer:function(f,g){var c={userStyles:[],namedStyles:[]};this.readChildNodes(f,c);for(var b=0,a=c.userStyles.length;b<a;++b){c.userStyles[b].layerName=c.name}if(g.namedLayers instanceof Array){g.namedLayers.push(c)}else{g.namedLayers[c.name]=c}},NamedStyle:function(b,a){a.namedStyles.push(this.getChildName(b.firstChild))},UserStyle:function(c,a){var f={defaultsPerSymbolizer:true,rules:[]};this.readChildNodes(c,f);var b=new OpenLayers.Style(this.defaultSymbolizer,f);a.userStyles.push(b)},IsDefault:function(b,a){if(this.getChildValue(b)=="1"){a.isDefault=true}},FeatureTypeStyle:function(b,a){var c={rules:[]};this.readChildNodes(b,c);a.rules=c.rules},Rule:function(a,c){var b=new OpenLayers.Rule();this.readChildNodes(a,b);c.rules.push(b)},ElseFilter:function(a,b){b.elseFilter=true},MinScaleDenominator:function(a,b){b.minScaleDenominator=parseFloat(this.getChildValue(a))},MaxScaleDenominator:function(a,b){b.maxScaleDenominator=parseFloat(this.getChildValue(a))},TextSymbolizer:function(b,c){var a=c.symbolizer.Text||{};this.readChildNodes(b,a);c.symbolizer.Text=a},Label:function(b,a){var f={};this.readChildNodes(b,f);if(f.property){a.label="${"+f.property+"}"}else{var c=this.readOgcExpression(b);if(c){a.label=c}}},Font:function(b,a){this.readChildNodes(b,a)},Halo:function(b,a){var c={};this.readChildNodes(b,c);a.haloRadius=c.haloRadius;a.haloColor=c.fillColor;a.haloOpacity=c.fillOpacity},Radius:function(c,b){var a=this.readOgcExpression(c);if(a!=null){b.haloRadius=a}},LineSymbolizer:function(b,c){var a=c.symbolizer.Line||{};this.readChildNodes(b,a);c.symbolizer.Line=a},PolygonSymbolizer:function(b,c){var a=c.symbolizer.Polygon||{};this.readChildNodes(b,a);c.symbolizer.Polygon=a},PointSymbolizer:function(b,c){var a=c.symbolizer.Point||{};this.readChildNodes(b,a);c.symbolizer.Point=a},Stroke:function(b,a){a.stroke=true;this.readChildNodes(b,a)},Fill:function(b,a){a.fill=true;this.readChildNodes(b,a)},CssParameter:function(c,b){var a=c.getAttribute("name");var g=this.cssMap[a];if(g){var f=this.readOgcExpression(c);if(f){b[g]=f}}},Graphic:function(g,f){f.graphic=true;var m={};this.readChildNodes(g,m);var c=["strokeColor","strokeWidth","strokeOpacity","strokeLinecap","fillColor","fillOpacity","graphicName","rotation","graphicFormat"];var l,k;for(var b=0,a=c.length;b<a;++b){l=c[b];k=m[l];if(k!=undefined){f[l]=k}}if(m.opacity!=undefined){f.graphicOpacity=m.opacity}if(m.size!=undefined){f.pointRadius=m.size/2}if(m.href!=undefined){f.externalGraphic=m.href}if(m.rotation!=undefined){f.rotation=m.rotation}},ExternalGraphic:function(a,b){this.readChildNodes(a,b)},Mark:function(a,b){this.readChildNodes(a,b)},WellKnownName:function(a,b){b.graphicName=this.getChildValue(a)},Opacity:function(b,c){var a=this.readOgcExpression(b);if(a){c.opacity=a}},Size:function(b,c){var a=this.readOgcExpression(b);if(a){c.size=a}},Rotation:function(b,c){var a=this.readOgcExpression(b);if(a){c.rotation=a}},OnlineResource:function(a,b){b.href=this.getAttributeNS(a,this.namespaces.xlink,"href")},Format:function(a,b){b.graphicFormat=this.getChildValue(a)}}},OpenLayers.Format.Filter.v1_0_0.prototype.readers),cssMap:{stroke:"strokeColor","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","stroke-linecap":"strokeLinecap","stroke-dasharray":"strokeDashstyle",fill:"fillColor","fill-opacity":"fillOpacity","font-family":"fontFamily","font-size":"fontSize","font-weight":"fontWeight","font-style":"fontStyle"},getCssProperty:function(a){var b=null;for(var c in this.cssMap){if(this.cssMap[c]==a){b=c;break}}return b},getGraphicFormat:function(a){var f,c;for(var b in this.graphicFormats){if(this.graphicFormats[b].test(a)){f=b;break}}return f||this.defautlGraphicFormat},defaultGraphicFormat:"image/png",graphicFormats:{"image/jpeg":/\.jpe?g$/i,"image/gif":/\.gif$/i,"image/png":/\.png$/i},write:function(a){return this.writers.sld.StyledLayerDescriptor.apply(this,[a])},writers:OpenLayers.Util.applyDefaults({sld:{StyledLayerDescriptor:function(g){var b=this.createElementNSPlus("StyledLayerDescriptor",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});if(g.name){this.writeNode("Name",g.name,b)}if(g.title){this.writeNode("Title",g.title,b)}if(g.description){this.writeNode("Abstract",g.description,b)}if(g.namedLayers instanceof Array){for(var f=0,a=g.namedLayers.length;f<a;++f){this.writeNode("NamedLayer",g.namedLayers[f],b)}}else{for(var c in g.namedLayers){this.writeNode("NamedLayer",g.namedLayers[c],b)}}return b},Name:function(a){return this.createElementNSPlus("Name",{value:a})},Title:function(a){return this.createElementNSPlus("Title",{value:a})},Abstract:function(a){return this.createElementNSPlus("Abstract",{value:a})},NamedLayer:function(c){var f=this.createElementNSPlus("NamedLayer");this.writeNode("Name",c.name,f);if(c.namedStyles){for(var b=0,a=c.namedStyles.length;b<a;++b){this.writeNode("NamedStyle",c.namedStyles[b],f)}}if(c.userStyles){for(var b=0,a=c.userStyles.length;b<a;++b){this.writeNode("UserStyle",c.userStyles[b],f)}}return f},NamedStyle:function(a){var b=this.createElementNSPlus("NamedStyle");this.writeNode("Name",a,b);return b},UserStyle:function(a){var b=this.createElementNSPlus("UserStyle");if(a.name){this.writeNode("Name",a.name,b)}if(a.title){this.writeNode("Title",a.title,b)}if(a.description){this.writeNode("Abstract",a.description,b)}if(a.isDefault){this.writeNode("IsDefault",a.isDefault,b)}this.writeNode("FeatureTypeStyle",a,b);return b},IsDefault:function(a){return this.createElementNSPlus("IsDefault",{value:(a)?"1":"0"})},FeatureTypeStyle:function(c){var f=this.createElementNSPlus("FeatureTypeStyle");for(var b=0,a=c.rules.length;b<a;++b){this.writeNode("Rule",c.rules[b],f)}return f},Rule:function(l){var k=this.createElementNSPlus("Rule");if(l.name){this.writeNode("Name",l.name,k)}if(l.title){this.writeNode("Title",l.title,k)}if(l.description){this.writeNode("Abstract",l.description,k)}if(l.elseFilter){this.writeNode("ElseFilter",null,k)}else{if(l.filter){this.writeNode("ogc:Filter",l.filter,k)}}if(l.minScaleDenominator!=undefined){this.writeNode("MinScaleDenominator",l.minScaleDenominator,k)}if(l.maxScaleDenominator!=undefined){this.writeNode("MaxScaleDenominator",l.maxScaleDenominator,k)}var c=OpenLayers.Style.SYMBOLIZER_PREFIXES;var g,f;for(var b=0,a=c.length;b<a;++b){g=c[b];f=l.symbolizer[g];if(f){this.writeNode(g+"Symbolizer",f,k)}}return k},ElseFilter:function(){return this.createElementNSPlus("ElseFilter")},MinScaleDenominator:function(a){return this.createElementNSPlus("MinScaleDenominator",{value:a})},MaxScaleDenominator:function(a){return this.createElementNSPlus("MaxScaleDenominator",{value:a})},LineSymbolizer:function(a){var b=this.createElementNSPlus("LineSymbolizer");this.writeNode("Stroke",a,b);return b},Stroke:function(a){var b=this.createElementNSPlus("Stroke");if(a.strokeColor!=undefined){this.writeNode("CssParameter",{symbolizer:a,key:"strokeColor"},b)}if(a.strokeOpacity!=undefined){this.writeNode("CssParameter",{symbolizer:a,key:"strokeOpacity"},b)}if(a.strokeWidth!=undefined){this.writeNode("CssParameter",{symbolizer:a,key:"strokeWidth"},b)}return b},CssParameter:function(a){return this.createElementNSPlus("CssParameter",{attributes:{name:this.getCssProperty(a.key)},value:a.symbolizer[a.key]})},TextSymbolizer:function(a){var b=this.createElementNSPlus("TextSymbolizer");if(a.label!=null){this.writeNode("Label",a.label,b)}if(a.fontFamily!=null||a.fontSize!=null||a.fontWeight!=null||a.fontStyle!=null){this.writeNode("Font",a,b)}if(a.haloRadius!=null||a.haloColor!=null||a.haloOpacity!=null){this.writeNode("Halo",a,b)}if(a.fillColor!=null||a.fillOpacity!=null){this.writeNode("Fill",a,b)}return b},Font:function(a){var b=this.createElementNSPlus("Font");if(a.fontFamily){this.writeNode("CssParameter",{symbolizer:a,key:"fontFamily"},b)}if(a.fontSize){this.writeNode("CssParameter",{symbolizer:a,key:"fontSize"},b)}if(a.fontWeight){this.writeNode("CssParameter",{symbolizer:a,key:"fontWeight"},b)}if(a.fontStyle){this.writeNode("CssParameter",{symbolizer:a,key:"fontStyle"},b)}return b},Label:function(b){var k=this.createElementNSPlus("Label");var l=b.split("${");k.appendChild(this.createTextNode(l[0]));var g,f;for(var c=1,a=l.length;c<a;c++){g=l[c];f=g.indexOf("}");if(f>0){this.writeNode("ogc:PropertyName",{property:g.substring(0,f)},k);k.appendChild(this.createTextNode(g.substring(++f)))}else{k.appendChild(this.createTextNode("${"+g))}}return k},Halo:function(a){var b=this.createElementNSPlus("Halo");if(a.haloRadius){this.writeNode("Radius",a.haloRadius,b)}if(a.haloColor||a.haloOpacity){this.writeNode("Fill",{fillColor:a.haloColor,fillOpacity:a.haloOpacity},b)}return b},Radius:function(a){return node=this.createElementNSPlus("Radius",{value:a})},PolygonSymbolizer:function(a){var b=this.createElementNSPlus("PolygonSymbolizer");if(a.fillColor!=undefined||a.fillOpacity!=undefined){this.writeNode("Fill",a,b)}if(a.strokeWidth!=undefined||a.strokeColor!=undefined||a.strokeOpacity!=undefined||a.strokeDashstyle!=undefined){this.writeNode("Stroke",a,b)}return b},Fill:function(a){var b=this.createElementNSPlus("Fill");if(a.fillColor){this.writeNode("CssParameter",{symbolizer:a,key:"fillColor"},b)}if(a.fillOpacity!=null){this.writeNode("CssParameter",{symbolizer:a,key:"fillOpacity"},b)}return b},PointSymbolizer:function(a){var b=this.createElementNSPlus("PointSymbolizer");this.writeNode("Graphic",a,b);return b},Graphic:function(a){var b=this.createElementNSPlus("Graphic");if(a.externalGraphic!=undefined){this.writeNode("ExternalGraphic",a,b)}else{this.writeNode("Mark",a,b)}if(a.graphicOpacity!=undefined){this.writeNode("Opacity",a.graphicOpacity,b)}if(a.pointRadius!=undefined){this.writeNode("Size",a.pointRadius*2,b)}if(a.rotation!=undefined){this.writeNode("Rotation",a.rotation,b)}return b},ExternalGraphic:function(a){var b=this.createElementNSPlus("ExternalGraphic");this.writeNode("OnlineResource",a.externalGraphic,b);var c=a.graphicFormat||this.getGraphicFormat(a.externalGraphic);this.writeNode("Format",c,b);return b},Mark:function(a){var b=this.createElementNSPlus("Mark");if(a.graphicName){this.writeNode("WellKnownName",a.graphicName,b)}this.writeNode("Fill",a,b);this.writeNode("Stroke",a,b);return b},WellKnownName:function(a){return this.createElementNSPlus("WellKnownName",{value:a})},Opacity:function(a){return this.createElementNSPlus("Opacity",{value:a})},Size:function(a){return this.createElementNSPlus("Size",{value:a})},Rotation:function(a){return this.createElementNSPlus("Rotation",{value:a})},OnlineResource:function(a){return this.createElementNSPlus("OnlineResource",{attributes:{"xlink:type":"simple","xlink:href":a}})},Format:function(a){return this.createElementNSPlus("Format",{value:a})}}},OpenLayers.Format.Filter.v1_0_0.prototype.writers),CLASS_NAME:"OpenLayers.Format.SLD.v1"});OpenLayers.Format.SLD.v1_0_0=OpenLayers.Class(OpenLayers.Format.SLD.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sld http://schemas.opengis.net/sld/1.0.0/StyledLayerDescriptor.xsd",initialize:function(a){OpenLayers.Format.SLD.v1.prototype.initialize.apply(this,[a])},CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0"});OpenLayers.Format.SLD.v1=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,{namespaces:{sld:"http://www.opengis.net/sld",ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"sld",schemaLocation:null,defaultSymbolizer:{fillColor:"#808080",fillOpacity:1,strokeColor:"#000000",strokeOpacity:1,strokeWidth:1,strokeDashstyle:"solid",pointRadius:3,graphicName:"square"},initialize:function(a){OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[a])},read:function(c,a){a=OpenLayers.Util.applyDefaults(a,this.options);var b={namedLayers:a.namedLayersAsArray===true?[]:{}};this.readChildNodes(c,b);return b},readers:OpenLayers.Util.applyDefaults({sld:{StyledLayerDescriptor:function(a,b){b.version=a.getAttribute("version");this.readChildNodes(a,b)},Name:function(a,b){b.name=this.getChildValue(a)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b.description=this.getChildValue(a)},NamedLayer:function(f,g){var c={userStyles:[],namedStyles:[]};this.readChildNodes(f,c);for(var b=0,a=c.userStyles.length;b<a;++b){c.userStyles[b].layerName=c.name}if(g.namedLayers instanceof Array){g.namedLayers.push(c)}else{g.namedLayers[c.name]=c}},NamedStyle:function(b,a){a.namedStyles.push(this.getChildName(b.firstChild))},UserStyle:function(c,a){var f={defaultsPerSymbolizer:true,rules:[]};this.readChildNodes(c,f);var b=new OpenLayers.Style(this.defaultSymbolizer,f);a.userStyles.push(b)},IsDefault:function(b,a){if(this.getChildValue(b)=="1"){a.isDefault=true}},FeatureTypeStyle:function(b,a){var c={rules:[]};this.readChildNodes(b,c);a.rules=c.rules},Rule:function(a,c){var b=new OpenLayers.Rule();this.readChildNodes(a,b);c.rules.push(b)},ElseFilter:function(a,b){b.elseFilter=true},MinScaleDenominator:function(a,b){b.minScaleDenominator=parseFloat(this.getChildValue(a))},MaxScaleDenominator:function(a,b){b.maxScaleDenominator=parseFloat(this.getChildValue(a))},TextSymbolizer:function(b,c){var a=c.symbolizer.Text||{};this.readChildNodes(b,a);c.symbolizer.Text=a},Label:function(b,a){var f={};this.readChildNodes(b,f);if(f.property){a.label="${"+f.property+"}"}else{var c=this.readOgcExpression(b);if(c){a.label=c}}},Font:function(b,a){this.readChildNodes(b,a)},Halo:function(b,a){var c={};this.readChildNodes(b,c);a.haloRadius=c.haloRadius;a.haloColor=c.fillColor;a.haloOpacity=c.fillOpacity},Radius:function(c,b){var a=this.readOgcExpression(c);if(a!=null){b.haloRadius=a}},LineSymbolizer:function(b,c){var a=c.symbolizer.Line||{};this.readChildNodes(b,a);c.symbolizer.Line=a},PolygonSymbolizer:function(b,c){var a=c.symbolizer.Polygon||{};this.readChildNodes(b,a);c.symbolizer.Polygon=a},PointSymbolizer:function(b,c){var a=c.symbolizer.Point||{};this.readChildNodes(b,a);c.symbolizer.Point=a},Stroke:function(b,a){a.stroke=true;this.readChildNodes(b,a)},Fill:function(b,a){a.fill=true;this.readChildNodes(b,a)},CssParameter:function(c,b){var a=c.getAttribute("name");var g=this.cssMap[a];if(g){var f=this.readOgcExpression(c);if(f){b[g]=f}}},Graphic:function(g,f){f.graphic=true;var m={};this.readChildNodes(g,m);var c=["strokeColor","strokeWidth","strokeOpacity","strokeLinecap","fillColor","fillOpacity","graphicName","rotation","graphicFormat"];var l,k;for(var b=0,a=c.length;b<a;++b){l=c[b];k=m[l];if(k!=undefined){f[l]=k}}if(m.opacity!=undefined){f.graphicOpacity=m.opacity}if(m.size!=undefined){f.pointRadius=m.size/2}if(m.href!=undefined){f.externalGraphic=m.href}if(m.rotation!=undefined){f.rotation=m.rotation}},ExternalGraphic:function(a,b){this.readChildNodes(a,b)},Mark:function(a,b){this.readChildNodes(a,b)},WellKnownName:function(a,b){b.graphicName=this.getChildValue(a)},Opacity:function(b,c){var a=this.readOgcExpression(b);if(a){c.opacity=a}},Size:function(b,c){var a=this.readOgcExpression(b);if(a){c.size=a}},Rotation:function(b,c){var a=this.readOgcExpression(b);if(a){c.rotation=a}},OnlineResource:function(a,b){b.href=this.getAttributeNS(a,this.namespaces.xlink,"href")},Format:function(a,b){b.graphicFormat=this.getChildValue(a)}}},OpenLayers.Format.Filter.v1_0_0.prototype.readers),cssMap:{stroke:"strokeColor","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","stroke-linecap":"strokeLinecap","stroke-dasharray":"strokeDashstyle",fill:"fillColor","fill-opacity":"fillOpacity","font-family":"fontFamily","font-size":"fontSize","font-weight":"fontWeight","font-style":"fontStyle"},getCssProperty:function(a){var b=null;for(var c in this.cssMap){if(this.cssMap[c]==a){b=c;break}}return b},getGraphicFormat:function(a){var f,c;for(var b in this.graphicFormats){if(this.graphicFormats[b].test(a)){f=b;break}}return f||this.defautlGraphicFormat},defaultGraphicFormat:"image/png",graphicFormats:{"image/jpeg":/\.jpe?g$/i,"image/gif":/\.gif$/i,"image/png":/\.png$/i},write:function(a){return this.writers.sld.StyledLayerDescriptor.apply(this,[a])},writers:OpenLayers.Util.applyDefaults({sld:{StyledLayerDescriptor:function(g){var b=this.createElementNSPlus("StyledLayerDescriptor",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});if(g.name){this.writeNode("Name",g.name,b)}if(g.title){this.writeNode("Title",g.title,b)}if(g.description){this.writeNode("Abstract",g.description,b)}if(g.namedLayers instanceof Array){for(var f=0,a=g.namedLayers.length;f<a;++f){this.writeNode("NamedLayer",g.namedLayers[f],b)}}else{for(var c in g.namedLayers){this.writeNode("NamedLayer",g.namedLayers[c],b)}}return b},Name:function(a){return this.createElementNSPlus("Name",{value:a})},Title:function(a){return this.createElementNSPlus("Title",{value:a})},Abstract:function(a){return this.createElementNSPlus("Abstract",{value:a})},NamedLayer:function(c){var f=this.createElementNSPlus("NamedLayer");this.writeNode("Name",c.name,f);if(c.namedStyles){for(var b=0,a=c.namedStyles.length;b<a;++b){this.writeNode("NamedStyle",c.namedStyles[b],f)}}if(c.userStyles){for(var b=0,a=c.userStyles.length;b<a;++b){this.writeNode("UserStyle",c.userStyles[b],f)}}return f},NamedStyle:function(a){var b=this.createElementNSPlus("NamedStyle");this.writeNode("Name",a,b);return b},UserStyle:function(a){var b=this.createElementNSPlus("UserStyle");if(a.name){this.writeNode("Name",a.name,b)}if(a.title){this.writeNode("Title",a.title,b)}if(a.description){this.writeNode("Abstract",a.description,b)}if(a.isDefault){this.writeNode("IsDefault",a.isDefault,b)}this.writeNode("FeatureTypeStyle",a,b);return b},IsDefault:function(a){return this.createElementNSPlus("IsDefault",{value:(a)?"1":"0"})},FeatureTypeStyle:function(c){var f=this.createElementNSPlus("FeatureTypeStyle");for(var b=0,a=c.rules.length;b<a;++b){this.writeNode("Rule",c.rules[b],f)}return f},Rule:function(l){var k=this.createElementNSPlus("Rule");if(l.name){this.writeNode("Name",l.name,k)}if(l.title){this.writeNode("Title",l.title,k)}if(l.description){this.writeNode("Abstract",l.description,k)}if(l.elseFilter){this.writeNode("ElseFilter",null,k)}else{if(l.filter){this.writeNode("ogc:Filter",l.filter,k)}}if(l.minScaleDenominator!=undefined){this.writeNode("MinScaleDenominator",l.minScaleDenominator,k)}if(l.maxScaleDenominator!=undefined){this.writeNode("MaxScaleDenominator",l.maxScaleDenominator,k)}var c=OpenLayers.Style.SYMBOLIZER_PREFIXES;var g,f;for(var b=0,a=c.length;b<a;++b){g=c[b];f=l.symbolizer[g];if(f){this.writeNode(g+"Symbolizer",f,k)}}return k},ElseFilter:function(){return this.createElementNSPlus("ElseFilter")},MinScaleDenominator:function(a){return this.createElementNSPlus("MinScaleDenominator",{value:a})},MaxScaleDenominator:function(a){return this.createElementNSPlus("MaxScaleDenominator",{value:a})},LineSymbolizer:function(a){var b=this.createElementNSPlus("LineSymbolizer");this.writeNode("Stroke",a,b);return b},Stroke:function(a){var b=this.createElementNSPlus("Stroke");if(a.strokeColor!=undefined){this.writeNode("CssParameter",{symbolizer:a,key:"strokeColor"},b)}if(a.strokeOpacity!=undefined){this.writeNode("CssParameter",{symbolizer:a,key:"strokeOpacity"},b)}if(a.strokeWidth!=undefined){this.writeNode("CssParameter",{symbolizer:a,key:"strokeWidth"},b)}return b},CssParameter:function(a){return this.createElementNSPlus("CssParameter",{attributes:{name:this.getCssProperty(a.key)},value:a.symbolizer[a.key]})},TextSymbolizer:function(a){var b=this.createElementNSPlus("TextSymbolizer");if(a.label!=null){this.writeNode("Label",a.label,b)}if(a.fontFamily!=null||a.fontSize!=null||a.fontWeight!=null||a.fontStyle!=null){this.writeNode("Font",a,b)}if(a.haloRadius!=null||a.haloColor!=null||a.haloOpacity!=null){this.writeNode("Halo",a,b)}if(a.fillColor!=null||a.fillOpacity!=null){this.writeNode("Fill",a,b)}return b},Font:function(a){var b=this.createElementNSPlus("Font");if(a.fontFamily){this.writeNode("CssParameter",{symbolizer:a,key:"fontFamily"},b)}if(a.fontSize){this.writeNode("CssParameter",{symbolizer:a,key:"fontSize"},b)}if(a.fontWeight){this.writeNode("CssParameter",{symbolizer:a,key:"fontWeight"},b)}if(a.fontStyle){this.writeNode("CssParameter",{symbolizer:a,key:"fontStyle"},b)}return b},Label:function(b){var k=this.createElementNSPlus("Label");var l=b.split("${");k.appendChild(this.createTextNode(l[0]));var g,f;for(var c=1,a=l.length;c<a;c++){g=l[c];f=g.indexOf("}");if(f>0){this.writeNode("ogc:PropertyName",{property:g.substring(0,f)},k);k.appendChild(this.createTextNode(g.substring(++f)))}else{k.appendChild(this.createTextNode("${"+g))}}return k},Halo:function(a){var b=this.createElementNSPlus("Halo");if(a.haloRadius){this.writeNode("Radius",a.haloRadius,b)}if(a.haloColor||a.haloOpacity){this.writeNode("Fill",{fillColor:a.haloColor,fillOpacity:a.haloOpacity},b)}return b},Radius:function(a){return node=this.createElementNSPlus("Radius",{value:a})},PolygonSymbolizer:function(a){var b=this.createElementNSPlus("PolygonSymbolizer");if(a.fillColor!=undefined||a.fillOpacity!=undefined){this.writeNode("Fill",a,b)}if(a.strokeWidth!=undefined||a.strokeColor!=undefined||a.strokeOpacity!=undefined||a.strokeDashstyle!=undefined){this.writeNode("Stroke",a,b)}return b},Fill:function(a){var b=this.createElementNSPlus("Fill");if(a.fillColor){this.writeNode("CssParameter",{symbolizer:a,key:"fillColor"},b)}if(a.fillOpacity!=null){this.writeNode("CssParameter",{symbolizer:a,key:"fillOpacity"},b)}return b},PointSymbolizer:function(a){var b=this.createElementNSPlus("PointSymbolizer");this.writeNode("Graphic",a,b);return b},Graphic:function(a){var b=this.createElementNSPlus("Graphic");if(a.externalGraphic!=undefined){this.writeNode("ExternalGraphic",a,b)}else{this.writeNode("Mark",a,b)}if(a.graphicOpacity!=undefined){this.writeNode("Opacity",a.graphicOpacity,b)}if(a.pointRadius!=undefined){this.writeNode("Size",a.pointRadius*2,b)}if(a.rotation!=undefined){this.writeNode("Rotation",a.rotation,b)}return b},ExternalGraphic:function(a){var b=this.createElementNSPlus("ExternalGraphic");this.writeNode("OnlineResource",a.externalGraphic,b);var c=a.graphicFormat||this.getGraphicFormat(a.externalGraphic);this.writeNode("Format",c,b);return b},Mark:function(a){var b=this.createElementNSPlus("Mark");if(a.graphicName){this.writeNode("WellKnownName",a.graphicName,b)}this.writeNode("Fill",a,b);this.writeNode("Stroke",a,b);return b},WellKnownName:function(a){return this.createElementNSPlus("WellKnownName",{value:a})},Opacity:function(a){return this.createElementNSPlus("Opacity",{value:a})},Size:function(a){return this.createElementNSPlus("Size",{value:a})},Rotation:function(a){return this.createElementNSPlus("Rotation",{value:a})},OnlineResource:function(a){return this.createElementNSPlus("OnlineResource",{attributes:{"xlink:type":"simple","xlink:href":a}})},Format:function(a){return this.createElementNSPlus("Format",{value:a})}}},OpenLayers.Format.Filter.v1_0_0.prototype.writers),CLASS_NAME:"OpenLayers.Format.SLD.v1"});OpenLayers.Format.WFST=function(b){b=OpenLayers.Util.applyDefaults(b,OpenLayers.Format.WFST.DEFAULTS);var a=OpenLayers.Format.WFST["v"+b.version.replace(/\./g,"_")];if(!a){throw"Unsupported WFST version: "+b.version}return new a(b)};OpenLayers.Format.WFST.DEFAULTS={version:"1.0.0"};OpenLayers.Format.WFST.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc"},defaultPrefix:"wfs",version:null,schemaLocations:null,srsName:null,extractAttributes:true,xy:true,stateName:null,initialize:function(a){this.stateName={};this.stateName[OpenLayers.State.INSERT]="wfs:Insert";this.stateName[OpenLayers.State.UPDATE]="wfs:Update";this.stateName[OpenLayers.State.DELETE]="wfs:Delete";OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},getSrsName:function(c,b){var a=b&&b.srsName;if(!a){if(c&&c.layer){a=c.layer.projection.getCode()}else{a=this.srsName}}return a},read:function(a){if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a])}if(a&&a.nodeType==9){a=a.documentElement}var b={};this.readNode(a,b);if(b.features){b=b.features}return b},readers:{wfs:{FeatureCollection:function(a,b){b.features=[];this.readChildNodes(a,b)}}},write:function(a){var b=this.writeNode("wfs:Transaction",a);var c=this.schemaLocationAttr();if(c){this.setAttributeNS(b,this.namespaces.xsi,"xsi:schemaLocation",c)}return OpenLayers.Format.XML.prototype.write.apply(this,[b])},writers:{wfs:{GetFeature:function(a){var b=this.createElementNSPlus("wfs:GetFeature",{attributes:{service:"WFS",version:this.version,maxFeatures:a&&a.maxFeatures,"xsi:schemaLocation":this.schemaLocationAttr(a)}});this.writeNode("Query",a,b);return b},Query:function(a){a=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},a);var b=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(a.featureNS?a.featurePrefix+":":"")+a.featureType,srsName:a.srsName}});if(a.featureNS){b.setAttribute("xmlns:"+a.featurePrefix,a.featureNS)}if(a.filter){this.setFilterProperty(a.filter);this.writeNode("ogc:Filter",a.filter,b)}return b},Transaction:function(g){var k=this.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version}});if(g){var b,f;for(var c=0,a=g.length;c<a;++c){f=g[c];b=this.stateName[f.state];if(b){this.writeNode(b,f,k)}}}return k},Insert:function(a){var b=this.createElementNSPlus("wfs:Insert");this.srsName=this.getSrsName(a);this.writeNode("feature:_typeName",a,b);return b},Update:function(b){var c=this.createElementNSPlus("wfs:Update",{attributes:{typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});if(this.featureNS){c.setAttribute("xmlns:"+this.featurePrefix,this.featureNS)}this.writeNode("Property",{name:this.geometryName,value:b},c);for(var a in b.attributes){this.writeNode("Property",{name:a,value:b.attributes[a]},c)}this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[b.fid]}),c);return c},Property:function(b){var a=this.createElementNSPlus("wfs:Property");this.writeNode("Name",b.name,a);this.writeNode("Value",b.value,a);return a},Name:function(a){return this.createElementNSPlus("wfs:Name",{value:a})},Value:function(c){var b;if(c instanceof OpenLayers.Feature.Vector){b=this.createElementNSPlus("wfs:Value");this.srsName=this.getSrsName(c);var a=this.writeNode("feature:_geometry",c.geometry).firstChild;b.appendChild(a)}else{b=this.createElementNSPlus("wfs:Value",{value:c})}return b},Delete:function(a){var b=this.createElementNSPlus("wfs:Delete",{attributes:{typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});if(this.featureNS){b.setAttribute("xmlns:"+this.featurePrefix,this.featureNS)}this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[a.fid]}),b);return b}}},schemaLocationAttr:function(a){a=OpenLayers.Util.extend({featurePrefix:this.featurePrefix,schema:this.schema},a);var k=OpenLayers.Util.extend({},this.schemaLocations);if(a.schema){k[a.featurePrefix]=a.schema}var g=[];var c;for(var b in k){c=this.namespaces[b];if(c){g.push(c+" "+k[b])}}var f=g.join(" ")||undefined;return f},setFilterProperty:function(c){if(c.filters){for(var b=0,a=c.filters.length;b<a;++b){this.setFilterProperty(c.filters[b])}}else{if(c instanceof OpenLayers.Filter.Spatial){c.property=this.geometryName}}},CLASS_NAME:"OpenLayers.Format.WFST.v1"});OpenLayers.Format.WFST.v1_0_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,OpenLayers.Format.WFST.v1,{version:"1.0.0",schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.0.0/WFS-transaction.xsd"},initialize:function(a){OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[a]);OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[a])},readers:{wfs:OpenLayers.Util.applyDefaults({WFS_TransactionResponse:function(a,b){b.insertIds=[];b.success=false;this.readChildNodes(a,b)},InsertResult:function(b,a){var c={fids:[]};this.readChildNodes(b,c);a.insertIds.push(c.fids[0])},TransactionResult:function(a,b){this.readChildNodes(a,b)},Status:function(a,b){this.readChildNodes(a,b)},SUCCESS:function(a,b){b.success=true}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.readers.ogc},writers:{wfs:OpenLayers.Util.applyDefaults({Query:function(b){b=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},b);var f=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(b.featureNS?b.featurePrefix+":":"")+b.featureType}});if(b.featureNS){f.setAttribute("xmlns:"+b.featurePrefix,b.featureNS)}if(b.propertyNames){for(var c=0,a=b.propertyNames.length;c<a;c++){this.writeNode("ogc:PropertyName",{property:b.propertyNames[c]},f)}}if(b.filter){this.setFilterProperty(b.filter);this.writeNode("ogc:Filter",b.filter,f)}return f}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_0_0"});OpenLayers.Format.WFST.v1_1_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_1_0,OpenLayers.Format.WFST.v1,{version:"1.1.0",schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"},initialize:function(a){OpenLayers.Format.Filter.v1_1_0.prototype.initialize.apply(this,[a]);OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[a])},readers:{wfs:OpenLayers.Util.applyDefaults({TransactionResponse:function(a,b){b.insertIds=[];b.success=false;this.readChildNodes(a,b)},TransactionSummary:function(a,b){b.success=true},InsertResults:function(a,b){this.readChildNodes(a,b)},Feature:function(b,a){var c={fids:[]};this.readChildNodes(b,c);a.insertIds.push(c.fids[0])}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.readers.ogc},writers:{wfs:OpenLayers.Util.applyDefaults({Query:function(b){b=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},b);var f=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(b.featureNS?b.featurePrefix+":":"")+b.featureType,srsName:b.srsName}});if(b.featureNS){f.setAttribute("xmlns:"+b.featurePrefix,b.featureNS)}if(b.propertyNames){for(var c=0,a=b.propertyNames.length;c<a;c++){this.writeNode("wfs:PropertyName",{property:b.propertyNames[c]},f)}}if(b.filter){this.setFilterProperty(b.filter);this.writeNode("ogc:Filter",b.filter,f)}return f},PropertyName:function(a){return this.createElementNSPlus("wfs:PropertyName",{value:a.property})}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_1_0"});OpenLayers.Format.Text=OpenLayers.Class(OpenLayers.Format,{defaultStyle:null,extractStyles:true,initialize:function(a){a=a||{};if(a.extractStyles!==false){a.defaultStyle={externalGraphic:OpenLayers.Util.getImagesLocation()+"marker.png",graphicWidth:21,graphicHeight:25,graphicXOffset:-10.5,graphicYOffset:-12.5}}OpenLayers.Format.prototype.initialize.apply(this,[a])},read:function(p){var a=p.split("\n");var b;var l=[];for(var F=0;F<(a.length-1);F++){var E=a[F].replace(/^\s*/,"").replace(/\s*$/,"");if(E.charAt(0)!="#"){if(!b){b=E.split("\t")}else{var r=E.split("\t");var f=new OpenLayers.Geometry.Point(0,0);var m={};var B=this.defaultStyle?OpenLayers.Util.applyDefaults({},this.defaultStyle):null;var C,D,c,v;var q=false;for(var o=0;o<r.length;o++){if(r[o]){if(b[o]=="point"){var A=r[o].split(",");f.y=parseFloat(A[0]);f.x=parseFloat(A[1]);q=true}else{if(b[o]=="lat"){f.y=parseFloat(r[o]);q=true}else{if(b[o]=="lon"){f.x=parseFloat(r[o]);q=true}else{if(b[o]=="title"){m.title=r[o]}else{if(b[o]=="image"||b[o]=="icon"&&B){B.externalGraphic=r[o]}else{if(b[o]=="iconSize"&&B){var u=r[o].split(",");B.graphicWidth=parseFloat(u[0]);B.graphicHeight=parseFloat(u[1])}else{if(b[o]=="iconOffset"&&B){var k=r[o].split(",");B.graphicXOffset=parseFloat(k[0]);B.graphicYOffset=parseFloat(k[1])}else{if(b[o]=="description"){m.description=r[o]}else{if(b[o]=="overflow"){m.overflow=r[o]}else{m[b[o]]=r[o]}}}}}}}}}}}if(q){if(this.internalProjection&&this.externalProjection){f.transform(this.externalProjection,this.internalProjection)}var g=new OpenLayers.Feature.Vector(f,m,B);l.push(g)}}}}return l},CLASS_NAME:"OpenLayers.Format.Text"});OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:false,initialize:function(a){OpenLayers.Format.prototype.initialize.apply(this,[a])},read:function(json,filter){try{if(/^[\],:{}\s]*$/.test(json.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){var object=eval("("+json+")");if(typeof filter==="function"){function walk(k,v){if(v&&typeof v==="object"){for(var i in v){if(v.hasOwnProperty(i)){v[i]=walk(i,v[i])}}}return filter(k,v)}object=walk("",object)}if(this.keepData){this.data=object}return object}}catch(e){}return null},write:function(g,c){this.pretty=!!c;var a=null;var b=typeof g;if(this.serialize[b]){try{a=this.serialize[b].apply(this,[g])}catch(f){OpenLayers.Console.error("Trouble serializing: "+f)}}return a},writeIndent:function(){var b=[];if(this.pretty){for(var a=0;a<this.level;++a){b.push(this.indent)}}return b.join("")},writeNewline:function(){return(this.pretty)?this.newline:""},writeSpace:function(){return(this.pretty)?this.space:""},serialize:{object:function(c){if(c==null){return"null"}if(c.constructor==Date){return this.serialize.date.apply(this,[c])}if(c.constructor==Array){return this.serialize.array.apply(this,[c])}var k=["{"];this.level+=1;var f,b,g;var a=false;for(f in c){if(c.hasOwnProperty(f)){b=OpenLayers.Format.JSON.prototype.write.apply(this,[f,this.pretty]);g=OpenLayers.Format.JSON.prototype.write.apply(this,[c[f],this.pretty]);if(b!=null&&g!=null){if(a){k.push(",")}k.push(this.writeNewline(),this.writeIndent(),b,":",this.writeSpace(),g);a=true}}}this.level-=1;k.push(this.writeNewline(),this.writeIndent(),"}");return k.join("")},array:function(g){var c;var f=["["];this.level+=1;for(var b=0,a=g.length;b<a;++b){c=OpenLayers.Format.JSON.prototype.write.apply(this,[g[b],this.pretty]);if(c!=null){if(b>0){f.push(",")}f.push(this.writeNewline(),this.writeIndent(),c)}}this.level-=1;f.push(this.writeNewline(),this.writeIndent(),"]");return f.join("")},string:function(b){var a={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};if(/["\\\x00-\x1f]/.test(b)){return'"'+b.replace(/([\x00-\x1f\\"])/g,function(g,f){var k=a[f];if(k){return k}k=f.charCodeAt();return"\\u00"+Math.floor(k/16).toString(16)+(k%16).toString(16)})+'"'}return'"'+b+'"'},number:function(a){return isFinite(a)?String(a):"null"},"boolean":function(a){return String(a)},date:function(a){function b(c){return(c<10)?"0"+c:c}return'"'+a.getFullYear()+"-"+b(a.getMonth()+1)+"-"+b(a.getDate())+"T"+b(a.getHours())+":"+b(a.getMinutes())+":"+b(a.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"});OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{initialize:function(a){OpenLayers.Format.JSON.prototype.initialize.apply(this,[a])},read:function(o,l,a){l=(l)?l:"FeatureCollection";var f=null;var c=null;if(typeof o=="string"){c=OpenLayers.Format.JSON.prototype.read.apply(this,[o,a])}else{c=o}if(!c){OpenLayers.Console.error("Bad JSON: "+o)}else{if(typeof(c.type)!="string"){OpenLayers.Console.error("Bad GeoJSON - no type: "+o)}else{if(this.isValidType(c,l)){switch(l){case"Geometry":try{f=this.parseGeometry(c)}catch(b){OpenLayers.Console.error(b)}break;case"Feature":try{f=this.parseFeature(c);f.type="Feature"}catch(b){OpenLayers.Console.error(b)}break;case"FeatureCollection":f=[];switch(c.type){case"Feature":try{f.push(this.parseFeature(c))}catch(b){f=null;OpenLayers.Console.error(b)}break;case"FeatureCollection":for(var g=0,k=c.features.length;g<k;++g){try{f.push(this.parseFeature(c.features[g]))}catch(b){f=null;OpenLayers.Console.error(b)}}break;default:try{var m=this.parseGeometry(c);f.push(new OpenLayers.Feature.Vector(m))}catch(b){f=null;OpenLayers.Console.error(b)}}break}}}}return f},isValidType:function(c,a){var b=false;switch(a){case"Geometry":if(OpenLayers.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],c.type)==-1){OpenLayers.Console.error("Unsupported geometry type: "+c.type)}else{b=true}break;case"FeatureCollection":b=true;break;default:if(c.type==a){b=true}else{OpenLayers.Console.error("Cannot convert types from "+c.type+" to "+a)}}return b},parseFeature:function(f){var b,k,a,g;a=(f.properties)?f.properties:{};g=(f.geometry&&f.geometry.bbox)||f.bbox;try{k=this.parseGeometry(f.geometry)}catch(c){throw c}b=new OpenLayers.Feature.Vector(k,a);if(g){b.bounds=OpenLayers.Bounds.fromArray(g)}if(f.id){b.fid=f.id}return b},parseGeometry:function(g){if(g==null){return null}var l,k=false;if(g.type=="GeometryCollection"){if(!(g.geometries instanceof Array)){throw"GeometryCollection must have geometries array: "+g}var b=g.geometries.length;var f=new Array(b);for(var a=0;a<b;++a){f[a]=this.parseGeometry.apply(this,[g.geometries[a]])}l=new OpenLayers.Geometry.Collection(f);k=true}else{if(!(g.coordinates instanceof Array)){throw"Geometry must have coordinates array: "+g}if(!this.parseCoords[g.type.toLowerCase()]){throw"Unsupported geometry type: "+g.type}try{l=this.parseCoords[g.type.toLowerCase()].apply(this,[g.coordinates])}catch(c){throw c}}if(this.internalProjection&&this.externalProjection&&!k){l.transform(this.externalProjection,this.internalProjection)}return l},parseCoords:{point:function(a){if(a.length!=2){throw"Only 2D points are supported: "+a}return new OpenLayers.Geometry.Point(a[0],a[1])},multipoint:function(k){var c=[];var g=null;for(var b=0,a=k.length;b<a;++b){try{g=this.parseCoords.point.apply(this,[k[b]])}catch(f){throw f}c.push(g)}return new OpenLayers.Geometry.MultiPoint(c)},linestring:function(k){var c=[];var g=null;for(var b=0,a=k.length;b<a;++b){try{g=this.parseCoords.point.apply(this,[k[b]])}catch(f){throw f}c.push(g)}return new OpenLayers.Geometry.LineString(c)},multilinestring:function(k){var c=[];var b=null;for(var f=0,a=k.length;f<a;++f){try{b=this.parseCoords.linestring.apply(this,[k[f]])}catch(g){throw g}c.push(b)}return new OpenLayers.Geometry.MultiLineString(c)},polygon:function(m){var k=[];var g,b;for(var c=0,a=m.length;c<a;++c){try{b=this.parseCoords.linestring.apply(this,[m[c]])}catch(f){throw f}g=new OpenLayers.Geometry.LinearRing(b.components);k.push(g)}return new OpenLayers.Geometry.Polygon(k)},multipolygon:function(k){var b=[];var g=null;for(var c=0,a=k.length;c<a;++c){try{g=this.parseCoords.polygon.apply(this,[k[c]])}catch(f){throw f}b.push(g)}return new OpenLayers.Geometry.MultiPolygon(b)},box:function(a){if(a.length!=2){throw"GeoJSON box coordinates must have 2 elements"}return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(a[0][0],a[0][1]),new OpenLayers.Geometry.Point(a[1][0],a[0][1]),new OpenLayers.Geometry.Point(a[1][0],a[1][1]),new OpenLayers.Geometry.Point(a[0][0],a[1][1]),new OpenLayers.Geometry.Point(a[0][0],a[0][1])])])}},write:function(g,f){var a={type:null};if(g instanceof Array){a.type="FeatureCollection";var l=g.length;a.features=new Array(l);for(var c=0;c<l;++c){var b=g[c];if(!b instanceof OpenLayers.Feature.Vector){var k="FeatureCollection only supports collections of features: "+b;throw k}a.features[c]=this.extract.feature.apply(this,[b])}}else{if(g.CLASS_NAME.indexOf("OpenLayers.Geometry")==0){a=this.extract.geometry.apply(this,[g])}else{if(g instanceof OpenLayers.Feature.Vector){a=this.extract.feature.apply(this,[g]);if(g.layer&&g.layer.projection){a.crs=this.createCRSObject(g)}}}}return OpenLayers.Format.JSON.prototype.write.apply(this,[a,f])},createCRSObject:function(b){var c=b.layer.projection.toString();var a={};if(c.match(/epsg:/i)){var f=parseInt(c.substring(c.indexOf(":")+1));if(f==4326){a={type:"OGC",properties:{urn:"urn:ogc:def:crs:OGC:1.3:CRS84"}}}else{a={type:"EPSG",properties:{code:f}}}}return a},extract:{feature:function(b){var a=this.extract.geometry.apply(this,[b.geometry]);return{type:"Feature",id:b.fid==null?b.id:b.fid,properties:b.attributes,geometry:a}},geometry:function(f){if(f==null){return null}if(this.internalProjection&&this.externalProjection){f=f.clone();f.transform(this.internalProjection,this.externalProjection)}var a=f.CLASS_NAME.split(".")[2];var c=this.extract[a.toLowerCase()].apply(this,[f]);var b;if(a=="Collection"){b={type:"GeometryCollection",geometries:c}}else{b={type:a,coordinates:c}}return b},point:function(a){return[a.x,a.y]},multipoint:function(c){var f=[];for(var b=0,a=c.components.length;b<a;++b){f.push(this.extract.point.apply(this,[c.components[b]]))}return f},linestring:function(b){var f=[];for(var c=0,a=b.components.length;c<a;++c){f.push(this.extract.point.apply(this,[b.components[c]]))}return f},multilinestring:function(c){var f=[];for(var b=0,a=c.components.length;b<a;++b){f.push(this.extract.linestring.apply(this,[c.components[b]]))}return f},polygon:function(c){var f=[];for(var b=0,a=c.components.length;b<a;++b){f.push(this.extract.linestring.apply(this,[c.components[b]]))}return f},multipolygon:function(f){var c=[];for(var b=0,a=f.components.length;b<a;++b){c.push(this.extract.polygon.apply(this,[f.components[b]]))}return c},collection:function(c){var a=c.components.length;var f=new Array(a);for(var b=0;b<a;++b){f[b]=this.extract.geometry.apply(this,[c.components[b]])}return f}},CLASS_NAME:"OpenLayers.Format.GeoJSON"});OpenLayers.Format.WMC=OpenLayers.Class({defaultVersion:"1.1.0",version:null,layerOptions:null,layerParams:null,parser:null,initialize:function(a){OpenLayers.Util.extend(this,a);this.options=a},read:function(g,c){if(typeof g=="string"){g=OpenLayers.Format.XML.prototype.read.apply(this,[g])}var b=g.documentElement;var a=this.version;if(!a){a=b.getAttribute("version");if(!a){a=this.defaultVersion}}if(!this.parser||this.parser.VERSION!=a){var l=OpenLayers.Format.WMC["v"+a.replace(/\./g,"_")];if(!l){throw"Can't find a WMC parser for version "+a}this.parser=new l(this.options)}var f=this.parser.read(g,c);var k;if(c.map){this.context=f;if(c.map instanceof OpenLayers.Map){k=this.mergeContextToMap(f,c.map)}else{k=this.contextToMap(f,c.map)}}else{k=f}return k},contextToMap:function(a,c){var b=new OpenLayers.Map(c,{maxExtent:a.maxExtent,projection:a.projection});b.addLayers(a.layers);b.setCenter(a.bounds.getCenterLonLat(),b.getZoomForExtent(a.bounds,true));return b},mergeContextToMap:function(a,b){b.addLayers(a.layers);return b},write:function(g,b){if(g.CLASS_NAME=="OpenLayers.Map"){g=this.mapToContext(g)}var a=(b&&b.version)||this.version||this.defaultVersion;if(!this.parser||this.parser.VERSION!=a){var f=OpenLayers.Format.WMC["v"+a.replace(/\./g,"_")];if(!f){throw"Can't find a WMS capabilities parser for version "+a}this.parser=new f(this.options)}var c=this.parser.write(g,b);return c},mapToContext:function(b){var a={bounds:b.getExtent(),maxExtent:b.maxExtent,projection:b.projection,layers:b.layers,size:b.getSize()};return a},CLASS_NAME:"OpenLayers.Format.WMC"});OpenLayers.Format.WMC.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ol:"http://openlayers.org/context",wmc:"http://www.opengis.net/context",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"",getNamespacePrefix:function(a){var b=null;if(a==null){b=this.namespaces[this.defaultPrefix]}else{for(b in this.namespaces){if(this.namespaces[b]==a){break}}}return b},defaultPrefix:"wmc",rootPrefix:null,defaultStyleName:"",defaultStyleTitle:"Default",initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(c){if(typeof c=="string"){c=OpenLayers.Format.XML.prototype.read.apply(this,[c])}var a=c.documentElement;this.rootPrefix=a.prefix;var b={version:a.getAttribute("version")};this.runChildNodes(b,a);return b},runChildNodes:function(g,f){var b=f.childNodes;var a,c,l,o;for(var k=0,m=b.length;k<m;++k){a=b[k];if(a.nodeType==1){l=this.getNamespacePrefix(a.namespaceURI);o=a.nodeName.split(":").pop();c=this["read_"+l+"_"+o];if(c){c.apply(this,[g,a])}}}},read_wmc_General:function(a,b){this.runChildNodes(a,b)},read_wmc_BoundingBox:function(a,b){a.projection=b.getAttribute("SRS");a.bounds=new OpenLayers.Bounds(parseFloat(b.getAttribute("minx")),parseFloat(b.getAttribute("miny")),parseFloat(b.getAttribute("maxx")),parseFloat(b.getAttribute("maxy")))},read_wmc_LayerList:function(a,b){a.layers=[];this.runChildNodes(a,b)},read_wmc_Layer:function(b,c){var f={params:this.layerParams||{},options:{visibility:(c.getAttribute("hidden")!="1"),queryable:(c.getAttribute("queryable")=="1")},formats:[],styles:[]};this.runChildNodes(f,c);f.params.layers=f.name;f.options.maxExtent=f.maxExtent;var a=this.getLayerFromInfo(f);b.layers.push(a)},getLayerFromInfo:function(c){var a=c.options;if(this.layerOptions){OpenLayers.Util.applyDefaults(a,this.layerOptions)}var b=new OpenLayers.Layer.WMS(c.title,c.href,c.params,a);return b},read_wmc_Extension:function(b,a){this.runChildNodes(b,a)},read_ol_units:function(b,a){b.options.units=this.getChildValue(a)},read_ol_maxExtent:function(c,b){var a=new OpenLayers.Bounds(b.getAttribute("minx"),b.getAttribute("miny"),b.getAttribute("maxx"),b.getAttribute("maxy"));c.maxExtent=a},read_ol_transparent:function(b,a){b.params.transparent=this.getChildValue(a)},read_ol_numZoomLevels:function(b,a){b.options.numZoomLevels=parseInt(this.getChildValue(a))},read_ol_opacity:function(b,a){b.options.opacity=parseFloat(this.getChildValue(a))},read_ol_singleTile:function(b,a){b.options.singleTile=(this.getChildValue(a)=="true")},read_ol_isBaseLayer:function(b,a){b.options.isBaseLayer=(this.getChildValue(a)=="true")},read_ol_displayInLayerSwitcher:function(b,a){b.options.displayInLayerSwitcher=(this.getChildValue(a)=="true")},read_wmc_Server:function(b,a){b.params.version=a.getAttribute("version");this.runChildNodes(b,a)},read_wmc_FormatList:function(b,a){this.runChildNodes(b,a)},read_wmc_Format:function(c,a){var b=this.getChildValue(a);c.formats.push(b);if(a.getAttribute("current")=="1"){c.params.format=b}},read_wmc_StyleList:function(b,a){this.runChildNodes(b,a)},read_wmc_Style:function(c,b){var a={};this.runChildNodes(a,b);if(b.getAttribute("current")=="1"){if(a.href){c.params.sld=a.href}else{if(a.body){c.params.sld_body=a.body}else{c.params.styles=a.name}}}c.styles.push(a)},read_wmc_SLD:function(a,b){this.runChildNodes(a,b)},read_sld_StyledLayerDescriptor:function(c,b){var a=OpenLayers.Format.XML.prototype.write.apply(this,[b]);c.body=a},read_wmc_OnlineResource:function(b,a){b.href=this.getAttributeNS(a,this.namespaces.xlink,"href")},read_wmc_Name:function(c,b){var a=this.getChildValue(b);if(a){c.name=a}},read_wmc_Title:function(b,a){var c=this.getChildValue(a);if(c){b.title=c}},read_wmc_MetadataURL:function(c,b){var f={};var a=b.getElementsByTagName("OnlineResource");if(a.length>0){this.read_wmc_OnlineResource(f,a[0])}c.options.metadataURL=f.href},read_wmc_Abstract:function(c,b){var a=this.getChildValue(b);if(a){c["abstract"]=a}},read_wmc_LatLonBoundingBox:function(a,b){a.llbbox=[parseFloat(b.getAttribute("minx")),parseFloat(b.getAttribute("miny")),parseFloat(b.getAttribute("maxx")),parseFloat(b.getAttribute("maxy"))]},read_wmc_LegendURL:function(c,f){var b={width:f.getAttribute("width"),height:f.getAttribute("height")};var a=f.getElementsByTagName("OnlineResource");if(a.length>0){this.read_wmc_OnlineResource(b,a[0])}c.legend=b},write:function(c,b){var a=this.createElementDefaultNS("ViewContext");this.setAttributes(a,{version:this.VERSION,id:(b&&typeof b.id=="string")?b.id:OpenLayers.Util.createUniqueID("OpenLayers_Context_")});this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);a.appendChild(this.write_wmc_General(c));a.appendChild(this.write_wmc_LayerList(c));return OpenLayers.Format.XML.prototype.write.apply(this,[a])},createElementDefaultNS:function(c,b,a){var f=this.createElementNS(this.namespaces[this.defaultPrefix],c);if(b){f.appendChild(this.createTextNode(b))}if(a){this.setAttributes(f,a)}return f},setAttributes:function(b,f){var c;for(var a in f){c=f[a].toString();if(c.match(/[A-Z]/)){this.setAttributeNS(b,null,a,c)}else{b.setAttribute(a,c)}}},write_wmc_General:function(a){var c=this.createElementDefaultNS("General");if(a.size){c.appendChild(this.createElementDefaultNS("Window",null,{width:a.size.w,height:a.size.h}))}var b=a.bounds;c.appendChild(this.createElementDefaultNS("BoundingBox",null,{minx:b.left.toPrecision(10),miny:b.bottom.toPrecision(10),maxx:b.right.toPrecision(10),maxy:b.top.toPrecision(10),SRS:a.projection}));c.appendChild(this.createElementDefaultNS("Title",a.title));c.appendChild(this.write_ol_MapExtension(a));return c},write_ol_MapExtension:function(b){var f=this.createElementDefaultNS("Extension");var c=b.maxExtent;if(c){var a=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(a,{minx:c.left.toPrecision(10),miny:c.bottom.toPrecision(10),maxx:c.right.toPrecision(10),maxy:c.top.toPrecision(10)});f.appendChild(a)}return f},write_wmc_LayerList:function(f){var g=this.createElementDefaultNS("LayerList");var c;for(var b=0,a=f.layers.length;b<a;++b){c=f.layers[b];if(c instanceof OpenLayers.Layer.WMS){g.appendChild(this.write_wmc_Layer(c))}}return g},write_wmc_Layer:function(a){var b=this.createElementDefaultNS("Layer",null,{queryable:a.queryable?"1":"0",hidden:a.visibility?"0":"1"});b.appendChild(this.write_wmc_Server(a));b.appendChild(this.createElementDefaultNS("Name",a.params.LAYERS));b.appendChild(this.createElementDefaultNS("Title",a.name));if(a.metadataURL){b.appendChild(this.write_wmc_MetadataURL(a))}b.appendChild(this.write_wmc_FormatList(a));b.appendChild(this.write_wmc_StyleList(a));b.appendChild(this.write_wmc_LayerExtension(a));return b},write_wmc_LayerExtension:function(k){var f=this.createElementDefaultNS("Extension");var a=k.maxExtent;var o=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(o,{minx:a.left.toPrecision(10),miny:a.bottom.toPrecision(10),maxx:a.right.toPrecision(10),maxy:a.top.toPrecision(10)});f.appendChild(o);var c=k.params.TRANSPARENT;if(c){var p=this.createElementNS(this.namespaces.ol,"ol:transparent");p.appendChild(this.createTextNode(c));f.appendChild(p)}var m=["numZoomLevels","units","isBaseLayer","opacity","displayInLayerSwitcher","singleTile"];var b;for(var g=0,l=m.length;g<l;++g){b=this.createOLPropertyNode(k,m[g]);if(b){f.appendChild(b)}}return f},createOLPropertyNode:function(b,c){var a=null;if(b[c]!=null){a=this.createElementNS(this.namespaces.ol,"ol:"+c);a.appendChild(this.createTextNode(b[c].toString()))}return a},write_wmc_Server:function(a){var b=this.createElementDefaultNS("Server");this.setAttributes(b,{service:"OGC:WMS",version:a.params.VERSION});b.appendChild(this.write_wmc_OnlineResource(a.url));return b},write_wmc_MetadataURL:function(a){var b=this.createElementDefaultNS("MetadataURL");b.appendChild(this.write_wmc_OnlineResource(a.metadataURL));return b},write_wmc_FormatList:function(a){var b=this.createElementDefaultNS("FormatList");b.appendChild(this.createElementDefaultNS("Format",a.params.FORMAT,{current:"1"}));return b},write_wmc_StyleList:function(g){var f=this.createElementDefaultNS("StyleList");var c=this.createElementDefaultNS("Style",null,{current:"1"});if(g.params.SLD){var b=this.createElementDefaultNS("SLD");var l=this.write_wmc_OnlineResource(g.params.SLD);b.appendChild(l);c.appendChild(b)}else{if(g.params.SLD_BODY){var b=this.createElementDefaultNS("SLD");var k=g.params.SLD_BODY;var m=OpenLayers.Format.XML.prototype.read.apply(this,[k]);var o=m.documentElement;if(b.ownerDocument&&b.ownerDocument.importNode){o=b.ownerDocument.importNode(o,true)}b.appendChild(o);c.appendChild(b)}else{var a=g.params.STYLES?g.params.STYLES:this.defaultStyleName;c.appendChild(this.createElementDefaultNS("Name",a));c.appendChild(this.createElementDefaultNS("Title",this.defaultStyleTitle))}}f.appendChild(c);return f},write_wmc_OnlineResource:function(a){var b=this.createElementDefaultNS("OnlineResource");this.setAttributeNS(b,this.namespaces.xlink,"xlink:type","simple");this.setAttributeNS(b,this.namespaces.xlink,"xlink:href",a);return b},CLASS_NAME:"OpenLayers.Format.WMC.v1"});OpenLayers.Format.WMC.v1_0_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.0.0/context.xsd",initialize:function(a){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[a])},CLASS_NAME:"OpenLayers.Format.WMC.v1_0_0"});OpenLayers.Format.WMC.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.1.0/context.xsd",initialize:function(a){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[a])},read_sld_MinScaleDenominator:function(b,a){b.options.maxScale=this.getChildValue(a)},read_sld_MaxScaleDenominator:function(b,a){b.options.minScale=this.getChildValue(a)},write_wmc_Layer:function(b){var c=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[b]);if(b.options.resolutions||b.options.scales||b.options.minResolution||b.options.maxScale){var f=this.createElementNS(this.namespaces.sld,"sld:MinScaleDenominator");f.appendChild(this.createTextNode(b.maxScale.toPrecision(10)));c.insertBefore(f,c.childNodes[3])}if(b.options.resolutions||b.options.scales||b.options.maxResolution||b.options.minScale){var a=this.createElementNS(this.namespaces.sld,"sld:MaxScaleDenominator");a.appendChild(this.createTextNode(b.minScale.toPrecision(10)));c.insertBefore(a,c.childNodes[4])}return c},CLASS_NAME:"OpenLayers.Format.WMC.v1_1_0"});OpenLayers.Format.WMSCapabilities=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:"1.1.1",version:null,parser:null,initialize:function(a){OpenLayers.Format.prototype.initialize.apply(this,[a]);this.options=a},read:function(g){if(typeof g=="string"){g=OpenLayers.Format.XML.prototype.read.apply(this,[g])}var c=g.documentElement;var b=this.version||c.getAttribute("version")||this.defaultVersion;if(!this.parser||this.parser.version!==b){var f=OpenLayers.Format.WMSCapabilities["v"+b.replace(/\./g,"_")];if(!f){throw"Can't find a WMS capabilities parser for version "+b}var k=new f(this.options)}var a=k.read(g);a.version=b;return a},CLASS_NAME:"OpenLayers.Format.WMSCapabilities"});OpenLayers.Format.WMSCapabilities.v1_1=OpenLayers.Class(OpenLayers.Format.XML,{initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);this.options=a},read:function(c){if(typeof c=="string"){c=OpenLayers.Format.XML.prototype.read.apply(this,[c])}var a={};var b=c.documentElement;this.runChildNodes(a,b);return a},runChildNodes:function(k,g){var c=g.childNodes;var b,f;for(var a=0;a<c.length;++a){b=c[a];if(b.nodeType==1){f=this["read_cap_"+b.nodeName];if(f){f.apply(this,[k,b])}}}},read_cap_Capability:function(a,c){var b={layers:[]};this.runChildNodes(b,c);a.capability=b},read_cap_Request:function(c,b){var a={};this.runChildNodes(a,b);c.request=a},read_cap_GetMap:function(c,b){var a={formats:[]};this.runChildNodes(a,b);c.getmap=a},read_cap_Format:function(b,a){if(b.formats){b.formats.push(this.getChildValue(a))}},read_cap_DCPType:function(c,b){var a=b.getElementsByTagName("OnlineResource");if(a.length>0){this.read_cap_OnlineResource(c,a[0])}},read_cap_Service:function(b,c){var a={};this.runChildNodes(a,c);b.service=a},read_cap_Layer:function(b,g,k){var m={formats:b.request.getmap.formats||[],styles:[],queryable:(g.getAttribute("queryable")==="1"||g.getAttribute("queryable")==="true")};if(k){m.styles=m.styles.concat(k.styles);m.llbbox=k.llbbox;m.minScale=k.minScale;m.maxScale=k.maxScale}var c=g.childNodes;var a,p,f;for(var l=0;l<c.length;++l){a=c[l];p=a.nodeName;f=this["read_cap_"+a.nodeName];if(f){if(p=="Layer"){f.apply(this,[b,a,m])}else{f.apply(this,[m,a])}}}if(m.name){var o=m.name.indexOf(":");if(o>0){m.prefix=m.name.substring(0,o)}b.layers.push(m)}},read_cap_ScaleHint:function(g,k){var f=k.getAttribute("min");var a=k.getAttribute("max");var c=Math.pow(2,0.5);var b=OpenLayers.INCHES_PER_UNIT.m;g.maxScale=parseFloat(((c*f)*b*OpenLayers.DOTS_PER_INCH).toPrecision(13));g.minScale=parseFloat(((c*a)*b*OpenLayers.DOTS_PER_INCH).toPrecision(13))},read_cap_Name:function(c,b){var a=this.getChildValue(b);if(a){c.name=a}},read_cap_Title:function(b,a){var c=this.getChildValue(a);if(c){b.title=c}},read_cap_Abstract:function(c,b){var a=this.getChildValue(b);if(a){c["abstract"]=a}},read_cap_LatLonBoundingBox:function(a,b){a.llbbox=[parseFloat(b.getAttribute("minx")),parseFloat(b.getAttribute("miny")),parseFloat(b.getAttribute("maxx")),parseFloat(b.getAttribute("maxy"))]},read_cap_Style:function(a,c){var b={};this.runChildNodes(b,c);a.styles.push(b)},read_cap_LegendURL:function(c,f){var b={width:f.getAttribute("width"),height:f.getAttribute("height")};var a=f.getElementsByTagName("OnlineResource");if(a.length>0){this.read_cap_OnlineResource(b,a[0])}c.legend=b},read_cap_OnlineResource:function(b,a){b.href=this.getAttributeNS(a,"http://www.w3.org/1999/xlink","href")},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1"});OpenLayers.Format.WMSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.0",initialize:function(a){OpenLayers.Format.WMSCapabilities.v1_1.prototype.initialize.apply(this,[a])},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_0"});OpenLayers.Format.WMSCapabilities.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.1",initialize:function(a){OpenLayers.Format.WMSCapabilities.v1_1.prototype.initialize.apply(this,[a])},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1"});OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},gmlFormat:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,arguments);OpenLayers.Util.extend(this,a);this.options=a},read:function(g){var a;if(typeof g=="string"){g=OpenLayers.Format.XML.prototype.read.apply(this,[g])}var b=g.documentElement;if(b){var c=this;var f=this["read_"+b.nodeName];if(f){a=f.call(this,b)}else{a=new OpenLayers.Format.GML((this.options?this.options:{})).read(g)}}else{a=g}return a},read_msGMLOutput:function(l){var f=[];var b=this.getSiblingNodesByTagCriteria(l,this.layerIdentifier);if(b){for(var m=0,q=b.length;m<q;++m){var c=b[m];var o=c.nodeName;if(c.prefix){o=o.split(":")[1]}var o=o.replace(this.layerIdentifier,"");var p=this.getSiblingNodesByTagCriteria(c,this.featureIdentifier);if(p){for(var k=0;k<p.length;k++){var a=p[k];var r=this.parseGeometry(a);var g=this.parseAttributes(a);var u=new OpenLayers.Feature.Vector(r,g,null);u.type=o;f.push(u)}}}}return f},read_FeatureInfoResponse:function(k){var c=[];var m=this.getElementsByTagNameNS(k,"*","FIELDS");for(var l=0,o=m.length;l<o;l++){var a=m[l];var p=null;var g={};for(var f=0,q=a.attributes.length;f<q;f++){var b=a.attributes[f];g[b.nodeName]=b.nodeValue}c.push(new OpenLayers.Feature.Vector(p,g,null))}return c},getSiblingNodesByTagCriteria:function(l,p){var a=[];var c,g,f,m,b;if(l&&l.hasChildNodes()){c=l.childNodes;f=c.length;for(var o=0;o<f;o++){b=c[o];while(b&&b.nodeType!=1){b=b.nextSibling;o++}g=(b?b.nodeName:"");if(g.length>0&&g.indexOf(p)>-1){a.push(b)}else{m=this.getSiblingNodesByTagCriteria(b,p);if(m.length>0){(a.length==0)?a=m:a.push(m)}}}}return a},parseAttributes:function(f){var g={};if(f.nodeType==1){var c=f.childNodes;n=c.length;for(var k=0;k<n;++k){var b=c[k];if(b.nodeType==1){var o=b.childNodes;if(o.length==1){var m=o[0];if(m.nodeType==3||m.nodeType==4){var a=(b.prefix)?b.nodeName.split(":")[1]:b.nodeName;var l=m.nodeValue.replace(this.regExes.trimSpace,"");g[a]=l}}}}}return g},parseGeometry:function(b){if(!this.gmlFormat){this.gmlFormat=new OpenLayers.Format.GML()}var a=this.gmlFormat.parseFeature(b);var c=null;if(a&&a.geometry){c=a.geometry.clone();a.destroy()}return c},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"});OpenLayers.Layer.WFS=OpenLayers.Class(OpenLayers.Layer.Vector,OpenLayers.Layer.Markers,{isBaseLayer:false,tile:null,ratio:2,DEFAULT_PARAMS:{service:"WFS",version:"1.0.0",request:"GetFeature"},featureClass:null,format:null,formatObject:null,formatOptions:null,vectorMode:true,encodeBBOX:false,extractAttributes:false,initialize:function(f,c,g,b){if(b==undefined){b={}}if(b.featureClass||!OpenLayers.Layer.Vector||!OpenLayers.Feature.Vector){this.vectorMode=false}OpenLayers.Util.extend(b,{reportError:false});var a=[];a.push(f,b);OpenLayers.Layer.Vector.prototype.initialize.apply(this,a);if(!this.renderer||!this.vectorMode){this.vectorMode=false;if(!b.featureClass){b.featureClass=OpenLayers.Feature.WFS}OpenLayers.Layer.Markers.prototype.initialize.apply(this,a)}if(this.params&&this.params.typename&&!this.options.typename){this.options.typename=this.params.typename}if(!this.options.geometry_column){this.options.geometry_column="the_geom"}this.params=OpenLayers.Util.applyDefaults(g,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));this.url=c},destroy:function(){if(this.vectorMode){OpenLayers.Layer.Vector.prototype.destroy.apply(this,arguments)}else{OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments)}if(this.tile){this.tile.destroy()}this.tile=null;this.ratio=null;this.featureClass=null;this.format=null;if(this.formatObject&&this.formatObject.destroy){this.formatObject.destroy()}this.formatObject=null;this.formatOptions=null;this.vectorMode=null;this.encodeBBOX=null;this.extractAttributes=null},setMap:function(b){if(this.vectorMode){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);var a={extractAttributes:this.extractAttributes};OpenLayers.Util.extend(a,this.formatOptions);if(this.map&&!this.projection.equals(this.map.getProjectionObject())){a.externalProjection=this.projection;a.internalProjection=this.map.getProjectionObject()}this.formatObject=this.format?new this.format(a):new OpenLayers.Format.GML(a)}else{OpenLayers.Layer.Markers.prototype.setMap.apply(this,arguments)}},moveTo:function(a,b,v){if(this.vectorMode){OpenLayers.Layer.Vector.prototype.moveTo.apply(this,arguments)}else{OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments)}if(v){return false}if(b){if(this.vectorMode){this.renderer.clear()}}if(this.options.minZoomLevel){OpenLayers.Console.warn(OpenLayers.i18n("minZoomLevelError"));if(this.map.getZoom()<this.options.minZoomLevel){return null}}if(a==null){a=this.map.getExtent()}var u=(this.tile==null);var l=(!u&&!this.tile.bounds.containsBounds(a));if(b||u||(!v&&l)){var c=a.getCenterLonLat();var r=a.getWidth()*this.ratio;var m=a.getHeight()*this.ratio;var p=new OpenLayers.Bounds(c.lon-(r/2),c.lat-(m/2),c.lon+(r/2),c.lat+(m/2));var A=this.map.getSize();A.w=A.w*this.ratio;A.h=A.h*this.ratio;var o=new OpenLayers.LonLat(p.left,p.top);var q=this.map.getLayerPxFromLonLat(o);var f=this.getFullRequestString();var k=null;var g=this.params.filter||this.params.FILTER;if(g){k={FILTER:g}}else{k={BBOX:this.encodeBBOX?p.toBBOX():p.toArray()}}if(this.map&&!this.projection.equals(this.map.getProjectionObject())){var B=p.clone();B.transform(this.map.getProjectionObject(),this.projection);if(!g){k.BBOX=this.encodeBBOX?B.toBBOX():B.toArray()}}f+="&"+OpenLayers.Util.getParameterString(k);if(!this.tile){this.tile=new OpenLayers.Tile.WFS(this,q,p,f,A);this.addTileMonitoringHooks(this.tile);this.tile.draw()}else{if(this.vectorMode){this.destroyFeatures();this.renderer.clear()}else{this.clearMarkers()}this.removeTileMonitoringHooks(this.tile);this.tile.destroy();this.tile=null;this.tile=new OpenLayers.Tile.WFS(this,q,p,f,A);this.addTileMonitoringHooks(this.tile);this.tile.draw()}}},addTileMonitoringHooks:function(a){a.onLoadStart=function(){if(this==this.layer.tile){this.layer.events.triggerEvent("loadstart")}};a.events.register("loadstart",a,a.onLoadStart);a.onLoadEnd=function(){if(this==this.layer.tile){this.layer.events.triggerEvent("tileloaded");this.layer.events.triggerEvent("loadend")}};a.events.register("loadend",a,a.onLoadEnd);a.events.register("unload",a,a.onLoadEnd)},removeTileMonitoringHooks:function(a){a.unload();a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,scope:a})},onMapResize:function(){if(this.vectorMode){OpenLayers.Layer.Vector.prototype.onMapResize.apply(this,arguments)}else{OpenLayers.Layer.Markers.prototype.onMapResize.apply(this,arguments)}},display:function(){if(this.vectorMode){OpenLayers.Layer.Vector.prototype.display.apply(this,arguments)}else{OpenLayers.Layer.Markers.prototype.display.apply(this,arguments)}},mergeNewParams:function(c){var b=OpenLayers.Util.upperCaseObject(c);var a=[b];return OpenLayers.Layer.HTTPRequest.prototype.mergeNewParams.apply(this,a)},clone:function(a){if(a==null){a=new OpenLayers.Layer.WFS(this.name,this.url,this.params,this.options)}if(this.vectorMode){a=OpenLayers.Layer.Vector.prototype.clone.apply(this,[a])}else{a=OpenLayers.Layer.Markers.prototype.clone.apply(this,[a])}return a},getFullRequestString:function(c,b){var a=this.projection.getCode()||this.map.getProjection();this.params.SRS=(a=="none")?null:a;return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},commit:function(){if(!this.writer){var a={};if(this.map&&!this.projection.equals(this.map.getProjectionObject())){a.externalProjection=this.projection;a.internalProjection=this.map.getProjectionObject()}this.writer=new OpenLayers.Format.WFS(a,this)}var b=this.writer.write(this.features);OpenLayers.Request.POST({url:this.url,data:b,success:this.commitSuccess,failure:this.commitFailure,scope:this})},commitSuccess:function(c){var a=c.responseText;if(a.indexOf("SUCCESS")!=-1){this.commitReport(OpenLayers.i18n("commitSuccess",{response:a}));for(var b=0;b<this.features.length;b++){this.features[b].state=null}}else{if(a.indexOf("FAILED")!=-1||a.indexOf("Exception")!=-1){this.commitReport(OpenLayers.i18n("commitFailed",{response:a}))}}},commitFailure:function(a){},commitReport:function(b,a){OpenLayers.Console.userError(b)},refresh:function(){if(this.tile){if(this.vectorMode){this.renderer.clear();this.features.length=0}else{this.clearMarkers();this.markers.length=0}this.tile.draw()}},getDataExtent:function(){var a;if(this.vectorMode){a=OpenLayers.Layer.Vector.prototype.getDataExtent.apply(this)}else{a=OpenLayers.Layer.Markers.prototype.getDataExtent.apply(this)}return a},setOpacity:function(a){if(this.vectorMode){OpenLayers.Layer.Vector.prototype.setOpacity.apply(this,[a])}else{OpenLayers.Layer.Markers.prototype.setOpacity.apply(this,[a])}},CLASS_NAME:"OpenLayers.Layer.WFS"});OpenLayers.Control.GetFeature=OpenLayers.Class(OpenLayers.Control,{protocol:null,multipleKey:null,toggleKey:null,modifiers:null,multiple:false,click:true,clickout:true,toggle:false,clickTolerance:5,hover:false,box:false,maxFeatures:10,features:null,hoverFeature:null,handlerOptions:null,handlers:null,hoverResponse:null,EVENT_TYPES:["featureselected","featureunselected","clickout","beforefeatureselected","hoverfeature","outfeature"],initialize:function(a){this.EVENT_TYPES=OpenLayers.Control.GetFeature.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);a.handlerOptions=a.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[a]);this.features={};this.handlers={};if(this.click){this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.selectSingle},this.handlerOptions.click||{})}if(this.box){this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},OpenLayers.Util.extend(this.handlerOptions.box,{boxDivClassName:"olHandlerBoxSelectFeature"}))}if(this.hover){this.handlers.hover=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.selectHover},OpenLayers.Util.extend(this.handlerOptions.hover,{delay:250}))}},activate:function(){if(!this.active){for(var a in this.handlers){this.handlers[a].activate()}}return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.active){for(var a in this.handlers){this.handlers[a].deactivate()}}return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(a){var c;for(var b=this.features.length-1;b>=0;--b){c=this.features[b];if(!a||a.except!=c){this.unselect(c)}}},selectSingle:function(a){OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");var b=this.pixelToBounds(a.xy);this.setModifiers(a);this.request(b,{single:true})},selectBox:function(a){if(a instanceof OpenLayers.Bounds){var f=this.map.getLonLatFromPixel(new OpenLayers.Pixel(a.left,a.bottom));var b=this.map.getLonLatFromPixel(new OpenLayers.Pixel(a.right,a.top));var c=new OpenLayers.Bounds(f.lon,f.lat,b.lon,b.lat);this.setModifiers(this.handlers.box.dragHandler.evt);this.request(c)}},selectHover:function(a){var b=this.pixelToBounds(a.xy);this.request(b,{single:true,hover:true})},cancelHover:function(){if(this.hoverResponse){this.protocol.abort(this.hoverResponse);this.hoverResponse=null}},request:function(f,b){b=b||{};var c=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:f});var a=this.protocol.read({maxFeatures:b.single==true?this.maxFeatures:undefined,filter:c,callback:function(g){if(g.code==1){if(g.features.length){if(b.single==true){this.selectBestFeature(g.features,f.getCenterLonLat(),b)}else{this.select(g.features)}}else{if(b.hover){this.hoverSelect()}else{this.events.triggerEvent("clickout");if(this.clickout){this.unselectAll()}}}}OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},scope:this});if(b.hover==true){this.hoverResponse=a}},selectBestFeature:function(b,a,o){o=o||{};if(b.length){var l=new OpenLayers.Geometry.Point(a.lon,a.lat);var m,f,g;var k=Number.MAX_VALUE;for(var c=0;c<b.length;++c){m=b[c];if(m.geometry){g=l.distanceTo(m.geometry,{edge:false});if(g<k){k=g;f=m;if(k==0){break}}}}if(o.hover==true){this.hoverSelect(f)}else{this.select(f||b)}}},setModifiers:function(a){this.modifiers={multiple:this.multiple||(this.multipleKey&&a[this.multipleKey]),toggle:this.toggle||(this.toggleKey&&a[this.toggleKey])}},select:function(f){if(!this.modifiers.multiple&&!this.modifiers.toggle){this.unselectAll()}if(!(f instanceof Array)){f=[f]}var c;for(var b=0,a=f.length;b<a;++b){c=f[b];if(this.features[c.fid||c.id]){if(this.modifiers.toggle){this.unselect(this.features[c.fid||c.id])}}else{cont=this.events.triggerEvent("beforefeatureselected",{feature:c});if(cont!==false){this.features[c.fid||c.id]=c;this.events.triggerEvent("featureselected",{feature:c})}}}},hoverSelect:function(a){var c=a?a.fid||a.id:null;var b=this.hoverFeature?this.hoverFeature.fid||this.hoverFeature.id:null;if(b&&b!=c){this.events.triggerEvent("outfeature",{feature:this.hoverFeature});this.hoverFeature=null}if(c&&c!=b){this.events.triggerEvent("hoverfeature",{feature:a});this.hoverFeature=a}},unselect:function(a){delete this.features[a.fid||a.id];this.events.triggerEvent("featureunselected",{feature:a})},unselectAll:function(){for(var a in this.features){this.unselect(this.features[a])}},setMap:function(b){for(var a in this.handlers){this.handlers[a].setMap(b)}OpenLayers.Control.prototype.setMap.apply(this,arguments)},pixelToBounds:function(b){var g=b.add(-this.clickTolerance/2,this.clickTolerance/2);var a=b.add(this.clickTolerance/2,-this.clickTolerance/2);var c=this.map.getLonLatFromPixel(g);var f=this.map.getLonLatFromPixel(a);return new OpenLayers.Bounds(c.lon,c.lat,f.lon,f.lat)},CLASS_NAME:"OpenLayers.Control.GetFeature"});OpenLayers.Control.MouseToolbar=OpenLayers.Class(OpenLayers.Control.MouseDefaults,{mode:null,buttons:null,direction:"vertical",buttonClicked:null,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,arguments);this.position=new OpenLayers.Pixel(OpenLayers.Control.MouseToolbar.X,OpenLayers.Control.MouseToolbar.Y);if(a){this.position=a}if(b){this.direction=b}this.measureDivs=[]},destroy:function(){for(var b in this.buttons){var a=this.buttons[b];a.map=null;a.events.destroy()}OpenLayers.Control.MouseDefaults.prototype.destroy.apply(this,arguments)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);OpenLayers.Control.MouseDefaults.prototype.draw.apply(this,arguments);this.buttons={};var b=new OpenLayers.Size(28,28);var a=new OpenLayers.Pixel(OpenLayers.Control.MouseToolbar.X,0);this._addButton("zoombox","drag-rectangle-off.png","drag-rectangle-on.png",a,b,"Shift->Drag to zoom to area");a=a.add((this.direction=="vertical"?0:b.w),(this.direction=="vertical"?b.h:0));this._addButton("pan","panning-hand-off.png","panning-hand-on.png",a,b,"Drag the map to pan.");a=a.add((this.direction=="vertical"?0:b.w),(this.direction=="vertical"?b.h:0));this.switchModeTo("pan");return this.div},_addButton:function(a,g,f,o,l,m){var k=OpenLayers.Util.getImagesLocation()+g;var c=OpenLayers.Util.getImagesLocation()+f;var b=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MouseToolbar_"+a,o,l,k,"absolute");this.div.appendChild(b);b.imgLocation=k;b.activeImgLocation=c;b.events=new OpenLayers.Events(this,b,null,true);b.events.on({mousedown:this.buttonDown,mouseup:this.buttonUp,dblclick:OpenLayers.Event.stop,scope:this});b.action=a;b.title=m;b.alt=m;b.map=this.map;this.buttons[a]=b;return b},buttonDown:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}this.buttonClicked=a.element.action;OpenLayers.Event.stop(a)},buttonUp:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}if(this.buttonClicked!=null){if(this.buttonClicked==a.element.action){this.switchModeTo(a.element.action)}OpenLayers.Event.stop(a);this.buttonClicked=null}},defaultDblClick:function(b){this.switchModeTo("pan");this.performedDrag=false;var a=this.map.getLonLatFromViewPortPx(b.xy);this.map.setCenter(a,this.map.zoom+1);OpenLayers.Event.stop(b);return false},defaultMouseDown:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}this.mouseDragStart=a.xy.clone();this.performedDrag=false;this.startViaKeyboard=false;if(a.shiftKey&&this.mode!="zoombox"){this.switchModeTo("zoombox");this.startViaKeyboard=true}else{if(a.altKey&&this.mode!="measure"){this.switchModeTo("measure")}else{if(!this.mode){this.switchModeTo("pan")}}}switch(this.mode){case"zoombox":this.map.div.style.cursor="crosshair";this.zoomBox=OpenLayers.Util.createDiv("zoomBox",this.mouseDragStart,null,null,"absolute","2px solid red");this.zoomBox.style.backgroundColor="white";this.zoomBox.style.filter="alpha(opacity=50)";this.zoomBox.style.opacity="0.50";this.zoomBox.style.fontSize="1px";this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.viewPortDiv.appendChild(this.zoomBox);this.performedDrag=true;break;case"measure":var c="";if(this.measureStart){var b=this.map.getLonLatFromViewPortPx(this.mouseDragStart);c=OpenLayers.Util.distVincenty(this.measureStart,b);c=Math.round(c*100)/100;c=c+"km";this.measureStartBox=this.measureBox}this.measureStart=this.map.getLonLatFromViewPortPx(this.mouseDragStart);this.measureBox=OpenLayers.Util.createDiv(null,this.mouseDragStart.add(-2-parseInt(this.map.layerContainerDiv.style.left),-2-parseInt(this.map.layerContainerDiv.style.top)),null,null,"absolute");this.measureBox.style.width="4px";this.measureBox.style.height="4px";this.measureBox.style.fontSize="1px";this.measureBox.style.backgroundColor="red";this.measureBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.layerContainerDiv.appendChild(this.measureBox);if(c){this.measureBoxDistance=OpenLayers.Util.createDiv(null,this.mouseDragStart.add(-2-parseInt(this.map.layerContainerDiv.style.left),2-parseInt(this.map.layerContainerDiv.style.top)),null,null,"absolute");this.measureBoxDistance.innerHTML=c;this.measureBoxDistance.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.layerContainerDiv.appendChild(this.measureBoxDistance);this.measureDivs.push(this.measureBoxDistance)}this.measureBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.layerContainerDiv.appendChild(this.measureBox);this.measureDivs.push(this.measureBox);break;default:this.map.div.style.cursor="move";break}document.onselectstart=function(){return false};OpenLayers.Event.stop(a)},switchModeTo:function(c){if(c!=this.mode){if(this.mode&&this.buttons[this.mode]){OpenLayers.Util.modifyAlphaImageDiv(this.buttons[this.mode],null,null,null,this.buttons[this.mode].imgLocation)}if(this.mode=="measure"&&c!="measure"){for(var b=0,a=this.measureDivs.length;b<a;b++){if(this.measureDivs[b]){this.map.layerContainerDiv.removeChild(this.measureDivs[b])}}this.measureDivs=[];this.measureStart=null}this.mode=c;if(this.buttons[c]){OpenLayers.Util.modifyAlphaImageDiv(this.buttons[c],null,null,null,this.buttons[c].activeImgLocation)}switch(this.mode){case"zoombox":this.map.div.style.cursor="crosshair";break;default:this.map.div.style.cursor="";break}}},leaveMode:function(){this.switchModeTo("pan")},defaultMouseMove:function(g){if(this.mouseDragStart!=null){switch(this.mode){case"zoombox":var f=Math.abs(this.mouseDragStart.x-g.xy.x);var b=Math.abs(this.mouseDragStart.y-g.xy.y);this.zoomBox.style.width=Math.max(1,f)+"px";this.zoomBox.style.height=Math.max(1,b)+"px";if(g.xy.x<this.mouseDragStart.x){this.zoomBox.style.left=g.xy.x+"px"}if(g.xy.y<this.mouseDragStart.y){this.zoomBox.style.top=g.xy.y+"px"}break;default:var f=this.mouseDragStart.x-g.xy.x;var b=this.mouseDragStart.y-g.xy.y;var k=this.map.getSize();var a=new OpenLayers.Pixel(k.w/2+f,k.h/2+b);var c=this.map.getLonLatFromViewPortPx(a);this.map.setCenter(c,null,true);this.mouseDragStart=g.xy.clone()}this.performedDrag=true}},defaultMouseUp:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}switch(this.mode){case"zoombox":this.zoomBoxEnd(a);if(this.startViaKeyboard){this.leaveMode()}break;case"pan":if(this.performedDrag){this.map.setCenter(this.map.center)}}document.onselectstart=null;this.mouseDragStart=null;this.map.div.style.cursor="default"},defaultMouseOut:function(a){if(this.mouseDragStart!=null&&OpenLayers.Util.mouseLeft(a,this.map.div)){if(this.zoomBox){this.removeZoomBox();if(this.startViaKeyboard){this.leaveMode()}}this.mouseDragStart=null;this.map.div.style.cursor="default"}},defaultClick:function(a){if(this.performedDrag){this.performedDrag=false;return false}},CLASS_NAME:"OpenLayers.Control.MouseToolbar"});OpenLayers.Control.MouseToolbar.X=6;OpenLayers.Control.MouseToolbar.Y=300;OpenLayers.Control.NavToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]);this.addControls([new OpenLayers.Control.Navigation(),new OpenLayers.Control.ZoomBox()])},draw:function(){var a=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);this.activateControl(this.controls[0]);return a},CLASS_NAME:"OpenLayers.Control.NavToolbar"});OpenLayers.Control.PanPanel=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]);this.addControls([new OpenLayers.Control.Pan(OpenLayers.Control.Pan.NORTH),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.SOUTH),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.EAST),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.WEST)])},CLASS_NAME:"OpenLayers.Control.PanPanel"});OpenLayers.Control.Pan=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,direction:null,type:OpenLayers.Control.TYPE_BUTTON,initialize:function(b,a){this.direction=b;this.CLASS_NAME+=this.direction;OpenLayers.Control.prototype.initialize.apply(this,[a])},trigger:function(){switch(this.direction){case OpenLayers.Control.Pan.NORTH:this.map.pan(0,-this.slideFactor);break;case OpenLayers.Control.Pan.SOUTH:this.map.pan(0,this.slideFactor);break;case OpenLayers.Control.Pan.WEST:this.map.pan(-this.slideFactor,0);break;case OpenLayers.Control.Pan.EAST:this.map.pan(this.slideFactor,0);break}},CLASS_NAME:"OpenLayers.Control.Pan"});OpenLayers.Control.Pan.NORTH="North";OpenLayers.Control.Pan.SOUTH="South";OpenLayers.Control.Pan.EAST="East";OpenLayers.Control.Pan.WEST="West";OpenLayers.Control.ZoomIn=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){this.map.zoomIn()},CLASS_NAME:"OpenLayers.Control.ZoomIn"});OpenLayers.Control.ZoomOut=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){this.map.zoomOut()},CLASS_NAME:"OpenLayers.Control.ZoomOut"});OpenLayers.Control.ZoomPanel=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]);this.addControls([new OpenLayers.Control.ZoomIn(),new OpenLayers.Control.ZoomToMaxExtent(),new OpenLayers.Control.ZoomOut()])},CLASS_NAME:"OpenLayers.Control.ZoomPanel"});OpenLayers.Control.EditingToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(c,b){OpenLayers.Control.Panel.prototype.initialize.apply(this,[b]);this.addControls([new OpenLayers.Control.Navigation()]);var a=[new OpenLayers.Control.DrawFeature(c,OpenLayers.Handler.Point,{displayClass:"olControlDrawFeaturePoint"}),new OpenLayers.Control.DrawFeature(c,OpenLayers.Handler.Path,{displayClass:"olControlDrawFeaturePath"}),new OpenLayers.Control.DrawFeature(c,OpenLayers.Handler.Polygon,{displayClass:"olControlDrawFeaturePolygon"})];this.addControls(a)},draw:function(){var a=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);this.activateControl(this.controls[0]);return a},CLASS_NAME:"OpenLayers.Control.EditingToolbar"});OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){if(!OpenLayers.Lang.code){OpenLayers.Lang.setCode()}return OpenLayers.Lang.code},setCode:function(b){var f;if(!b){b=(OpenLayers.Util.getBrowserName()=="msie")?navigator.userLanguage:navigator.language}var c=b.split("-");c[0]=c[0].toLowerCase();if(typeof OpenLayers.Lang[c[0]]=="object"){f=c[0]}if(c[1]){var a=c[0]+"-"+c[1].toUpperCase();if(typeof OpenLayers.Lang[a]=="object"){f=a}}if(!f){OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+c.join("-")+" dictionary, falling back to default language");f=OpenLayers.Lang.defaultCode}OpenLayers.Lang.code=f},translate:function(b,a){var f=OpenLayers.Lang[OpenLayers.Lang.getCode()];var c=f[b];if(!c){c=b}if(a){c=OpenLayers.String.format(c,a)}return c}};OpenLayers.i18n=OpenLayers.Lang.translate;OpenLayers.Lang.en={unhandledRequest:"Unhandled request return ${statusText}",permalink:"Permalink",overlays:"Overlays",baseLayer:"Base Layer",sameProjection:"The overview map only works when it is in the same projection as the main map",readNotImplemented:"Read not implemented.",writeNotImplemented:"Write not implemented.",noFID:"Can't update a feature for which there is no FID.",errorLoadingGML:"Error in loading GML file ${url}",browserNotSupported:"Your browser does not support vector rendering. Currently supported renderers are:\n${renderers}",componentShouldBe:"addFeatures : component should be an ${geomType}",getFeatureError:"getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.",minZoomLevelError:"The minZoomLevel property is only intended for use with the FixedZoomLevels-descendent layers. That this wfs layer checks for minZoomLevel is a relic of thepast. We cannot, however, remove it without possibly breaking OL based applications that may depend on it. Therefore we are deprecating it -- the minZoomLevel check below will be removed at 3.0. Please instead use min/max resolution setting as described here: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"WFS Transaction: SUCCESS ${response}",commitFailed:"WFS Transaction: FAILED ${response}",googleWarning:"The Google Layer was unable to load correctly.<br><br>To get rid of this message, select a new BaseLayer in the layer switcher in the upper-right corner.<br><br>Most likely, this is because the Google Maps library script was either not included, or does not contain the correct API key for your site.<br><br>Developers: For help getting this working correctly, <a href='http://trac.openlayers.org/wiki/Google' target='_blank'>click here</a>",getLayerWarning:"The ${layerType} Layer was unable to load correctly.<br><br>To get rid of this message, select a new BaseLayer in the layer switcher in the upper-right corner.<br><br>Most likely, this is because the ${layerLib} library script was not correctly included.<br><br>Developers: For help getting this working correctly, <a href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'>click here</a>",scale:"Scale = 1 : ${scaleDenom}",layerAlreadyAdded:"You tried to add the layer: ${layerName} to the map, but it has already been added",reprojectDeprecated:"You are using the 'reproject' option on the ${layerName} layer. This option is deprecated: its use was designed to support displaying data over commercial basemaps, but that functionality should now be achieved by using Spherical Mercator support. More information is available from http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"This method has been deprecated and will be removed in 3.0. Please use ${newMethod} instead.",boundsAddError:"You must pass both x and y values to the add function.",lonlatAddError:"You must pass both lon and lat values to the add function.",pixelAddError:"You must pass both x and y values to the add function.",unsupportedGeometryType:"Unsupported geometry type: ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition failed: element with id ${elemId} may be misplaced.",end:"",filterEvaluateNotImplemented:"evaluate is not implemented for this filter type."};OpenLayers.IAAA_MetadataURL=OpenLayers.Class({format:null,url:null,metadataType:null,initialize:function(c,b,a){this.format=c||"";this.url=b||"";this.metadataType=a||""},clone:function(){var a=new MetadataURL();a.format=this.format;a.url=this.url;a.metadataType=this.metadataType;return a},getFormat:function(){return this.format},setFormat:function(a){this.format=a},getURL:function(){return this.url},setURL:function(a){this.url=a},getMetadataType:function(){return this.metadataType},setMetadataType:function(a){this.metadataType=a},getURLFileName:function(){var b=this.url;var a=true;var c=b;while(a){if(c.indexOf("/")!=-1){c=c.substring(c.indexOf("/")+1,c.length)}else{a=false}}return c},CLASS_NAME:"OpenLayers.IAAA_MetadataURL"});OpenLayers.IAAA_Style=OpenLayers.Class.create();OpenLayers.IAAA_Style.prototype={name:null,title:null,layer:null,legendList:null,initialize:function(b,f,g,a){this.legendList=new Array();this.name=b;if(g!=null){this.title=g;this.layer=f}else{this.title=b}if(a!=null){for(var c in a){this.legendList[c]=a[c]}}},setLayer:function(a){this.layer=a},getLegendList:function(){return this.legendList},getName:function(){return this.name},getTitle:function(){return this.title},setName:function(a){this.name=a},setTitle:function(a){this.title=a},setLegendList:function(a){this.legendList=a},CLASS_NAME:"OpenLayers.IAAA_Style"};OpenLayers.IAAA_WMS=OpenLayers.Class.create();OpenLayers.IAAA_WMS.prototype={ISPARENTLAYER:false,name:null,title:null,styleList:null,styleSelected:0,modifiable:true,queryable:false,parent:null,visibility:false,excluder:false,metadataURLList:new Array(),removeable:true,treeNode:null,attribution:null,service:"WMS",maxSupportedExtent:null,minSupportedScale:null,maxSupportedScale:null,initialize:function(b,g,f,a){this.name=b;this.title=g;if(f){this.setStyleList(f)}else{this.styleList=new Array(new OpenLayers.IAAA_Style("default",this,"Default"))}this.styleSelected=0;for(var c in a){this[c]=a[c]}},getModifiable:function(){return this.modifiable},getQueryable:function(){return this.queryable},setParent:function(a){this.parent=a},getParent:function(){return this.parent},getChildLayerList:function(){return new Array()},getStyleList:function(){return this.styleList},getMetadataURLList:function(){return this.metadataURLList},getStyleSelected:function(){return this.styleSelected},getTitle:function(){return this.title},getName:function(){return this.name},setModifiable:function(a){this.modifiable=a},setQueryable:function(a){this.queryable=a},setLayerName:function(a){this.name=a},setLayerTitle:function(a){this.title=a},setStyleList:function(b){this.styleList=b;for(var a in b){b[a].setLayer(this)}},setStyleSelected:function(a){this.styleSelected=a},setMetadataURLList:function(a){this.metadataURLList=a},getVisibility:function(){return this.visibility},setVisibility:function(b,a){this.visibility=b;if(this.isExcluder()&&this.parent){if(this.parent.CLASS_NAME=="OpenLayers.Layer.IAAA_Server"&&b){this.parent.updateExcluderLayers(this,a)}else{if(this.parent.CLASS_NAME=="OpenLayers.IAAA_WMS.IAAA_ParentLayer"&&b){if(this.parent.parent&&(this.parent.parent.CLASS_NAME=="OpenLayers.Layer.IAAA_Server"&&b)){this.parent.parent.updateExcluderLayers(this,a)}}}}if(!a){if(this.parent!=null){this.parent.updateVisibility()}}},isExcluder:function(){return this.excluder},setExcluder:function(a){this.excluder=a},getTreeNode:function(){return this.treeNode},setTreeNode:function(a){this.treeNode=a},setAttribution:function(a){this.attribution=a},getAttribution:function(){return this.attribution},setMaxSupportedExtent:function(a){this.maxSupportedExtent=a},setMinSupportedScale:function(a){this.minSupportedScale=a},setMaxSupportedScale:function(a){this.maxSupportedScale=a},CLASS_NAME:"OpenLayers.IAAA_WMS"};OpenLayers.IAAA_Utils={};OpenLayers.IAAA_Utils.doParseSLD=false;OpenLayers.IAAA_Utils.isNetscape=function(){if(document.all){if(navigator.userAgent.indexOf("Opera")!=-1&&document.getElementById){return true}return false}else{return true}};OpenLayers.IAAA_Utils.getNavigator=function(){var f="firefox";var c="3.x";var l=window.navigator.userAgent.toLowerCase();if(/firefox[\/\s](\d+\.\d+)/.test(l)){f="firefox";var g=new Number(RegExp.$1);if(g>=3){c="3.x"}else{if(g>=2){c="2.x"}else{if(g>=1){c="1.x"}}}}else{if(/msie (\d+\.\d+);/.test(l)){f="msie";var b=new Number(RegExp.$1);if(b>=8){c="8.x"}else{if(b>=7){c="7.x"}else{if(b>=6){c="6.x"}else{if(b>=5){c="5.x"}}}}}else{if(/opera[\/\s](\d+\.\d+)/.test(l)){f="opera";var k=new Number(RegExp.$1);if(k>=10){c="10.x"}else{if(k>=9){c="9.x"}else{if(k>=8){c="8.x"}else{if(k>=7){c="7.x"}}}}}else{if(/webkit/.test(l)&&!/chrome/.test(l)){f="safari";c=(l.match(/.+(?:rv|it|ra|ie|me)[\/: ]([\d.]+)/)||[])[1]}else{if(/chrome/.test(l)){f="chrome";c=(l.match(/.+(?:rv|it|ra|ie|me)[\/: ]([\d.]+)/)||[])[1]}}}}}var a=new Array(2);a[0]=f;a[1]=c;return a};OpenLayers.IAAA_Utils.Trim=function(a){while((a.substring(0,1)==" ")||(a.substring(0,1)=="\n")||(a.substring(0,1)=="\r")){a=a.substring(1,a.length)}while((a.substring(a.length-1,a.length)==" ")||(a.substring(a.length-1,a.length)=="\n")||(a.substring(a.length-1,a.length)=="\r")){a=a.substring(0,a.length-1)}return a};OpenLayers.IAAA_Utils.replaceCad=function(k,g,f){var a=k+"";var b="";while(a.indexOf(g)!=-1){var c=a.indexOf(g);b+=a.substring(0,c)+f;a=a.substring(c+g.length)}return(b+a)};OpenLayers.IAAA_Utils.ADD_WMS_FACADE=0;OpenLayers.IAAA_Utils.ADD_WMS_LOAD_FROM_TREE=1;OpenLayers.IAAA_Utils.ADD_WMS_TREE=2;OpenLayers.IAAA_Utils.ADD_LAYER_TREE=3;OpenLayers.IAAA_Utils.addElementType=-1;try{var mapReference=parent.frames.mapFrame}catch(e){}OpenLayers.IAAA_Utils.initAddElement=function(a){if(isClientReady()){OpenLayers.IAAA_Utils.addElementType=a;parent.setClientReady(false);try{if(a==OpenLayers.IAAA_Utils.ADD_LAYER_TREE){document.getElementById("addingLabel").firstChild.nodeValue=messages.addingLayer}else{document.getElementById("addingLabel").firstChild.nodeValue=messages.addingWMS}}catch(b){}}};OpenLayers.IAAA_Utils.endAddElement=function(){try{if((OpenLayers.IAAA_Utils.addElementWindow!=null)&&(OpenLayers.IAAA_Utils.addElementWindow.document!=null)){if(OpenLayers.IAAA_Utils.isNetscape()){OpenLayers.IAAA_Utils.addElementWindow.location="vacio.html?bgColor=#D4D0C8";OpenLayers.IAAA_Utils.addElementWindow.close()}else{OpenLayers.IAAA_Utils.addElementWindow.close()}}}catch(a){}OpenLayers.IAAA_Utils.addElementWindow=null;OpenLayers.IAAA_Utils.setNullNewAddWMS();mapReference.parent.setClientReady(true);enableMainClient();if(hideLoadingWMSDiv){hideLoadingWMSDiv()}};OpenLayers.IAAA_Utils.numAddWMSList=0;OpenLayers.IAAA_Utils.urlAddWMSList=new Array(0);OpenLayers.IAAA_Utils.titleAddWMSList=new Array(0);OpenLayers.IAAA_Utils.versionAddWMSList=new Array(0);OpenLayers.IAAA_Utils.numLoadedAddWMSList=-1;OpenLayers.IAAA_Utils.initAddWMSList=function(a,c,b){OpenLayers.IAAA_Utils.urlAddWMSList=a;OpenLayers.IAAA_Utils.titleAddWMSList=c;OpenLayers.IAAA_Utils.versionAddWMSList=b;OpenLayers.IAAA_Utils.numAddWMSList=a.length;OpenLayers.IAAA_Utils.doNextAddWMSList()};OpenLayers.IAAA_Utils.doNextAddWMSList=function(){OpenLayers.IAAA_Utils.numLoadedAddWMSList++;if(OpenLayers.IAAA_Utils.numLoadedAddWMSList<OpenLayers.IAAA_Utils.numAddWMSList){var g=OpenLayers.IAAA_Utils.urlAddWMSList[OpenLayers.IAAA_Utils.numLoadedAddWMSList];var k=OpenLayers.IAAA_Utils.titleAddWMSList[OpenLayers.IAAA_Utils.numLoadedAddWMSList];var c=OpenLayers.IAAA_Utils.versionAddWMSList[OpenLayers.IAAA_Utils.numLoadedAddWMSList];OpenLayers.IAAA_Utils.createNewAddWMS(self);var b=OpenLayers.IAAA_Utils.setVersion(c);var l=g;if(l.indexOf("?")!=-1){if(l.indexOf("?")==(l.length-1)){l=l.substring(0,l.length-1)}else{l=replaceCad(l,"?","&")}}var f="";if(OpenLayers.IAAA_Utils.relayServlet.indexOf("?")!=-1){f=OpenLayers.IAAA_Utils.relayServlet+"&URL="+l+"&outputType=1"}else{f=OpenLayers.IAAA_Utils.relayServlet+"?URL="+l+"&outputType=1"}f+="&"+b[0]+"="+c+"&REQUEST="+b[1];var a=c.split(".");if((a[1]>=1)&&(a[2]>=1)){f+="&useRequestValue=false"}OpenLayers.IAAA_Utils.setParserProperties(g,k,c,false,false,self);OpenLayers.IAAA_Utils.loadWMSListXML(f)}else{if(OpenLayers.IAAA_Utils.numAddWMSList>0){OpenLayers.IAAA_Utils.endAddElement()}OpenLayers.IAAA_Utils.numLoadedAddWMSList=-1;OpenLayers.IAAA_Utils.numAddWMSList=0;OpenLayers.IAAA_Utils.urlAddWMSList=new Array(0);OpenLayers.IAAA_Utils.titleAddWMSList=new Array(0);OpenLayers.IAAA_Utils.versionAddWMSList=new Array(0)}};OpenLayers.IAAA_Utils.loadWMSListXML=function(a){if(window.XMLHttpRequest){req=new XMLHttpRequest();req.onreadystatechange=OpenLayers.IAAA_Utils.handlerWhenAddWMSListLoaded;req.open("GET",a,true);req.send(null)}else{if(window.ActiveXObject){req=new ActiveXObject("Microsoft.XMLHTTP");if(req){req.onreadystatechange=OpenLayers.IAAA_Utils.handlerWhenAddWMSListLoaded;req.open("GET",a,true);req.send()}}}};OpenLayers.IAAA_Utils.setNewAddWMS=function(b,a){OpenLayers.IAAA_Utils.newAddWMS=b;OpenLayers.IAAA_Utils.indexNewAddWMS=a};OpenLayers.IAAA_Utils.addingWMSFromTree=false;OpenLayers.IAAA_Utils.addWMSFromLoadTree=function(l){if(!OpenLayers.IAAA_Utils.addingWMSFromTree){OpenLayers.IAAA_Utils.addingWMSFromTree=true}else{return -1}if(l>=0&&l<getMap().layers.length){var o=getMap().layers[l];var a=o.getTitle();var c=o.url;var f=o.getVersion();var m=!o.singleTile;var g=o.isWMSC;OpenLayers.IAAA_Utils.initAddElement(OpenLayers.IAAA_Utils.ADD_WMS_LOAD_FROM_TREE);OpenLayers.IAAA_Utils.setNewAddWMS(o,l);var p=OpenLayers.IAAA_Utils.setVersion(f);var b=c;if(b.indexOf("?")!=-1){if(b.indexOf("?")==(b.length-1)){b=b.substring(0,b.length-1)}else{b=OpenLayers.IAAA_Utils.replaceCad(b,"?","&")}}var k=OpenLayers.IAAA_Utils.relayServlet+"?URL="+b+"&outputType=1";k+="&"+p[0]+"="+f+"&REQUEST="+p[1];OpenLayers.IAAA_Utils.setParserProperties(c,a,f,m,g,self);OpenLayers.IAAA_Utils.loadXML(k)}return 1};OpenLayers.IAAA_Utils.setVersion=function(g,b){if(b==null){b="WMS"}var c="VERSION";var f="GetCapabilities";if((b=="WMS")&&g&&(g.length>0)){switch(g.charAt(0)){case"0":c="WMTVER";f="GetCapabilities";break;case"1":if(g.length>2){if(g.charAt(2)=="0"){c="WMTVER";f="capabilities"}else{c="VERSION";f="GetCapabilities"}}else{c="VERSION";f="GetCapabilities"}break;default:c="VERSION";f="GetCapabilities"}}var a=new Array(2);a[0]=c;a[1]=f;return a};OpenLayers.IAAA_Utils.setParserProperties=function(g,m,l,f,k,c,b,a){OpenLayers.IAAA_Utils.urlWMS=g;OpenLayers.IAAA_Utils.nameWMS=m;OpenLayers.IAAA_Utils.versionWMS=l;OpenLayers.IAAA_Utils.tileWMS=f;OpenLayers.IAAA_Utils.isWMSC=k;ref=c};OpenLayers.IAAA_Utils.loadXML=function(c,b,a){if(b){mapReference=b}if(!a){a="WMS"}if(window.XMLHttpRequest){req=new XMLHttpRequest();req.onreadystatechange=function(){OpenLayers.IAAA_Utils.handlerWhenAddElementLoaded(a)};req.open("GET",c,true);req.send(null)}else{if(window.ActiveXObject){req=new ActiveXObject("Microsoft.XMLHTTP");if(req){req.onreadystatechange=function(){OpenLayers.IAAA_Utils.handlerWhenAddElementLoaded(a)};req.open("GET",c,true);req.send()}}}};OpenLayers.IAAA_Utils.loadWMSContextFromCapabilities=function(c,b){if(b){mapReference=b}var k=c.url;var a=OpenLayers.IAAA_Utils.setVersion(c.getVersion());if(k.indexOf("?")!=-1){if(k.indexOf("?")==(k.length-1)){k=k.substring(0,k.length-1)}else{k=OpenLayers.IAAA_Utils.replaceCad(k,"?","&")}}var g="";if(OpenLayers.IAAA_Utils.relayServlet.indexOf("?")!=-1){g=OpenLayers.IAAA_Utils.relayServlet+"&URL="+k+"&outputType=1"}else{g=OpenLayers.IAAA_Utils.relayServlet+"?URL="+k+"&outputType=1"}g+="&"+a[0]+"="+c.getVersion()+"&REQUEST="+a[1];var f=c.getVersion().split(".");if((f[1]>=1)&&(f[2]>=1)){g+="&useRequestValue=false"}OpenLayers.IAAA_Utils.newAddWMS=c;if(window.XMLHttpRequest){req=new XMLHttpRequest();req.open("GET",g,false);req.setRequestHeader("Content-Type","application/x-www-form-urlencoded");req.send(null)}else{if(window.ActiveXObject){req=new ActiveXObject("Microsoft.XMLHTTP");if(req){req.open("GET",g,false);req.setRequestHeader("Content-Type","application/x-www-form-urlencoded");req.send()}}}OpenLayers.IAAA_Utils.handlerWhenWMSContextLoaded(req)};OpenLayers.IAAA_Utils.loadKMLFromPath=function(c,b){var a=new OpenLayers.Layer.IAAA_KML("KML Layer",c,{format:OpenLayers.Format.IAAA_KML,formatOptions:{extractStyles:true,extractAttributes:true,maxDepth:2},errorMessage:messages.errorLoadingKML,tempURL:b});getMap().addLayer(a);if(getTree&&getTree()){getTree().addNode("WMS",[getMap().layers.length-1])}};OpenLayers.IAAA_Utils.newAddWMS=null;OpenLayers.IAAA_Utils.indexNewAddWMS=-1;OpenLayers.IAAA_Utils.addElementWindow=null;OpenLayers.IAAA_Utils.addElementType=-1;OpenLayers.IAAA_Utils.setNullNewAddWMS=function(){OpenLayers.IAAA_Utils.newAddWMS=null;OpenLayers.IAAA_Utils.indexNewAddWMS=-1};OpenLayers.IAAA_Utils.handlerWhenAddElementLoaded=function(q){try{var a=getMap();if(req.readyState==4){if(req.status==200){if((!OpenLayers.IAAA_Utils.newAddWMS)||(!OpenLayers.IAAA_Utils.newAddWMS.getTreeNode())){if(q=="WMS"){if(OpenLayers.IAAA_Utils.doParseSLD){OpenLayers.IAAA_Utils.newAddWMS=OpenLayers.IAAA_Utils.parseCapabilitiesXML(OpenLayers.IAAA_Utils.newAddWMS,req.responseXML,OpenLayers.IAAA_Utils.urlWMS,OpenLayers.IAAA_Utils.nameWMS,OpenLayers.IAAA_Utils.versionWMS,OpenLayers.IAAA_Utils.tileWMS,OpenLayers.IAAA_Utils.isWMSC,true)}else{OpenLayers.IAAA_Utils.newAddWMS=OpenLayers.IAAA_Utils.parseCapabilitiesXML(OpenLayers.IAAA_Utils.newAddWMS,req.responseXML,OpenLayers.IAAA_Utils.urlWMS,OpenLayers.IAAA_Utils.nameWMS,OpenLayers.IAAA_Utils.versionWMS,OpenLayers.IAAA_Utils.tileWMS,OpenLayers.IAAA_Utils.isWMSC,false)}}else{if(q=="WFS"){OpenLayers.IAAA_Utils.newAddWMS=OpenLayers.IAAA_Utils.parseWFSCapabilitiesXML(OpenLayers.IAAA_Utils.newAddWMS,req.responseXML,OpenLayers.IAAA_Utils.urlWMS,OpenLayers.IAAA_Utils.nameWMS,OpenLayers.IAAA_Utils.versionWMS,OpenLayers.IAAA_Utils.tileWMS,OpenLayers.IAAA_Utils.isWMSC,false)}}}else{var b=OpenLayers.IAAA_Utils.newAddWMS.getTreeNode();if(q=="WMS"){OpenLayers.IAAA_Utils.newAddWMS=OpenLayers.IAAA_Utils.parseCapabilitiesXML(OpenLayers.IAAA_Utils.newAddWMS,req.responseXML,OpenLayers.IAAA_Utils.urlWMS,OpenLayers.IAAA_Utils.nameWMS,OpenLayers.IAAA_Utils.versionWMS,OpenLayers.IAAA_Utils.tileWMS,OpenLayers.IAAA_Utils.isWMSC,false)}else{if(q=="WFS"){OpenLayers.IAAA_Utils.newAddWMS=OpenLayers.IAAA_Utils.parseWFSCapabilitiesXML(OpenLayers.IAAA_Utils.newAddWMS,req.responseXML,OpenLayers.IAAA_Utils.urlWMS,OpenLayers.IAAA_Utils.nameWMS,OpenLayers.IAAA_Utils.versionWMS,OpenLayers.IAAA_Utils.tileWMS,OpenLayers.IAAA_Utils.isWMSC,false)}}OpenLayers.IAAA_Utils.newAddWMS.setTreeNode(b)}var c=(OpenLayers.IAAA_Utils.newAddWMS.isWMSC&&OpenLayers.IAAA_Utils.newAddWMS.maxExtent&&OpenLayers.IAAA_Utils.newAddWMS.resolutions&&OpenLayers.IAAA_Utils.newAddWMS.getSRSList()[OpenLayers.IAAA_Utils.newAddWMS.getSelectedSRS()]);if(c&&(OpenLayers.IAAA_Utils.newAddWMS.CLASS_NAME=="OpenLayers.Layer.IAAA_Server")&&a.ancientMaxExtent&&a.ancientResolutions){var l=false;if(OpenLayers.IAAA_Utils.newAddWMS.resolutions.length==a.resolutions.length){l=true;for(var p in a.resolutions){l=l&&(OpenLayers.IAAA_Utils.newAddWMS.resolutions[p]==a.resolutions[p])}}if((OpenLayers.IAAA_Utils.newAddWMS.maxExtent.left!=a.maxExtent.left)||(OpenLayers.IAAA_Utils.newAddWMS.maxExtent.bottom!=a.maxExtent.bottom)||(OpenLayers.IAAA_Utils.newAddWMS.maxExtent.right!=a.maxExtent.right)||(OpenLayers.IAAA_Utils.newAddWMS.maxExtent.top!=a.maxExtent.top)||(!l)||(OpenLayers.IAAA_Utils.newAddWMS.getSRSList()[OpenLayers.IAAA_Utils.newAddWMS.getSelectedSRS()]!=a.getProjection())){var u=[];for(var m in a.layers){if((a.layers[m].CLASS_NAME=="OpenLayers.Layer.IAAA_Server")&&a.layers[m].isWMSC&&(!a.layers[m].getLoadFromTree())){u.push(a.layers[m].name)}}var o="<center>"+messages.WMSCIncompatibility1+" "+OpenLayers.IAAA_Utils.newAddWMS.name+" ";if(u.length==1){o+=messages.WMSCIncompatibility2+u[0]+" "+messages.WMSCIncompatibility3+"</center>";o+="<br><center>"+messages.WMSCIncompatibility4}else{if(u.length>1){o+=messages.WMSCIncompatibility5+"</center>";for(var g in u){o+="<center>- "+u[g]+"</center>"}o+="<br><center>"+messages.WMSCIncompatibility6}}o+=OpenLayers.IAAA_Utils.newAddWMS.name+messages.WMSCIncompatibility7+"</center>";a.setIncompatibleWMSCText(o);a.showIncompatibleWMSCDialog();return}}var v=0;if(OpenLayers.IAAA_Utils.getAddElementType()==OpenLayers.IAAA_Utils.ADD_WMS_FACADE){var B=new Array(OpenLayers.IAAA_Utils.newAddWMS.getLayerList().length);var A=0;for(var p=OpenLayers.IAAA_Utils.newAddWMS.getLayerList().length-1;p>=0;p--){B[A]=OpenLayers.IAAA_Utils.newAddWMS.getLayerList()[p];A++}B[0].setVisibility(true);if(B[0].getChildLayerList().length>0){B[0].getChildLayerList()[0].setVisibility(true)}OpenLayers.IAAA_Utils.doAddWMS(a,OpenLayers.IAAA_Utils.newAddWMS,B,indexReference)}else{if(OpenLayers.IAAA_Utils.getAddElementType()==OpenLayers.IAAA_Utils.ADD_WMS_TREE){if(OpenLayers.IAAA_Utils.addElementWindow!=null){OpenLayers.IAAA_Utils.addElementWindow.closedByOK=true;OpenLayers.IAAA_Utils.addElementWindow.self.location="addWMSCapabilities.html?lang="+lang;OpenLayers.IAAA_Utils.addElementWindow.resizeTo(450,580)}else{alert(messages.blockWindowFirefox);OpenLayers.IAAA_Utils.endAddElement()}}else{if(OpenLayers.IAAA_Utils.getAddElementType()==OpenLayers.IAAA_Utils.ADD_WMS_LOAD_FROM_TREE){var B=[];var f=OpenLayers.IAAA_Utils.newAddWMS.getLayerList();for(var p=f.length-1;p>=0;p--){B[(f.length-1)-p]=OpenLayers.IAAA_Utils.newAddWMS.getLayerList()[p]}if(OpenLayers.IAAA_Utils.newAddWMS.isWMSC&&OpenLayers.IAAA_Utils.newAddWMS.maxExtent&&OpenLayers.IAAA_Utils.newAddWMS.resolutions&&OpenLayers.IAAA_Utils.newAddWMS.getSRSList()[OpenLayers.IAAA_Utils.newAddWMS.getSelectedSRS()]&&((!getMap().ancientMaxExtent)||(getMap().ancientResolutions.length==0))){getMap().changeMapPropertiesForWMSC(OpenLayers.IAAA_Utils.newAddWMS)}OpenLayers.IAAA_Utils.newAddWMS.setLayerList(B);OpenLayers.IAAA_Utils.doAddWMSLoadFromTree(OpenLayers.IAAA_Utils.newAddWMS)}else{if(OpenLayers.IAAA_Utils.getAddElementType()==OpenLayers.IAAA_Utils.ADD_LAYER_TREE){if(OpenLayers.IAAA_Utils.addElementWindow!=null){OpenLayers.IAAA_Utils.addElementWindow.showAddedWMS()}else{OpenLayers.IAAA_Utils.endAddElement()}}else{alert(messages.parsingCapabilitiesError);OpenLayers.IAAA_Utils.addingWMSFromTree=false;OpenLayers.IAAA_Utils.endAddElement()}}}}}else{alert(messages.parsingCapabilitiesError);if(OpenLayers.IAAA_Utils.getAddElementType()==OpenLayers.IAAA_Utils.ADD_WMS_LOAD_FROM_TREE&&OpenLayers.IAAA_Utils.indexNewAddWMS!=-1){OpenLayers.IAAA_Utils.newAddWMS.getTreeNode().collapse()}OpenLayers.IAAA_Utils.addingWMSFromTree=false;OpenLayers.IAAA_Utils.endAddElement()}}}catch(r){alert(messages.parsingCapabilitiesError);if(OpenLayers.IAAA_Utils.getAddElementType()==OpenLayers.IAAA_Utils.ADD_WMS_LOAD_FROM_TREE&&OpenLayers.IAAA_Utils.indexNewAddWMS!=-1){OpenLayers.IAAA_Utils.newAddWMS.getTreeNode().collapse()}OpenLayers.IAAA_Utils.addingWMSFromTree=false;OpenLayers.IAAA_Utils.endAddElement()}};OpenLayers.IAAA_Utils.handlerWhenAddWMSListLoaded=function(){try{if(req.readyState==4){if(req.status==200){OpenLayers.IAAA_Utils.newAddWMS=OpenLayers.IAAA_Utils.parseCapabilitiesXML(OpenLayers.IAAA_Utils.newAddWMS,req.responseXML,OpenLayers.IAAA_Utils.urlWMS,OpenLayers.IAAA_Utils.nameWMS,OpenLayers.IAAA_Utils.versionWMS,OpenLayers.IAAA_Utils.tileWMS,OpenLayers.IAAA_Utils.isWMSC);var b=0;if(OpenLayers.IAAA_Utils.getAddElementType()==OpenLayers.IAAA_Utils.ADD_WMS_FACADE){var c=new Array(OpenLayers.IAAA_Utils.newAddWMS.getLayerList().length);var a=0;for(var g=OpenLayers.IAAA_Utils.newAddWMS.getLayerList().length-1;g>=0;g--){c[a]=OpenLayers.IAAA_Utils.newAddWMS.getLayerList()[g];a++}OpenLayers.IAAA_Utils.newAddWMS.setLayerList(c);if(OpenLayers.IAAA_Utils.newAddWMS.getLayerList().length>0){var k=OpenLayers.IAAA_Utils.newAddWMS.getLayerList()[0];k.setVisibility(true);for(var f=0;f<k.getChildLayerList().length;g++){k.getChildLayerList()[f].setVisibility(true)}}OpenLayers.IAAA_Utils.doAddWMSList()}}else{OpenLayers.IAAA_Utils.addingWMSFromTree=false;OpenLayers.IAAA_Utils.doNextAddWMSList()}}}catch(l){alert(indexReference.messages.parsingCapabilitiesError);addingWMSFromTree=false;OpenLayers.IAAA_Utils.doNextAddWMSList()}};OpenLayers.IAAA_Utils.handlerWhenWMSContextLoaded=function(a){try{var c=getMap();if(a.readyState==4){if(a.status==200){OpenLayers.IAAA_Utils.newAddWMS=OpenLayers.IAAA_Utils.parseWMSContext(OpenLayers.IAAA_Utils.newAddWMS,a.responseXML)}else{alert(messages.parsingCapabilitiesError);if(OpenLayers.IAAA_Utils.getAddElementType()==OpenLayers.IAAA_Utils.ADD_WMS_LOAD_FROM_TREE&&OpenLayers.IAAA_Utils.indexNewAddWMS!=-1){OpenLayers.IAAA_Utils.newAddWMS.getTreeNode().collapse()}OpenLayers.IAAA_Utils.addingWMSFromTree=false;OpenLayers.IAAA_Utils.endAddElement()}}}catch(b){alert(messages.parsingCapabilitiesError);if(OpenLayers.IAAA_Utils.getAddElementType()==OpenLayers.IAAA_Utils.ADD_WMS_LOAD_FROM_TREE&&OpenLayers.IAAA_Utils.indexNewAddWMS!=-1){OpenLayers.IAAA_Utils.newAddWMS.getTreeNode().collapse()}OpenLayers.IAAA_Utils.addingWMSFromTree=false;OpenLayers.IAAA_Utils.endAddElement()}};OpenLayers.IAAA_Utils.doAddWMSList=function(){getMap().addLayer(OpenLayers.IAAA_Utils.newAddWMS);try{if(getTree&&getTree()){var a=[getMap().layers.length-1];getTree().addNode("WMS",a);getTree().selectNode("WMS",a);getTree().open("WMS",a)}}catch(b){}if((!this.ignoreScope)&&(!OpenLayers.IAAA_Utils.newAddWMS.inSupportedRange())){alert(messages.WMSOutOfScope)}OpenLayers.IAAA_Utils.doNextAddWMSList()};OpenLayers.IAAA_Utils.getAddElementType=function(){return OpenLayers.IAAA_Utils.addElementType};OpenLayers.IAAA_Utils.parseCapabilitiesXML=function(r,m,O,at,aa,C,ah,Y){var af=Y||false;var J=m.getElementsByTagName("WMS_Capabilities").item(0);J=J?J:m.getElementsByTagName("WMT_MS_Capabilities").item(0);if(J&&J.getAttribute("version")){aa=J.getAttribute("version")}r=new OpenLayers.Layer.IAAA_Server(at,O,{transparent:"true",format:"image/png",version:aa},{visibility:false,singleTile:!C,showLoadingIcon:true,ratio:1,clearBeforeLoading:true,isWMSC:ah,ignoreScope:false});var B="";var Z="";var M=null;var ap=m.getElementsByTagName("Service").item(0);var H=false;for(var ay=0;ay<ap.childNodes.length;ay++){var T=ap.childNodes.item(ay);if((T.nodeName.toUpperCase()=="NAME")&&T.childNodes&&T.childNodes.item(0)){B=T.childNodes.item(0).nodeValue}else{if((T.nodeName.toUpperCase()=="TITLE")&&T.childNodes&&T.childNodes.item(0)){var o=T.childNodes.item(0).nodeValue;try{Z=OpenLayers.IAAA_Utils.decode_utf8(o)}catch(aw){Z=o}}else{if((T.nodeName.toUpperCase()=="ACCESSCONSTRAINTS")&&T.childNodes&&T.childNodes.item(0)){accessConstraintsAux=T.childNodes.item(0).nodeValue;try{M=OpenLayers.IAAA_Utils.decode_utf8(accessConstraintsAux)}catch(aw){M=accessConstraintsAux}}}}}if(at==""){if(Z!=""){at=Z}else{if(B!=""){at=B}}}if(at==""){at="WMS"+numWMS}r.name=at;r.accessConstraints=M;var E=m.getElementsByTagName("Capability").item(0);for(var ay=0;ay<E.childNodes.length;ay++){var T=E.childNodes.item(ay);if((T.nodeName.toUpperCase()=="EXCEPTION")&&T.childNodes){var p=new Array();var ac=0;var aB=0;for(var an=0;an<T.childNodes.length;an++){var k=T.childNodes.item(an);if((k.nodeName.toUpperCase()=="FORMAT")&&k.childNodes&&k.childNodes.item(0)){var q=k.childNodes.item(0).nodeValue;p[ac]=q;if(q.indexOf("inimage")!=-1){aB=ac}ac++}}r.setException(p[aB])}else{if((T.nodeName.toUpperCase()=="REQUEST")&&T.childNodes){for(var an=0;an<T.childNodes.length;an++){var X=T.childNodes.item(an);if((X.nodeName.toUpperCase()=="GETMAP")&&X.childNodes){var A=new Array();var ac=0;for(var al=0;al<X.childNodes.length;al++){var b=X.childNodes.item(al);if((b.nodeName.toUpperCase()=="FORMAT")&&b.childNodes){var V=b.childNodes.item(0).nodeValue;A[ac]=V;ac++}}r.setFormatList(A)}}}else{if((T.nodeName.toUpperCase()=="LAYER")&&T.childNodes){var aj=new Array();var F=0;var aA=new Array();var v=0;var l=null;var R=new Array();for(var an=0;an<T.childNodes.length;an++){var ax=T.childNodes.item(an);if((ax.nodeName.toUpperCase()=="SRS")&&ax.childNodes){var aD=quotedStringToVector(ax.childNodes.item(0).nodeValue," ");for(var g=0;g<aD.length;g++){aA[v]=aD[g];v++}}else{if((ax.nodeName.toUpperCase()=="CRS")&&ax.childNodes){var aD=quotedStringToVector(ax.childNodes.item(0).nodeValue," ");for(var g=0;g<aD.length;g++){aA[v]=aD[g];v++}}else{if((ax.nodeName.toUpperCase()=="LATLONBOUNDINGBOX")&&(((parseInt(aa[0])==1)&&(parseInt(aa[2])<=1))||(parseInt(aa[0])==0))&&ax.childNodes){var av=ax.getAttribute("minx");var D=ax.getAttribute("miny");var K=ax.getAttribute("maxx");var am=ax.getAttribute("maxy");r.maxSupportedExtent=new OpenLayers.IAAA_Bounds(av,D,K,am);r.maxSupportedExtent.setSrs("EPSG:4326");r.mainLayerMaxSupportedExtent=r.maxSupportedExtent}else{if((ax.nodeName.toUpperCase()=="EX_GEOGRAPHICBOUNDINGBOX")&&((parseInt(aa[0])>1)||((parseInt(aa[0])==1)&&(parseInt(aa[2])>1)))&&ax.childNodes){var av,D,K,am;for(var al=0;al<ax.childNodes.length;al++){var ao=ax.childNodes.item(al);if(ao.nodeName.toUpperCase()=="WESTBOUNDLONGITUDE"){av=ao.childNodes.item(0).nodeValue}if(ao.nodeName.toUpperCase()=="EASTBOUNDLONGITUDE"){K=ao.childNodes.item(0).nodeValue}if(ao.nodeName.toUpperCase()=="SOUTHBOUNDLONGITUDE"){D=ao.childNodes.item(0).nodeValue}if(ao.nodeName.toUpperCase()=="NORTHBOUNDLONGITUDE"){am=ao.childNodes.item(0).nodeValue}}if(av&&D&&K&&am){r.maxSupportedExtent=new OpenLayers.IAAA_Bounds(av,D,K,am);r.maxSupportedExtent.setSrs("EPSG:4326");r.mainLayerMaxSupportedExtent=r.maxSupportedExtent}}else{if((ax.nodeName.toUpperCase()=="MINSCALEDENOMINATOR")&&((parseInt(aa[0])>1)||((parseInt(aa[0])==1)&&(parseInt(aa[2])>1)))&&ax.childNodes&&ax.childNodes.item(0)){r.minSupportedScale=parseFloat(ax.childNodes.item(0).nodeValue);r.mainLayerMinSupportedScale=r.minSupportedScale}else{if((ax.nodeName.toUpperCase()=="MAXSCALEDENOMINATOR")&&((parseInt(aa[0])>1)||((parseInt(aa[0])==1)&&(parseInt(aa[2])>1)))&&ax.childNodes&&ax.childNodes.item(0)){r.maxSupportedScale=parseFloat(ax.childNodes.item(0).nodeValue);r.mainLayerMaxSupportedScale=r.maxSupportedScale}else{if((ax.nodeName.toUpperCase()=="SCALEHINT")&&(((parseInt(aa[0])==1)&&(parseInt(aa[2])<=1))||(parseInt(aa[0])==0))){var ai=parseFloat(ax.getAttribute("min"));var u=parseFloat(ax.getAttribute("max"));if(ai&&parseInt(ai)){r.minSupportedScale=(parseInt(ai)*1000)/0.44;r.mainLayerMinSupportedScale=r.minSupportedScale}if(u&&parseInt(u)){r.maxSupportedScale=(parseInt(u)*1000)/0.44;r.mainLayerMaxSupportedScale=r.maxSupportedScale}}else{if((ax.nodeName.toUpperCase()=="ATTRIBUTION")&&ax.childNodes){var I=null;var au=null;for(var al=0;al<ax.childNodes.length;al++){var ao=ax.childNodes.item(al);if((ao.nodeName.toUpperCase()=="TITLE")&&ao.childNodes&&ao.childNodes.item(0)){I=ao.childNodes.item(0).nodeValue}else{if(ao.nodeName.toUpperCase()=="ONLINERESOURCE"){if(ao.getAttribute("xlink:href")!=null){au=ao.getAttribute("xlink:href")}else{if(ao.getAttribute("href")!=null){au=ao.getAttribute("href")}}}}}r.mainAttribution={title:I,url:au}}else{if((ax.nodeName.toUpperCase()=="TITLE")&&ax.childNodes&&ax.childNodes.item(0)){l=ax.childNodes.item(0).nodeValue}else{if(ax.nodeName.toUpperCase()=="STYLE"){for(var al=0;al<ax.childNodes.length;al++){var ad=ax.childNodes.item(al);if(ad.nodeName.toUpperCase()=="LEGENDURL"){var a,aC,ag;var ae=0;if(ad.getAttribute("width")!=null){aC=parseInt(ad.getAttribute("width"))}if(ad.getAttribute("height")!=null){ag=parseInt(ad.getAttribute("height"))}for(var ak=0;ak<ad.childNodes.length;ak++){var Q=ad.childNodes.item(ak);if(Q.nodeName.toUpperCase()=="ONLINERESOURCE"){if(Q.getAttribute("xlink:href")!=null){a=Q.getAttribute("xlink:href")}else{if(Q.getAttribute("href")!=null){a=Q.getAttribute("href")}}}}if(a){R[ae]={url:a,width:aC,height:ag};ae++}}}}else{if(ax.nodeName.toUpperCase()=="LAYER"){var c=OpenLayers.IAAA_Utils.parseLayerXML(ax,1,O);aj[F]=c;F++}}}}}}}}}}}}if(aA.length>0){r.setSRSList(aA);r.setSelectedSRS(0)}r.setLayerList(aj);r.setMainLayerTitle(l);r.setLegendList(R)}else{if((T.nodeName.toUpperCase()=="VENDORSPECIFICCAPABILITIES")&&ah&&T.childNodes){for(var an=0;an<T.childNodes.length;an++){var f=T.childNodes.item(an);if((f.nodeName.toUpperCase()=="TILESET")&&f.childNodes&&(!H)){for(var al=0;al<f.childNodes.length;al++){var G=f.childNodes.item(al);if(G.nodeName.toUpperCase()=="BOUNDINGBOX"){var av=G.getAttribute("minx");var D=G.getAttribute("miny");var K=G.getAttribute("maxx");var am=G.getAttribute("maxy");var U=G.getAttribute("SRS");var ar=new OpenLayers.Bounds(av,D,K,am);r.maxExtent=ar}if(G.nodeName.toUpperCase()=="RESOLUTIONS"){var S=G.childNodes.item(0).nodeValue.split(" ");r.resolutions=S}if(G.nodeName.toUpperCase()=="WIDTH"){var az=G.childNodes.item(0).nodeValue}if(G.nodeName.toUpperCase()=="HEIGHT"){var aq=G.childNodes.item(0).nodeValue}if(G.nodeName.toUpperCase()=="SRS"){var ab=G.childNodes.item(0).nodeValue;r.setSRSList([ab]);r.setSelectedSRS(0)}}H=true;r.setTileSize(new OpenLayers.Size(az,aq))}}}else{if(T.nodeName.toUpperCase()=="USERDEFINEDSYMBOLIZATION"){if(af){if(T.getAttribute("SupportSLD")!=null){valor=T.getAttribute("SupportSLD");if(valor==1){isSLD=true}else{isSLD=false}}r.setIsSLD(isSLD)}}}}}}}OpenLayers.IAAA_Utils.addingWMSFromTree=false;return r};OpenLayers.IAAA_Utils.parseWFSCapabilitiesXML=function(E,S,U,H,J,f,l){var c="http://www.opengis.net/wfs";var q="http://www.opengis.net/ows";try{var O=S.getElementsByTagNameNS(c,"WFS_Capabilities").item(0)}catch(M){var O=S.getElementsByTagName("wfs:WFS_Capabilities").item(0)}if(O==null){O=S.getElementsByTagName("WFS_Capabilities").item(0)}if(O&&O.getAttribute("version")){J=O.getAttribute("version")}E=new OpenLayers.Layer.IAAA_ServerWFS(H,U,{version:J},{visibility:false,singleTile:!f,showLoadingIcon:true,ratio:1,clearBeforeLoading:true,isWMSC:l,ignoreScope:false,displayOutsideMaxExtent:true,urlServlet:getHost()+urlRelayServlet,useWCTS:true,urlWCTS:wctsServer});var V="";var T="";var o=null;try{var b=S.getElementsByTagNameNS(q,"ServiceIdentification").item(0)}catch(M){var b=S.getElementsByTagName("ows:ServiceIdentification").item(0)}if(b==null){b=S.getElementsByTagName("Service").item(0)}for(var r=0;r<b.childNodes.length;r++){var p=b.childNodes.item(r);if((p.nodeName.toUpperCase()=="OWS:ACCESSCONSTRAINTS")||(p.nodeName.toUpperCase()=="ACCESSCONSTRAINTS")){accessConstraintsAux=p.childNodes.item(0).nodeValue;try{o=OpenLayers.IAAA_Utils.decode_utf8(accessConstraintsAux)}catch(M){o=accessConstraintsAux}}else{if((p.nodeName.toUpperCase()=="OWS:NAME")||(p.nodeName.toUpperCase()=="NAME")){V=p.childNodes.item(0).nodeValue}else{if((p.nodeName.toUpperCase()=="OWS:TITLE")||(p.nodeName.toUpperCase()=="TITLE")){T=p.childNodes.item(0).nodeValue}}}}E.accessConstraints=o;if(H==""){if(V!=""){H=V}else{if(T!=""){H=T}else{H="WFS"}}}E.name=H;try{var C=S.getElementsByTagNameNS(c,"FeatureTypeList").item(0)}catch(M){var C=S.getElementsByTagName("wfs:FeatureTypeList").item(0)}if(C==null){C=S.getElementsByTagName("FeatureTypeList").item(0)}var k=[];var u=[];var K=[];for(var r=0;r<C.childNodes.length;r++){var p=C.childNodes.item(r);if((p.nodeName.toUpperCase()=="WFS:FEATURETYPE")||(p.nodeName.toUpperCase()=="FEATURETYPE")){var g={};var D="";var G="";var a=false;var v="";for(var F=0;F<p.childNodes.length;F++){var m=p.childNodes.item(F);if((m.nodeName.toUpperCase()=="WFS:NAME")||(m.nodeName.toUpperCase()=="NAME")){g.name=m.childNodes.item(0).nodeValue;if(g.name.indexOf(":")!=-1){var R=OpenLayers.IAAA_Utils.quotedStringToVector(g.name,":");v=R[0];a=true}}else{if((m.nodeName.toUpperCase()=="WFS:TITLE")||(m.nodeName.toUpperCase()=="TITLE")){g.title=m.childNodes.item(0).nodeValue}else{if((m.nodeName.toUpperCase()=="WFS:DEFAULTSRS")||(m.nodeName.toUpperCase()=="DEFAULTSRS")){D=m.childNodes.item(0).nodeValue}else{if((m.nodeName.toUpperCase()=="WFS:SRS")||(m.nodeName.toUpperCase()=="SRS")||(m.nodeName.toUpperCase()=="WFS:OTHERSRS")||(m.nodeName.toUpperCase()=="OTHERSRS")){if(G==""){G=m.childNodes.item(0).nodeValue}}}}}}if(D!=""){g.srs=D}else{if(G!=""){g.srs=G}else{g.srs="EPSG:4258"}}var B=true;for(var I in u){if(u[I]==g.srs){B=false;break}}if(B){u.push(g.srs)}if(a){var A="xmlns:"+v;if(p.getAttribute(A)){g.namespace=v;g.namespaceURI=p.getAttribute(A)}}k.push(g);var Q=new OpenLayers.IAAA_WMS(g.name,g.title,[],{service:"WFS"});Q.setVisibility(false);Q.setModifiable(true);Q.setQueryable(false);K.push(Q)}}E.setFeatureList(k);if(u.length>0){E.setSRSList(u);E.setSelectedSRS(0)}E.setLayerList(K);E.setFormatList([]);E.setFormatSelected(0);OpenLayers.IAAA_Utils.addingWMSFromTree=false;return E};OpenLayers.IAAA_Utils.parseLayerXML=function(al,g,H){var b=new OpenLayers.IAAA_WMS(null,H);b.setVisibility(false);b.setModifiable(true);b.setQueryable(false);if(al.getAttribute("queryable")!=null){var J=parseInt(al.getAttribute("queryable"));if(J==1){b.setQueryable(true)}}var T=new Array();var an=0;var c=new Array();var A=0;var U=new Array();var ao=0;var am="";var l="";for(var ab=(al.childNodes.length-1);ab>=0;ab--){var ah=al.childNodes.item(ab);if((ah.nodeName.toUpperCase()=="NAME")&&ah.childNodes&&ah.childNodes.item(0)){am=ah.childNodes.item(0).nodeValue;b.setLayerName(ah.childNodes.item(0).nodeValue)}else{if((ah.nodeName.toUpperCase()=="TITLE")&&ah.childNodes){if(ah.childNodes.item(0)){l=ah.childNodes.item(0).nodeValue;try{b.setLayerTitle(OpenLayers.IAAA_Utils.decode_utf8(l))}catch(ak){b.setLayerTitle(l)}}}else{if(ah.nodeName.toUpperCase()=="LATLONBOUNDINGBOX"){var ai=ah.getAttribute("minx");var v=ah.getAttribute("miny");var C=ah.getAttribute("maxx");var aa=ah.getAttribute("maxy");b.maxSupportedExtent=new OpenLayers.IAAA_Bounds(ai,v,C,aa);b.maxSupportedExtent.setSrs("EPSG:4326")}else{if(ah.nodeName.toUpperCase()=="EX_GEOGRAPHICBOUNDINGBOX"){var ai,v,C,aa;for(var Y=0;Y<ah.childNodes.length;Y++){var ac=ah.childNodes.item(Y);if(ac.nodeName.toUpperCase()=="WESTBOUNDLONGITUDE"){ai=ac.childNodes.item(0).nodeValue}if(ac.nodeName.toUpperCase()=="EASTBOUNDLONGITUDE"){C=ac.childNodes.item(0).nodeValue}if(ac.nodeName.toUpperCase()=="SOUTHBOUNDLONGITUDE"){v=ac.childNodes.item(0).nodeValue}if(ac.nodeName.toUpperCase()=="NORTHBOUNDLONGITUDE"){aa=ac.childNodes.item(0).nodeValue}}if(ai&&v&&C&&aa){b.maxSupportedExtent=new OpenLayers.IAAA_Bounds(ai,v,C,aa);b.maxSupportedExtent.setSrs("EPSG:4326")}}else{if((ah.nodeName.toUpperCase()=="MINSCALEDENOMINATOR")&&ah.childNodes.item(0)){b.minSupportedScale=parseFloat(ah.childNodes.item(0).nodeValue)}else{if((ah.nodeName.toUpperCase()=="MAXSCALEDENOMINATOR")&&ah.childNodes.item(0)){b.maxSupportedScale=parseFloat(ah.childNodes.item(0).nodeValue)}else{if(ah.nodeName.toUpperCase()=="SCALEHINT"){var R=parseFloat(ah.getAttribute("min"));var q=parseFloat(ah.getAttribute("max"));if(R&&parseInt(R)){b.minSupportedScale=(parseInt(R)*1000)/0.44}if(q&&parseInt(q)){b.maxSupportedScale=(parseInt(q)*1000)/0.44}}else{if((ah.nodeName.toUpperCase()=="ATTRIBUTION")&&ah.nodeName){var B=null;var aj=null;for(var Z=0;Z<ah.childNodes.length;Z++){var ac=ah.childNodes.item(Z);if((ac.nodeName.toUpperCase()=="TITLE")&&ac.childNodes&&ac.childNodes.item(0)){B=ac.childNodes.item(0).nodeValue}else{if(ac.nodeName.toUpperCase()=="ONLINERESOURCE"){if(ac.getAttribute("xlink:href")!=null){aj=ac.getAttribute("xlink:href")}else{if(ac.getAttribute("href")!=null){aj=ac.getAttribute("href")}}}}}b.setAttribution({title:B,url:aj})}else{if(ah.nodeName.toUpperCase()=="LAYER"){var X=OpenLayers.IAAA_Utils.parseLayerXML(ah,g++,H);X.parent=b;c[A]=X;A++}else{if((ah.nodeName.toUpperCase()=="STYLE")&&ah.childNodes){var ad=new OpenLayers.IAAA_Style();ad.setName("default");ad.setTitle("default");var E=new Array();var M=0;for(var Z=0;Z<ah.childNodes.length;Z++){var K=ah.childNodes.item(Z);if((K.nodeName.toUpperCase()=="NAME")&&K.childNodes&&K.childNodes.item(0)){ad.setName(K.childNodes.item(0).nodeValue)}else{if((K.nodeName.toUpperCase()=="TITLE")&&K.childNodes&&K.childNodes.item(0)){var F=K.childNodes.item(0).nodeValue;try{ad.setTitle(OpenLayers.IAAA_Utils.decode_utf8(F))}catch(ak){ad.setTitle(F)}}else{if(K.nodeName.toUpperCase()=="LEGENDURL"){var a,ap,O;if(K.getAttribute("width")!=null){ap=parseInt(K.getAttribute("width"))}if(K.getAttribute("height")!=null){O=parseInt(K.getAttribute("height"))}for(var Y=0;Y<K.childNodes.length;Y++){var D=K.childNodes.item(Y);if(D.nodeName.toUpperCase()=="ONLINERESOURCE"){if(D.getAttribute("xlink:href")!=null){a=D.getAttribute("xlink:href")}else{if(D.getAttribute("href")!=null){a=D.getAttribute("href")}}}}if(a){E[M]={url:a,width:ap,height:O};M++}}}}}ad.setLegendList(E);U[ao]=ad;ao++}else{if(ah.nodeName.toUpperCase()=="METADATAURL"){var r=new OpenLayers.IAAA_MetadataURL();if(ah.getAttribute("type")!=null){r.setMetadataType(ah.getAttribute("type"))}if(ah.childNodes){for(var Z=0;Z<ah.childNodes.length;Z++){var u=ah.childNodes.item(Z);if(u.nodeName.toUpperCase()=="FORMAT"){r.setFormat(u.childNodes.item(0).nodeValue)}else{if(u.nodeName.toUpperCase()=="ONLINERESOURCE"){var f="";if(u.getAttribute("xlink:href")!=null){f=u.getAttribute("xlink:href")}else{if(u.getAttribute("href")!=null){f=u.getAttribute("href")}}r.setURL(f)}}}}T[an]=r;an++}else{if(ah.nodeName.toUpperCase()=="FEATURELISTURL"){}}}}}}}}}}}}}var p="";if(c.length>0){b=new OpenLayers.IAAA_WMS.IAAA_ParentLayer(am,l);if(am==""){var I="";for(var ag in c){if(ag>0){am=am+",";I=I+","}am=am+c[ag].name;I=I+c[ag].styleList[c[ag].styleSelected].name}b.setLayerName(am);b.setStyleList([new OpenLayers.IAAA_Style(I,null,"Default")])}}b.setMetadataURLList(T);if(U.length==0){if(c.length>0){var o=new Array();var G=new Array();var m=0;for(var af=0;af<c.length;af++){var X=c[af];o[af]=new Array();m=Math.max(X.getStyleList().length,m);for(var ae=0;ae<X.getStyleList().length;ae++){o[af][ae]=X.getStyleList()[ae];G[af]=X.name}}var Q=new Array(m);for(var af=0;af<m;af++){Q[af]=""}var S=0;for(var af=0;af<o.length;af++){if(p==""){p+=G[af]}else{p+=","+G[af]}for(var ae=0;ae<m;ae++){if(o[af][ae]){if(Q[ae]==""){Q[ae]+=o[af][ae].getName()}else{Q[ae]+=","+o[af][ae].getName()}}else{if(Q[ae]==""){Q[ae]+="default"}else{Q[ae]+=",default"}}}}U=new Array(m);for(var ae=0;ae<m;ae++){var ad=new OpenLayers.IAAA_Style();ad.setTitle("Default");ad.setName(Q[ae]);U[ae]=ad}}else{var ad=new OpenLayers.IAAA_Style();ad.setName("");ad.setTitle("");U=new Array(1);U[0]=ad}}var V=new Array();for(var ae=(U.length-1);ae>=0;ae--){V.push(U[ae])}b.setStyleList(V);b.setStyleSelected(0);if(b.name==""){if(c.length>0){var am="";for(var af=0;af<c.length;af++){if(am==""){am+=c[af].name}else{am+=","+c[af].name}}b.name=am}}if(p!=""){b.name=p}if(c.length>0){b.setChildLayerList(c)}return b};OpenLayers.IAAA_Utils.parseWMSContext=function(b,M){var K=M.getElementsByTagName("Service").item(0);for(var o=0;o<K.childNodes.length;o++){var l=K.childNodes.item(o);if((l.nodeName.toUpperCase()=="ACCESSCONSTRAINTS")&&l.childNodes&&l.childNodes.item(0)){accessConstraintsAux=l.childNodes.item(0).nodeValue;try{b.accessConstraints=OpenLayers.IAAA_Utils.decode_utf8(accessConstraintsAux)}catch(J){b.accessConstraints=accessConstraintsAux}}}var m=M.getElementsByTagName("Capability").item(0);for(var o=0;o<m.childNodes.length;o++){var l=m.childNodes.item(o);if((l.nodeName.toUpperCase()=="LAYER")&&l.childNodes){for(var E=0;E<l.childNodes.length;E++){var C=l.childNodes.item(E);if((C.nodeName.toUpperCase()=="ATTRIBUTION")&&C.childNodes){var g=null;var a=null;for(var B=0;B<C.childNodes.length;B++){var v=C.childNodes.item(B);if(v.nodeName.toUpperCase()=="TITLE"){g=v.childNodes.item(0).nodeValue}else{if(v.nodeName.toUpperCase()=="ONLINERESOURCE"){if(v.getAttribute("xlink:href")!=null){a=v.getAttribute("xlink:href")}else{if(v.getAttribute("href")!=null){a=v.getAttribute("href")}}}}}b.mainAttribution={title:g,url:a}}else{if((C.nodeName.toUpperCase()=="LAYER")&&C.childNodes){var I=null;var g=null;var a=null;for(var A=(C.childNodes.length-1);A>=0;A--){var f=C.childNodes.item(A);if((f.nodeName.toUpperCase()=="NAME")&&f.childNodes&&f.childNodes.item(0)){I=f.childNodes.item(0).nodeValue}else{if((f.nodeName.toUpperCase()=="ATTRIBUTION")&&f.childNodes){var g=null;var a=null;var k=null;for(var u=0;u<f.childNodes.length;u++){var v=f.childNodes.item(u);if((v.nodeName.toUpperCase()=="TITLE")&&v.childNodes&&v.childNodes.item(0)){g=v.childNodes.item(0).nodeValue}else{if(v.nodeName.toUpperCase()=="ONLINERESOURCE"){if(v.getAttribute("xlink:href")!=null){a=v.getAttribute("xlink:href")}else{if(v.getAttribute("href")!=null){a=v.getAttribute("href")}}}}}}else{if((f.nodeName.toUpperCase()=="ACCESSCONSTRAINTS")&&f.childNodes&&f.childNodes.item(0)){accessConstraintsAux=f.childNodes.item(0).nodeValue;try{k=OpenLayers.IAAA_Utils.decode_utf8(accessConstraintsAux)}catch(J){k=accessConstraintsAux}}else{if((f.nodeName.toUpperCase()=="LAYER")&&f.childNodes){var p=null;var H=null;var G=null;var c=null;for(var u=(f.childNodes.length-1);u>=0;u--){var r=f.childNodes.item(u);if((r.nodeName.toUpperCase()=="NAME")&&r.childNodes&&r.childNodes.item(0)){p=r.childNodes.item(0).nodeValue}else{if((r.nodeName.toUpperCase()=="ATTRIBUTION")&&r.childNodes){H=null;a=null;for(var q=0;q<r.childNodes.length;q++){var v=r.childNodes.item(q);if((v.nodeName.toUpperCase()=="TITLE")&&v.childNodes&&v.childNodes.item(0)){H=v.childNodes.item(0).nodeValue}else{if(v.nodeName.toUpperCase()=="ONLINERESOURCE"){if(v.getAttribute("xlink:href")!=null){G=v.getAttribute("xlink:href")}else{if(v.getAttribute("href")!=null){G=v.getAttribute("href")}}}}}}else{if((f.nodeName.toUpperCase()=="ACCESSCONSTRAINTS")&&f.childNodes&&f.childNodes.item(0)){accessConstraintsAux=f.childNodes.item(0).nodeValue;try{c=OpenLayers.IAAA_Utils.decode_utf8(accessConstraintsAux)}catch(J){c=accessConstraintsAux}}}}}if(p&&(H||c)){for(var F in b.layers){if(b.layers[F].name==p){for(var D in b.layers[F].getChildLayerList()){if(b.layers[F].getChildLayerList()[D].name==p){b.layers[F].getChildLayerList()[D].setAttribution({title:H,url:G});b.layers[F].getChildLayerList()[D].accessConstraints=c}}}}}}}}}}if(I&&(g||k)){for(var F in b.layers){if(b.layers[F].name==I){b.layers[F].setAttribution({title:g,url:a});b.layers[F].accessConstraints=k}}}}}}}}return b};OpenLayers.IAAA_Utils.doAddWMS=function(l,a,g,k){a.setLayerList(g);l.addLayer(a);n=l.layers.length-1;var b=[];b[0]=n;b[2]=n;k.frames.tree.tree.addNode("WMS",b);for(var c=0;c<g.length;c++){var f=g[c].getChildLayerList().length;b[1]=c;k.frames.tree.tree.addNode("WMS_LAYER",b)}k.frames.tree.tree.selectNode("WMS",b);if(k.frames.tree.tree.hasChildren("WMS",b)){k.frames.tree.tree.open("WMS",[n])}else{k.frames.tree.tree.open("WMS",[n]);k.frames.tree.tree.close("WMS",[n])}if((a.CLASS_NAME=="OpenLayers.Layer.IAAA_Server")&&(!a.ignoreScope)&&(!a.inSupportedRange())){alert(messages.WMSOutOfScope)}OpenLayers.IAAA_Utils.endAddElement()};OpenLayers.IAAA_Utils.isLayerInLayers=function(b,f){var c=false;var a;for(a=0;a<f.length;a++){if(f[a].name==b.name){c=true;break}}if(!c){a=-1}return[c,a]};OpenLayers.IAAA_Utils.doAddWMSLayers=function(J,u,F,H){var A=u.getTreeNode();var o=[];o[0]=parseInt(A.widgetId.split("_")[1]);var G=u.getLayerList().length;if(u.getLayerList().length>0){H.frames.tree.tree.open("WMS",[o[0]])}var f=0;var m=0;for(var E=0;E<F.length;E++){if(E<u.getLayerList().length){f=u.getLayerList()[E].getChildLayerList().length}else{f=F[E].getChildLayerList().length}var c=0;var g=0;if(!F[E].ISPARENTLAYER){if(!OpenLayers.IAAA_Utils.isLayerInLayers(F[E],u.getLayerList())[0]){u.addLayer(F[E]);c=u.getLayerIndex(F[E].name,F[E].name);o[1]=G+m;m++;H.frames.tree.tree.addNode("WMS_LAYER",o);if(c>=0){o[1]=c}}}else{var b=false;for(var D=0;D<u.getLayerList().length;D++){if((u.layers[D].ISPARENTLAYER)&&(u.layers[D].title==F[E].title)){var a=[];var v=[];for(var C=0;C<F[E].childLayers.length;C++){var r=OpenLayers.IAAA_Utils.isLayerInLayers(F[E].childLayers[C],u.layers[D].childLayers);var l=!r[0];var q=r[1];if(l){a.push(F[E].childLayers[C]);a[a.length-1].setParent(u.layers[D])}else{var B;var I;if(u.layers[D].childLayers[q].childLayers){B=u.layers[D].childLayers[q].childLayers.length;var M=[];for(var p in F[E].childLayers[C].childLayers){if(!OpenLayers.IAAA_Utils.isLayerInLayers(F[E].childLayers[C].childLayers[p],u.layers[D].childLayers[q].childLayers)[0]){M.push(F[E].childLayers[C].childLayers[p]);M[M.length-1].setParent(u.layers[D].childLayers[q])}}u.layers[D].childLayers[q].childLayers=u.layers[D].childLayers[q].childLayers.concat(M);I=u.layers[D].childLayers[q].childLayers.length}else{B=0;if(F[E].childLayers[C].childLayers){u.layers[D].childLayers[q].childLayers=F[E].childLayers[C].childLayers;I=u.layers[D].childLayers[q].childLayers.length}else{I=0}}u.layers[D].childLayers[q].addNewChilds=true;u.layers[D].childLayers[q].n1=B;u.layers[D].childLayers[q].n2=I;v.push(u.layers[D].childLayers[q]);v[v.length-1].index=q}}f=u.layers[D].childLayers.length;u.layers[D].childLayers=u.layers[D].childLayers.concat(a);b=true;g=u.layers[D].childLayers.length;o[1]=parseInt(u.layers[D].getTreeNode().widgetId.split("_")[2])}}if(!b){if(c>=0){o[1]=c}u.addLayer(F[E]);c=u.getLayerIndex(F[E].name,F[E].name);o[1]=G+m;m++;H.frames.tree.tree.addNode("WMS_LAYER",o);g=0}}for(var D=0;D<(g-f);D++){o[2]=f+D;H.frames.tree.tree.addNode("WMS_CHILD_LAYER",o);o[2]=null}for(var D in v){var K=v[D];o[2]=K.index;if(K.addNewChilds){for(q=0;q<(K.n2-K.n1);q++){o[3]=K.n1+q;H.frames.tree.tree.addNode("WMS_GRAND_CHILD_LAYER",o)}K.index=null;K.addNewChilds=null;K.n1=null;K.n2=null}}}H.frames.tree.tree.selectNode("WMS",o);if(H.frames.tree.tree.hasChildren("WMS",o)){H.frames.tree.tree.open("WMS",o)}OpenLayers.IAAA_Utils.endAddElement()};OpenLayers.IAAA_Utils.doAddWMSLoadFromTree=function(f){var l=getMap();var a=f;var b=[OpenLayers.IAAA_Utils.indexNewAddWMS];var g=f.getTreeNode();var c;if(!g){g=parent.frames.tree.dojo.widget.byId("tree").children[(l.layers.length-1)-b[0]];c=l.layers[b]}else{c=l.layers[b]}var k=g.widgetId.split("_")[1];c.setLayerList(f.getLayerList());c.setSRSList(f.getSRSList());c.setFormatList(f.getFormatList());c.changeSrs(l.projection);c.setAccessConstraints(f.accessConstraints);c.setMainAttribution(f.mainAttribution);c.setException(f.getException());c.setMainLayerMaxSupportedExtent(f.maxSupportedExtent);c.setMainLayerMinSupportedScale(f.minSupportedScale);c.setMainLayerMaxSupportedScale(f.maxSupportedScale);if(!f.name){a.setLayerList(new Array(0));parent.frames.tree.tree.close("WMS",b)}else{c.setLoadFromTree(false);parent.frames.tree.tree.selectNode("WMS",[k]);parent.frames.tree.tree.updateSelectedNode();if(parent.frames.tree.tree.hasChildren("WMS",[k])){parent.frames.tree.tree.open("WMS",[k])}else{parent.frames.tree.tree.close("WMS",[k])}}if((c.CLASS_NAME=="OpenLayers.Layer.IAAA_Server")&&(!c.ignoreScope)&&(!c.inSupportedRange())){alert(messages.WMSOutOfScope)}OpenLayers.IAAA_Utils.endAddElement()};OpenLayers.IAAA_Utils.createNewAddWMS=function(a){OpenLayers.IAAA_Utils.newAddWMS=new OpenLayers.Layer.IAAA_Server();OpenLayers.IAAA_Utils.newAddWMS.ignoreScope=false;OpenLayers.IAAA_Utils.newAddWMS.showLoadingIcon=false;OpenLayers.IAAA_Utils.indexNewAddWMS=-1};quotedStringToVector=function(g,k){var a=new Array();var b=0;var c=0;var f=0;while(c<g.length){b=c;while((c<g.length)&&(g.charAt(c)!=k)){c++}a[f]=g.substring(b,c);f++;c++}return a};addEvent=OpenLayers.IAAA_Utils.addEvent;OpenLayers.IAAA_Utils.addEvent=function(g,c,b,a){if(g.addEventListener){g.addEventListener(c,b,a);return true}else{if(g.attachEvent){var f=g.attachEvent("on"+c,b);return f}else{alert("Handler could not be attached")}}};removeEvent=function(g,c,b,a){if(g.removeEventListener){g.removeEventListener(c,b,a);return true}else{if(g.detachEvent){var f=g.detachEvent("on"+c,b);return f}else{alert("Handler could not be removed")}}};isPNGImage=function(a){if(a.substring(a.length-4,a.length)==".png"){return true}else{return false}};isClientReady=function(){if(parent){if(parent.clientReady){return parent.clientReady}}return false};enableMainClient=function(a){if(indexReference){indexReference.doEnableClient(a)}};disableMainClient=function(a){if(indexReference){indexReference.doDisableClient(a)}};getDragBox=function(){return dragBoxAux};degrees2radians=function(a){return(a*Math.PI/180)};radians2degrees=function(a){return(a*180/Math.PI)};getWMSClientPath=function(){return wmsClientPath};getVacioGif=function(){return getGraphicLibFolder()+"vacio.gif"};getWMSClientFolder=function(){return"../"};RoundDecimal=function(c,f){var a=Math.pow(10,f);var b=c*a;return(Math.round(b)/a)};MapBuilder=function(S,H,F,E,B,C,A,K,M,G,o,D,T,v,q,J,r,R,a,m,b,g,O,c){S.div.style.height=F;S.div.style.width=H;var k=new Array();for(var l=0;l<M;l++){var f;for(var Q=0;Q<O[l].length;Q++){if(Q==0){f=O[l][Q]}else{f=S.layers[l].params.LAYERS+","+O[l][Q]}}var u=null;if(c){for(var I=0;I<c[l].length;I++){if(I==0){u=c[l][I]}else{u=S.layers[l].params.STYLES+","+c[l][I]}}}var p={format:v[l][0],transparent:J[l],layers:f};if(u){p.styles=u}k[l]=new OpenLayers.Layer.IAAA_WMS(b[l],G[l],p,{singleTile:true,visibility:true,isBaseLayer:(l==0)});T=new String(T);if((parseInt(T.split(".")[0])>=1)&&(parseInt(T.split(".")[1])>=2)){k[l].getFullRequestString=function(X,V){var U=this.map.getProjection();this.params.CRS=(U=="none")?null:U;return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)}}}S.addLayers(k);S.zoomToExtent(new OpenLayers.Bounds(E,B,C,A))};getTree=function(){if(window.parent&&window.parent.frames&&window.parent.frames.tree&&window.parent.frames.tree.tree){return window.parent.frames.tree.tree}else{return null}};getIndexWindow=function(){if(window.parent){return window.parent}else{return window}};OpenLayers.IAAA_Utils.buttonAutomaticSrs=function(){var a=document.getElementById("automaticSrsList");if(a.selectedIndex>=0){var c=a.options[a.selectedIndex].value;if(c=="automaticSrs"){var f=getMap().baseLayer.scales[getMap().getZoom()];getMap().automaticSrs=true;var b=getMap().getAutomaticSrs(f);OpenLayers.IAAA_Utils.changeSrs(b)}else{getMap().automaticSrs=false;if(isSupportedSrs(c)){OpenLayers.IAAA_Utils.changeSrs(c)}}comboSrsSelected=c}};OpenLayers.IAAA_Utils.changeSrs=function(a){oldSrs=getMap().getProjection();if(oldSrs!=a){getMap().changeSrs(a)}};OpenLayers.IAAA_Utils.changeAutomaticSrs=function(b){var a=getMap();if(automaticSrs){if(b>=scaleLevelSrs){newSrs="EPSG:4258"}else{var c=a.getExtent().right;if(a.getProjection()!="EPSG:4258"){punto=coordTransform(a.getProjection(),"EPSG:4258",a.getExtent().right,a.getExtent().left);xMaxA=punto[0];punto=coordTransform(a.getProjection(),"EPSG:4258",a.getExtent().right,a.getExtent().left);xMaxB=punto[0];c=((xMaxA+xMaxB)/2)}if(c<=-10){newSrs="EPSG:25828"}else{newSrs="EPSG:25830"}}OpenLayers.IAAA_Utils.changeSrs(newSrs)}};OpenLayers.IAAA_Utils.createNewSelectionMenu=function(c,g,a,b,f){return new OpenLayers.IAAA_SelectionMenu(c,g,a,b,f)};OpenLayers.IAAA_Utils.loadSelectionMenuFromVector=function(c,b,a){c.loadFromVector(b,a)};OpenLayers.IAAA_Utils.isCanariasExtent=function(b,a){if(!b){return false}var c=b.right;if(a!="EPSG:4258"){punto=coordTransform(a,"EPSG:4258",b.right,b.bottom);xMaxA=punto[0];punto=coordTransform(a,"EPSG:4258",b.right,b.top);xMaxB=punto[0];c=((xMaxA+xMaxB)/2)}if(c<=-10){return true}else{return false}};OpenLayers.IAAA_Utils.getSrsForDescription=function(b){for(var a=0;a<supportedSrsListDescription.length;a++){if(supportedSrsListDescription[a]==b){return supportedSrsList[a]}}return""};OpenLayers.IAAA_Utils.isDisabledSrs=function(f,b){var c=OpenLayers.IAAA_Utils.isCanariasExtent(getMap().getExtent(),getMap().getProjection());if(f>indexReference.disableScaleLevelSrs){if(isProjectedSrs(b)){return true}else{if(c){var a=getDatum(b);if(OpenLayers.IAAA_Utils.Trim(a)=="ED50"){return true}}}}else{if(c){var a=getDatum(b);if(OpenLayers.IAAA_Utils.Trim(a)=="ED50"){return true}}}return false};OpenLayers.IAAA_Utils.updateChangeSrsList=function(){var f=getMap().getActualScale();if(indexReference.useAutomaticSrs){var q=false;var b=document.getElementById("automaticSrsList");if(b){var m=new Array(b.childNodes.length);for(var g=0;g<b.childNodes.length;g++){var k=b.childNodes[g];if(k.nodeName=="OPTION"){var p=k.value;if(!getMap().automaticSrs){if(p==getMap().projection){k.selected=true}else{k.selected=false}}if(OpenLayers.IAAA_Utils.isDisabledSrs(f,p)){if(k.selected){b.selectedIndex=0;indexReference.automaticSrs=false;q=true}m[g]=0;k.style.fontStyle="italic";k.disabled=true}else{if(OpenLayers.IAAA_Utils.getNavigator()[0]!="msie"){m[g]=-1;k.style.fontStyle="normal";k.disabled=false}else{m[g]=-1}}}else{if(k.nodeName=="OPTGROUP"){var o=k.label;var p=OpenLayers.IAAA_Utils.getSrsForDescription(o);if(!OpenLayers.IAAA_Utils.isDisabledSrs(f,p)){m[g]=1;k.style.fontStyle="normal";k.disabled=false}else{m[g]=-1}}else{m[g]=-1}}}if(OpenLayers.IAAA_Utils.getNavigator()[0]=="msie"){for(var c=m.length-1;c>=0;c--){if(m[c]==0){var k=b.childNodes[c];var o=k.innerHTML;var a=document.createElement("<optgroup label='"+o+"' style='color:graytext; font-style:normal;'/>");k.parentNode.replaceChild(a,k)}else{if(m[c]==1){var k=b.childNodes[c];var o=k.label;var p=OpenLayers.IAAA_Utils.getSrsForDescription(o);var l=document.createElement("<option name='"+p+"' value='"+p+"' style='color:black; font-style:normal;'>"+o+"</option>");l.innerHTML=o;k.parentNode.replaceChild(l,k)}}}}if((q)&&(!getMap().automaticSrs)){OpenLayers.IAAA_Utils.buttonAutomaticSrs()}}}OpenLayers.IAAA_Utils.decode_utf8=function(r){return decodeURIComponent(escape(r))}};OpenLayers.IAAA_Utils.decodeHTMLSpecialChars=function(c){var a=new Array(["%3F%3F","üé"],["%C3%A1","á"],["%C3%A9","é"],["%C3%AD","í"],["%C3%B3","ó"],["%C3%BA","ú"],["%2F","/"],["%C2%A1","í"],["%C2%BD","ó"],["%C5%93","ú"],["%C3%8F","ñ"],["%C3%F","ñ"],["%25a","á"],["%2C"," "],["%3F","é"],["%28","("],["%29",")"],["+"," "],["%20"," "],["%F3","ó"]);for(var b in a){var f=a[b];c=OpenLayers.IAAA_Utils.replaceCad(c,f[0],f[1])}return c};OpenLayers.IAAA_Utils.utf8_decode=function(g){var b=[],f=0,l=0,k=0,c=0,a=0;g+="";while(f<g.length){k=g.charCodeAt(f);if(k<128){b[l++]=String.fromCharCode(k);f++}else{if((k>191)&&(k<224)){c=g.charCodeAt(f+1);b[l++]=String.fromCharCode(((k&31)<<6)|(c&63));f+=2}else{c=g.charCodeAt(f+1);a=g.charCodeAt(f+2);b[l++]=String.fromCharCode(((k&15)<<12)|((c&63)<<6)|(a&63));f+=3}}}return b.join("")};OpenLayers.IAAA_Utils.contieneAcentos=function(g){var c=g;var k="";var b=new Array(["Á","A"],["É","E"],["Í","I"],["Ó","O"],["Ú","U"],["á","a"],["é","e"],["í","i"],["ó","o"],["ú","u"],["À","A"],["È","E"],["Ì","I"],["Ò","O"],["Ù","U"],["à","a"],["è","e"],["ì","i"],["ò","o"],["ù","u"]);var f=0;var m=true;while(f<b.length&&m){var l=b[f];if(g.indexOf(l[0])==0){k=l[1]+g.substring(1,g.length);m=false}f++}var a=new Array(2);a[0]=c;a[1]=k;return a};OpenLayers.IAAA_Utils.getIndexElement=function(c,b){for(var a=0;a<c.length;a++){if(c[a]==b){return a}}return -1};OpenLayers.IAAA_Utils.getAspectDescription=function(c){var b="";if(c!=messages_territorial.noData){if((c>15*PI/8&&c<=2*PI)||(c>=0&&c<=PI/8)){b=messages_territorial.aspectNorth}else{if((c>PI/8&&c<=PI/4)||(c>PI/4&&c<=3*PI/8)){b=messages_territorial.aspectNorthEast}else{if((c>3*PI/8&&c<=PI/2)||(c>PI/2&&c<=5*PI/8)){b=messages_territorial.aspectEast}else{if((c>5*PI/8&&c<=3*PI/4)||(c>3*PI/4&&c<=7*PI/8)){b=messages_territorial.aspectSouthEast}else{if((c>7*PI/8&&c<=PI)||(c>PI&&c<=9*PI/8)){b=messages_territorial.aspectSouth}else{if((c>9*PI/8&&c<=5*PI/4)||(c>5*PI/4&&c<=11*PI/8)){b=messages_territorial.aspectSouthWest}else{if((c>11*PI/8&&c<=3*PI/2)||(c>3*PI/2&&c<=13*PI/8)){b=messages_territorial.aspectWest}else{if((c>13*PI/8&&c<=7*PI/4)||(c>7*PI/4&&c<=15*PI/8)){b=messages_territorial.aspectNorthWest}}}}}}}}var a=RoundDecimal(c*180/PI,0);if(b!=""){a+="º ("+b+")"}return a}else{return c}};OpenLayers.IAAA_Utils.quotedStringToVector=function(g,k){var a=new Array();var b=0;var c=0;var f=0;while(c<g.length){b=c;while((c<g.length)&&(g.charAt(c)!=k)){c++}a[f]=g.substring(b,c);f++;c++}return a};OpenLayers.IAAA_Utils.quotedStringOfParametersToVector=function(l){var b=new Array();var r=0;var m=0;var q=0;var o="&";while(m<l.length){r=m;while((m<l.length)&&(l.charAt(m)!=o)){m++}b[q]=l.substring(r,m);q++;m++}var c=new Array();var a="=";for(var g in b){var p=b[g];var f=0;while((f<p.length)&&(p.charAt(f)!=a)){f++}c[p.substring(0,f)]=p.substring(f+1,p.length)}return c};OpenLayers.IAAA_Utils.getIAAA_Request=function(b,a){return new OpenLayers.Ajax.IAAA_Request(b,a)};OpenLayers.IAAA_Utils.getPixel=function(a,b){return new OpenLayers.Pixel(a,b)};OpenLayers.IAAA_Utils.getLonLat=function(b,a){return new OpenLayers.LonLat(b,a)};OpenLayers.IAAA_Utils.getParameterStringNoEncode=function(l){var k=[];for(var b in l){var f=l[b];if((f!=null)&&(typeof f!="function")){var a;if(typeof f=="object"&&f.constructor==Array){var g=[];for(var c=0;c<f.length;c++){g.push(f[c])}a=g.join(",")}else{a=f}k.push(b+"="+a)}}return k.join("&")};OpenLayers.IAAA_Utils.isURLProtocolValue=function(a){if((a.toLowerCase().startsWith("http"))||(a.toLowerCase().startsWith("ftp"))||(a.toLowerCase().startsWith("https"))||(a.toLowerCase().startsWith("data:"))||(a.toLowerCase().startsWith("file:///"))||(a.toLowerCase().startsWith("gopher://"))||(a.toLowerCase().startsWith("javascript:"))||(a.toLowerCase().startsWith("mailto:"))||(a.toLowerCase().startsWith("news:"))||(a.toLowerCase().startsWith("res://"))||(a.toLowerCase().startsWith("telnet://"))||(a.toLowerCase().startsWith("view-source:"))){return true}return false};OpenLayers.IAAA_Utils.isInteger=function(b){var a;if(OpenLayers.IAAA_Utils.isEmpty(b)){if(OpenLayers.IAAA_Utils.isInteger.arguments.length==1){return 0}else{return(OpenLayers.IAAA_Utils.isInteger.arguments[1]==true)}}for(a=0;a<b.length;a++){var f=b.charAt(a);if(!OpenLayers.IAAA_Utils.isDigit(f)){return false}}return true};OpenLayers.IAAA_Utils.isEmpty=function(a){return((a==null)||(a.length==0))};OpenLayers.IAAA_Utils.isDigit=function(a){return((a>="0")&&(a<="9"))};OpenLayers.IAAA_Utils.deleteNoIntegerElements=function(c){var b=new Array();for(var a in c){if(OpenLayers.IAAA_Utils.isInteger(c[a])){b.push(c[a])}}return b};OpenLayers.IAAA_Utils._cloneObjectAux=function(a,c){for(var b in c){a[b]=c[b]}return a};OpenLayers.IAAA_Utils.cloneObject=function(a){return OpenLayers.IAAA_Utils._cloneObjectAux({},a)};OpenLayers.IAAA_Utils.alertWindow=null;OpenLayers.IAAA_Utils.alertCounter=0;OpenLayers.IAAA_Utils.alert=function(b){if(OpenLayers.IAAA_Utils.alertWindow==null){OpenLayers.IAAA_Utils.alertWindow=window.open("","alertWindow","width=500,height=500,scrollbars=yes,resizable=yes");OpenLayers.IAAA_Utils.alertWindow.document.title="Alert 2.0"}else{if(OpenLayers.IAAA_Utils.alertWindow.document==null){OpenLayers.IAAA_Utils.alertWindow=window.open("","alertWindow","width=500,height=500,scrollbars=yes,resizable=yes");OpenLayers.IAAA_Utils.alertWindow.document.title="Alert 2.0"}}var f=OpenLayers.IAAA_Utils.alertWindow.document.createElement("DIV");f.innerHTML="Mensaje nº"+OpenLayers.IAAA_Utils.alertCounter+":<br><br>";OpenLayers.IAAA_Utils.alertCounter++;OpenLayers.IAAA_Utils.alertWindow.document.body.appendChild(f);var c=OpenLayers.IAAA_Utils.alertWindow.document.createElement("DIV");c.innerHTML=b;OpenLayers.IAAA_Utils.alertWindow.document.body.appendChild(c);var a=OpenLayers.IAAA_Utils.alertWindow.document.createElement("DIV");a.innerHTML="<br><br>";OpenLayers.IAAA_Utils.alertWindow.document.body.appendChild(a)};alert2=OpenLayers.IAAA_Utils.alert;OpenLayers.IAAA_Utils.alertObject=function(a){var c="";for(var b in a){c+=b+" => "+a[b]+"<br>"}OpenLayers.IAAA_Utils.alert(c)};alertObject=OpenLayers.IAAA_Utils.alertObject;OpenLayers.IAAA_Utils.alertMapLayersVisibility=function(l){var g="";for(var f in l.layers){g+="["+f+"] "+l.layers[f].url+" -> "+l.layers[f].getVisibility()+"<br>";for(var c in l.layers[f].getLayerList()){g+="["+f+","+c+"] "+l.layers[f].getLayerList()[c].title+" -> "+l.layers[f].getLayerList()[c].getVisibility()+"<br>";for(var b in l.layers[f].getLayerList()[c].getChildLayerList()){g+="["+f+","+c+","+b+"] "+l.layers[f].getLayerList()[c].getChildLayer(b).title+" -> "+l.layers[f].getLayerList()[c].getChildLayer(b).getVisibility()+"<br>";for(var a in l.layers[f].getLayerList()[c].getChildLayer(b).getChildLayerList()){g+="["+f+","+c+","+b+","+a+"] "+l.layers[f].getLayerList()[c].getChildLayer(b).getChildLayer(a).title+" -> "+l.layers[f].getLayerList()[c].getChildLayer(b).getChildLayer(a).getVisibility()+"<br>"}}}}OpenLayers.IAAA_Utils.alert(g)};alertMapLayersVisibility=OpenLayers.IAAA_Utils.alertMapLayersVisibility;OpenLayers.Map.IAAA_Map=OpenLayers.Class(OpenLayers.Map,{checkedLayerForFeatureInfo:new Array(),mapUpdated:true,extentAux:null,resAux:null,measureLayer:null,wmc:null,automaticSrs:false,projection:null,windowSizeForMinMapSize:new OpenLayers.Size(10,10),minWidth:0,minHeight:0,maxHeight:null,maxWidth:null,notMapHeight:0,selectedGeometryList:null,selectedGeometryLayer:null,selectedGeometryExtent:null,originalSelectedGeometry:null,analysisTreeNode:null,fullExtent:null,ignoreMaxExtent:false,scaleLevelSrs:0,ancientResolutions:[],ancientMaxExtent:null,ancientSRS:null,_incompatibleWMSCDialog:null,_incompatibleWMSCText:null,acceptButtonText:"accept",cancelButtonText:"cancel",toolbarDiv:null,EVENT_TYPES:["preaddlayer","addlayer","removelayer","changelayer","movestart","move","moveend","zoomend","popupopen","popupclose","addmarker","removemarker","clearmarkers","mouseover","mouseout","mousemove","dragstart","drag","dragend","changebaselayer","resizeend","newExtent","changepropsforwmsc","restoreprops","layerloading","layerloaded","layerupdated","layervisibilitychanged","iaaa_waitingserver","iaaa_finishCommunication"],initialize:function(c,b){var a=new Array();a.push(c,b);OpenLayers.Map.prototype.initialize.apply(this,a);this.layerContainerDiv.style.left="0px";this.layerContainerDiv.style.top="0px"},cloneForPrint:function(g){var b={center:this.getCenter(),zoom:this.getZoom(),controls:[]};var a=new OpenLayers.Map.IAAA_Map(g,b);a.projection=this.projection;var k=new Array();for(var f=0;f<this.layers.length;f++){var c=new OpenLayers.Layer.WMS(this.layers[f].name,this.layers[f].url,{transparent:(f>0),version:this.layers[f].getVersion(),bgColor:this.layers[f].getBgColor(),format:this.layers[f].getFormatSelected()},{visibility:false,buffer:0,loadFromTree:false,singleTile:true});k.push(c)}a.addLayers(k);a.zoomToExtent(new OpenLayers.Bounds(this.getExtent().left,this.getExtent().bottom,this.getExtent().right,this.getExtent().up));return a},setOptions:function(a){this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT);this.maxExtent=new OpenLayers.Bounds(-9999999999,-9999999999,9999999999,9999999999);this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css";OpenLayers.Util.extend(this,a)},createIncompatibleWMSCWindow:function(){this._incompatibleWMSCDialog=OpenLayers.Util.createDiv("incompatibleWMSCDialog",new OpenLayers.Pixel(0,0),new OpenLayers.Size(350,200),null,"absolute","1px solid black");this._incompatibleWMSCDialog.style.zIndex=100000;this._incompatibleWMSCDialog.style.backgroundColor="#FFFFFF";this._incompatibleWMSCDialog.style.cursor="default";this._incompatibleWMSCDialog.style.visibity="hidden";this.div.parentNode.appendChild(this._incompatibleWMSCDialog);this._incompatibleWMSCText=document.createElement("FONT");this._incompatibleWMSCText.style.fontFamily="Arial";this._incompatibleWMSCText.style.fontSize="8pt";this._incompatibleWMSCText.style.position="absolute";this._incompatibleWMSCText.style.width="300px";this._incompatibleWMSCText.style.top="30px";this._incompatibleWMSCText.style.left="25px";this._incompatibleWMSCDialog.appendChild(this._incompatibleWMSCText);var a=document.createElement("button");this._incompatibleWMSCDialog.appendChild(a);a.appendChild(document.createTextNode(this.acceptButtonText));a.style.display="block";a.style.position="absolute";a.style.top=150;a.style.left=70;a.style.width=70;a.style.height=24;a.style.cursor="pointer";a.style.fontFamily="Arial";a.style.fontSize="8pt";a.onclick=this.acceptAddIncompatibleWMSC;var b=document.createElement("button");this._incompatibleWMSCDialog.appendChild(b);b.appendChild(document.createTextNode(this.cancelButtonText));b.style.display="block";b.style.position="absolute";b.style.top=150;b.style.left=200;b.style.width=70;b.style.height=24;b.style.cursor="pointer";b.style.fontFamily="Arial";b.style.fontSize="8pt";b.onclick=this.cancelAddIncompatibleWMSC;this.hideIncompatibleWMSCDialog()},addLayer:function(b){for(var a=0;a<this.layers.length;a++){if(this.layers[a]==b){var k=OpenLayers.i18n("layerAlreadyAdded",{layerName:b.name});OpenLayers.Console.warn(k);return false}}var c=(b.isWMSC&&b.maxExtent&&b.resolutions&&b.getSRSList()[b.getSelectedSRS()]&&((!this.ancientMaxExtent)||(this.ancientResolutions.length==0)));var g=null;b.div.style.overflow="";this.setLayerZIndex(b,this.layers.length);if(b.isFixed){this.viewPortDiv.appendChild(b.div)}else{this.layerContainerDiv.appendChild(b.div)}this.layers.push(b);b.setMap(this);if(g!=null){this.setLayerIndex(b,g)}if(b.isBaseLayer){if(this.baseLayer==null){this.setBaseLayer(b)}else{b.setVisibility(false)}}else{if(this.baseLayer==null){var f=b.getVisibility();b.isBaseLayer=true;this.setBaseLayer(b);this.baseLayer.setVisibility(f)}else{if(b.CLASS_NAME!="OpenLayers.Layer.IAAA_GeoRSS"){b.redraw()}}}if((b.CLASS_NAME=="OpenLayers.Layer.IAAA_Server")&&(!b.loadFromTree)){if(!c){b.changeSrs(this.getProjection())}else{this.changeMapPropertiesForWMSC(b)}}else{if(b.CLASS_NAME=="OpenLayers.Layer.IAAA_GeoRSS"){this.events.register("mouseover",b,b.onMouseOverClosePopup);this.events.register("mousemove",b,b.onMouseMoveClosePopup)}else{if(b.CLASS_NAME=="OpenLayers.Layer.IAAA_TooltipMarkers"){b.initEvents()}else{if(b.CLASS_NAME=="OpenLayers.Layer.Google"){this.changeMapPropertiesForGoogleMaps(b)}}}}if((b.CLASS_NAME=="OpenLayers.Layer.IAAA_Server")){b.events.register("loadstart",this,function(){this.events.triggerEvent("layerloaded")});b.events.register("tileloaded",this,function(){this.events.triggerEvent("layerloaded")});b.events.register("visibilitychanged",this,function(){this.events.triggerEvent("layervisibilitychanged")});b.events.register("layerlistvisibilityupdated",this,function(l){this.events.triggerEvent("layerupdated",{layer:l.layer})})}this.events.triggerEvent("addlayer",{layer:b});if((b.CLASS_NAME=="OpenLayers.Layer.Vector")||(b.CLASS_NAME=="OpenLayers.Layer.IAAA_GeoRSS")){if(b.afterAdd){b.afterAdd()}}},changeMapPropertiesForWMSC:function(f){if(this.ancientSRS&&this.ancientResolutions&&this.ancientMaxExtent){this.restoreMapFromWMSC()}this.ancientSRS=this.getProjection();this.ignoreMaxExtent=true;this.automaticSrs=false;var a=f.resolutions;this.ancientResolutions=this.resolutions;this.ancientMaxExtent=this.maxExtent.clone();var g=this.getExtent();this.changeSrs(f.getSRSList()[f.getSelectedSRS()],a);if((g)&&(this.getProjection()!=this.ancientSRS)){var l=coordTransform(this.ancientSRS,this.getProjection(),g.left,g.bottom);var k=coordTransform(this.ancientSRS,this.getProjection(),g.right,g.top);g=new OpenLayers.Bounds(l[0],l[1],k[0],k[1])}this.resolutions=a;this.maxExtent=f.maxExtent.clone();for(var c in this.layers){if((!this.layers[c].isWMSC)&&(this.layers[c].CLASS_NAME!="OpenLayers.Layer.Google")){this.layers[c].maxExtent=this.maxExtent;this.layers[c].resolutions=this.resolutions}}if(g){this.zoomToExtent(g,true)}else{this.redraw()}for(var b in this.controls){if(this.controls[b].CLASS_NAME=="OpenLayers.Control.IAAA_ToolBar"){this.controls[b].disableSRSSelector()}}this.events.triggerEvent("changepropsforwmsc",{layer:f})},changeMapPropertiesForGoogleMaps:function(f){if(this.ancientSRS&&this.ancientResolutions&&this.ancientMaxExtent){this.restoreMapFromWMSC()}this.ancientSRS=this.getProjection();this.ignoreMaxExtent=true;this.automaticSrs=false;var a;if(f.RESOLUTIONS){a=f.RESOLUTIONS}else{a=f.resolutions}this.ancientResolutions=this.resolutions;this.ancientMaxExtent=this.maxExtent.clone();var g=this.getExtent();this.changeSrs(f.projection,a);if((g)&&(this.getProjection()!=this.ancientSRS)){var l=coordTransform(this.ancientSRS,this.getProjection(),g.left,g.bottom);var k=coordTransform(this.ancientSRS,this.getProjection(),g.right,g.top);g=new OpenLayers.Bounds(l[0],l[1],k[0],k[1])}this.resolutions=a;this.maxExtent=f.maxExtent.clone();for(var c in this.layers){if((!this.layers[c].isWMSC)&&(this.layers[c].CLASS_NAME!="OpenLayers.Layer.Google")){this.layers[c].maxExtent=this.maxExtent;this.layers[c].resolutions=this.resolutions}}if(g){this.zoomToExtent(g,true)}else{this.redraw()}for(var b in this.controls){if(this.controls[b].CLASS_NAME=="OpenLayers.Control.IAAA_ToolBar"){this.controls[b].disableSRSSelector()}}this.events.triggerEvent("changepropsforwmsc",{layer:f})},removeLayer:function(f){if(this.baseLayer==f){if(this.layers.length>1){if(f==this.layers[0]){var a=this.layers[1].getVisibility();this.setBaseLayer(this.layers[1]);this.layers[1].setVisibility(a)}else{var a=this.layers[0].getVisibility();this.setBaseLayer(this.layers[0]);this.layers[0].setVisibility(a)}}}if(f.isFixed){this.viewPortDiv.removeChild(f.div)}else{this.layerContainerDiv.removeChild(f.div)}f.map=null;OpenLayers.Util.removeItem(this.layers,f);f.removeMap(this);if(this.layers.length==0){this.baseLayer=null}if((f.CLASS_NAME=="OpenLayers.Layer.IAAA_Server")&&(f.isWMSC)&&(!f.getLoadFromTree())){var m=false;for(var c in this.layers){m=(m||((this.layers[c].CLASS_NAME=="OpenLayers.Layer.IAAA_Server")&&this.layers[c].isWMSC&&(!this.layers[c].getLoadFromTree())))}if(!m){var g=this.getExtent();if((g)&&(this.ancientSRS)&&(this.getProjection()!=this.ancientSRS)){var l=coordTransform(this.getProjection(),this.ancientSRS,g.left,g.bottom);var k=coordTransform(this.getProjection(),this.ancientSRS,g.right,g.top);g=new OpenLayers.Bounds(l[0],l[1],k[0],k[1])}if(this.ancientSRS){this.changeSrs(this.ancientSRS)}for(var c in this.layers){if((!this.layers[c].isWMSC)&&(this.layers[c].CLASS_NAME!="OpenLayers.Layer.Google")){this.layers[c].maxExtent=this.ancientMaxExtent;this.layers[c].resolutions=this.ancientResolutions}}this.maxExtent=this.ancientMaxExtent;this.resolutions=this.ancientResolutions;this.ancientMaxExtent=null;this.ancientSRS=null;this.ancientResolutions=[];if(g){this.zoomToExtent(g,true)}else{this.redraw()}for(var b in this.controls){if(this.controls[b].CLASS_NAME=="OpenLayers.Control.IAAA_ToolBar"){this.controls[b].enableSRSSelector()}}this.events.triggerEvent("restoreprops",{layer:f})}}else{if(f.CLASS_NAME=="OpenLayers.Layer.Google"){this.restoreMapFromWMSC()}}if((f.CLASS_NAME=="OpenLayers.Layer.IAAA_GML")||(f.CLASS_NAME=="OpenLayers.Layer.IAAA_KML")){f.destroy()}this.events.triggerEvent("removelayer",{layer:f,property:"remove"})},restoreMapFromWMSC:function(){var f=this.getProjection();if(this.ancientSRS){this.changeSrs(this.ancientSRS,this.ancientResolutions)}for(var b in this.layers){if((!this.layers[b].isWMSC)&&(this.layers[b].CLASS_NAME!="OpenLayers.Layer.Google")){this.layers[b].maxExtent=this.ancientMaxExtent;this.layers[b].resolutions=this.ancientResolutions}}this.maxExtent=this.ancientMaxExtent;this.resolutions=this.ancientResolutions;if(f==this.ancientSRS){var c=this.getExtent();if(c){this.zoomToExtentForNewSrs(c,true)}}this.ancientMaxExtent=null;this.ancientSRS=null;this.ancientResolutions=[];this.redraw();for(var a in this.controls){if(this.controls[a].CLASS_NAME=="OpenLayers.Control.IAAA_ToolBar"){this.controls[a].enableSRSSelector()}}this.events.triggerEvent("restoreprops")},setCenter:function(m,B,A,c){var v=false;var g=null;if(!this.mapUpdated){var p=this.extentAux;var f=this.getZoom();var a=this.extentAux.getWidth()*((m.lon-p.left)/p.getWidth());var u=this.extentAux.getHeight()*((m.lat-p.bottom)/p.getHeight());m=new OpenLayers.LonLat(a,u);if(B){g=B-f;B=this.getZoomForExtent(this.extentAux,true)+g}this.mapUpdated=true;this.zoomToExtent(this.extentAux);v=true}f=B||this.getZoom();if(this.automaticSrs&&this.baseLayer){var k=this.baseLayer.scales[f];if(this.getExtent()){var b=this.getAutomaticSrs(k);if(b!=this.getProjection()){c=true}}else{c=true}}newArguments=[m,B,A,c];if(((B!=undefined)&&(B!=null)&&(B!=this.getZoom())&&(B>=0)&&((!this.resolutions)||(B<this.resolutions.length)))){for(var l in this.layers){var o=this.layers[l];if(o.CLASS_NAME=="OpenLayers.Layer.IAAA_IconsWMS"){o.clearTiles()}}}OpenLayers.Map.prototype.setCenter.apply(this,newArguments);if(v){if(this.resAux!=null){var r=this.resAux;this.resAux=null;this.zoomToScale(r);if(g!=null){this.zoomTo(this.getZoom()+g)}}}var q=false;if(this.automaticSrs&&this.baseLayer){var k=this.baseLayer.scales[this.getZoom()];var b=this.getAutomaticSrs(k);if(b!=this.getProjection()){this.changeSrs(b);q=true}}this.events.triggerEvent("newExtent");for(var l in this.controls){if(this.controls[l].CLASS_NAME=="OpenLayers.Control.IAAA_ToolBar"){if(this.controls[l].analysisMenu!=null){this.controls[l].events.triggerEvent("newExtent")}}else{if((this.controls[l].CLASS_NAME=="OpenLayers.Control.IAAA_AspectAnalyzer")||(this.controls[l].CLASS_NAME=="OpenLayers.Control.IAAA_GradientAnalyzer")||(this.controls[l].CLASS_NAME=="OpenLayers.Control.IAAA_HeightAnalyzer")){this.controls[l].events.triggerEvent("newExtent");if(q){this.controls[l].events.triggerEvent("newSrs")}}else{if(this.controls[l].CLASS_NAME=="OpenLayers.Control.IAAA_TerritorialAnalyzer"){this.controls[l].events.triggerEvent("newExtent")}else{if(this.controls[l].CLASS_NAME=="OpenLayers.Control.IAAA_BufferOperation"){if(q){this.controls[l].events.triggerEvent("newSrs")}}else{if(this.controls[l].CLASS_NAME=="OpenLayers.Control.IAAA_AreaSelectorByUserZone"){if(q){this.controls[l].events.triggerEvent("newSrs")}}}}}}}},moveTo:function(l,r,A){if(!A){A={}}var q=A.dragging;var c=A.forceZoomChange;var m=A.noEvent;if(this.panTween&&A.caller=="setCenter"){this.panTween.stop()}if(!this.center&&!this.isValidLonLat(l)){l=this.maxExtent.getCenterLonLat()}if(this.restrictedExtent!=null){if(l==null){l=this.getCenter()}if(r==null){r=this.getZoom()}var f=this.getResolutionForZoom(r);var u=this.calculateBounds(l,f);if(!this.restrictedExtent.containsBounds(u)){var v=this.restrictedExtent.getCenterLonLat();if(u.getWidth()>this.restrictedExtent.getWidth()){l=new OpenLayers.LonLat(v.lon,l.lat)}else{if(u.left<this.restrictedExtent.left){l=l.add(this.restrictedExtent.left-u.left,0)}else{if(u.right>this.restrictedExtent.right){l=l.add(this.restrictedExtent.right-u.right,0)}}}if(u.getHeight()>this.restrictedExtent.getHeight()){l=new OpenLayers.LonLat(l.lon,v.lat)}else{if(u.bottom<this.restrictedExtent.bottom){l=l.add(0,this.restrictedExtent.bottom-u.bottom)}else{if(u.top>this.restrictedExtent.top){l=l.add(0,this.restrictedExtent.top-u.top)}}}}}var b=c||((this.isValidZoomLevel(r))&&(r!=this.getZoom()));var g=(this.isValidLonLat(l))&&(!l.equals(this.center));if(b||g||!q){if(!this.dragging&&!m){this.events.triggerEvent("movestart")}if(g){if((!b)&&(this.center)){this.centerLayerContainer(l)}this.center=l.clone()}if((b)||(this.layerContainerOrigin==null)){this.layerContainerOrigin=this.center.clone();this.layerContainerDiv.style.left="0px";this.layerContainerDiv.style.top="0px"}if(b){this.zoom=r;this.resolution=this.getResolutionForZoom(r);this.viewRequestID++}var a=this.getExtent();if(this.baseLayer){this.baseLayer.moveTo(a,b,q)}if(this.baseLayer){a=this.baseLayer.getExtent()}for(var k=0;k<this.layers.length;k++){var o=this.layers[k];if(!o.isBaseLayer){var p=o.calculateInRange();if(o.inRange!=p){o.inRange=p;if(!p){o.display(false)}this.events.triggerEvent("changelayer",{layer:o,property:"visibility"})}if(p&&o.visibility){o.moveTo(a,b,q)}}}if(b){for(var k=0;k<this.popups.length;k++){this.popups[k].updatePosition()}}this.events.triggerEvent("move");if(b){this.events.triggerEvent("zoomend")}}if(!q&&!m){this.events.triggerEvent("moveend")}this.dragging=!!q},getAutomaticSrs:function(a){if(this.automaticSrs){if(a>=this.scaleLevelSrs){newSrs="EPSG:4258"}else{var b=this.getExtent().right;if(this.getProjection()!="EPSG:4258"){punto=coordTransform(this.getProjection(),"EPSG:4258",this.getExtent().right,this.getExtent().left);xMaxA=punto[0];punto=coordTransform(this.getProjection(),"EPSG:4258",this.getExtent().right,this.getExtent().left);xMaxB=punto[0];b=((xMaxA+xMaxB)/2)}if(b<=-10){newSrs="EPSG:25828"}else{newSrs="EPSG:25830"}}return newSrs}},redraw:function(){if(!this.mapUpdated){this.mapUpdated=true;this.zoomToExtent(this.extentAux)}if(this.resAux!=null){newRes=this.resAux;this.resAux=null;this.zoomToScale(newRes)}for(var a in this.layers){if((this.layers[a].CLASS_NAME!="OpenLayers.Layer.IAAA_GML")&&(this.layers[a].CLASS_NAME!="OpenLayers.Layer.IAAA_KML")){var b=this.layers[a].getVisibility();this.layers[a].setVisibility(false);this.layers[a].setVisibility(b)}else{this.layers[a].moveTo(this.getExtent(),true)}}},setExtentAux:function(a){this.extentAux=a;this.mapUpdated=false},setResAux:function(a){this.resAux=a},getServer:function(a,c){var b=0;if(c==null){while((b<this.layers.length)&&(this.layers[b].getUrl()!=a)){b++}}else{while((b<this.layers.length)&&!((this.layers[b].getUrl()==a)&&(this.layers[b].name==c))){b++}}if(b<this.layers.length){return this.layers[b]}else{return null}},getLayerPosition:function(b){for(var a in this.layers){if(this.layers[a]==b){return parseInt(a)}}return -1},removeServerByIndex:function(g){var b=g;if(b<this.layers.length){var f=this.layers[b].getLayerList();var c=f.length;for(var a=c-1;a>=0;a--){this.layers[b].removeLayer(a)}while(b<(this.layers.length-1)){this.layers[b]=this.layers[b+1];b++}this.layers[b]=null;this.layers.length--;return true}else{return false}},getMapServerConnection:function(a){return this.layers[a]},getMapServerConnectionCount:function(){return this.layers.length},interchangeLayers2:function(o,m){if(o[1]<m[0]){var B=o;var r=m}else{if(m[1]<m[0]){var B=m;var r=o}else{return}}if(this.layers[B[0]]==this.baseLayer){this.layers[r[0]].isBaseLayer=true;var u=this.layers[B[0]].getVisibility();var p=this.layers[r[0]].getVisibility();this.setBaseLayer(this.layers[r[0]]);this.layers[B[0]].isBaseLayer=false;if(this.layers[B[0]].CLASS_NAME=="OpenLayers.Layer.IAAA_Server"){this.layers[B[0]].params.TRANSPARENT=true}this.layers[B[0]].setVisibility(u);this.layers[r[0]].setVisibility(p)}var g=new Array();var A=new Array();var v=new Array();var q=new Array();for(var f=r[0];f<=r[1];f++){g.push(this.layers[f])}for(var f=B[0];f<=B[1];f++){A.push(this.layers[f])}for(var f=B[1]+1;f<r[0];f++){v.push(this.layers[f])}for(var f=r[1]+1;f<this.layers.length;f++){q.push(this.layers[f])}var f=B[0];while((f-B[0])<=(r[1]-r[0])){this.setLayerIndex(g[f-B[0]],f);f++}var c=0;while(c<v.length){this.setLayerIndex(v[c],f);f++;c++}var b=0;while(b<A.length){this.setLayerIndex(A[b],f);f++;b++}var a=0;while(a<q.length){this.setLayerIndex(q[a],f);f++;a++}},addWMSFromTree:function(c,a,f,m,g){OpenLayers.IAAA_Utils.initAddElement(OpenLayers.IAAA_Utils.ADD_WMS_TREE);var o=OpenLayers.IAAA_Utils.setVersion(f);var b=c;if(b.indexOf("?")!=-1){if(b.indexOf("?")==(b.length-1)){b=b.substring(0,b.length-1)}else{b=OpenLayers.IAAA_Utils.replaceCad(b,"?","&")}}var k="";if(OpenLayers.IAAA_Utils.relayServlet.indexOf("?")!=-1){k=OpenLayers.IAAA_Utils.relayServlet+"&URL="+b+"&outputType=1"}else{k=OpenLayers.IAAA_Utils.relayServlet+"?URL="+b+"&outputType=1"}k+="&"+o[0]+"="+f+"&REQUEST="+o[1];var l=f.split(".");if((l[1]>=1)&&(l[2]>=1)){k+="&useRequestValue=false"}OpenLayers.IAAA_Utils.setParserProperties(c,a,f,m,g,self);OpenLayers.IAAA_Utils.loadXML(k)},addWFSFromTree:function(g,b,l,a,m){OpenLayers.IAAA_Utils.initAddElement(OpenLayers.IAAA_Utils.ADD_WMS_TREE);var o=OpenLayers.IAAA_Utils.setVersion(l,"WFS");var k=g;if(k.indexOf("?")!=-1){if(k.indexOf("?")==(k.length-1)){k=k.substring(0,k.length-1)}else{k=OpenLayers.IAAA_Utils.replaceCad(k,"?","&")}}var c="";if(OpenLayers.IAAA_Utils.relayServlet.indexOf("?")!=-1){c=OpenLayers.IAAA_Utils.relayServlet+"&URL="+k+"&outputType=1"}else{c=OpenLayers.IAAA_Utils.relayServlet+"?URL="+k+"&outputType=1"}c+="&"+o[0]+"="+l+"&REQUEST="+o[1];var f=l.split(".");if((f[1]>=1)&&(f[2]>=1)){c+="&useRequestValue=false"}c+="&SERVICE=WFS";OpenLayers.IAAA_Utils.setParserProperties(g,b,l,a,m,self);OpenLayers.IAAA_Utils.loadXML(c,null,"WFS")},setBaseLayer:function(c,b){var a=null;if(this.baseLayer){a=this.baseLayer.getExtent()}if(c!=this.baseLayer){if(OpenLayers.Util.indexOf(this.layers,c)!=-1){this.baseLayer=c;this.viewRequestID++;if((b==null)||(b==false)){this.events.triggerEvent("changebaselayer")}}}},removeControl:function(a){if((a)&&(a==this.getControl(a.id))){if((!a.outsideViewport)&&(a.div!=null)){this.viewPortDiv.removeChild(a.div)}OpenLayers.Util.removeItem(this.controls,a)}},resize:function(g,p){var f=this.getWindowSizeForMinMapSize().w;var b=this.getWindowSizeForMinMapSize().h;var a=this.size;var l=a.w;factorX=g/f;factorY=p/b;var q=this.getExtent();var v=(navigator.appName=="Microsoft Internet Explorer")?12:6;if(factorX>=1){if((this.getMaxWidth()!=null)&&((this.getMinWidth()*factorX)>this.getMaxWidth())){this.div.style.width=this.getMaxWidth()-v}else{this.div.style.width=(this.getMinWidth()*factorX)-v}}else{this.div.style.width=this.getMinWidth()-v}if(factorY>=1){if((this.getMaxHeight()!=null)&&((this.getMinHeight()*factorY)>this.getMaxHeight())){this.div.style.height=(this.getMaxHeight()-v)-this.notMapHeight}else{this.div.style.height=((this.getMinHeight()*factorY)-v)-this.notMapHeight}}else{this.div.style.height=this.getMinHeight()-v}this.size=new OpenLayers.Size(this.div.style.width,this.div.style.height);var r=[];for(var o in this.layers){r[r.length]=this.layers[o].getVisibility();this.layers[o].setVisibility(false);if(((this.layers[o].CLASS_NAME=="OpenLayers.Layer.Grid")||(this.layers[o].CLASS_NAME=="OpenLayers.Layer.WMS")||(this.layers[o].CLASS_NAME=="OpenLayers.Layer.IAAA_WMS")||(this.layers[o].CLASS_NAME=="OpenLayers.Layer.IAAA_Server"))&&this.layers[o].singleTile){this.layers[o].setTileSize(this.size)}}var k=document.getElementById("fondo_img");if(k){var u=l-k.width;var c=(navigator.appName=="Microsoft Internet Explorer")?6:0;if(this.div.style.width.split("px").length==0){k.width=(this.div.style.width-u)-c}else{k.width=this.div.style.width.split("px")[0]-u-c}}if(this.baseLayer&&(this.baseLayer.CLASS_NAME!="OpenLayers.Layer.Google")&&(this.baseLayer.CLASS_NAME!="OpenLayers.Layer.IAAA_Google")&&q){this.zoomToExtent(q,true)}var m=0;for(var o in this.layers){this.layers[o].setVisibility(r[m]);m++}if(this.baseLayer&&((this.baseLayer.CLASS_NAME=="OpenLayers.Layer.Google")||(this.baseLayer.CLASS_NAME=="OpenLayers.Layer.IAAA_Google"))){if(q){this.zoomToExtent(q,true);if(this.baseLayer.numZoomLevels<=this.getZoom()){this.zoomTo(this.baseLayer.numZoomLevels-1)}}if(navigator.appName=="Microsoft Internet Explorer"){this.baseLayer.mapObject=null;this.baseLayer.div.removeChild(this.baseLayer.div.firstChild);while(this.baseLayer.pane.childNodes.length>0){this.baseLayer.pane.removeChild(this.baseLayer.pane.firstChild)}this.baseLayer.loadMapObject();this.baseLayer.redraw();this.baseLayer.setMapType()}}for(var o in this.layers){if((this.layers[o].CLASS_NAME=="OpenLayers.Layer.IAAA_WMS")||(this.layers[o].CLASS_NAME=="OpenLayers.Layer.IAAA_IconsWMS")||(this.layers[o].CLASS_NAME=="OpenLayers.Layer.IAAA_Markers")||(this.layers[o].CLASS_NAME=="OpenLayers.Layer.Markers")){this.layers[o].redraw()}else{if((this.layers[o].CLASS_NAME=="OpenLayers.Layer.Vector")||(this.layers[o].CLASS_NAME=="OpenLayers.Layer.IAAA_Vector")||(this.layers[o].CLASS_NAME=="OpenLayers.Layer.IAAA_VectorGenericPopups")){this.layers[o].setMap(this)}}}this.resizeDrawFeatureLayers();if(this._incompatibleWMSCDialog){this._incompatibleWMSCDialog.style.top=(p/2)-100;this._incompatibleWMSCDialog.style.left=(g/2)-175}this.events.triggerEvent("resizeend")},resizeDrawFeatureLayers:function(){for(var a in this.controls){if((this.controls[a].CLASS_NAME=="OpenLayers.Control.DrawFeature")&&(this.controls[a].handler)&&(this.controls[a].handler.layer)){this.controls[a].handler.layer.renderer.setSize(this.getSize());this.controls[a].handler.layer.maxResolution=this.baseLayer.resolutions[0];this.controls[a].handler.layer.minResolution=this.baseLayer.resolutions[this.baseLayer.resolutions.length-1];this.controls[a].handler.layer.inRange=this.controls[a].handler.layer.calculateInRange(this.getResolution());this.controls[a].handler.layer.moveTo(this.getExtent());switch(this.controls[a].handler.CLASS_NAME){case"OpenLayers.Handler.Point":if(this.controls[a].handler.point!=null){this.controls[a].handler.drawFeature()}break;case"OpenLayers.Handler.Path":if((this.controls[a].handler.point!=null)&&(this.controls[a].handler.line!=null)){this.controls[a].handler.drawFeature()}break;case"OpenLayers.Handler.Polygon":if((this.controls[a].handler.point!=null)&&(this.controls[a].handler.polygon!=null)){this.controls[a].handler.drawFeature()}break;default:this.controls[a].handler.drawFeature()}}}},getMinWidth:function(){return this.minWidth},getMinHeight:function(){return this.minHeight},getMaxWidth:function(){return this.maxWidth},getMaxHeight:function(){return this.maxHeight},getWindowSizeForMinMapSize:function(){return this.windowSizeForMinMapSize},getMaxExtent:function(){var a=null;if((this.baseLayer!=null)&&(this.baseLayer.maxExtent)){a=this.baseLayer.maxExtent}else{a=this.maxExtent}return a},getToolBar:function(){for(var a in this.controls){if(this.controls[a].CLASS_NAME=="OpenLayers.Control.IAAA_ToolBar"){return this.controls[a]}}return null},setCheckedLayerForFeatureInfo:function(a,b){this.checkedLayerForFeatureInfo[b]=a},getCheckedLayerForFeatureInfo:function(a){return this.checkedLayerForFeatureInfo[a]},setCoordsCenter:function(c,b){var a=new OpenLayers.LonLat(c,b);this.setCenter(a)},zoomToCoordsExtent:function(g,f,c,b){var a=new OpenLayers.Bounds(g,f,c,b);OpenLayers.Map.prototype.zoomToExtent.apply(this,[a])},getPixelDistanceInMeters:function(f,c){var b=this.getLonLatFromPixel(f);var a=this.getLonLatFromPixel(c);if(b&&a){return this.getCoordDistanceInMeters(b,a)}else{return 0}},getCoordDistanceInMeters:function(f,c){var a=this.getProjection();var g=Math.sqrt((c.lon-f.lon)*(c.lon-f.lon)+(c.lat-f.lat)*(c.lat-f.lat));var b=0;if((a=="EPSG:4326")||(a=="EPSG:4230")||(a=="EPSG:4258")){b=111194.874284}else{if((startsWith(a,"EPSG:230"))||(startsWith(a,"EPSG:258"))||(a=="EPSG:900913")){b=1}}return g*b},addMeasureLayer:function(a){a.div.style.overflow="";this.setLayerZIndex(a,this.layers.length);if(a.isFixed){this.viewPortDiv.appendChild(a.div)}else{this.layerContainerDiv.appendChild(a.div)}a.setMap(this);a.setVisibility(true);a.redraw();this.measureLayer=a},changeSrs:function(k,a){var c=this.getProjection().toString();if(k==c){return}this.projection=k.toString();if(this.maxExtent){var l=((c.slice(0,6)=="EPSG:4")&&(parseInt(c.slice(5))>=4000)&&(parseInt(c.slice(5))<5000));if(l){if(this.maxExtent.left<=-180){this.maxExtent.left=-179.99}if(this.maxExtent.top>=90){this.maxExtent.top=89.99}if(this.maxExtent.right>=180){this.maxExtent.right=179.99}if(this.maxExtent.bottom<=-90){this.maxExtent.bottom=-89.99}}var g=coordTransform(c,k,this.maxExtent.left,this.maxExtent.top);var f=coordTransform(c,k,this.maxExtent.right,this.maxExtent.bottom);this.maxExtent=new OpenLayers.Bounds(g[0],f[1],f[0],g[1])}this.units="";this.changeLayersSrs(k,c);var r=this.getExtent();if(r){punto=coordTransform(c,k,r.left,r.top);xMinA=punto[0];yMaxA=punto[1];punto=coordTransform(c,k,r.right,r.bottom);xMaxA=punto[0];yMinA=punto[1];punto=coordTransform(c,k,r.left,r.bottom);xMinB=punto[0];yMinB=punto[1];punto=coordTransform(c,k,r.right,r.top);xMaxB=punto[0];yMaxB=punto[1];xMin=((xMinA+xMinB)/2);yMin=((yMinA+yMinB)/2);xMax=((xMaxA+xMaxB)/2);yMax=((yMaxA+yMaxB)/2);var b=new OpenLayers.Bounds(xMin,yMin,xMax,yMax)}var u;var o;if(this.WMSCMaxExtent){u=this.WMSCMaxExtent;o=0}else{if(this.extentReference&&this.zoomReference&&this.SRSReference){var v=this.extentReference;var q=this.SRSReference;var g=coordTransform(q,k,v.left,v.top);var f=coordTransform(q,k,v.right,v.bottom);u=new OpenLayers.Bounds(g[0],f[1],f[0],g[1]);o=this.zoomReference}else{var p=false;var m=0;while((m<this.controls.length)&&(!p)){p=(this.controls[m].CLASS_NAME=="OpenLayers.Control.IAAA_ToolBar");m++}if(p){m--;var v=this.controls[m].getInitialExtent();var q=this.controls[m]._initialSrs;var g=coordTransform(q,k,v.left,v.top);var f=coordTransform(q,k,v.right,v.bottom);u=new OpenLayers.Bounds(g[0],f[1],f[0],g[1]);o=this.controls[m].getInitialZoomLevel()}else{u=b;o=this.getZoom()}}}if(a){this.resolutions=a}else{if(u){this.initResolutionsFromParameters(u,o)}else{if(this.maxExtent){this.initResolutionsFromParameters(this.maxExtent,0)}}}if(b){this.zoomToExtentForNewSrs(b,true)}},zoomToExtent:function(c,f){var b=c.getCenterLonLat();if(this.baseLayer&&this.baseLayer.wrapDateLine){var a=this.getMaxExtent();c=c.clone();while(c.right<c.left){c.right+=a.getWidth()}b=c.getCenterLonLat().wrapDateLine(a)}this.setCenter(b,this.getZoomForExtent(c,true),null,f)},zoomToExtentForNewSrs:function(a,c){var b=a.getCenterLonLat();if(this.baseLayer&&this.baseLayer.wrapDateLine){var m=this.getMaxExtent();a=a.clone();while(a.right<a.left){a.right+=m.getWidth()}b=a.getCenterLonLat().wrapDateLine(m)}var k=this.getSize();var f=Math.max(a.getWidth()/k.w,a.getHeight()/k.h);var l;var p=Number.POSITIVE_INFINITY;for(var g=0;g<this.resolutions.length;g++){l=Math.abs(this.resolutions[g]-f);if(l>p){break}p=l}var o=Math.max(0,g-1);this.setCenter(b,o,null,c)},getExtentForMapResolutions:function(){var g=null;var a=this.getCenter();var l=this.getZoom();var b=this.resolutions[Math.round(l)];if((a!=null)&&(b!=null)){var f=this.getSize();var k=f.w*b;var c=f.h*b;g=new OpenLayers.Bounds(a.lon-k/2,a.lat-c/2,a.lon+k/2,a.lat+c/2)}return g},changeLayersSrs:function(F,o){for(var C=0;C<this.getMapServerConnectionCount();C++){var v=this.getMapServerConnection(C);if(((v.CLASS_NAME=="OpenLayers.Layer.IAAA_Server")&&(!v.getLoadFromTree()))||(v.CLASS_NAME=="OpenLayers.Layer.IAAA_WFS")||(v.CLASS_NAME=="OpenLayers.Layer.IAAA_GML")||(v.CLASS_NAME=="OpenLayers.Layer.IAAA_KML")||(v.CLASS_NAME=="OpenLayers.Layer.IAAA_Markers")){v.changeSrs(F)}else{if((v.CLASS_NAME=="OpenLayers.Layer.Vector")||(v.CLASS_NAME=="OpenLayers.Layer.IAAA_VectorGenericPopups")){if(!((this.selectedGeometryLayer!=null)&&(v.id==this.selectedGeometryLayer.id))){var b=[];var I=[];for(var E in v.features){var H=new OpenLayers.IAAA_SRSGeometry(v.features[E].geometry.clone(),o);H.transformSrs(F);b.push(H.geometry);I.push(v.features[E].clone())}v.destroyFeatures();for(var q in b){var k;if(v.additionalInfo){k=new OpenLayers.Feature.Vector();for(var A in I[q]){k[A]=I[q][A]}k.geometry=b[q]}else{k=new OpenLayers.Feature.Vector(b[q])}v.addFeatures(k)}}}else{if(v.CLASS_NAME=="OpenLayers.Layer.IAAA_GeoRSS"){var b=[];var I=[];for(var E in v.features){var l=new OpenLayers.Geometry.Point(v.features[E].marker.lonlat.lon,v.features[E].marker.lonlat.lat);var H=new OpenLayers.IAAA_SRSGeometry(l.clone(),o);H.transformSrs(F);v.features[E].marker.lonlat.lon=H.geometry.x;v.features[E].marker.lonlat.lat=H.geometry.y}}else{if(v.CLASS_NAME=="OpenLayers.Layer.Image"){var u=((F.slice(0,6)=="EPSG:4")&&(parseInt(F.slice(5))>=4000)&&(parseInt(F.slice(5))<5000));if((!v.vectorLayer)||u){if(v.vectorLayer){v.setVisibility(v.vectorLayer.getVisibility());ancientSrsAux=v.projection}else{ancientSrsAux=o}var c=this.layers[C].extent;var r=new OpenLayers.IAAA_Bounds(c.left,c.bottom,c.right,c.top);r.setSrs(ancientSrsAux);r.transformSrs(this.getProjection());if(this.layers[C].getVisibility()){this.layers[C].setVisibility(false);this.layers[C].extent=new OpenLayers.Bounds(r.left,r.bottom,r.right,r.top);this.layers[C].setVisibility(true)}else{this.layers[C].extent=new OpenLayers.Bounds(r.left,r.bottom,r.right,r.top)}}else{var D=v.getVisibility();v.setVisibility(false);if(D){var m=v.vectorLayer;var a=true;for(var G in m.layerImages){a=(a&&(!m.layerImages[G].getVisibility()))}if(a){alert(messages.noKMLImageReprojection1+v.vectorLayer.name+messages.noKMLImageReprojection2+F+messages.noKMLImageReprojection3)}}}}}}}}if(this.selectedGeometryList!=null){if(this.selectedGeometryLayer!=null){this.selectedGeometryLayer.destroyFeatures()}for(var C in this.selectedGeometryList){this.selectedGeometryList[C].transformSrs(this.getProjection());if(this.selectedGeometryLayer!=null){var B=new OpenLayers.Feature.Vector(this.selectedGeometryList[C].geometry);this.selectedGeometryLayer.addFeatures(B)}}if(this.selectedGeometryExtent!=null){this.selectedGeometryExtent.transformSrs(this.getProjection())}if((this.originalSelectedGeometry!=null)&&(this.selectedGeometryLayer!=null)){this.originalSelectedGeometry.transformSrs(this.getProjection());var f=new OpenLayers.Feature.Vector(this.originalSelectedGeometry.geometry,{},this.originalSelectedGeometry.style);this.selectedGeometryLayer.addFeatures(f)}}},initResolutionsFromParameters:function(g,b){if((b>=0)&&(b<this.getNumZoomLevels())){var f=new Array();f[b]=Math.max(g.getWidth()/this.getSize().w,g.getHeight()/this.getSize().h);for(var c=b+1;c<this.getNumZoomLevels();c++){f[c]=f[c-1]/2}for(var c=b-1;c>=0;c--){f[c]=f[c+1]*2}for(var a=0;a<this.layers.length;a++){if((!this.layers[a].isWMSC)&&(this.layers[a].CLASS_NAME!="OpenLayers.Layer.Google")){this.layers[a].resolutions=f}}this.resolutions=f}},clearMapServerConnection:function(){for(var a=0;a<this.layers.length;a++){this.removeLayer(this.layers[a])}},setMaxExtent:function(b){this.maxExtent=b;for(var a=0;a<this.layers.length;a++){this.layers[a].maxExtent=b}},getProjection:function(){return this.projection},isValidLonLat:function(a){if(this.ignoreMaxExtent){return((a!=undefined)&&(a!=null))}else{return OpenLayers.Map.prototype.isValidLonLat.apply(this,[a])}},getSRSScale:function(o){var a=this.getExtent();if(o==this.getProjection()){var f=a.left;var u=a.bottom;var q=a.right;var k=a.top}else{p=coordTransform(this.getProjection(),o,a.left,a.top);var l=p[0];var v=p[1];var p=coordTransform(this.getProjection(),o,a.right,a.bottom);var B=p[0];var c=p[1];p=coordTransform(this.getProjection(),o,a.left,a.bottom);var g=p[0];var b=p[1];p=coordTransform(this.getProjection(),o,a.right,a.top);var A=p[0];var r=p[1];var f=((l+g)/2);var u=((c+b)/2);var q=((B+A)/2);var k=((v+r)/2)}var m=((((q-f)/this.getSize().w)+((k-u)/this.getSize().h))/2)*500000000;return m},getSelectedGeometryList:function(){return this.selectedGeometryList},setSelectedGeometryList:function(a){this.selectedGeometryList=a},setFullExtentValue:function(a){this.fullExtent=a},zoomToFullExtent:function(){if(this.fullExtent){this.zoomToExtent(this.fullExtent);for(var a in this.layers){if((this.layers[a].CLASS_NAME=="OpenLayers.Layer.WMS")||(this.layers[a].CLASS_NAME=="OpenLayers.Layer.IAAA_WMS")){this.layers[a].redraw()}}}},getPointer:function(){return this.viewPortDiv.style.cursor},setPointer:function(a){this.viewPortDiv.style.cursor=a},getActualScale:function(){var g=this.getExtent();if(!g){return -1}var f=new OpenLayers.LonLat(g.top,g.left);var m=new OpenLayers.LonLat(g.top,g.right);var a=this.getCoordDistanceInMeters(f,m,this.getProjection())/this.getSize().w;var k=a*100;var c=32;try{var b=c/screen.availWidth}catch(l){var b=c/1024}scale=k/b;return scale},setActualScale:function(p){var m=32;try{var c=m/screen.availWidth}catch(q){var c=m/1024}var b=p*c;var k=b/100;if((this.getProjection()=="EPSG:4326")||(this.getProjection()=="EPSG:4230")||(this.getProjection()=="EPSG:4258")){constantValue=111194.874284}else{constantValue=1}var a=this.getCenter();var l=this.getSize().w;var o=this.getSize().h;var A=(l*k)/constantValue;var r=(o*k)/constantValue;var v=a.lon-(A/2);var g=a.lat-(r/2);var f=a.lon+(A/2);var u=a.lat+(r/2);this.zoomToExtent(new OpenLayers.Bounds(v,g,f,u))},showIncompatibleWMSCDialog:function(){if(this._incompatibleWMSCDialog){disableMainClient(true);this._incompatibleWMSCDialog.style.visibility="visible"}},hideIncompatibleWMSCDialog:function(){if(this._incompatibleWMSCDialog){enableMainClient(false);this._incompatibleWMSCDialog.style.visibility="hidden"}},setIncompatibleWMSCText:function(a){if(this._incompatibleWMSCText){this._incompatibleWMSCText.innerHTML=a}},acceptAddIncompatibleWMSC:function(){var f=getMap();f.hideIncompatibleWMSCDialog();var c=f.layers.length;for(var b=(c-1);b>=0;b--){if((f.layers[b].CLASS_NAME=="OpenLayers.Layer.IAAA_Server")&&f.layers[b].isWMSC&&(!f.layers[b].getLoadFromTree())){if(getTree&&getTree()&&f.layers[b].getTreeNode()){getTree()._removeWMSNode(f.layers[b].getTreeNode(),getTree().dojo)}else{f.removeLayer(f.layers[b])}}}var a=OpenLayers.IAAA_Utils.newAddWMS;OpenLayers.IAAA_Utils.handlerWhenAddElementLoaded();if(getTree&&getTree()&&a.getTreeNode&&a.getTreeNode()){getTree().expandNode({source:a.getTreeNode()})}if((!OpenLayers.IAAA_Utils.addElementWindow)||(!OpenLayers.IAAA_Utils.addElementWindow.document)){OpenLayers.IAAA_Utils.endAddElement()}},cancelAddIncompatibleWMSC:function(){getMap().hideIncompatibleWMSCDialog();if((OpenLayers.IAAA_Utils.getAddElementType()==OpenLayers.IAAA_Utils.ADD_WMS_LOAD_FROM_TREE)&&OpenLayers.IAAA_Utils.newAddWMS.getTreeNode&&OpenLayers.IAAA_Utils.newAddWMS.getTreeNode()){OpenLayers.IAAA_Utils.newAddWMS.getTreeNode().collapse()}OpenLayers.IAAA_Utils.endAddElement()},getNumZoomLevels:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.numZoomLevels}else{a=this.numZoomLevels}return a},CLASS_NAME:"OpenLayers.Map.IAAA_Map"});OpenLayers.Map.IAAA_OverviewMap=OpenLayers.Class(OpenLayers.Map,{map:null,draggingBox:false,actualSrs:null,initialize:function(g,c){var k="visible";if(c&&(c.visibility!=undefined)&&(!c.visibility)){k="hidden"}this.map=g;var m=OpenLayers.Util.createDiv("minimap",null,null,null,"absolute",null,k);document.body.appendChild(m);if(c&&(c.offsetX)){m.style.left=c.offsetX+"px"}if(c&&(c.offsetY)){m.style.top=c.offsetY+"px"}if(c&&(c.height)){m.style.height=c.height+"px"}if(c&&(c.width)){m.style.width=c.width+"px"}if(c&&(c.border)){m.style.border=c.border+"px solid black"}if(c&&(c.zIndex)){m.style.zIndex=c.zIndex}var a=new Array();a.push("minimap",{controls:[]});OpenLayers.Map.prototype.initialize.apply(this,a);var l=new OpenLayers.Layer.WMS(this.map.baseLayer.name,this.map.baseLayer.url,{format:this.map.baseLayer.format,transparent:false,layers:this.map.baseLayer.params.LAYERS},{singleTile:true,buffer:0,visibility:true,isBaseLayer:true});this.actualSrs=this.map.getProjection();var b=new OpenLayers.Layer.Boxes("Boxes");var f=new OpenLayers.Marker.Box(this.map.getExtent());this.events.register("mousedown",this,function(o){this.setDraggingBox(true)});this.events.register("mouseup",this,function(p){if(this.draggingBox){var o=this.getLonLatFromPixel(new OpenLayers.Pixel(p.xy.x,p.xy.y));this.setBox(o);this.setDraggingBox(false)}});this.map.events.register("zoomend",this,function(o){this.drawBox(this.map.getExtent())});this.map.events.register("moveend",this,function(o){this.drawBox(this.map.getExtent())});b.addMarker(f);this.addLayers([l,b]);this.baseLayer.projection=this.map.getProjection();if(c&&(c.extent)){this.zoomToExtent(c.extent)}this.realSrs=this.map.getProjection();this.div.style.visibility=k},setOptions:function(a){this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT);this.maxExtent=new OpenLayers.Bounds(-9999999999,-9999999999,9999999999,9999999999);this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css";OpenLayers.Util.extend(this,a)},setVisibility:function(a){if(a){this.div.style.visibility="visible"}else{this.div.style.visibility="hidden"}},getVisibility:function(){return(this.div.style.visibility=="visible")},setBox:function(a){if(this.getProjection()!=this.map.getProjection()){var b=coordTransform(this.getProjection(),this.map.getProjection(),a.lon,a.lat);a=new OpenLayers.LonLat(b[0],b[1])}this.map.setCenter(a)},drawBox:function(a){if(this.realSrs!=this.getProjection()){punto=coordTransform(this.realSrs,this.getProjection(),a.left,a.top);xMinA=punto[0];yMaxA=punto[1];punto=coordTransform(this.realSrs,this.getProjection(),a.right,a.bottom);xMaxA=punto[0];yMinA=punto[1];punto=coordTransform(this.realSrs,this.getProjection(),a.left,a.bottom);xMinB=punto[0];yMinB=punto[1];punto=coordTransform(this.realSrs,this.getProjection(),a.right,a.top);xMaxB=punto[0];yMaxB=punto[1];xMin=((xMinA+xMinB)/2);yMin=((yMinA+yMinB)/2);xMax=((xMaxA+xMaxB)/2);yMax=((yMaxA+yMaxB)/2);a=new OpenLayers.Bounds(xMin,yMin,xMax,yMax)}this.layers[1].markers[0].bounds=a;this.layers[1].drawMarker(this.layers[1].markers[0])},setDraggingBox:function(a){this.draggingBox=a},changeSrs:function(a){this.realSrs=a},getProjection:function(){if(this.projection){return this.projection}if(this.baseLayer){return this.baseLayer.projection}return null},CLASS_NAME:"OpenLayers.Map.IAAA_OverviewMap"});OpenLayers.Control.IAAA_ZoomOut=OpenLayers.Class(OpenLayers.Control,{initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments)},draw:function(){this.activate()},defaultClick:function(b){var a=this.map.getLonLatFromViewPortPx(b.xy);if(!this.map.isValidZoomLevel(this.map.zoom-1)){return}this.map.setCenter(a,this.map.zoom-1);OpenLayers.Event.stop(b);return false},activate:function(){if(this.active){return false}this.map.events.register("click",this,this.defaultClick);this.active=true;return true},deactivate:function(){this.map.events.unregister("click",this,this.defaultClick);this.active=false},CLASS_NAME:"OpenLayers.Control.IAAA_ZoomOut"});OpenLayers.Control.IAAA_ZoomBox=OpenLayers.Class(OpenLayers.Control.ZoomBox,{boxStyle:"2px solid red",draw:function(){this.handler=new OpenLayers.Handler.IAAA_Box(this,{done:this.zoomBox},{keyMask:this.keyMask,style:this.boxStyle})},CLASS_NAME:"OpenLayers.Control.IAAA_ZoomBox"});OpenLayers.Control.IAAA_LoadingMap=OpenLayers.Class(OpenLayers.Control,{imgUrl:null,layersLoaded:new Array(),loadingMessage:null,timeOutRef:null,loadingDiv:null,messageColor:null,wmsClientFontFamily:null,standardFontSize:null,loadingImg:null,uniqueId:null,errorMessage:"Problemas cargando los siguientes servidores:",waitingTime:40000,timeOutBehavior:true,initialize:function(a){this.messageColor="#003399";OpenLayers.Control.prototype.initialize.apply(this,[a]);this.active=true;this.uniqueId=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(c){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.generateLoadingDiv();for(var a in this.map.layers){var b={layer:this.map.layers[a]};this.generateLoadingVector(b)}this.map.events.register("addlayer",this,this.generateLoadingVector);this.map.events.register("removelayer",this,this.removeLayerHandler);this.map.events.register("resizeend",this,this.readjustLoadingDiv)},changeImg:function(a){this.imgUrl=a;this.generateLoadingDiv()},generateLoadingDiv:function(){var b=(this.loadingMessage!=null)?this.loadingMessage:messages.loadingMap;var a="#FF2300";var c="#D4D0C8";this.loadingDiv=OpenLayers.Util.createDiv("loading_div_"+this.uniqueId,null,null,null,"relative",null,"hidden");this.map.div.appendChild(this.loadingDiv);this.loadingDiv.style["background-color"]="#FFFFFF";this.loadingDiv.style.display="none";this.loadingDiv.style.position="absolute";var k=0;var g=0;var f=this.loadingDiv;while(f.parentNode&&f.parentNode.offsetLeft&&f.parentNode.offsetTop){k+=f.parentNode.offsetLeft;g+=f.parentNode.offsetTop;f=f.parentNode}this.loadingDiv.style.left=k+((this.map.getSize().w/2)-60);this.loadingDiv.style.top=g+((this.map.getSize().h/2)-25);this.loadingDiv.style.width=141+"px";this.loadingDiv.style.height="auto";this.loadingDiv.style.border="1px solid "+c;if(navigator.userAgent.indexOf("Firefox/3.0")>=0){this.loadingDiv.style.zIndex=2000}else{this.loadingDiv.style.zIndex=2000}this.loadingDiv.innerHTML='<table width="100%" height="100%" style="background-color:#FFFFFF;"><tr valign="middle" align="center"><td>&nbsp;<font style="font-family:'+this.wmsClientFontFamily+";font-size:"+this.standardFontSize+";color:"+this.messageColor+';">'+b+'</font></td></tr><tr valign="middle" align="center"><td><img width=101 height=13 src="'+this.loadingImg+'"></td></tr><tr style="height: 4px;"></tr></table>';this.loadingDiv.refControl=this},generateLoadingVector:function(b){if((b)&&(b.layer)){var a=b.layer;if((a.CLASS_NAME=="OpenLayers.Layer.IAAA_Server")&&(a.showLoadingIcon)&&(!this.layersLoaded["IAAA_Server_"+a.name+"_"+a.url])){a.events.register("tileloaded",this,this.layerLoadedHandler);a.events.register("tileunload",this,this.layerLoadedHandler);a.events.register("loadstart",this,this.layerLoadingHandler);a.events.register("visibilitychanged",this,function(c){if(!c.object.getVisibility()){this.layerLoadedHandler(c)}});a.events.register("urlchanged",this,this.changeUrlWMS);a.events.register("titlechanged",this,this.changeTitleWMS);if((this.numLoadingTiles==0)||(!a.getVisibility())){this.layersLoaded["IAAA_Server_"+a.name+"_"+a.url]=true}else{this.layersLoaded["IAAA_Server_"+a.name+"_"+a.url]=false;this.showLoadingDiv(a)}}else{if(((a.CLASS_NAME=="OpenLayers.Layer.WMS")||(a.CLASS_NAME=="OpenLayers.Layer.IAAA_WMS"))&&(a.showLoadingIcon)&&(!this.layersLoaded["IAAA_WMS_"+a.name+"_"+a.url])){a.events.register("loadend",this,this.layerLoadedHandler);a.events.register("loadcancel",this,this.layerLoadedHandler);a.events.register("loadstart",this,this.layerLoadingHandler);a.events.register("visibilitychanged",this,function(c){if(!c.object.getVisibility()){this.layerLoadedHandler(c)}});if((this.numLoadingTiles==0)||(!a.getVisibility())){this.layersLoaded["IAAA_WMS_"+a.name+"_"+a.url]=true}else{this.layersLoaded["IAAA_WMS_"+a.name+"_"+a.url]=false;this.showLoadingDiv(a)}}else{if((a.CLASS_NAME=="OpenLayers.Layer.IAAA_GML")&&(a.showLoadingIcon)&&(!this.layersLoaded["IAAA_GML_"+a.location+"_"+a.name])){a.events.register("loadend",this,this.layerLoadedHandler);a.events.register("loadstart",this,this.layerLoadingHandler);a.events.register("visibilitychanged",this,function(c){if(!c.object.getVisibility()){this.layerLoadedHandler(c)}});if(a.loaded){this.layersLoaded["IAAA_GML_"+a.name+"_"+a.url]=true}else{this.layersLoaded["IAAA_GML_"+a.name+"_"+a.url]=false;if(this.timeOutBehavior){window.clearTimeout(this.timeOutRef);this.timeOutRef=window.setTimeout('OpenLayers.Control.IAAA_LoadingMap.timeOut("'+this.uniqueId+'", "'+this.errorMessage+'");',this.waitingTime)}this.showLoadingDiv(a)}}else{if((a.CLASS_NAME=="OpenLayers.Layer.IAAA_IconsWMS")&&(a.showLoadingIcon)&&(!this.layersLoaded["SaveImageWMS_"+a.name+"_"+a.url])){this.layersLoaded["SaveImageWMS_"+a.name+"_"+a.url]=true;a.events.register("loadend",this,this.layerLoadedHandler);a.events.register("loadstart",this,this.layerLoadingHandler);a.events.register("visibilitychanged",this,function(c){if(!c.object.getVisibility()){this.layerLoadedHandler(c)}})}else{if((a.CLASS_NAME=="OpenLayers.Layer.IAAA_GeoRSS")&&(a.showLoadingIcon)&&(!this.layersLoaded["IAAA_GeoRSS_"+a.id])){this.layersLoaded["IAAA_GeoRSS_"+a.id]=true;a.events.register("loadend",this,this.layerLoadedHandler);a.events.register("loadstart",this,this.layerLoadingHandler);a.events.register("visibilitychanged",this,function(c){if(!c.object.getVisibility()){this.layerLoadedHandler(c)}})}else{if((a.CLASS_NAME=="OpenLayers.Layer.IAAA_TooltipMarkers")&&(a.showLoadingIcon)&&(!this.layersLoaded["TooltipMarkersLayer_"+a.serviceUrl+"_"+a.name])){this.layersLoaded["TooltipMarkersLayer_"+a.serviceUrl+"_"+a.name]=true;a.events.register("loadend",this,this.layerLoadedHandler);a.events.register("loadstart",this,this.layerLoadingHandler);a.events.register("visibilitychanged",this,function(c){if(!c.object.getVisibility()){this.layerLoadedHandler(c)}})}}}}}}}},removeLayerHandler:function(b){if(b&&b.layer){var a=b.layer;if(a.CLASS_NAME=="OpenLayers.Layer.IAAA_Server"){this.layersLoaded["IAAA_Server_"+a.name+"_"+a.url]=undefined}else{if((a.CLASS_NAME=="OpenLayers.Layer.WMS")||(a.CLASS_NAME=="OpenLayers.Layer.IAAA_WMS")){this.layersLoaded["IAAA_WMS_"+a.name+"_"+a.url]=undefined}else{if(a.CLASS_NAME=="OpenLayers.Layer.IAAA_GML"){this.layersLoaded["IAAA_GML_"+a.name+"_"+a.url]=undefined}else{if(a.CLASS_NAME=="OpenLayers.Layer.IAAA_IconsWMS"){this.layersLoaded["SaveImageWMS_"+a.name+"_"+a.url]=undefined}else{if(a.CLASS_NAME=="OpenLayers.Layer.IAAA_GeoRSS"){this.layersLoaded["IAAA_GeoRSS_"+a.id]=undefined}else{if(a.CLASS_NAME=="OpenLayers.Layer.IAAA_TooltipMarkers"){this.layersLoaded["TooltipMarkersLayer_"+a.serviceUrl+"_"+a.name]=undefined}}}}}}}},showLoadingDiv:function(a){if(this.active){this.loadingDiv.style.display="block"}if(this.uniqueId&&this.timeOutBehavior){var b=this.uniqueId;window.clearTimeout(this.timeOutRef);this.timeOutRef=window.setTimeout('OpenLayers.Control.IAAA_LoadingMap.timeOut("'+this.uniqueId+'", "'+this.errorMessage+'");',this.waitingTime)}this.map.events.register("iaaa_finishCommunication",this,this.hideLoadingDiv)},hideLoadingDiv:function(){this.loadingDiv.style.display="none";window.clearTimeout(this.timeOutRef)},allLayersLoaded:function(){for(var a in this.layersLoaded){if(this.layersLoaded[a]==false){return false}}return true},layerLoadingHandler:function(b){var a=b.object;if((a.CLASS_NAME=="OpenLayers.Layer.IAAA_Server")&&(a.showLoadingIcon)&&(a.getVisibility())){this.layersLoaded["IAAA_Server_"+a.name+"_"+a.url]=false}else{if(((a.CLASS_NAME=="OpenLayers.Layer.WMS")||(a.CLASS_NAME=="OpenLayers.Layer.IAAA_WMS"))&&(a.showLoadingIcon)&&(a.getVisibility())){this.layersLoaded["IAAA_WMS_"+a.name+"_"+a.url]=false}else{if((a.CLASS_NAME=="OpenLayers.Layer.IAAA_GML")&&(a.showLoadingIcon)&&(a.getVisibility())){this.layersLoaded["IAAA_GML_"+a.name+"_"+a.url]=false;if(this.uniqueId&&this.timeOutBehavior){window.clearTimeout(this.timeOutRef);this.timeOutRef=window.setTimeout('OpenLayers.Control.IAAA_LoadingMap.timeOut("'+this.uniqueId+'", "'+this.errorMessage+'");',this.waitingTime)}}else{if((a.CLASS_NAME=="OpenLayers.Layer.IAAA_IconsWMS")&&(a.showLoadingIcon)){this.layersLoaded["SaveImageWMS_"+a.name+"_"+a.url]=false}else{if((a.CLASS_NAME=="OpenLayers.Layer.IAAA_GeoRSS")&&(a.showLoadingIcon)){this.layersLoaded["IAAA_GeoRSS_"+a.id]=false}else{if((a.CLASS_NAME=="OpenLayers.Layer.IAAA_TooltipMarkers")&&(a.showLoadingIcon)){this.layersLoaded["TooltipMarkersLayer_"+a.serviceUrl+"_"+a.name]=false}else{return}}}}}}this.showLoadingDiv(a)},layerLoadedHandler:function(b){var a=b.object;if((a.CLASS_NAME=="OpenLayers.Layer.IAAA_Server")&&(a.showLoadingIcon)){this.layersLoaded["IAAA_Server_"+a.name+"_"+a.url]=true}else{if(((a.CLASS_NAME=="OpenLayers.Layer.WMS")||(a.CLASS_NAME=="OpenLayers.Layer.IAAA_WMS"))&&(a.showLoadingIcon)){this.layersLoaded["IAAA_WMS_"+a.name+"_"+a.url]=true}else{if((a.CLASS_NAME=="OpenLayers.Layer.IAAA_GML")&&(a.showLoadingIcon)){this.layersLoaded["IAAA_GML_"+a.location+"_"+a.name]=true}else{if((a.CLASS_NAME=="OpenLayers.Layer.IAAA_IconsWMS")&&(a.showLoadingIcon)){this.layersLoaded["SaveImageWMS_"+a.name+"_"+a.url]=true}else{if((a.CLASS_NAME=="OpenLayers.Layer.IAAA_TooltipMarkers")&&(a.showLoadingIcon)){this.layersLoaded["TooltipMarkersLayer_"+a.serviceUrl+"_"+a.name]=true}else{if((a.CLASS_NAME=="OpenLayers.Layer.IAAA_GeoRSS")&&(a.showLoadingIcon)){this.layersLoaded["IAAA_GeoRSS_"+a.id]=true}}}}}}if(this.allLayersLoaded()){this.hideLoadingDiv()}},changeUrlWMS:function(b){var a=this.layersLoaded["IAAA_Server_"+b.layer.name+"_"+b.ancientUrl];this.layersLoaded["IAAA_Server_"+b.layer.name+"_"+b.ancientUrl]=true;this.layersLoaded["IAAA_Server_"+b.layer.name+"_"+b.layer.url]=a},changeTitleWMS:function(b){var a=this.layersLoaded["IAAA_Server_"+b.ancientTitle+"_"+b.layer.url];this.layersLoaded["IAAA_Server_"+b.ancientTitle+"_"+b.layer.url]=true;this.layersLoaded["IAAA_Server_"+b.layer.name+"_"+b.layer.url]=a},readjustLoadingDiv:function(){this.loadingDiv.style.left=((this.map.getSize().w/2)-60);this.loadingDiv.style.top=((this.map.getSize().h/2)-25)},deactivate:function(){this.loadingDiv.style.display="none";OpenLayers.Control.prototype.deactivate.apply(this,arguments);this.active=false},CLASS_NAME:"OpenLayers.Control.IAAA_LoadingMap"});OpenLayers.Control.IAAA_LoadingMap.timeOut=function(b,m){document.getElementById("loading_div_"+b).style.display="none";window.clearTimeout(b);var p="";if(m&&document.getElementById("loading_div_"+b).refControl){var f=document.getElementById("loading_div_"+b).refControl.layersLoaded;if(f){for(var l in f){var c=l.split("_");var a="";if(c[0]=="IAAA"){a=c[2]}else{a=c[1]}if(f[l]==false){p+="\n"+a;document.getElementById("loading_div_"+b).refControl.layersLoaded[l]=true}}}}var k=document.getElementById("loading_div_"+b).refControl.map.layers;for(var g in k){if(((k[g].CLASS_NAME=="OpenLayers.Layer.Grid")||(k[g].CLASS_NAME=="OpenLayers.Layer.WMS")||(k[g].CLASS_NAME=="OpenLayers.Layer.IAAA_WMS")||(k[g].CLASS_NAME=="OpenLayers.Layer.IAAA_Server")||(k[g].CLASS_NAME=="OpenLayers.Layer.IAAA_GeoRSS")||(k[g].CLASS_NAME=="OpenLayers.Layer.IAAA_IconsWMS"))&&(k[g].numLoadingTiles>0)){if(k[g].CLASS_NAME=="OpenLayers.Layer.IAAA_Server"){k[g].setVisibilityToAllLayers(false);try{if(getTree&&getTree()){getTree().updateCheckBoxesVisibility();if(k[g].treeLoadImg!=null){k[g].treeLoadImg.style.visibility="hidden";k[g].treeLoadImg.style.display="inline"}}}catch(o){}}else{k[g].setVisibility(false)}}}if(p!=""){alert(m+p)}};OpenLayers.Control.IAAA_ImprovedScaleBar=OpenLayers.Class(OpenLayers.Control.ScaleBar,{barAlign:"left",draw:function(){this.map.events.register("resizeend",this,this.onMapResize);var a=OpenLayers.Control.ScaleBar.prototype.draw.apply(this,arguments);this.div.style.top=this.map.getSize().h-30;if(this.barAlign=="right"){this.div.style.left=this.map.getSize().w-(this.maxWidth+40)}else{this.div.style.left=20}return a},onMapResize:function(){this.div.style.top=this.map.getSize().h-30;if(this.barAlign=="right"){this.div.style.left=this.map.getSize().w-(this.maxWidth+40)}else{this.div.style.left=20}},update:function(g){if(this.map.baseLayer==null||!this.map.getActualScale()){return}this.scale=(g!=undefined)?g:this.map.getActualScale();this.element.title="scale 1:"+this.formatNumber(this.scale);this.element.style.width=this.maxWidth+"px";var l=this.getComp();this.setSubProps(l);this.setSubProps(l);if(this.map.getActualScale()<100000){this.subProps.dec=2}else{if(this.map.getActualScale()<5000000){this.subProps.dec=1}else{this.subProps.dec=0}}this.labelContainer.innerHTML="";this.graphicsContainer.innerHTML="";this.numbersContainer.innerHTML="";var k,p,v,q;var f=this.divisions*this.subdivisions;var m={left:0+(this.singleLine?0:this.xOffsetNumbersBox),center:(this.maxWidth/2)-(f*this.subProps.pixels/2)-(this.singleLine?this.xOffsetSingleLine/2:0),right:this.maxWidth-(f*this.subProps.pixels)-(this.singleLine?this.xOffsetSingleLine:this.xOffsetNumbersBox)};var a=0+m[this.align];var b=0;for(var r=0;r<this.divisions;++r){a=r*this.subdivisions*this.subProps.pixels;a+=m[this.align];markerActualMeasure=(r==0)?0:(((r*this.subdivisions)*this.map.getPixelDistanceInMeters(new OpenLayers.Pixel(0,0),new OpenLayers.Pixel(this.subProps.pixels,0)))/1000).toFixed(this.subProps.dec);b=(r==0)?0:((r*this.subdivisions)*this.subProps.length).toFixed(this.subProps.dec);k=document.createElement("div");k.className=this.displayClass+"MarkerMajor";k.style.position="absolute";k.style.overflow="hidden";k.style.left=Math.round(a-this.xOffsetMarkerMajor)+"px";k.appendChild(document.createTextNode(" "));this.graphicsContainer.appendChild(k);if(!this.singleLine){v=document.createElement("div");v.className=this.displayClass+"NumbersBox";v.style.position="absolute";v.style.overflow="visible";v.style.textAlign="center";try{if(this.showMinorMeasures){v.style.left=Math.round(a-this.xOffsetNumbersBox)-b.length-1+"px"}else{v.style.left=Math.round(a-this.xOffsetNumbersBox)-b.length-1+"px"}}catch(o){}v.appendChild(document.createTextNode(markerActualMeasure));this.numbersContainer.appendChild(v)}for(var u=0;u<this.subdivisions;++u){p=document.createElement("div");p.style.position="absolute";p.style.overflow="hidden";p.style.width=Math.round(this.subProps.pixels)+"px";if((u%2)==0){p.className=this.displayClass+"Bar";p.style.left=Math.round(a-this.xOffsetBar)+"px"}else{p.className=this.displayClass+"BarAlt";p.style.left=Math.round(a-this.xOffsetBarAlt)+"px"}p.appendChild(document.createTextNode(" "));this.graphicsContainer.appendChild(p);if(u<(this.subdivisions-1)){a=((r*this.subdivisions)+(u+1))*this.subProps.pixels;a+=m[this.align];b=(r*this.subdivisions+u+1)*this.subProps.length;markerActualMeasure=(((r*this.subdivisions)*this.map.getPixelDistanceInMeters(new OpenLayers.Pixel(0,0),new OpenLayers.Pixel(this.subProps.pixels,0)))/1000).toFixed(this.subProps.dec);k=document.createElement("div");k.className=this.displayClass+"MarkerMinor";k.style.position="absolute";k.style.overflow="hidden";k.style.left=Math.round(a-this.xOffsetMarkerMinor)+"px";k.appendChild(document.createTextNode(" "));this.graphicsContainer.appendChild(k);if(this.showMinorMeasures&&!this.singleLine){v=document.createElement("div");v.className=this.displayClass+"NumbersBox";v.style.position="absolute";v.style.overflow="visible";v.style.textAlign="center";v.style.left=Math.round(a-this.xOffsetNumbersBox)+"px";v.appendChild(document.createTextNode(markerActualMeasure));this.numbersContainer.appendChild(v)}}}}a=f*this.subProps.pixels;a+=m[this.align];b=(f*this.subProps.length).toFixed(this.subProps.dec);markerActualMeasure=((f*this.map.getPixelDistanceInMeters(new OpenLayers.Pixel(0,0),new OpenLayers.Pixel(this.subProps.pixels,0)))/1000).toFixed(this.subProps.dec);k=document.createElement("div");k.className=this.displayClass+"MarkerMajor";k.style.position="absolute";k.style.overflow="hidden";k.style.left=Math.round(a-this.xOffsetMarkerMajor)+"px";k.appendChild(document.createTextNode(" "));this.graphicsContainer.appendChild(k);if(!this.singleLine){v=document.createElement("div");v.className=this.displayClass+"NumbersBox";v.style.position="absolute";v.style.overflow="visible";v.style.textAlign="center";try{if(this.showMinorMeasures){v.style.left=Math.round(a-this.xOffsetNumbersBox)-b.length-1+"px"}else{v.style.left=Math.round(a-this.xOffsetNumbersBox)-b.length-1+"px"}}catch(o){}v.appendChild(document.createTextNode(markerActualMeasure));this.numbersContainer.appendChild(v)}var A=document.createElement("div");A.style.position="absolute";var c;if(this.singleLine){c=markerActualMeasure;c=parseInt(c);A.className=this.displayClass+"LabelBoxSingleLine";A.style.left=Math.round(a+this.styleValue("LabelBoxSingleLine","left"))+5+"px";A.style.width="100px"}else{c="";A.className=this.displayClass+"LabelBox";A.style.textAlign="right";A.style.width=Math.round(f*this.subProps.pixels)+"px";A.style.left=Math.round(m[this.align])+30+"px";A.style.overflow="hidden"}if(this.abbreviateLabel){c+=" "+this.subProps.abbr}else{c+=" "+this.subProps.units}A.appendChild(document.createTextNode(c));this.labelContainer.appendChild(A)},setSubProps:function(l){var a=this.measurementProperties[this.displaySystem];var b=null;var g=null;var o=null;var q=null;var c=Number.POSITIVE_INFINITY;var k=Number.POSITIVE_INFINITY;var f=0;for(var p=0;p<l.length;++p){for(valueIndex in l[p]){var m=l[p][valueIndex];c=m.score;k=m.tie;b=m.value;f=m.dec;o=a.units[p];q=a.abbr[p];pixelsPerDisplayUnit=OpenLayers.DOTS_PER_INCH*a.inches[p]/this.scale;g=pixelsPerDisplayUnit*b}}this.subProps={length:b,pixels:g,units:o,abbr:q,dec:f}},CLASS_NAME:"OpenLayers.Control.IAAA_ImprovedScaleBar"});OpenLayers.Control.IAAA_ScaleBar=OpenLayers.Class(OpenLayers.Control.Scale,{barDiv:null,zeroDiv:null,lengthDiv:null,length:60,barImgSrc:"../img/others/vacio_negro.gif",initialize:function(b,a){OpenLayers.Control.Scale.prototype.initialize.apply(this,[a]);this.barDiv=document.createElement("DIV");this.zeroDiv=document.createElement("DIV");this.lengthDiv=document.createElement("DIV")},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.div.style.left=35;this.div.style.top=this.map.getSize().h-30;this.div.style.visibility="visible";this.div.style.display="block";this.barDiv.style.width=this.length;this.barDiv.style.height=3;this.barDiv.style.position="absolute";this.barDiv.style.top=20;this.barDiv.style.left=0;this.div.appendChild(this.barDiv);var a=document.createElement("IMG");this.barDiv.appendChild(a);this.zeroDiv.style.position="absolute";this.zeroDiv.style.top=0;this.zeroDiv.style.left=0;this.zeroDiv.style.fontFamily="Arial";this.zeroDiv.style.fontSize="8pt";this.zeroDiv.style.textAlign="left";this.zeroDiv.style.fontWeight="normal";this.zeroDiv.style.color="rgb(0, 0, 0)";this.div.appendChild(this.zeroDiv);this.lengthDiv.style.position="absolute";this.lengthDiv.style.top=0;this.lengthDiv.style.width=100;this.lengthDiv.style.left=this.length-20;this.lengthDiv.style.fontFamily="Arial";this.lengthDiv.style.fontSize="8pt";this.lengthDiv.style.textAlign="left";this.lengthDiv.style.fontWeight="normal";this.lengthDiv.style.color="rgb(0, 0, 0)";this.div.appendChild(this.lengthDiv);a.src=this.barImgSrc;a.border="0";a.align="right";a.style.width="100%";a.style.height="100%";this.map.events.register("moveend",this,this.updateScale);this.map.events.register("resizeend",this,this.onMapResize);this.zeroDiv.innerHTML="0";this.updateScale();return this.div},onMapResize:function(){this.div.style.top=this.map.getSize().h-30},updateScale:function(){var b=new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top)+parseInt(this.barDiv.style.top));var a=new OpenLayers.Pixel(parseInt(this.div.style.left)+this.length,parseInt(this.div.style.top)+parseInt(this.barDiv.style.top));var c=parseFloat(this.map.getPixelDistanceInMeters(b,a))/1000;c=c*10;c=Math.floor(c);c=c/10;this.lengthDiv.innerHTML=c+" Km"},CLASS_NAME:"OpenLayers.Control.IAAA_ScaleBar"});OpenLayers.Control.IAAA_OverviewMap=OpenLayers.Class(OpenLayers.Control.OverviewMap,{initExtent:null,initSRS:null,styleExtentBox:"2px dotted red",styleBorder:"1px solid black",updateOverviewMapExtent:false,minRectSize:0,align:"left",vAlign:"top",draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(this.align=="right"){this.div.style.right="0"}if(this.vAlign=="bottom"){this.div.style.bottom="0"}if(!(this.layers.length>0)){if(this.map.baseLayer){var b=this.map.baseLayer.clone();this.layers=[b]}else{this.map.events.register("changebaselayer",this,this.baseLayerDraw);return this.div}}this.element=document.createElement("div");this.element.className=this.displayClass+"Element";this.element.style.display="none";this.mapDiv=document.createElement("div");this.mapDiv.style.width=this.size.w+"px";this.mapDiv.style.height=this.size.h+"px";this.mapDiv.style.position="relative";this.mapDiv.style.overflow="hidden";this.mapDiv.style.display="";this.mapDiv.style.border=this.styleBorder;this.mapDiv.style.cursor="crosshair";this.mapDiv.id=OpenLayers.Util.createUniqueID("overviewMap");this.extentRectangle=document.createElement("div");this.extentRectangle.style.position="absolute";this.extentRectangle.style.zIndex=1000;this.extentRectangle.style.cursor="move";this.extentRectangle.style.border=this.styleExtentBox;this.extentRectangle.className=this.displayClass+"ExtentRectangle";if(OpenLayers.IAAA_Utils.getNavigator()[0]=="msie"){this.extentRectangle.appendChild(document.createElement("<!-->"))}this.mapDiv.appendChild(this.extentRectangle);this.element.appendChild(this.mapDiv);this.div.appendChild(this.element);this.element.style.display="";this.active=true;if(this.map.getExtent()){this.update()}this.map.events.register("moveend",this,this.update);this.map.events.register("changepropsforwmsc",this,this.update);this.map.events.register("restoreprops",this,this.update);if(this.ovmap){this.ovmap.div.style.backgroundColor="#FFFFFF";for(var a in this.ovmap.layers){this.ovmap.layers[a].redraw()}}return this.div},createMap:function(){var a=OpenLayers.Util.extend({controls:[],maxResolution:"auto",fallThrough:false,maxExtent:new OpenLayers.Bounds(-180,-90,180,90)},this.mapOptions);this.ovmap=new OpenLayers.Map.IAAA_Map(this.mapDiv,a);OpenLayers.Event.stopObserving(window,"unload",this.ovmap.unloadDestroy);this.ovmap.addLayers(this.layers);if(this.initExtent){if((this.initSRS)&&(this.initSRS!=this.ovmap.getProjection())){var c=coordTransform(this.initSRS,this.ovmap.getProjection(),this.initExtent.left,this.initExtent.top);var b=coordTransform(this.initSRS,this.ovmap.getProjection(),this.initExtent.right,this.initExtent.bottom);firstExtent=new OpenLayers.Bounds(c[0],b[1],b[0],c[1])}else{firstExtent=this.initExtent}this.ovmap.zoomToExtent(firstExtent)}else{this.ovmap.zoomToMaxExtent()}this.wComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-right-width"));this.wComp=(this.wComp)?this.wComp:2;this.hComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-bottom-width"));this.hComp=(this.hComp)?this.hComp:2;this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.rectDrag,done:this.updateMapToRect},{map:this.ovmap});this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.mapDivClick},{single:true,"double":false,stopSingle:true,stopDouble:true,pixelTolerance:1,map:this.ovmap});this.handlers.click.activate();this.rectEvents=new OpenLayers.Events(this,this.extentRectangle,null,true);this.rectEvents.register("mouseover",this,function(f){if(!this.handlers.drag.active&&!this.map.dragging){this.handlers.drag.activate()}});this.rectEvents.register("mouseout",this,function(f){if(!this.handlers.drag.dragging){this.handlers.drag.deactivate()}})},isSuitableOverview:function(){if(!this.updateOverviewMapExtent){return true}var c=this.map.getExtent();if(this.map.ignoreMaxExtent){var f=c}else{var l=this.map.maxExtent;var f=new OpenLayers.Bounds(Math.max(c.left,l.left),Math.max(c.bottom,l.bottom),Math.min(c.right,l.right),Math.min(c.top,l.top))}if(!f){return false}if(this.map.getProjection()!=this.ovmap.getProjection()){var k=coordTransform(this.map.getProjection(),this.ovmap.getProjection(),f.left,f.top);var g=coordTransform(this.map.getProjection(),this.ovmap.getProjection(),f.right,f.bottom);f=new OpenLayers.Bounds(k[0],g[1],g[0],k[1])}var a=this.ovmap.getExtent();var o=(((a.right-a.left)/this.size.w)+((a.top-a.bottom)/this.size.h))/2;var b=(((f.right-f.left)/this.map.getSize().w)+((f.top-f.bottom)/this.map.getSize().h))/2;var m=o/b;return((m>this.minRatio)&&(m<=this.maxRatio)&&(this.ovmap.getExtent().containsBounds(f,false,false)))},updateOverview:function(){var c=this.map.getExtent();if(this.map.ignoreMaxExtent){var f=c}else{var m=this.map.maxExtent;var f=new OpenLayers.Bounds(Math.max(c.left,m.left),Math.max(c.bottom,m.bottom),Math.min(c.right,m.right),Math.min(c.top,m.top))}if(!f){return false}if(this.map.getProjection()!=this.ovmap.getProjection()){var l=coordTransform(this.map.getProjection(),this.ovmap.getProjection(),f.left,f.top);var k=coordTransform(this.map.getProjection(),this.ovmap.getProjection(),f.right,f.bottom);f=new OpenLayers.Bounds(l[0],k[1],k[0],l[1])}var a=this.ovmap.getExtent();var p=(((a.right-a.left)/this.size.w)+((a.top-a.bottom)/this.size.h))/2;var b=(((f.right-f.left)/this.map.getSize().w)+((f.top-f.bottom)/this.map.getSize().h))/2;var o=p/b;var g=this.ovmap.getResolution();if(o>this.maxRatio){g=this.minRatio*b}else{if(o<=this.minRatio){g=this.maxRatio*b}}this.ovmap.setCenter(f.getCenterLonLat(),this.ovmap.getZoomForResolution(g));this.updateRectToMap()},updateRectToMap:function(){if(!this.map.getExtent()){return}var b=this.map.getExtent();if(((this.map.getProjection()[5]=="4")&&((this.map.getProjection()[6]=="2")||(this.map.getProjection()[6]=="3")))&&((this.ovmap.getProjection()[5]=="4")&&((this.ovmap.getProjection()[6]=="2")||(this.ovmap.getProjection()[6]=="3")))){if(b.left<=-180){b.left=-179.99}if(b.top>=90){b.top=89.99}if(b.right>=180){b.right=179.99}if(b.bottom<=-90){b.bottom=-89.99}}var a=this.getRectBoundsFromMapBounds(b);if(a){this.setRectPxBounds(a)}},updateMapToRect:function(){var c=this.getMapBoundsFromRectBounds(this.rectPxBounds);var f;if((this.map.baseLayer.CLASS_NAME!="OpenLayers.Layer.Google")&&(this.map.baseLayer.CLASS_NAME!="OpenLayers.Layer.IAAA_Google")){f=this.map.getProjection()}else{f="EPSG:900913"}if(this.ovmap.getProjection()!=f){var g=c.getCenterLonLat();var b=coordTransform(this.ovmap.getProjection(),f,g.lon,g.lat);var a=new OpenLayers.LonLat(b[0],b[1])}else{var a=c.getCenterLonLat()}this.map.panTo(a)},getRectBoundsFromMapBounds:function(b){var E;if((this.map.baseLayer.CLASS_NAME!="OpenLayers.Layer.Google")&&(this.map.baseLayer.CLASS_NAME!="OpenLayers.Layer.IAAA_Google")){E=this.map.getProjection()}else{E="EPSG:900913"}if(this.ovmap.getProjection()!=E){var q=coordTransform(E,this.ovmap.getProjection(),b.left,b.top);var A=q[0];var l=q[1];q=coordTransform(E,this.ovmap.getProjection(),b.right,b.bottom);var u=q[0];var o=q[1];q=coordTransform(E,this.ovmap.getProjection(),b.left,b.bottom);var v=q[0];var m=q[1];q=coordTransform(E,this.ovmap.getProjection(),b.right,b.top);var r=q[0];var k=q[1];var D=((A+v)/2);var a=((o+m)/2);var F=((u+r)/2);var c=((l+k)/2)}else{var D=b.left;var a=b.bottom;var F=b.right;var c=b.top}var C=new OpenLayers.LonLat(D,a);var B=new OpenLayers.LonLat(F,c);var g=this.getOverviewPxFromLonLat(C);var f=this.getOverviewPxFromLonLat(B);var p=null;if(g&&f){p=new OpenLayers.Bounds(g.x,g.y,f.x,f.y)}return p},rectDrag:function(q){var g=this.handlers.drag.last.x-q.x;var c=this.handlers.drag.last.y-q.y;if(g!=0||c!=0){var o=this.rectPxBounds.top;var b=this.rectPxBounds.left;var l=Math.abs(this.rectPxBounds.getHeight());var f=this.rectPxBounds.getWidth();if(!this.updateOverviewMapExtent){var m=Math.max(0,(o-c));m=Math.min(m,this.ovmap.size.h-this.hComp-l);var p=Math.max(0,(b-g));p=Math.min(p,this.ovmap.size.w-this.wComp-f)}else{var m=o-c;var p=b-g;var a=l;var k=f}this.setRectPxBounds(new OpenLayers.Bounds(p,m+l,p+f,m))}},activate:function(){this.div.style.display="block";OpenLayers.Control.OverviewMap.prototype.activate.apply(this,[])},deactivate:function(){this.div.style.display="none";OpenLayers.Control.OverviewMap.prototype.deactivate.apply(this,[])},showToggle:function(){},CLASS_NAME:"OpenLayers.Control.IAAA_OverviewMap"});OpenLayers.Control.IAAA_GenericToolBar=OpenLayers.Class(OpenLayers.Control,{controlList:new Array(),iconImagesList:new Array(),isHorizontal:true,horizontalPosition:"left",verticalPosition:"top",margin:new OpenLayers.Pixel(0,0),toolSeparationWidth:2,_handlerAuxList:new Array(),initialize:function(c,m){OpenLayers.Control.prototype.initialize.apply(this,[c]);if(m&&m.controls){for(var g in m.controls){var k=(m.imageStableList&&m.imageStableList[g])?m.imageStableList[g]:null;var a=(m.imageOverList&&m.imageOverList[g])?m.imageOverList[g]:null;var f=(m.imageSelectedList&&m.imageSelectedList[g])?m.imageSelectedList[g]:null;var l=(m.isToggleList&&m.isToggleList[g])?m.isToggleList[g]:false;var b=(m.isExluderList&&m.isExluderList[g])?m.isExluderList[g]:false;this.addTool(m.controls[g],l,b,k,a,f)}}},draw:function(a){OpenLayers.Control.prototype.draw.apply(this,[a]);this.div.style.position="absolute";this.div.style.cursor="pointer";if(this.horizontalPosition=="right"){this.div.style.right=this.margin.x}else{this.div.style.left=this.margin.x}if(this.verticalPosition=="bottom"){this.div.style.bottom=this.margin.y}else{this.div.style.top=this.margin.y}return this.div},addTool:function(control,isToggle,isExcluder,imageStable,imageOver,imageSelected){control.isToggle=(isToggle)?isToggle:false;control.isExcluder=(isExcluder)?isExcluder:false;control.toolBarPointer=this;if(this.isHorizontal){control.draw=function(){eval("this.div = "+this.CLASS_NAME+".prototype.draw.apply(this, arguments)");this.toolbarNode=document.createElement("SPAN");this.toolbarNode.className=this.displayClass;if(!this.allowSelection){this.toolbarNode.className+=" olControlNoSelect";this.toolbarNode.setAttribute("unselectable","on",0);this.toolbarNode.onselectstart=function(){return(false)}}if(this.title!=""){this.toolbarNode.title=this.title}return this.div}}else{control.draw=function(){eval("this.div = "+this.CLASS_NAME+".prototype.draw.apply(this, arguments)");this.toolbarNode=OpenLayers.Util.createDiv(this.id,null,null,null,"relative");this.toolbarNode.className=this.displayClass;if(!this.allowSelection){this.toolbarNode.className+=" olControlNoSelect";this.toolbarNode.setAttribute("unselectable","on",0);this.toolbarNode.onselectstart=function(){return(false)}}if(this.title!=""){this.toolbarNode.title=this.title}return this.div}}this.map.addControl(control);control.deactivate();this.controlList.push(control);var imageVector={};imageVector.imageStable=(imageStable)?imageStable:null;imageVector.imageOver=(imageOver)?imageOver:null;imageVector.imageSelected=(imageSelected)?imageSelected:null;this.iconImagesList.push(imageVector);var imgHTML='<img class="'+control.CLASS_NAME+'Image"';if(imageStable){imgHTML+=' src="'+imageStable+'"'}imgHTML+="/>";control.toolbarNode.innerHTML=imgHTML;this.div.appendChild(control.toolbarNode);var separator;separator=(this.isHorizontal)?document.createElement("SPAN"):document.createElement("DIV");separator.style.width=this.toolSeparationWidth;separator.style.height=this.toolSeparationWidth;separator.style.display="inline-block";this.div.appendChild(separator);control.toolbarNode.controlPointer=control;control.toolbarNode.style.zIndex=parseInt(this.div.style.zIndex)+1000;OpenLayers.Event.observe(control.toolbarNode,"click",OpenLayers.Function.bind(this.selectToolHandler,this,control));control.toolbarNode.onmouseover=function(e){this.controlPointer.toolBarPointer.toolOverHandler(this.controlPointer,e)};if(isExcluder&&isToggle){var firstExcluderSelected=true;var i=0;while(firstExcluderSelected&&(i<(this.controlList.length-1))){firstExcluderSelected=(!this.controlList[i].isToggle||!this.controlList[i].isExcluder);i++}if(firstExcluderSelected){this.selectTool(control)}}},activateTool:function(b){if(!this.controlList[b]){return}if(this.iconImagesList[b]&&this.iconImagesList[b]["imageSelected"]){var a='<img class="'+this.controlList[b].CLASS_NAME+'Image"';if(this.iconImagesList[b]["imageSelected"]){a+=' src="'+this.iconImagesList[b]["imageSelected"]+'"'}a+="/>";this.controlList[b].toolbarNode.innerHTML=a}this.controlList[b].activate()},deactivateTool:function(b){if(!this.controlList[b]){return}if(this.iconImagesList[b]&&this.iconImagesList[b]["imageStable"]){var a='<img class="'+this.controlList[b].CLASS_NAME+'Image"';if(this.iconImagesList[b]["imageStable"]){a+=' src="'+this.iconImagesList[b]["imageStable"]+'"'}a+="/>";this.controlList[b].toolbarNode.innerHTML=a}this.controlList[b].deactivate();this.controlList[b].toolbarNode.onmouseover=function(c){this.controlPointer.toolBarPointer.toolOverHandler(this.controlPointer,c)}},deactivateAll:function(){for(var a in this.controlList){if(this.controlList[a].isExcluder){this.deactivateTool(a)}}},selectTool:function(f){if(!f){return}var c=-1;for(var a in this.controlList){if(this.controlList[a]==f){c=a}}if(c<0){return}if(!f.isToggle){f.trigger()}else{if(!f.isExcluder){if(f.active){this.deactivateTool(c)}else{this.activateTool(c)}}else{if(!f.active){for(var b in this.controlList){if((b!=c)&&this.controlList[b].isToggle&&this.controlList[b].isExcluder){this.deactivateTool(b)}}this.activateTool(c)}}}},selectToolHandler:function(f,a){OpenLayers.Event.stop(a?a:window.event);while(this._handlerAuxList.length>0){this._handlerAuxList.pop().activate()}this.selectTool(f);var b=f.toolBarPointer.controlList;for(var c in b){if(b[c].handler&&b[c].handler.active){this._handlerAuxList.push(b[c].handler);b[c].handler.deactivate()}}},toolOverHandler:function(l,b){l.toolbarNode.onmouseover=null;var f=l.toolBarPointer.controlList;for(var g in f){if(f[g].handler&&f[g].handler.active){this._handlerAuxList.push(f[g].handler);f[g].handler.deactivate()}}if((!l)||l.active){return}var k=-1;for(var a in this.controlList){if(this.controlList[a]==l){k=a}}if(k<0){return}var c='<img class="'+l.CLASS_NAME+'Image"';if(this.iconImagesList[k]["imageOver"]){c+=' src="'+this.iconImagesList[k]["imageOver"]+'"'}c+="/>";l.toolbarNode.innerHTML=c;l.toolbarNode.onmouseout=function(m){this.controlPointer.toolBarPointer.toolOutHandler(this.controlPointer,m)}},toolOutHandler:function(g,b){g.toolbarNode.onmouseout=null;while(this._handlerAuxList.length>0){this._handlerAuxList.pop().activate()}if((!g)||g.active){return}var f=-1;for(var a in this.controlList){if(this.controlList[a]==g){f=a}}if(f<0){return}var c='<img class="'+g.CLASS_NAME+'Image"';if(this.iconImagesList[f]["imageStable"]){c+=' src="'+this.iconImagesList[f]["imageStable"]+'"'}c+="/>";g.toolbarNode.innerHTML=c;g.toolbarNode.onmouseover=function(k){this.controlPointer.toolBarPointer.toolOverHandler(this.controlPointer,k)}},CLASS_NAME:"OpenLayers.Control.IAAA_GenericToolBar"});OpenLayers.Control.IAAA_ExternalGenericToolBar=OpenLayers.Class(OpenLayers.Control,{toolbarDiv:null,toolbarDivTop:5,toolbarDivLeft:5,toolbarDivHeight:25,controlList:new Array(),iconImagesList:new Array(),isHorizontal:true,horizontalPosition:"left",verticalPosition:"top",margin:new OpenLayers.Pixel(0,0),toolSeparationWidth:2,initialize:function(c,m){OpenLayers.Control.prototype.initialize.apply(this,[c]);if(m&&m.controls){for(var g in m.controls){var k=(m.imageStableList&&m.imageStableList[g])?m.imageStableList[g]:null;var a=(m.imageOverList&&m.imageOverList[g])?m.imageOverList[g]:null;var f=(m.imageSelectedList&&m.imageSelectedList[g])?m.imageSelectedList[g]:null;var l=(m.isToggleList&&m.isToggleList[g])?m.isToggleList[g]:false;var b=(m.isExluderList&&m.isExluderList[g])?m.isExluderList[g]:false;this.addTool(m.controls[g],l,b,k,a,f)}}},draw:function(c){this.toolbarDiv=document.createElement("div");this.toolbarDiv.id="toolbar";this.toolbarDiv.style.position="absolute";this.toolbarDiv.style.top=this.toolbarDivTop;this.toolbarDiv.style.left=this.toolbarDivLeft;this.toolbarDiv.style.width=this.map.viewPortDiv.style.width;this.map.div.style.position="absolute";this.map.div.style.top=this.toolbarDivTop+this.toolbarDivHeight;this.map.div.style.left=this.toolbarDivLeft;var b=document.getElementById(this.map.div.id);var a=b.parentNode;a.insertBefore(this.toolbarDiv,b);this.toolbarDiv.style.position="absolute";this.toolbarDiv.style.cursor="pointer";if(this.horizontalPosition=="right"){this.toolbarDiv.style.right=this.margin.x}else{this.toolbarDiv.style.left=this.margin.x}if(this.verticalPosition=="bottom"){this.toolbarDiv.style.bottom=this.margin.y}else{this.toolbarDiv.style.top=this.margin.y}return null},addTool:function(control,isToggle,isExcluder,imageStable,imageOver,imageSelected){control.isToggle=(isToggle)?isToggle:false;control.isExcluder=(isExcluder)?isExcluder:false;control.toolBarPointer=this;if(this.isHorizontal){control.draw=function(){eval("this.div = "+this.CLASS_NAME+".prototype.draw.apply(this, arguments)");this.toolbarNode=document.createElement("SPAN");this.toolbarNode.className=this.displayClass;if(!this.allowSelection){this.toolbarNode.className+=" olControlNoSelect";this.toolbarNode.setAttribute("unselectable","on",0);this.toolbarNode.onselectstart=function(){return(false)}}if(this.title!=""){this.toolbarNode.title=this.title}return this.div}}else{control.draw=function(){eval("this.div = "+this.CLASS_NAME+".prototype.draw.apply(this, arguments)");this.toolbarNode=OpenLayers.Util.createDiv(this.id,null,null,null,"relative");this.toolbarNode.className=this.displayClass;if(!this.allowSelection){this.toolbarNode.className+=" olControlNoSelect";this.toolbarNode.setAttribute("unselectable","on",0);this.toolbarNode.onselectstart=function(){return(false)}}if(this.title!=""){this.toolbarNode.title=this.title}return this.div}}this.map.addControl(control);control.deactivate();this.controlList.push(control);var imageVector={};imageVector.imageStable=(imageStable)?imageStable:null;imageVector.imageOver=(imageOver)?imageOver:null;imageVector.imageSelected=(imageSelected)?imageSelected:null;this.iconImagesList.push(imageVector);var imgHTML='<img class="'+control.CLASS_NAME+'Image"';if(imageStable){imgHTML+=' src="'+imageStable+'"'}imgHTML+="/>";control.toolbarNode.innerHTML=imgHTML;this.toolbarDiv.appendChild(control.toolbarNode);var separator;separator=(this.isHorizontal)?document.createElement("SPAN"):document.createElement("DIV");separator.style.width=this.toolSeparationWidth;separator.style.height=this.toolSeparationWidth;separator.style.display="inline-block";this.toolbarDiv.appendChild(separator);control.toolbarNode.controlPointer=control;control.toolbarNode.style.zIndex=parseInt(this.toolbarDiv.style.zIndex)+1000;OpenLayers.Event.observe(control.toolbarNode,"click",OpenLayers.Function.bind(this.selectToolHandler,this,control));control.toolbarNode.onmouseover=function(e){this.controlPointer.toolBarPointer.toolOverHandler(this.controlPointer,e)};if(isExcluder&&isToggle){var firstExcluderSelected=true;var i=0;while(firstExcluderSelected&&(i<(this.controlList.length-1))){firstExcluderSelected=(!this.controlList[i].isToggle||!this.controlList[i].isExcluder);i++}if(firstExcluderSelected){this.selectTool(control)}}},activateTool:function(b){if(!this.controlList[b]){return}if(this.iconImagesList[b]&&this.iconImagesList[b]["imageSelected"]){var a='<img class="'+this.controlList[b].CLASS_NAME+'Image"';if(this.iconImagesList[b]["imageSelected"]){a+=' src="'+this.iconImagesList[b]["imageSelected"]+'"'}a+="/>";this.controlList[b].toolbarNode.innerHTML=a}this.controlList[b].activate()},deactivateTool:function(b){if(!this.controlList[b]){return}if(this.iconImagesList[b]&&this.iconImagesList[b]["imageStable"]){var a='<img class="'+this.controlList[b].CLASS_NAME+'Image"';if(this.iconImagesList[b]["imageStable"]){a+=' src="'+this.iconImagesList[b]["imageStable"]+'"'}a+="/>";this.controlList[b].toolbarNode.innerHTML=a}this.controlList[b].deactivate();this.controlList[b].toolbarNode.onmouseover=function(c){this.controlPointer.toolBarPointer.toolOverHandler(this.controlPointer,c)}},deactivateAll:function(){for(var a in this.controlList){if(this.controlList[a].isExcluder){this.deactivateTool(a)}}},selectTool:function(f){if(!f){return}var c=-1;for(var a in this.controlList){if(this.controlList[a]==f){c=a}}if(c<0){return}if(!f.isToggle){f.trigger()}else{if(!f.isExcluder){if(f.active){this.deactivateTool(c)}else{this.activateTool(c)}}else{if(!f.active){for(var b in this.controlList){if((b!=c)&&this.controlList[b].isToggle&&this.controlList[b].isExcluder){this.deactivateTool(b)}}this.activateTool(c)}}}},selectToolHandler:function(b,a){OpenLayers.Event.stop(a?a:window.event);this.selectTool(b)},toolOverHandler:function(g,b){g.toolbarNode.onmouseover=null;if((!g)||g.active){return}var f=-1;for(var a in this.controlList){if(this.controlList[a]==g){f=a}}if(f<0){return}var c='<img class="'+g.CLASS_NAME+'Image"';if(this.iconImagesList[f]["imageOver"]){c+=' src="'+this.iconImagesList[f]["imageOver"]+'"'}c+="/>";g.toolbarNode.innerHTML=c;g.toolbarNode.onmouseout=function(k){this.controlPointer.toolBarPointer.toolOutHandler(this.controlPointer,k)}},toolOutHandler:function(g,b){g.toolbarNode.onmouseout=null;if((!g)||g.active){return}var f=-1;for(var a in this.controlList){if(this.controlList[a]==g){f=a}}if(f<0){return}var c='<img class="'+g.CLASS_NAME+'Image"';if(this.iconImagesList[f]["imageStable"]){c+=' src="'+this.iconImagesList[f]["imageStable"]+'"'}c+="/>";g.toolbarNode.innerHTML=c;g.toolbarNode.onmouseover=function(k){this.controlPointer.toolBarPointer.toolOverHandler(this.controlPointer,k)}},CLASS_NAME:"OpenLayers.Control.IAAA_ExternalGenericToolBar"});OpenLayers.Control.IAAA_DragPan=OpenLayers.Class(OpenLayers.Control.DragPan,{draw:function(){OpenLayers.Control.DragPan.prototype.draw.apply(this,[]);this.handler.mouseup=function(b){if(this.started){var a=(this.start!=this.last);this.started=false;this.dragging=false;this.up(b);this.callback("up",[b.xy]);if(a){this.callback("done",[b.xy])}document.onselectstart=this.oldOnselectstart}return true};this.handler.mouseout=function(b){if(this.started&&OpenLayers.Util.mouseLeft(b,this.map.div)){var a=(this.start!=this.last);this.started=false;this.dragging=false;this.out(b);this.callback("out",[]);if(a){this.callback("done",[b.xy])}if(document.onselectstart){document.onselectstart=this.oldOnselectstart}}return true}},panMapDone:function(a){if(this.panned){this.panMap(a);this.panned=false;this.map.events.triggerEvent("dragend")}},CLASS_NAME:"OpenLayers.Control.IAAA_DragPan"});OpenLayers.Control.IAAA_NavBarInfo=OpenLayers.Class(OpenLayers.Control,{showScale:true,mapText:"Mapa",scaleText:"Escala",firstCoordProjection:null,secondCoordProjection:null,drawInStatusBar:false,parentDiv:null,UTMCoordDecimals:2,geogCoordDecimals:4,setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.activate()},draw:function(a){if(!this.drawInStatusBar){if(this.div==null){this.div=OpenLayers.Util.createDiv();this.div.id=this.id;this.div.className=this.displayClass;if(!this.parentDiv){this.parentDiv=this.map.div}this.parentDiv.appendChild(this.div)}if(a!=null){this.position=a.clone()}this.moveTo(this.position)}return false},setParentDiv:function(a){this.parentDiv=a},drawInfo:function(o){var b,g;if(this.firstCoordProjection=="mapProjection"){b=this.map.getProjection()}else{b=this.firstCoordProjection}if(this.secondCoordProjection=="mapProjection"){g=this.map.getProjection()}else{g=this.secondCoordProjection}var k=1;for(var f=0;f<this.UTMCoordDecimals;f++){k=k*10}var p=1;for(var f=0;f<this.geogCoordDecimals;f++){p=p*10}try{var c="";if(this.firstCoordProjection||this.secondCoordProjection){c+=this.mapText+": "}if(this.firstCoordProjection){var l=this.map.getLonLatFromPixel(o.xy);if(this.firstCoordProjection=="mapProjection"){b=this.map.getProjection();if((this.map.baseLayer.CLASS_NAME=="OpenLayers.Layer.Google")||(this.map.baseLayer.CLASS_NAME=="OpenLayers.Layer.IAAA_Google")){b="EPSG:900913"}}else{if(b!=this.map.getProjection()){coordAux=coordTransform(this.map.getProjection(),b,l.lon,l.lat);l=new OpenLayers.LonLat(coordAux[0],coordAux[1])}}var a=((b.slice(0,6)=="EPSG:4")&&(parseInt(b.slice(5))>=4000)&&(parseInt(b.slice(5))<5000));if(a){l.lon=parseInt(l.lon*p)/p;l.lat=parseInt(l.lat*p)/p}else{l.lon=parseInt(l.lon*k)/k;l.lat=parseInt(l.lat*k)/k}c+=l.lon+", "+l.lat+" ("+getSupportedSrsDescription(b)+")"}if(this.firstCoordProjection&&this.secondCoordProjection&&(b!=g)){c+=" , "}if((this.secondCoordProjection)&&(b!=g)){var l=this.map.getLonLatFromPixel(o.xy);if(this.secondCoordProjection=="mapProjection"){g=this.map.getProjection();if((this.map.baseLayer.CLASS_NAME=="OpenLayers.Layer.Google")||(this.map.baseLayer.CLASS_NAME=="OpenLayers.Layer.IAAA_Google")){g="EPSG:900913"}}else{if(g!=this.map.getProjection()){coordAux=coordTransform(this.map.getProjection(),g,l.lon,l.lat);l=new OpenLayers.LonLat(coordAux[0],coordAux[1])}}var a=((g.slice(0,6)=="EPSG:4")&&(parseInt(g.slice(5))>=4000)&&(parseInt(g.slice(5))<5000));if(a){l.lon=parseInt(l.lon*p)/p;l.lat=parseInt(l.lat*p)/p}else{l.lon=parseInt(l.lon*k)/k;l.lat=parseInt(l.lat*k)/k}c+=l.lon+", "+l.lat+" ("+getSupportedSrsDescription(g)+")"}if(this.firstCoordProjection||this.secondCoordProjection){c+=" - "}if(this.showScale){c+=this.scaleText+" 1:"+parseInt(this.map.getActualScale())}if(!this.drawInStatusBar){this.div.innerHTML='<font face="Arial" size="1">'+c+"</font>"}else{window.status=c}}catch(m){}},clearInfo:function(){if(!this.drawInStatusBar){this.div.innerHTML=""}else{window.status=""}},activate:function(){OpenLayers.Control.prototype.activate.apply(this,arguments);this.map.events.register("mousemove",this,this.drawInfo);this.map.events.register("afterresize",this,this.clearInfo)},deactivate:function(){this.map.events.unregister("mousemove",this,this.drawInfo);this.map.events.unregister("afterresize",this,this.clearInfo);this.clearInfo();OpenLayers.Control.prototype.activate.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.IAAA_NavBarInfo"});OpenLayers.Control.IAAA_MouseWheelZoom=OpenLayers.Class(OpenLayers.Control,{wheelHandler:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments)},activate:function(){this.wheelHandler.activate();return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){this.wheelHandler.deactivate();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){var a=function(l){if(!this.map||!this.checkModifiers(l)){return}var b=false;var k=false;var g=OpenLayers.Event.element(l);while((g!=null)&&!k&&!b){if(!b){try{if(g.currentStyle){m=g.currentStyle.overflow}else{var c=document.defaultView.getComputedStyle(g,null);var m=c.getPropertyValue("overflow")}b=(m&&(m=="auto")||(m=="scroll"))}catch(f){}}k=(g==this.map.div);g=g.parentNode}if(!b&&k){this.wheelZoom(l);OpenLayers.Event.stop(l)}};this.wheelHandler=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},{onWheelEvent:a});this.activate()},wheelChange:function(m,c){var k=this.map.getZoom()+c;if(!this.map.isValidZoomLevel(k)){return}var o=this.map.getSize();var g=o.w/2-m.xy.x;var f=m.xy.y-o.h/2;var l=this.map.baseLayer.resolutions[k];var a=this.map.getLonLatFromPixel(m.xy);var b=new OpenLayers.LonLat(a.lon,a.lat);this.map.setCenter(b,k)},wheelUp:function(a){this.wheelChange(a,1)},wheelDown:function(a){this.wheelChange(a,-1)},CLASS_NAME:"OpenLayers.Control.IAAA_MouseWheelZoom"});OpenLayers.Control.IAAA_FullExtent=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,initialExtent:null,predefinedInitialExtent:null,trigger:function(){if(this.map){if(this.initialExtent){var b=this.map.getProjection().toString();var a=this.initialExtent.getSrs().toString();if(b!=a){this.initialExtent.transformSrs(b)}this.map.zoomToExtent(this.initialExtent)}else{this.map.zoomToMaxExtent()}}},setMap:function(b){OpenLayers.Control.prototype.setMap.apply(this,arguments);if(this.predefinedInitialExtent!=null){this.initialExtent=new OpenLayers.IAAA_Bounds(this.predefinedInitialExtent.left,this.predefinedInitialExtent.bottom,this.predefinedInitialExtent.right,this.predefinedInitialExtent.top);this.initialExtent.setSrs(this.predefinedInitialExtent.getSrs())}else{var a=this.map.getExtent();if(a!=null){this.initialExtent=new OpenLayers.IAAA_Bounds(a.left,a.bottom,a.right,a.top);this.initialExtent.setSrs(this.map.projection)}else{this.map.events.register("moveend",this,this.setInitialExtent)}}},setInitialExtent:function(){this.events.unregister("moveend",this,this.setInitialExtent);var a=this.map.getExtent();if(a!=null){this.initialExtent=new OpenLayers.IAAA_Bounds(a.left,a.bottom,a.right,a.top);this.initialExtent.setSrs(this.map.getProjection())}else{this.map.events.register("moveend",this,this.setInitialExtent)}},CLASS_NAME:"OpenLayers.Control.IAAA_FullExtent"});OpenLayers.Handler.IAAA_Box=OpenLayers.Class(OpenLayers.Handler.Box,{style:"2px solid red",initialize:function(c,b,a){OpenLayers.Handler.Box.prototype.initialize.apply(this,arguments);this.dragHandler.mousedown=function(g){var f=true;this.dragging=false;if(this.checkModifiers(g)){this.started=true;this.start=g.xy;this.last=g.xy;this.map.div.style.cursor="move";this.down(g);this.callback("down",[g.xy]);OpenLayers.Event.stop(g);if(!this.oldOnselectstart){this.oldOnselectstart=(document.onselectstart)?document.onselectstart:function(){return true};document.onselectstart=function(){return false}}f=!this.stopDown}else{this.started=false;this.start=null;this.last=null}return f};this.dragHandler.mouseup=function(g){if(this.started){var f=(this.start!=this.last);this.started=false;this.dragging=false;this.up(g);this.callback("up",[g.xy]);if(f){this.callback("done",[g.xy])}document.onselectstart=this.oldOnselectstart}return true}},startBox:function(b){if(this.zoomBox){this.map.viewPortDiv.removeChild(this.zoomBox);this.zoomBox=null;return}var a=new OpenLayers.Pixel(this.dragHandler.start.x,this.dragHandler.start.y);this.zoomBox=OpenLayers.Util.createDiv("zoomBox",a,null,null,"absolute",this.style);this.zoomBox.style.fontSize="1px";this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.zoomBox.style.display="block";this.zoomBox.visibility="visible";this.map.viewPortDiv.appendChild(this.zoomBox);this.map.div.style.cursor="crosshair"},moveBox:function(f){try{var b=Math.abs(this.dragHandler.start.x-f.x);var a=Math.abs(this.dragHandler.start.y-f.y);this.zoomBox.style.width=Math.max(1,b)+"px";this.zoomBox.style.height=Math.max(1,a)+"px";if(f.x<this.dragHandler.start.x){this.zoomBox.style.left=f.x+"px"}if(f.y<this.dragHandler.start.y){this.zoomBox.style.top=(f.y)+"px"}}catch(c){}},endBox:function(b){var a;if(Math.abs(this.dragHandler.start.x-b.x)>5||Math.abs(this.dragHandler.start.y-b.y)>5){var l=this.dragHandler.start;var k=Math.min(l.y,b.y);var c=Math.max(l.y,b.y);var g=Math.min(l.x,b.x);var f=Math.max(l.x,b.x);a=new OpenLayers.Bounds(g,c,f,k)}else{a=this.dragHandler.start.clone()}this.removeBox();this.callback("done",[a])},removeBox:function(){if(this.zoomBox){this.map.viewPortDiv.removeChild(this.zoomBox);this.zoomBox=null}},deactivate:function(){if(OpenLayers.Handler.Box.prototype.deactivate.apply(this,arguments)){if(this.zoomBox){this.removeBox()}return true}else{return false}},CLASS_NAME:"OpenLayers.Handler.IAAA_Box"});OpenLayers.IAAA_WMS.IAAA_ParentLayer=OpenLayers.Class(OpenLayers.IAAA_WMS,{ISPARENTLAYER:true,childLayers:null,initialize:function(c,g,f,b){var a=new Array();a.push(c,g,f,b);OpenLayers.IAAA_WMS.prototype.initialize.apply(this,a);this.childLayers=new Array()},addChildLayer:function(a){if(a.maxSupportedExtent){if(this.maxSupportedExtent){var g=a.maxSupportedExtent.getSrs();var c=this.maxSupportedExtent.getSrs();var k=coordTransform(g,c,a.maxSupportedExtent.right,a.maxSupportedExtent.bottom);var f=coordTransform(g,c,a.maxSupportedExtent.left,a.maxSupportedExtent.top);var b=new OpenLayers.Bounds(f[0],k[1],k[0],f[1]);this.maxSupportedExtent.left=(b.left<this.maxSupportedExtent.left)?b.left:this.maxSupportedExtent.left;this.maxSupportedExtent.top=(b.top>this.maxSupportedExtent.top)?b.top:this.maxSupportedExtent.top;this.maxSupportedExtent.right=(b.right>this.maxSupportedExtent.right)?b.right:this.maxSupportedExtent.right;this.maxSupportedExtent.bottom=(b.bottom<this.maxSupportedExtent.bottom)?b.bottom:this.maxSupportedExtent.bottom}else{if(this.getChildLayerList().length<=0){this.setMaxSupportedExtent(a.maxSupportedExtent)}else{}}}a.setParent(this);this.childLayers[this.childLayers.length]=a;if(a.getVisibility()){this.setVisibility(true);if(a.isExcluder()&&this.parent){this.parent.updateExcluderLayers(a)}}},addChildLayers:function(b){for(var a in b){this.addChildLayer(b[a])}},getChildLayerList:function(){return this.childLayers},getChildLayer:function(a){return this.childLayers[a]},getChildLayerIndex:function(a,c){var b;for(b=0;b<this.childLayers.length;b++){if((this.childLayers[b].name==a)&&(this.childLayers[b].title==c)){return b}}return -1},removeChildLayer:function(c){var b=c;if((b>=0)&&(b<this.childLayers.length)){while(b<(this.childLayers.length-1)){this.childLayers[b]=this.childLayers[b+1];b++}var a=this.childLayers.pop().getVisibility();if(this.childLayers.length>0){this.updateVisibility()}else{this.setVisibility(a)}return true}else{return false}},interchangeChildLayers:function(a,c){var b=this.getChildLayerList()[a];this.getChildLayerList()[a]=this.getChildLayerList()[c];this.getChildLayerList()[c]=b},updateVisibility:function(){for(var a=0;a<this.childLayers.length;a++){if(this.childLayers[a].getVisibility()){this.setVisibility(true);return}}this.setVisibility(false)},getMetadataUrlList:function(){return new Array()},setChildLayerList:function(a){this.childLayers=a},setParent:function(b){this.parent=b;for(var a in this.getChildLayerList()){this.getChildLayerList()[a].setParent(this)}},CLASS_NAME:"OpenLayers.IAAA_WMS.IAAA_ParentLayer"});var mouseTolerance=30;OpenLayers.Layer.IAAA_GeoRSS=OpenLayers.Class(OpenLayers.Layer.GeoRSS,{popupOpened:false,mouseOverPopup:false,mouseOverPopupAux:false,showLoadingIcon:false,centerId:null,centerMarkerZoomLevel:null,cursor:null,params:null,loaded:false,defualtIcon:"iconos_de_eventos/obras.PNG",dragPanControl:null,reactiveZoomBox:false,controlIndexAux:-1,toleranceList:new Array(new OpenLayers.Size(20,20)),resolutionList:new Array(100),popupBackgroundColor:"white",popupOpacity:0.8,titleFontFamily:"arial",titleFontSize:"16px",descriptionFontFamily:"arial",descriptionFontSize:"14px",dataSRS:null,initialize:function(c,a,b,f){OpenLayers.Layer.Markers.prototype.initialize.apply(this,[c,b]);this.location=a;this.features=[];this.params=f;if(!this.params){this.params={}}if(!this.options.mapTipBehavior){this.options.mapTipBehavior=0}if(!this.options.scaleIconSize){this.options.scaleIconSize=false}this.icon=new OpenLayers.Icon(this.defaultIcon);if(b.markersResolutionList){this.toleranceList=b.markersSizeList}if(b.markersSizeList){this.resolutionList=b.markersResolutionList}},setMap:function(a){OpenLayers.Layer.prototype.setMap.apply(this,arguments);this.map.events.register("moveend",this,this.setIconsSize)},afterAdd:function(){this.redraw()},redraw:function(){this.loaded=false;this.events.triggerEvent("loadstart");OpenLayers.loadURL=function(f,l,b,g,c){if(OpenLayers.ProxyHost&&OpenLayers.String.startsWith(f,"http")){f=OpenLayers.ProxyHost+"?urlWFS="+f}var k=(g)?OpenLayers.Function.bind(g,b):OpenLayers.nullHandler;var a=(c)?OpenLayers.Function.bind(c,b):OpenLayers.nullHandler;new OpenLayers.Ajax.IAAA_Request(f,{method:"get",parameters:l,onComplete:k,onFailure:a})};OpenLayers.loadURL(this.location,this.params,this,this.parseData);this.loaded=true},parseData:function(H){var M=H.responseXML;if(!M||H.fileType!="XML"){M=OpenLayers.parseXMLString(H.responseText)}if(this.useFeedTitle){var O=null;try{O=M.getElementsByTagNameNS("*","title")[0].firstChild.nodeValue}catch(F){O=M.getElementsByTagName("title")[0].firstChild.nodeValue}if(O){this.setName(O)}}var v=null;try{v=M.getElementsByTagNameNS("*","image")}catch(F){v=M.getElementsByTagName("image")}if(v){var G;try{G=OpenLayers.Util.getNodes(v[0],"link")[0].firstChild.nodeValue}catch(F){G="Undefined"}this.setIcon(G)}var q=null;try{q=M.getElementsByTagNameNS("*","item")}catch(F){q=M.getElementsByTagName("item")}if(q.length==0){try{q=M.getElementsByTagNameNS("*","entry")}catch(F){q=M.getElementsByTagName("entry")}}for(var E=0;E<q.length;E++){var I={};var C=OpenLayers.Util.getNodes(q[E],"georss:point");var l=OpenLayers.Util.getNodes(q[E],"geo:lat");var f=OpenLayers.Util.getNodes(q[E],"geo:long");var A=q[E].getAttribute("rdf:about");if(C.length>0){var a=C[0].firstChild.nodeValue.split(" ");if(a.length!=2){var a=C[0].firstChild.nodeValue.split(",")}}else{if(l.length>0&&f.length>0){var a=[parseFloat(l[0].firstChild.nodeValue),parseFloat(f[0].firstChild.nodeValue)]}else{continue}}a=new OpenLayers.LonLat(parseFloat(a[1]),parseFloat(a[0]));if(this.dataSRS){var c=this.map.getProjection();if(this.dataSRS!=c){var u=coordTransform(this.dataSRS,c,a.lon,a.lat);a.lon=u[0];a.lat=u[1]}}var b=A.split("?id=");if(A==b[0]){b=A.split("&id=");if(A==b[0]){}else{A=b[1]}}else{A=b[1]}if((A!=null)&&(A==this.centerId)){this.map.setCenter(a);if(this.centerMarkerZoomLevel!=null){this.map.zoomTo(this.centerMarkerZoomLevel)}}var K="Untitled";try{K=OpenLayers.Util.getNodes(q[E],"title")[0].firstChild.nodeValue}catch(F){K="Untitled"}var g=null;try{g=q[E].getElementsByTagNameNS("*","description")}catch(F){g=q[E].getElementsByTagName("description")}if(g.length==0){try{g=q[E].getElementsByTagNameNS("*","summary")}catch(F){g=q[E].getElementsByTagName("summary")}}var D="No description.";try{D=g[0].firstChild.nodeValue}catch(F){D="No description."}try{var o=OpenLayers.Util.getNodes(q[E],"link")[0].firstChild.nodeValue}catch(F){try{var o=OpenLayers.Util.getNodes(q[E],"link")[0].getAttribute("href")}catch(F){}}var B=null;var p=null;try{B=OpenLayers.Util.getNodes(q[E],"icon")[0];try{p=OpenLayers.Util.getNodes(B,"url")[0].firstChild.nodeValue}catch(F){}}catch(F){}I.icon=this.icon==null?OpenLayers.Marker.defaultIcon():this.icon.clone();if(p){I.icon.url=p}I.popupSize=this.popupSize?this.popupSize.clone():new OpenLayers.Size(250,120);if(o){if(o.slice(0,7)!="http://"){o="http://"+o}}if((K!=null)&&(D!=null)){contentHTML='<meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />';contentHTML+='<table height="100%"><tr valign="top"><td>';contentHTML+='<div class="olGeoRSSTitleContainer">';contentHTML+='<div class="olLayerGeoRSSTitle" style="font-family:'+this.titleFontFamily+"; font-size:"+this.titleFontSize+';">';if(o){contentHTML+='<a class="link" style="color:red;text-decoration:none;" href="'+o+'" target="_blank">'}contentHTML+="<b>"+K+"</b>";if(o){contentHTML+="</a>"}contentHTML+="</div></div>";contentHTML+='</td></tr><tr valign="top"><td>';var r=(navigator.appName=="Microsoft Internet Explorer")?"auto":"100%";contentHTML+='<div class="olLayerGeoRSSDescription" style="background-color:white; color:black; overflow:auto; font-family:'+this.descriptionFontFamily+"; font-size:"+this.descriptionFontSize+"; height: "+r+';">';contentHTML+=D;contentHTML+="</div>";contentHTML+="</td></tr></table>";I.link=o;I.title=K;I.description=D;I.popupContentHTML=contentHTML;I.popupSize=new OpenLayers.Size(256,182)}var k=new OpenLayers.Feature(this,a,I);this.features.push(k);var m=k.createMarker();if(this.options.scaleIconSize){I.icon.size.h=this.getTolerance();I.icon.size.w=this.getTolerance()}else{I.icon.size.h=20;I.icon.size.w=20}if(this.options.mapTipBehavior==0){m.events.register("mouseover",k,this.overMarker)}else{for(var J in this.map.controls){if(this.map.controls[J].CLASS_NAME=="OpenLayers.Control.DragPan"){this.dragPanControl=this.map.controls[J]}}OpenLayers.Event.observe(m.icon.imageDiv,"mouseover",OpenLayers.Function.bind(function(R){for(var Q in this.layer.map.controls){if(((this.layer.map.controls[Q].CLASS_NAME=="OpenLayers.Control.ZoomBox")||(this.layer.map.controls[Q].CLASS_NAME=="OpenLayers.Control.IAAA_ZoomBox")||(this.layer.map.controls[Q].CLASS_NAME=="OpenLayers.Control.ZoomIn")||(this.layer.map.controls[Q].CLASS_NAME=="OpenLayers.Control.IAAA_ZoomOut"))&&(this.layer.map.controls[Q].active)&&(!((this.layer.map.controls[Q].handler)&&(this.layer.map.controls[Q].handler.zoomBox)))){this.layer.reactiveZoomBox=true;this.layer.controlIndexAux=Q;this.layer.map.controls[Q].deactivate()}}if(((!this.layer.dragPanControl)||(!this.layer.dragPanControl.panned))){this.layer.generatePopup(this);OpenLayers.Event.stop(R)}},k));OpenLayers.Event.observe(m.icon.imageDiv,"mouseout",OpenLayers.Function.bind(function(Q){if(this.reactiveZoomBox&&this.controlIndexAux){this.map.controls[this.controlIndexAux].activate();this.reactiveZoomBox=false}},this));OpenLayers.Event.observe(m.icon.imageDiv,"click",OpenLayers.Function.bind(function(Q){if(this.data.link){window.open(this.data.link)}OpenLayers.Event.stop(Q)},k))}m.icon.imageDiv.style.zIndex=1999;m.icon.imageDiv.style.cursor="pointer";this.addMarker(m)}if(this.options.mapTipBehavior==0){OpenLayers.Event.observe(this.map.div,"click",OpenLayers.Function.bind(function(){if((this.map)&&(this.map.popups)){for(var Q=0;Q<this.map.popups.length;Q++){this.map.removePopup(this.map.popups[Q])}}},this));OpenLayers.Event.observe(this.map.div,"mousedown",OpenLayers.Function.bind(function(){if((this.map)&&(this.map.popups)){for(var Q=0;Q<this.map.popups.length;Q++){this.map.removePopup(this.map.popups[Q])}}},this))}else{this.map.events.register("moveend",this,function(Q){this.removePopups()});this.map.events.register("mouseout",this,this.removePopups)}this.loaded=true;this.events.triggerEvent("loadend")},removePopups:function(){if((this.map)&&(this.map.popups)){while(this.map.popups.length>0){this.map.removePopup(this.map.popups[this.map.popups.length-1])}}},generatePopup:function(g){OpenLayers.Util.modifyDOMElement=function(q,m,B,A,r,p,o,u){if(m){q.id=m}if(B){q.style.left=B.x+"px";q.style.top=B.y+"px"}try{if(A){q.style.width=A.w+"px";q.style.height=A.h+"px"}}catch(v){}if(r){q.style.position=r}if(p){q.style.border=p}if(o){q.style.overflow=o}if(u){q.style.opacity=u;q.style.filter="alpha(opacity="+(u*100)+")"}};if((g.data.title)&&(g.data.title!="")){var l;var k;if(navigator.appName=="Microsoft Internet Explorer"){k='<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>';k+='<div class="olLayerGeoRSSDescription" align="center" style="height:auto; top:50px">';k+='<font face="Arial" size="1">&nbsp;'+g.data.title+"&nbsp;&nbsp;</font>";k+="</div>"}else{k='<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>';k+='<div class="olLayerGeoRSSDescription" align="center" style="height:auto; top:50px">';k+='<font face="Arial" size="1">'+g.data.title+"</font>";k+="</div>"}var c=g.data.title?g.data.title:"marker";var f=new OpenLayers.IAAA_Size(120,"auto");var b={size:new OpenLayers.Size(22,22),offset:new OpenLayers.Pixel(-12,-12)};var a=new OpenLayers.Popup.IAAA_Anchored(c+"_popup",g.lonlat,f,k,b);a.setSize(f);a.setOpacity(1);g.layer.map.addPopup(a,true);a.div.style.border="1px solid black"}},setIconsSize:function(){for(var a in this.features){if(this.options.scaleIconSize){this.features[a].marker.icon.size.h=this.getTolerance();this.features[a].marker.icon.size.w=this.getTolerance()}this.drawMarker(this.features[a].marker)}},overMarker:function(b){sameMarkerClicked=(this==this.layer.selectedFeature);this.layer.selectedFeature=(!sameMarkerClicked)?this:null;for(var c=0;c<this.layer.map.popups.length;c++){this.layer.map.removePopup(this.layer.map.popups[c])}var a=this.createPopup();this.layer.map.addPopup(a);a.setRicoCorners=function(k){var f=this.getCornersToRound(this.relativePosition);var g={corners:f,bgColor:"transparent",blend:false,numSlices:2};if(!this.rounded){OpenLayers.Rico.Corner.round(this.div,g);this.rounded=true}else{this.setBackgroundColor();this.setOpacity();OpenLayers.Rico.Corner.reRound(this.groupDiv,g)}};a.setSize(new OpenLayers.Size(this.data.popupSize.w,this.data.popupSize.h));a.setBackgroundColor(this.layer.popupBackgroundColor);a.setOpacity(this.layer.popupOpacity);a.contentDiv.style.overflow="auto";OpenLayers.Event.observe(a.div,"click",OpenLayers.Function.bind(function(){for(var f=0;f<this.layer.map.popups.length;f++){this.layer.map.removePopup(this.layer.map.popups[f])}},this));a.events.registerPriority("mouseover",a.contentDiv,OpenLayers.Function.bind(function(){this.layer.mouseOverPopup=true;this.layer.mouseOverPopupAux=true},this));a.events.register("mouseout",a.contentDiv,OpenLayers.Function.bind(function(){this.layer.mouseOverPopup=false},this));a.div.style.opacity=1;this.layer.mouseOverPopupAux=false;this.layer.popupOpened=true;OpenLayers.Event.stop(b)},setIcon:function(a){this.icon=new OpenLayers.Icon(a)},onMouseMoveClosePopup:function(a){if((!this.mouseOverPopupAux)&&(this.popupOpened)){if(!this.isNearMarker(a.xy.x,a.xy.y)){if((this.map)&&(this.map.popups)){for(var b=0;b<this.map.popups.length;b++){this.map.removePopup(this.map.popups[b])}}this.selectedFeature=null;this.popupOpened=false}}OpenLayers.Event.stop(a)},onMouseOverClosePopup:function(a){if((!this.mouseOverPopup)&&(this.popupOpened)){if(!this.isNearMarker(a.xy.x,a.xy.y)){if((this.map)&&(this.map.popups)){for(var b=0;b<this.map.popups.length;b++){this.map.removePopup(this.map.popups[b])}}this.selectedFeature=null;this.popupOpened=false}}OpenLayers.Event.stop(a)},isNearMarker:function(a,g){for(var f=0;f<this.markers.length;f++){var c=this.map.getPixelFromLonLat(this.markers[f].lonlat).x;var b=this.map.getPixelFromLonLat(this.markers[f].lonlat).y;if(((c-a)>-1*mouseTolerance)&&((c-a)<mouseTolerance)&&((b-g)>-1*mouseTolerance)&&((b-g)<mouseTolerance)){return true}}return false},getTolerance:function(){for(var a=0;a<this.resolutionList.length;a++){if(a==(this.resolutionList.length-1)){if(this.map.getResolution()<this.resolutionList[a]){if(this.toleranceList[a]){return this.toleranceList[a]}else{return new OpenLayers.Size(0,0)}}}else{if((this.map.getResolution()<this.resolutionList[a])&&(this.map.getResolution()>this.resolutionList[a+1])){if(this.toleranceList[a]){return this.toleranceList[a]}else{return new OpenLayers.Size(0,0)}}}}return new OpenLayers.Size(0,0)},setVisibility:function(a){if(a!=this.visibility){this.visibility=a;this.display(a);if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"})}this.events.triggerEvent("visibilitychanged")}},CLASS_NAME:"OpenLayers.Layer.IAAA_GeoRSS"});OpenLayers.Layer.IAAA_Server=OpenLayers.Class(OpenLayers.Layer.WMS,{service:null,version:"1.3.0",formatList:new Array(),versionParameterName:"VERSION",capabilitiesRequest:"GetCapabilities",dimensionNamesList:new Array(),dimensionValuesList:new Array(),formatSelected:-1,defaultFormatSelected:null,SRSList:new Array(),selectedSRS:-1,exception:null,loaded:false,layers:new Array(),isSLD:false,returnPx:null,clearBeforeLoading:true,initQueryTime:-1,endQueryTime:-1,treeNode:null,treeLoadImg:null,removeable:true,modifiable:true,loadFromTree:false,isWMSC:false,accessConstraints:null,mainAttribution:null,delayDisplay:true,maxSupportedExtent:null,mainLayerMaxSupportedExtent:null,minSupportedScale:null,mainLayerMinSupportedScale:null,maxSupportedScale:null,mainLayerMaxSupportedScale:null,mainLayerTitle:null,legendList:null,ignoreScope:true,_treeNodeVisibility:true,_visibilityToRestore:false,EVENT_TYPES:["loadstart","loadend","loadcancel","visibilitychanged","tileloadstart","tileloaded","tileunload","urlchanged","titlechanged","layerlistvisibilityupdated"],initialize:function(f,c,k,b){var a=new Array();k=OpenLayers.Util.upperCaseObject(k);if(b&&b.isWMSC){b.singleTile=false}if(c.indexOf("&")!=-1){c=c.substring(0,c.indexOf("&"))+"?"+c.substring(c.indexOf("&")+1,c.length)}a.push(f,c,k,b);if(this.version){this.DEFAULT_PARAMS.version=this.version}OpenLayers.Layer.WMS.prototype.initialize.apply(this,a);this.params.LAYERS="";if((this.params.BGCOLOR==undefined)||(this.params.BGCOLOR==null)||(this.params.BGCOLOR=="")){this.params.BGCOLOR="0xFFFFFF"}if((this.params.SERVICE!=undefined)&&(this.params.SERVICE!=null)){this.service=this.params.SERVICE}else{this.service="WMS"}this.layers=new Array();this.setVisibility(false);this.formatList=new Array(this.params.FORMAT);if((this.getFormatSelected()<0)&&this.defaultFormatSelected){var g=0;while((g<this.formatList.length)&&(this.getFormatSelected()<0)){if(this.defaultFormatSelected==this.formatList[g]){this.setFormatSelected(g)}g++}if(this.getFormatSelected()<0){this.setFormatSelected(0)}}this.events.register("loadstart",null,this.onLoadStartHandler);this.events.register("loadend",null,this.onLoadHandler);this.events.register("tileloaded",null,this.onTileLoadHandler)},setMap:function(b){if(this.map==null){this.map=b;this.maxExtent=this.maxExtent||this.map.maxExtent;this.projection=this.projection||this.map.projection;if(this.projection&&typeof this.projection=="string"){this.projection=new OpenLayers.Projection(this.projection)}this.units=this.projection.getUnits()||this.units||this.map.units;if((!this.isWMSC)||(!this.resolutions)){this.initResolutions()}else{if(this.isWMSC&&this.resolutions){this.numZoomLevels=this.resolutions.length}}if(!this.isBaseLayer){this.inRange=this.calculateInRange();var a=((this.visibility)&&(this.inRange));this.div.style.display=a?"":"none"}this.setTileSize();if(this.treeNode){this.map.events.register("moveend",this,this.updateTreeNodeVisibility);this.updateTreeNodeVisibility()}}},addLayer:function(c){this.updateScopeVisibilityParams(c);if(c.ISPARENT){var b=0;while((b<this.layers.length)&&((c.name!=this.layers[b].name)||(!this.layers[b].ISPARENT))){b++}if(b<this.layers.length){var p=c.getChildLayerList().length;var o=this.layers[b].getChildLayerList().length;var m=0;var k=0;while(m<p){while((k<o)&&(c.childLayers[m].name!=this.layers[b].childLayers[k].name)){k++}if(k=o){this.layers[b].childLayers[this.layers[b].childLayers.length]=c.childLayers[m]}m++;k=0}return}}this.layers[this.layers.length]=c;c.setParent(this);if(c.getVisibility()){this.updateVisibility()}if(c.CLASS_NAME=="OpenLayers.IAAA_WMS"){if(c.isExcluder()&&c.getVisibility()){this.updateExcluderLayers(c)}}else{if(c.CLASS_NAME=="OpenLayers.IAAA_WMS.IAAA_ParentLayer"){for(var l=0;l<c.getChildLayerList().length;l++){var a=c.getChildLayerList()[l];if(a.isExcluder()&&a.getVisibility()){this.updateExcluderLayers(a)}}}}},addLayers:function(b){for(var a in b){this.addLayer(b[a])}},setLayerList:function(b){this.layers=new Array();for(var a in b){this.updateScopeVisibilityParams(b[a]);this.layers.push(b[a]);b[a].setParent(this)}},removeLayer:function(c){var a=c;var b=this.layers.length;if(a<b){while(a<(b-1)){this.layers[a]=this.layers[a+1];a++}this.layers.pop();this.updateVisibility();this.updateScopeVisibilityParams(null);return true}else{return false}},getLayerIndex:function(a,c){var b;for(b=0;b<this.layers.length;b++){if((this.layers[b].name==a)&&(this.layers[b].title==c)){return b}}return -1},interchangeLayers:function(a,c){var b=this.layers[a];this.layers[a]=this.layers[c];this.layers[c]=b},getVersion:function(){return this.params.VERSION},getTransparent:function(){return(((this.params.TRANSPARENT==undefined)||(this.params.TRANSPARENT==null)||((this.params.TRANSPARENT+"").toUpperCase()!="FALSE"))+"")},getVersionParameterName:function(){return this.versionParameterName},getCapabilitiesRequest:function(){return this.capabilitiesRequest},getBgColor:function(){return this.params.BGCOLOR},getDimensionNamesList:function(){return this.dimensionNamesList},getDimensionName:function(a){return this.dimensionNamesList[a]},getDimensionValuesList:function(){return this.dimensionValuesList},getDimensionValue:function(a){return this.dimensionValuesList[a]},getFormatSelected:function(){return this.formatSelected},getFormatList:function(){return this.formatList},getException:function(){return this.exception},setVersion:function(a){this.version=a;this.params.VERSION=a},setTransparent:function(a){this.params.TRANSPARENT=a},setBgColor:function(a){this.params.BGCOLOR=a},setDimensionName:function(b,a){this.dimensionNamesList[b]=a},setDimensionValue:function(b,a){this.dimensionValuesList[b]=a},setDimensionNamesList:function(a){this.dimensionNamesList=a},setFormatList:function(b){this.formatList=b;if(this.defaultFormatSelected){for(var a in this.formatList){if(this.defaultFormatSelected==this.formatList[a]){this.setFormatSelected(a);return}}}this.setFormatSelected(0)},setDimensionValuesList:function(a){this.dimensionValuesList=a},setFormatSelected:function(a){this.formatSelected=a;this.params.FORMAT=this.formatList[this.formatSelected]},setException:function(a){this.exception=a;this.params.EXCEPTIONS=a},updateVisibility:function(){this.params.LAYERS="";this.params.STYLES="";for(var a=0;a<this.layers.length;a++){if(this.layers[a].getVisibility()){if((!this.layers[a].ISPARENTLAYER)||(this.layers[a].getChildLayerList().length==0)){if(this.params.LAYERS!=""){this.params.LAYERS=this.params.LAYERS+",";this.params.STYLES=this.params.STYLES+","}this.params.LAYERS=this.params.LAYERS+this.layers[a].name;this.params.STYLES=this.params.STYLES+this.layers[a].styleList[this.layers[a].getStyleSelected()].getName()}else{var b={layers:"",styles:""};this.getChildVisibleLayers(this.layers[a],b);if(this.params.LAYERS!=""){this.params.LAYERS=this.params.LAYERS+",";this.params.STYLES=this.params.STYLES+","}this.params.LAYERS=this.params.LAYERS+b.layers;this.params.STYLES=this.params.STYLES+b.styles}}}if(this.params.LAYERS!=""){var c=this.getVisibility();this.setVisibility(true);if(c){this.redraw()}}else{this.setVisibility(false)}this.events.triggerEvent("layerlistvisibilityupdated",{layer:this})},getChildVisibleLayers:function(b,c){var f=b.getChildLayerList();for(var a in f){if(f[a].getVisibility()){if((!f[a].ISPARENTLAYER)||(f[a].getChildLayerList().length==0)){if(c.layers!=""){c.layers=c.layers+",";c.styles=c.styles+","}c.layers=c.layers+f[a].name;c.styles=c.styles+f[a].styleList[f[a].getStyleSelected()].getName()}else{this.getChildVisibleLayers(f[a],c)}}}},setVisibilityToAllLayers:function(a){for(var c=0;c<this.layers.length;c++){this.layers[c].setVisibility(a,true);if((!this.layers[c].ISPARENTLAYER)||(this.layers[c].getChildLayerList().length==0)){}else{for(var b=0;b<this.layers[c].getChildLayerList().length;b++){this.layers[c].getChildLayerList()[b].setVisibility(a,true)}}}this.updateVisibility()},addTile:function(c,a){var b=this.getURL(c);return new OpenLayers.Tile.IAAA_Image(this,a,c,b,this.tileSize,{delayDisplay:this.delayDisplay})},spiralTileLoad:function(){if((this.treeLoadImg!=null)&&(this.visibility)){this.treeLoadImg.style.visibility="visible";this.treeLoadImg.style.display="inline"}this.loaded=false;OpenLayers.Layer.Grid.prototype.spiralTileLoad.apply(this,arguments)},resizeTiles:function(c,a){var g=(this.tileSize.w*c)-((this.tileSize.w*c)%1);var b=(this.tileSize.h*a)-((this.tileSize.h*a)%1);var f=new OpenLayers.Size(g,b);this.setTileSize(f);this.clearGrid();this.initGriddedTiles(this.getExtent())},moveTo:function(b,a,c){if(this.getVisibility()){OpenLayers.Layer.WMS.prototype.moveTo.apply(this,arguments)}},getModifiable:function(){return this.modifiable},getLoadFromTree:function(){return this.loadFromTree},getLayerList:function(){return this.layers},getTitle:function(){return this.name},getUrl:function(){return this.url},getSRSList:function(){return this.SRSList},getSelectedSRS:function(){return this.selectedSRS},setLoadFromTree:function(a){this.loadFromTree=a},setTitle:function(b){var a=this.name;this.name=b;this.events.triggerEvent("titlechanged",{ancientTitle:a,layer:this})},setUrl:function(b){if(b.indexOf("&")!=-1){b=b.substring(0,b.indexOf("&"))+"?"+b.substring(b.indexOf("&")+1,b.length)}var a=this.url;this.url=b;this.events.triggerEvent("urlchanged",{ancientUrl:a,layer:this})},getIsSLD:function(){return this.isSLD},setIsSLD:function(a){this.isSLD=a},setSRSList:function(a){this.SRSList=a},setSelectedSRS:function(b){this.selectedSRS=b;this.projection=this.getSRSList()[b];this.params.SRS=this.getSRSList()[b];var a=this.params.VERSION;if(a){if((parseInt(a.split(".")[0])>=1)&&(parseInt(a.split(".")[1])>=2)){this.params.CRS=this.getSRSList()[b];this.params.SRS=null;return}}this.redraw()},changeSrs:function(k){var c=this.findSrs(k);if(c>=0&&c<this.getSRSList().length){this.setSelectedSRS(c)}else{var b=0;var g=false;while(!g&&b<getPrioritySrsList().length){var a=getPrioritySrs(b);if(a!=k){var f=this.findSrs(a);if(f>=0&&f<this.getSRSList().length){this.setSelectedSRS(f);g=true}}b++}if(!g){alert(indexReference.messages.wmsSrsNotSupported)}}},findSrs:function(c){var a=-1;var b=0;while((a==-1)&&(b<this.getSRSList().length)){if(this.getSRSList()[b]==c){a=b}b++}return a},getFullRequestString:function(b){var a=this.map.getProjection();if(this.getVersion().charAt(2)&&(parseInt(this.getVersion().charAt(2))>=2)){this.params.CRS=(this.projection)?this.projection:a}else{this.params.SRS=(this.projection)?this.projection:a}return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},calculateInRange:function(){return true},initSingleTile:function(k){var a=k.getCenterLonLat();var m=k.getWidth()*this.ratio;var b=k.getHeight()*this.ratio;var l=new OpenLayers.Bounds(a.lon-(m/2),a.lat-(b/2),a.lon+(m/2),a.lat+(b/2));var f=new OpenLayers.LonLat(l.left,l.top);var c=this.map.getLayerPxFromLonLat(f);this.returnPx=c;if(!this.grid.length){this.grid[0]=[]}var g=this.grid[0][0];if(!g){g=this.addTile(l,c);this.addTileMonitoringHooks(g);g.draw();this.grid[0][0]=g}else{g.moveTo(l,g.position)}this.removeExcessTiles(1,1)},initGriddedTiles:function(f){if(this.grid){while(this.grid.length>0){var g=this.grid.pop();for(var b=0,a=g.length;b<a;b++){var c=g[b];this.removeTileMonitoringHooks(c);c.destroy()}}if(this.grid[0]){while(this.grid[0].length>0){for(var b=0,a=this.grid.length;b<a;b++){var g=this.grid[b];var c=g.pop();this.removeTileMonitoringHooks(c);c.destroy()}}}}OpenLayers.Layer.WMS.prototype.initGriddedTiles.apply(this,[f])},addTileMonitoringHooks:function(a){a.onLoadStart=function(){this.events.triggerEvent("tileloadstart");if(this.numLoadingTiles==0){this.events.triggerEvent("loadstart")}this.numLoadingTiles++};a.events.register("loadstart",this,a.onLoadStart);a.onLoadEnd=function(){this.numLoadingTiles--;this.events.triggerEvent("tileloaded");if(this.numLoadingTiles==0){this.events.triggerEvent("loadend")}};a.events.register("loadend",this,a.onLoadEnd);a.onUnload=function(){this.numLoadingTiles--;this.events.triggerEvent("tileunload")};a.events.register("unload",this,a.onUnload)},onLoadHandler:function(){if((this.singleTile)&&(this.returnPx)){OpenLayers.Util.modifyDOMElement(this.grid[0][0].frame,null,this.returnPx);this.grid[0][0].position=this.returnPx}if((this.treeLoadImg!=null)&&(this.visibility)){this.treeLoadImg.style.visibility="hidden";this.treeLoadImg.style.display="inline"}},onTileLoadHandler:function(){this.setEndQueryTime(new Date().getTime())},onLoadStartHandler:function(){if((this.treeLoadImg!=null)&&(this.visibility)){this.treeLoadImg.style.visibility="visible";this.treeLoadImg.style.display="inline"}this.resetEndQueryTime();this.setInitQueryTime(new Date().getTime())},getZoomForResolution:function(f){var q;if(this.map.fractionalZoom){var m=0;var b=this.resolutions.length-1;var c=this.resolutions[m];var a=this.resolutions[b];var l;for(var g=0;g<this.resolutions.length;++g){l=this.resolutions[g];if(l>=f){c=l;m=g}if(l<=f){a=l;b=g;break}}var k=c-a;if(k>0){q=m+((f-a)/k)}else{q=m}}else{var o;var p=Number.POSITIVE_INFINITY;for(var g=0;g<this.resolutions.length;g++){o=Math.abs(this.resolutions[g]-f);if(o>p){break}p=o}q=Math.max(0,g-1)}return q},setInitQueryTime:function(a){this.initQueryTime=a},resetEndQueryTime:function(){this.endQueryTime=-1},setEndQueryTime:function(a){if(this.endQueryTime<0){this.endQueryTime=a}},getInitQueryTime:function(){return this.initQueryTime},getEndQueryTime:function(){return this.endQueryTime},getResponseTime:function(){return(this.endQueryTime-this.initQueryTime)},updateExcluderLayers:function(l,a){for(var c=0;c<this.layers.length;c++){var k=this.layers[c];var m=null;if((k!=l)&&(k.isExcluder())){this.layers[c].setVisibility(false,a);var f=k.getTreeNode();if(f&&getTree&&getTree()){var g=f.widgetId;var o=[];o[0]=g.split("_")[1];o[1]=g.split("_")[2];var m=getTree().dojo.widget.byId("chk_WMSLayer_"+o[0]+"_"+o[1])}}else{if(k.CLASS_NAME=="OpenLayers.IAAA_WMS.IAAA_ParentLayer"){for(var b=0;b<k.getChildLayerList().length;b++){var p=k.getChildLayerList()[b];if((p!=l)&&(p.isExcluder())){p.setVisibility(false,a);var f=p.getTreeNode();if(f&&getTree&&getTree()){var g=f.widgetId;var o=[];o[0]=g.split("_")[1];o[1]=g.split("_")[2];o[2]=g.split("_")[3];var m=getTree().dojo.widget.byId("chk_WMSChildLayer_"+o[0]+"_"+o[1]+"_"+o[0])}}}}}if(m&&m.checked!=false){m.checked=false;m.fillInTemplate();m.imageNode.setAttribute("title",messages.showLayer)}}if(getTree&&getTree()&&this.getTreeNode()){var q=getTree();q._updateWMSNode(this.getTreeNode(),q.dojo)}},clearTiles:function(){for(var f=0,k=this.grid.length;f<k;f++){var g=this.grid[f];for(var l=0,a=g.length;l<a;l++){var b=g[l];b.clear()}}},setTreeNode:function(a){this.treeNode=a;if(this.map){this.map.events.register("moveend",this,this.updateTreeNodeVisibility);this.updateTreeNodeVisibility()}},getTreeNode:function(){return this.treeNode},getTreeNodeVisibility:function(){return this._treeNodeVisibility},setAccessConstraints:function(a){this.accessConstraints=a},getAccessConstraints:function(){return this.accessConstraints},setMainAttribution:function(a){this.mainAttribution=a},getMainAttribution:function(){return this.mainAttribution},redraw:function(a){OpenLayers.Layer.WMS.prototype.redraw.apply(this,[a]);this.events.triggerEvent("loadstart")},inSupportedRange:function(){var g=true;if(!this.ignoreScope){if(!this.map){g=true}else{if((this.minSupportedScale&&(this.map.getActualScale()<this.minSupportedScale))||(this.maxSupportedScale&&(this.map.getActualScale()>this.maxSupportedScale))){g=false}else{if(this.maxSupportedExtent){var b,a;if(this.maxSupportedExtent.srs==this.map.projection){b=this.maxSupportedExtent;a=this.map.getExtent()}else{if(this.maxSupportedExtent.srs[5]=="4"){var f=coordTransform(this.map.projection,this.maxSupportedExtent.srs,this.map.getExtent().right,this.map.getExtent().bottom);var c=coordTransform(this.map.projection,this.maxSupportedExtent.srs,this.map.getExtent().left,this.map.getExtent().top);b=new OpenLayers.Bounds(c[0],f[1],f[0],c[1]);a=this.maxSupportedExtent}else{var f=coordTransform(this.maxSupportedExtent.srs,this.map.projection,this.maxSupportedExtent.right,this.maxSupportedExtent.bottom);var c=coordTransform(this.maxSupportedExtent.srs,this.map.projection,this.maxSupportedExtent.left,this.maxSupportedExtent.top);b=new OpenLayers.Bounds(c[0],f[1],f[0],c[1]);a=this.map.getExtent()}}if(!b.intersectsBounds(a)){g=false}}}}}return g},setMaxSupportedExtent:function(a){this.maxSupportedExtent=a;this.updateTreeNodeVisibility()},setMainLayerMaxSupportedExtent:function(a){this.mainLayerMaxSupportedExtent=a;this.setMaxSupportedExtent(a)},setMinSupportedScale:function(a){this.minSupportedScale=a;this.updateTreeNodeVisibility()},setMainLayerMinSupportedScale:function(a){this.mainLayerMinSupportedScale=a;this.setMinSupportedScale(a)},setMaxSupportedScale:function(a){this.maxSupportedScale=a;this.updateTreeNodeVisibility()},setMainLayerMaxSupportedScale:function(a){this.mainLayerMaxSupportedScale=a;this.setMaxSupportedScale(a)},updateTreeNodeVisibility:function(){if(!this.inSupportedRange()){if(this._treeNodeVisibility){this._treeNodeVisibility=false;this._visibilityToRestore=this.getVisibility();this.setVisibility(false);if(this.treeNode&&this.treeNode.domNode){this.treeNode.domNode.style.display="none"}}}else{if(!this._treeNodeVisibility){this._treeNodeVisibility=true;this.setVisibility(this._visibilityToRestore);this._visibilityToRestore=false;if(this.treeNode&&this.treeNode.domNode){this.treeNode.domNode.style.display="block"}}}},updateScopeVisibilityParams:function(f){if(f){if(!this.mainLayerMaxSupportedExtent){if(f.maxSupportedExtent){if(this.maxSupportedExtent){var g=f.maxSupportedExtent.getSrs();var m=this.maxSupportedExtent.getSrs();var p=coordTransform(g,m,f.maxSupportedExtent.right,f.maxSupportedExtent.bottom);var o=coordTransform(g,m,f.maxSupportedExtent.left,f.maxSupportedExtent.top);var c=new OpenLayers.Bounds(o[0],p[1],p[0],o[1]);this.maxSupportedExtent.left=(c.left<this.maxSupportedExtent.left)?c.left:this.maxSupportedExtent.left;this.maxSupportedExtent.top=(c.top>this.maxSupportedExtent.top)?c.top:this.maxSupportedExtent.top;this.maxSupportedExtent.right=(c.right>this.maxSupportedExtent.right)?c.right:this.maxSupportedExtent.right;this.maxSupportedExtent.bottom=(c.bottom<this.maxSupportedExtent.bottom)?c.bottom:this.maxSupportedExtent.bottom}else{if(this.getLayerList().length<=0){this.setMaxSupportedExtent(f.maxSupportedExtent)}else{}}}else{this.setMaxSupportedExtent(null)}}if(!this.mainLayerMinSupportedScale){if(f.minSupportedScale){if(this.minSupportedScale){this.minSupportedScale=(this.minSupportedScale>f.minSupportedScale)?f.minSupportedScale:this.minSupportedScale}else{if(this.getLayerList().length<=0){this.setMinSupportedScale(f.minSupportedScale)}else{}}}else{this.setMinSupportedScale(null)}}if(!this.mainLayerMaxSupportedScale){if(f.maxSupportedScale){if(this.maxSupportedScale){this.maxSupportedScale=(this.maxSupportedScale<f.maxSupportedScale)?f.maxSupportedScale:this.maxSupportedScale}else{if(this.getLayerList().length<=0){this.setMaxSupportedScale(f.maxSupportedScale)}else{}}}else{this.setMaxSupportedScale(null)}}}else{if(!this.mainLayerMaxSupportedExtent){var b=(this.layers[0])?this.layers[0].maxSupportedExtent:null;var a=1;while((a<this.layers.length)&&b){if(this.layers[a].maxSupportedExtent){var g=this.layers[a].maxSupportedExtent.getSrs();var m=this.maxSupportedExtent.getSrs();var p=coordTransform(g,m,this.layers[a].maxSupportedExtent.right,this.layers[a].maxSupportedExtent.bottom);var o=coordTransform(g,m,this.layers[a].maxSupportedExtent.left,this.layers[a].maxSupportedExtent.top);var c=new OpenLayers.Bounds(o[0],p[1],p[0],o[1]);b.left=(c.left<b.left)?c.left:this.maxSupportedExtent.left;b.top=(c.top>b.top)?c.top:this.maxSupportedExtent.top;b.right=(c.right>b.right)?c.right:this.maxSupportedExtent.right;b.bottom=(c.bottom<b.bottom)?c.bottom:this.maxSupportedExtent.bottom}else{b=null}a++}this.maxSupportedExtent=b}if(!this.mainLayerMinSupportedScale){var k=(this.layers[0])?this.layers[0].minSupportedScale:null;var a=1;while((a<this.layers.length)&&k){if(this.layers[a].minSupportedScale){k=(k>this.layers[a].minSupportedScale)?this.layers[a].minSupportedScale:k}else{k=null}a++}this.minSupportedScale=k}if(!this.mainLayerMaxSupportedScale){var l=(this.layers[0])?this.layers[0].maxSupportedScale:null;var a=1;while((a<this.layers.length)&&l){if(this.layers[a].maxSupportedScale){l=(l<this.layers[a].maxSupportedScale)?this.layers[a].maxSupportedScale:l}else{l=null}a++}this.maxSupportedScale=l}}this.updateTreeNodeVisibility()},sphericalReproject:true,getSphericalReproject:function(){return this.sphericalReproject},setSphericalReproject:function(a){this.sphericalReproject=a},getLegendList:function(){return this.legendList},setLegendList:function(a){this.legendList=a},getMainLayerTitle:function(){return this.mainLayerTitle},setMainLayerTitle:function(a){this.mainLayerTitle=a},isLatLon:function(){var a=this.getSRSList()[this.getSelectedSRS()];var b=(a&&(a.slice(0,6)=="EPSG:4")&&(parseInt(a.slice(5))>=4000)&&(parseInt(a.slice(5))<5000));return((parseInt(this.getVersion().charAt(0))>=1)&&(parseInt(this.getVersion().charAt(2))>=2)&&b)},getURL:function(b){b=this.adjustBounds(b);var c=this.getImageSize();var f;if(!this.isLatLon()){f={BBOX:this.encodeBBOX?b.toBBOX():b.toArray(),WIDTH:c.w,HEIGHT:c.h}}else{f={BBOX:[b.bottom,b.left,b.top,b.right],WIDTH:c.w,HEIGHT:c.h}}var a=this.getFullRequestString(f);return a},CLASS_NAME:"OpenLayers.Layer.IAAA_Server"});OpenLayers.Layer.IAAA_WMS=OpenLayers.Class(OpenLayers.Layer.WMS,{printUrl:null,isSLD:false,ratio:1,clearBeforeLoading:true,showLoadingIcon:false,EVENT_TYPES:["loadstart","loadend","loadcancel","visibilitychanged","tileloadstart","tileloaded","tileunload"],initialize:function(f,c,g,b){var a=new Array();g=OpenLayers.Util.upperCaseObject(g);a.push(f,c,g,b);OpenLayers.Layer.WMS.prototype.initialize.apply(this,a)},initGriddedTiles:function(f){if(this.grid){while(this.grid.length>0){var g=this.grid.pop();for(var b=0,a=g.length;b<a;b++){var c=g[b];this.removeTileMonitoringHooks(c);c.destroy()}}if(this.grid[0]){while(this.grid[0].length>0){for(var b=0,a=this.grid.length;b<a;b++){var g=this.grid[b];var c=g.pop();this.removeTileMonitoringHooks(c);c.destroy()}}}}OpenLayers.Layer.WMS.prototype.initGriddedTiles.apply(this,[f])},addTileMonitoringHooks:function(a){a.onLoadStart=function(){this.events.triggerEvent("tileloadstart");baseLoaded=false;if(this.numLoadingTiles==0){this.events.triggerEvent("loadstart")}this.numLoadingTiles++};a.events.register("loadstart",this,a.onLoadStart);a.onLoadEnd=function(){this.numLoadingTiles--;this.events.triggerEvent("tileloaded");if(this.numLoadingTiles==0){this.events.triggerEvent("loadend")}};a.events.register("loadend",this,a.onLoadEnd);a.onUnload=function(){this.numLoadingTiles--;this.events.triggerEvent("tileunload")};a.events.register("unload",this,a.onUnload)},getURL:function(f){if(this.ratio!=1){var b=this.adjustBounds(f);difX=(b.right-b.left);difY=(b.top-b.bottom);var f=new OpenLayers.Bounds(b.left,b.top-(difY*this.ratio),b.left+(difX*this.ratio),b.top)}else{var f=this.adjustBounds(f)}var g=this.getImageSize();var c=g.w*this.ratio-(g.w*this.ratio)%1;var a=g.h*this.ratio-(g.h*this.ratio)%1;return this.getFullRequestString({BBOX:this.encodeBBOX?f.toBBOX():f.toArray(),WIDTH:c,HEIGHT:a})},setVisibility:function(a){if(a!=this.visibility){this.visibility=a;this.display(a);this.redraw();if(this.map!=null){this.map.events.triggerEvent("changelayer")}this.events.triggerEvent("visibilitychanged")}},sphericalReproject:true,getSphericalReproject:function(){return this.sphericalReproject},setSphericalReproject:function(a){this.sphericalReproject=a},addTile:function(b,a){var c=new OpenLayers.Size(this.tileSize.w*this.ratio,this.tileSize.h*this.ratio);return new OpenLayers.Tile.IAAA_Image(this,a,b,null,c)},getFullRequestString:function(b){var a=this.map.getProjection();if(this.params.VERSION){this.params.version=new String(this.params.VERSION)}if((this.params.VERSION)&&(parseInt(this.params.VERSION.split(".")[0])>=1)&&(parseInt(this.params.VERSION.split(".")[1])>=2)){this.params.CRS=(a=="none")?null:a;this.params.SRS=null;if((this.map.projection=="EPSG:900913")&&(this.getSphericalReproject())&&((this.utm==undefined)||((this.utm!=undefined)&&(this.utm==false)))){this.params.CRS=this.projection}}else{this.params.SRS=(a=="none")?null:a;this.params.CRS=null;if((this.map.projection=="EPSG:900913")&&(this.getSphericalReproject())&&((this.utm==undefined)||((this.utm!=undefined)&&(this.utm==false)))){this.params.SRS=this.projection}}return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},onMapResize:function(){if(this.singleTile){this.clearGrid();this.setTileSize()}},setSLD:function(a){this.isSLD=a},getIsSLD:function(){return this.isSLD},addLayer:function(b,a){var a=((a==undefined)||(a==null))?"default":a;if((this.params.LAYERS==null)||(this.params.LAYERS=="")){this.params.LAYERS=b;this.params.STYLES=a}else{this.params.LAYERS=this.params.LAYERS+","+b;this.params.STYLES=this.params.STYLES+","+a}},addLayerInFirstPlace:function(b,a){var a=((a==undefined)||(a==null))?"default":a;if((this.params.LAYERS==null)||(this.params.LAYERS=="")){this.params.LAYERS=b;this.params.STYLES=a}else{this.params.LAYERS=b+","+this.params.LAYERS;this.params.STYLES=a+","+this.params.STYLES}},clearTiles:function(){for(var f=0,k=this.grid.length;f<k;f++){var g=this.grid[f];for(var l=0,a=g.length;l<a;l++){var b=g[l];b.clear()}}},resizeTiles:function(c,a){var g=(this.tileSize.w*c)-((this.tileSize.w*c)%1);var b=(this.tileSize.h*a)-((this.tileSize.h*a)%1);var f=new OpenLayers.Size(g,b);this.setTileSize(f);this.clearGrid();this.initGriddedTiles(this.getExtent())},isLatLon:function(){var a=(this.params.CRS)?this.params.CRS:this.params.SRS;var b=(a&&(a.slice(0,6)=="EPSG:4")&&(parseInt(a.slice(5))>=4000)&&(parseInt(a.slice(5))<5000));return((parseInt(this.params.VERSION.charAt(0))>=1)&&(parseInt(this.params.VERSION.charAt(2))>=2)&&b)},getURL:function(b){b=this.adjustBounds(b);var c=this.getImageSize();var f;if(!this.isLatLon()){f={BBOX:this.encodeBBOX?b.toBBOX():b.toArray(),WIDTH:c.w,HEIGHT:c.h}}else{f={BBOX:[b.bottom,b.left,b.top,b.right],WIDTH:c.w,HEIGHT:c.h}}var a=this.getFullRequestString(f);return a},CLASS_NAME:"OpenLayers.Layer.IAAA_WMS"});OpenLayers.Layer.IAAA_VectorGenericPopups=OpenLayers.Class(OpenLayers.Layer.Vector,{additionalInfo:true,tolerance:10,currentFeature:null,lastFeature:null,lastValidFeature:null,mouseOverPopup:false,popupStyle:{bubble:true,ignorePadding:true,ignoreMapSizeRestrictions:true,anchorSize:new OpenLayers.Size(6,6),anchorOffset:new OpenLayers.Pixel(0,0),border:"1px solid black",backgroundColor:"white",font:"10pt arial"},defaultPointer:null,PRIORITY_LAYERS:["OpenLayers.Layer.IAAA_GeoRSS"],initialize:function(b,a){OpenLayers.Layer.Vector.prototype.initialize.apply(this,arguments)},setMap:function(f){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);this.map.events.register("mousemove",this,this.mousemove);var k=this.map.layers.length-1;var g=k;var c=this.map.layers[g];for(var b=(k-1);b>=0;b--){if(this.isPriorityLayer(this.map.layers[b])){var a=this.map.layers[b];this.map.layers[b]=c;this.map.layers[g]=a;g=b}}this.map.resetLayersZIndex()},isPriorityLayer:function(b){for(var a in this.PRIORITY_LAYERS){if(this.PRIORITY_LAYERS[a]==b.CLASS_NAME){return true}}return false},removeMap:function(a){a.events.unregister("mousemove",this,this.mousemove);this.destroy()},mousemove:function(a){if(!this.mouseOverPopup){var f=this.map.getLonLatFromPixel(a.xy);var g=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.map.getLonLatFromPixel(new OpenLayers.Pixel(a.xy.x-this.tolerance,a.xy.y-this.tolerance)).lon,this.map.getLonLatFromPixel(new OpenLayers.Pixel(a.xy.x-this.tolerance,a.xy.y-this.tolerance)).lat),new OpenLayers.Geometry.Point(this.map.getLonLatFromPixel(new OpenLayers.Pixel(a.xy.x+this.tolerance,a.xy.y-this.tolerance)).lon,this.map.getLonLatFromPixel(new OpenLayers.Pixel(a.xy.x+this.tolerance,a.xy.y-this.tolerance)).lat),new OpenLayers.Geometry.Point(this.map.getLonLatFromPixel(new OpenLayers.Pixel(a.xy.x+this.tolerance,a.xy.y+this.tolerance)).lon,this.map.getLonLatFromPixel(new OpenLayers.Pixel(a.xy.x+this.tolerance,a.xy.y+this.tolerance)).lat),new OpenLayers.Geometry.Point(this.map.getLonLatFromPixel(new OpenLayers.Pixel(a.xy.x-this.tolerance,a.xy.y+this.tolerance)).lon,this.map.getLonLatFromPixel(new OpenLayers.Pixel(a.xy.x-this.tolerance,a.xy.y+this.tolerance)).lat)])]);if(this.currentFeature){this.lastValidFeature=this.currentFeature}this.lastFeature=this.currentFeature;var b=null;var k=false;for(var c in this.features){if(this.features[c].geometry.intersects(g)){b=this.features[c];k=true}}if(!k){this.currentFeature=null;if(this.lastValidFeature){this.outsideFeature(this.lastValidFeature)}}else{if(this.lastFeature&&(b==this.lastFeature)){return}else{this.currentFeature=b;if(this.currentFeature.geometry.x&&this.currentFeature.geometry.y){f=new OpenLayers.LonLat(this.currentFeature.geometry.x,this.currentFeature.geometry.y)}this.showPopup(this.currentFeature,f);this.overFeature(this.currentFeature);this.currentFeature.popup.events.registerPriority("mouseover",this.currentFeature.popup.div,OpenLayers.Function.bind(function(){this.mouseOverPopup=true;OpenLayers.Event.stop(a);return false},this));this.currentFeature.popup.events.register("mouseout",this.currentFeature.popup.div,OpenLayers.Function.bind(function(){this.mouseOverPopup=false},this));this.currentFeature.popup.events.register("mousemove",this.currentFeature.popup.div,OpenLayers.Function.bind(function(){OpenLayers.Event.stop(a);return false},this))}}}},showPopup:function(c,f,a,b){if(c.popup){this.map.removePopup(c.popup)}this.createPopup(c);if(f){c.popup.lonlat=f}this.map.addPopup(c.popup,false);c.popup.hide()},createPopup:function(b){var a={size:this.popupStyle.anchorSize,offset:this.popupStyle.anchorOffset};var c;if(this.popupStyle.bubble){c=OpenLayers.Popup.AnchoredBubble}else{c=OpenLayers.Popup.Anchored}b.popup=new c("vector_"+this.id,new OpenLayers.LonLat(0,0),new OpenLayers.Size(0,0),"",a,false,null);b.popup.autoSize=true;b.popup.border=this.popupStyle.border;b.popup.div.style.font=this.popupStyle.font;b.popup.setBackgroundColor(this.popupStyle.backgroundColor);b.popup.contentHTML=this.generatePopupContent(b);b.popup.div.style.opacity=1;if(this.popupStyle.ignorePadding){b.popup.setSize=function(f){this.size=f.clone();if(this.div!=null){this.div.style.width=this.size.w+"px";this.div.style.height=this.size.h+"px"}if(this.contentDiv!=null){this.contentDiv.style.width=f.w+"px";this.contentDiv.style.height=f.h+"px"}}}if(this.popupStyle.ignoreMapSizeRestrictions){b.popup.updateSize=function(){var g="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>";var k=(this.map)?this.map.layerContainerDiv:document.body;var f=OpenLayers.Util.getRenderedDimensions(g,null,{displayClass:this.displayClass,containerElement:k});this.setSize(f)}}},generatePopupContent:function(g){var b="padding: 5px; overflow: hidden;";var l=g.id.replace("OpenLayers.Feature.","");var a=(g.attributes?(g.attributes.title?g.attributes.title:(g.attributes.name?g.attributes.name:l)):l);var k="<div style='"+b+"'>";k+="<b>"+a+"</b>";var f="";for(var c in g.attributes){if((c!="title")&&(c!="name")){f+="<li>"+c+" = "+g.attributes[c]+"</li>"}}if(f){k+="<ul>"+f+"</ul>"}k+="</div>";return k},overFeature:function(a){if(!a.over){if(this.lastFeature){this.outsideFeature(this.lastFeature)}if(a.popup){a.popup.show()}this.defaultPointer=this.map.getPointer();this.map.setPointer("pointer");a.over=true}},outsideFeature:function(a){if(a.over){if(a.popup){a.popup.hide()}this.map.setPointer(this.defaultPointer);a.over=false}},CLASS_NAME:"OpenLayers.Layer.IAAA_VectorGenericPopups"});OpenLayers.Tile.IAAA_Image=OpenLayers.Class(OpenLayers.Tile.Image,{reloadTimeoutId:null,delayDisplay:true,initialize:function(g,a,k,c,f,b){OpenLayers.Tile.Image.prototype.initialize.apply(this,[g,a,k,c,f]);OpenLayers.Util.extend(this,b);this.events.register("loadend",null,this.onLoadHandler)},initImgDiv:function(){OpenLayers.Tile.Image.prototype.initImgDiv.apply(this,arguments);var a=function(){if((!this.layer.loaded)&&(this.layer.treeLoadImg)){this.layer.treeLoadImg.style.visibility="hidden";this.layer.treeLoadImg.style.display="none";this.layer.loaded=true}this.frame.style.display="block";this.imgDiv.style.display=""};OpenLayers.Event.observe(this.imgDiv,"load",OpenLayers.Function.bind(a,this));OpenLayers.Event.observe(this.imgDiv,"error",OpenLayers.Function.bind(a,this))},draw:function(){if(this.layer!=this.layer.map.baseLayer&&this.layer.reproject){this.bounds=this.getBoundsFromBaseLayer(this.position)}if(this.layer.clearBeforeLoading){this.hide()}if(this.isLoading){this.events.triggerEvent("reload")}else{this.isLoading=true;this.events.triggerEvent("loadstart")}if(this.imgDiv==null){this.initImgDiv();var m=function(){try{if(this.imgDiv._attempts>OpenLayers.IAAA_IMAGE_RELOAD_ATTEMPTS){onload.call(this)}}catch(A){}};OpenLayers.Event.observe(this.imgDiv,"error",OpenLayers.Function.bind(m,this))}this.imgDiv.viewRequestID=this.layer.map.viewRequestID;var g=new OpenLayers.Bounds();if((this.layer.map.projection=="EPSG:900913")&&(this.layer.getSphericalReproject())&&(this.layer.projection!="EPSG:900913")&&((this.layer.utm==undefined)||((this.layer.utm!=undefined)&&(this.layer.utm==false)))){var o=this.inverseMercator(this.bounds.left,this.bounds.bottom);var l=this.inverseMercator(this.bounds.right,this.bounds.top);g.left=o.lon;g.bottom=o.lat;g.right=l.lon;g.top=l.lat;if(this.layer.projection!="EPSG:4326"){punto=coordTransform("EPSG:4326",this.layer.projection,g.left,g.top);var f=punto[0];var r=punto[1];punto=coordTransform("EPSG:4326",this.layer.projection,g.right,g.bottom);var v=punto[0];var b=punto[1];punto=coordTransform("EPSG:4326",this.layer.projection,g.left,g.bottom);var c=punto[0];var a=punto[1];punto=coordTransform("EPSG:4326",this.layer.projection,g.right,g.top);var u=punto[0];var p=punto[1];g.left=((f+c)/2);g.bottom=((b+a)/2);g.right=((v+u)/2);g.top=((r+p)/2)}this.url=this.layer.getURL(g)}else{if(this.layer.map.projection!=this.layer.projection){g=this.bounds;punto=coordTransform(this.layer.map.projection,this.layer.projection,g.left,g.top);var f=punto[0];var r=punto[1];punto=coordTransform(this.layer.map.projection,this.layer.projection,g.right,g.bottom);var v=punto[0];var b=punto[1];punto=coordTransform(this.layer.map.projection,this.layer.projection,g.left,g.bottom);var c=punto[0];var a=punto[1];punto=coordTransform(this.layer.map.projection,this.layer.projection,g.right,g.top);var u=punto[0];var p=punto[1];g.left=((f+c)/2);g.bottom=((b+a)/2);g.right=((v+u)/2);g.top=((r+p)/2);g=this.layer.adjustBounds(g);var k=this.layer.getImageSize();var q;if(!this.layer.isLatLon()){q=this.encodeBBOX?g.toBBOX():g.toArray()}else{q=[g.bottom,g.left,g.top,g.right]}this.url=this.layer.getFullRequestString({BBOX:q,WIDTH:k.w,HEIGHT:k.h})}else{g=this.layer.adjustBounds(this.bounds);var k=this.layer.getImageSize();this.url=this.layer.getURL(this.bounds)}}this.url=decodeURI(this.url);if(!this.layer.singleTile){OpenLayers.Util.modifyDOMElement(this.frame,null,this.position,this.size)}else{OpenLayers.Util.modifyDOMElement(this.frame,null,null,this.size)}var k=this.layer.getImageSize();if(this.layer.alpha){OpenLayers.Util.modifyAlphaImageDiv(this.imgDiv,null,null,k,this.url)}else{this.imgDiv.src=this.url;OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,k)}this.drawn=true;return true},onLoadHandler:function(){window.clearTimeout(this.reloadTimeoutId)},drawAux:function(){if(this.layer.clearBeforeLoading){this.clear()}var b=this.layer.maxExtent;var f=(b&&this.bounds.intersectsBounds(b,false));var a=this.layer.map.getExtent();var c=(a&&this.bounds.intersectsBounds(a,false));return((f||this.layer.displayOutsideMaxExtent)&&(c||(this.layer.buffer!=0)))},inverseMercator:function(a,f){var c=(a/20037508.34)*180;var b=(f/20037508.34)*180;b=180/Math.PI*(2*Math.atan(Math.exp(b*Math.PI/180))-Math.PI/2);return new OpenLayers.LonLat(c,b)},createDiv:function(){this.frame=document.createElement("div");this.frame.style.overflow="hidden";this.frame.style.position="absolute"},clearDiv:function(){if(this.imgDiv!=null){OpenLayers.Event.stopObservingElement(this.imgDiv.id);if(this.imgDiv.parentNode==this.frame){this.frame.removeChild(this.imgDiv);this.imgDiv.map=null}}this.imgDiv=null;if((this.frame!=null)&&(this.frame.parentNode==this.layer.div)){this.layer.div.removeChild(this.frame)}this.frame=null},initImgDiv:function(){var c=this.layer.imageOffset;var a=this.size;if(this.layer.alpha){this.imgDiv=OpenLayers.Util.createAlphaImageDiv(null,c,a,null,"relative",null,null,null,this.delayDisplay)}else{this.imgDiv=OpenLayers.Util.createImage(null,c,a,null,"relative",null,null,this.delayDisplay)}this.imgDiv.className="olTileImage";this.imgDiv.setAttribute("unselectable","on");this.frame.setAttribute("unselectable","on");this.frame.style.MozUserSelect="none";this.imgDiv.tile=this;this.frame.appendChild(this.imgDiv);this.layer.div.appendChild(this.frame);if(this.layer.opacity!=null){OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,null,null,null,null,this.layer.opacity)}this.imgDiv.map=this.layer.map;var b=function(){if(this.layer.singleTile){OpenLayers.Util.modifyDOMElement(this.frame,null,this.position,this.size)}this.frame.style.display="block";if(this.isLoading){this.isLoading=false;this.events.triggerEvent("loadend")}};OpenLayers.Event.observe(this.imgDiv,"load",OpenLayers.Function.bind(b,this))},moveTo:function(b,a,c){if(c==null){c=true}if(this.layer.clearBeforeLoading){this.clear()}this.bounds=b.clone();this.position=a.clone();if(c){this.draw()}},setImage:function(a,c,m){var f=this.imgDiv;var b=this.layer;var l=this.frame;var k=function(){if(b.alpha){f.style.visibility=m;b.div.style.display="";l.style.position="";l.style.overflow="";f.childNodes[0].style.visibility=m}else{f.style.visibility=m}};var g=new OpenLayers.Size(this.layer.getImageSize().w*this.layer.ratio,this.layer.getImageSize().h*this.layer.ratio);if(this.layer.alpha){this.imgDiv.childNodes[0].onload=k;OpenLayers.Util.modifyAlphaImageDiv(this.imgDiv,this.imgDiv.id,c,g,a,null,null,null,false)}else{this.imgDiv.onload=k;this.imgDiv.src=a;OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,g)}this.drawn=true},CLASS_NAME:"OpenLayers.Tile.IAAA_Image"});OpenLayers.Popup.IAAA_Anchored=OpenLayers.Class(OpenLayers.Popup.Anchored,{calculateNewPx:function(b){var k=b.offset(this.anchor.offset);var g=(this.relativePosition.charAt(0)=="t");var a=(this.size.h!="auto")?this.size.h:(((((this.contentHTML.length*6)+5)/140)+1)*2.5)+3;k.y+=(g)?-a:this.anchor.size.h;var f=(this.relativePosition.charAt(1)=="l");var c=(this.size.w!="auto")?this.size.w:((this.contentHTML.length*6)+5)+3;k.x+=(f)?-c:this.anchor.size.w;return k},setSize:function(a){if(a!=undefined){this.size=a}if(this.div!=null){if(this.size.w!="auto"){this.div.style.width=this.size.w+"px"}else{this.div.style.width=this.size.w}if(this.size.h!="auto"){this.div.style.height=this.size.h+"px"}else{this.div.style.height=this.size.h}}if(this.contentDiv!=null){if(this.size.w!="auto"){this.contentDiv.style.width=this.size.w+"px"}else{this.contentDiv.style.width=this.size.w}if(this.size.h!="auto"){this.contentDiv.style.height=this.size.h+"px"}else{this.contentDiv.style.height=this.size.h}}},CLASS_NAME:"OpenLayers.Popup.IAAA_Anchored"});OpenLayers.IAAA_Size=OpenLayers.Class(OpenLayers.Size,{w:0,h:0,initialize:function(a,b){if(a!="auto"){this.w=parseFloat(a)}else{this.w=a}if(b!="auto"){this.h=parseFloat(b)}else{this.h=b}},clone:function(){return new OpenLayers.IAAA_Size(this.w,this.h)},CLASS_NAME:"OpenLayers.IAAA_Size"});OpenLayers.IAAA_Bounds=OpenLayers.Class(OpenLayers.Bounds,{srs:null,clone:function(){var a=new OpenLayers.IAAA_Bounds(this.left,this.bottom,this.right,this.top);if(this.srs){a.setSrs(this.srs)}return a},getSrs:function(){return this.srs},setSrs:function(a){this.srs=a},toString:function(){return("left-bottom=("+this.left+","+this.bottom+") right-top=("+this.right+","+this.top+") SRS="+this.getSrs())},toStandarBBOX:function(a){if(a==null){a=10}var b=Math.pow(10,a);var c=Math.round(this.left*b)/b+","+Math.round(this.bottom*b)/b+" "+Math.round(this.right*b)/b+","+Math.round(this.top*b)/b;return c},toSRSGeometry:function(){var a=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])]);return new OpenLayers.IAAA_SRSGeometry(a,this.getSrs())},transformSrs:function(b){if(this.getSrs()!=b){var a;a=coordTransform(this.getSrs(),b,this.left,this.bottom);this.left=a[0];this.bottom=a[1];a=coordTransform(this.getSrs(),b,this.right,this.top);this.right=a[0];this.top=a[1];this.setSrs(b);this.centerLonLat=null}},CLASS_NAME:"OpenLayers.IAAA_Bounds"});OpenLayers.IAAA_SRSGeometry=OpenLayers.Class({geometry:null,srs:null,initialize:function(b,a){this.geometry=b;this.srs=a},getSrs:function(){return this.srs},setSrs:function(a){this.srs=a},transformSrs:function(g){if(this.getSrs()!=g){var f=function(){this.bounds=null;if(this.components&&this.components.length>0){this.components[0].bounds=null;this.setBounds(this.components[0].getBounds());for(var k=1;k<this.components.length;k++){this.components[k].bounds=null;this.extendBounds(this.components[k].getBounds())}}else{this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)}};if(this.geometry.CLASS_NAME=="OpenLayers.Geometry.Collection"){for(var b in this.geometry.components){var c=this.transformInnerGeometry(this.geometry.components[b],this.getSrs(),g);this.geometry.components[b]=c;this.geometry.components[b].bounds=null;this.geometry.components[b].calculateBounds=f}this.geometry.bounds=null;this.geometry.calculateBounds=f}else{var a=this.transformInnerGeometry(this.geometry,this.getSrs(),g);this.geometry=a;this.geometry.bounds=null;this.geometry.calculateBounds=f}this.setSrs(g)}},transformInnerGeometry:function(o,p,f){if(p!=f){if(o.CLASS_NAME=="OpenLayers.Geometry.Point"){var c=new OpenLayers.Geometry.Point();var a=o;var l=coordTransform(p,f,a.x,a.y);c.x=l[0];c.y=l[1];c.bounds=null;return c}else{if(o.CLASS_NAME=="OpenLayers.Geometry.LineString"){var q=[];var m=new OpenLayers.Geometry.LineString(o.components);for(var k=0;k<o.components.length;k++){var a=o.components[k];if(q[a.id]==null){var l=coordTransform(p,f,a.x,a.y);m.components[k].x=l[0];m.components[k].y=l[1];m.components[k].bounds=null;q[a.id]=true}}return m}else{var q=[];var b=new OpenLayers.Geometry.Polygon(o.components);for(var k=0;k<o.components[0].components.length;k++){var a=o.components[0].components[k];if(q[a.id]==null){var l=coordTransform(p,f,a.x,a.y);b.components[0].components[k].x=l[0];b.components[0].components[k].y=l[1];b.components[0].components[k].bounds=null;q[a.id]=true}}for(var k=1;k<o.components.length;k++){for(var g=0;g<o.components[k].components.length;g++){var a=o.components[k].components[g];if(q[a.id]==null){var l=coordTransform(p,f,a.x,a.y);b.components[k].components[g].x=l[0];b.components[k].components[g].y=l[1];b.components[k].components[g].bounds=null;q[a.id]=true}}}return b}}}},toAsciiPolygon:function(){var g=asciiPolygon;var a="";if(this.geometry.CLASS_NAME=="OpenLayers.Geometry.Point"){a+="P  1\n";a+=" "+this.geometry.x+" "+this.geometry.y+"\n"}else{if(this.geometry.CLASS_NAME=="OpenLayers.Geometry.LineString"){a+="L  "+(this.geometry.components.length-1)+"\n";for(var b=1;b<this.geometry.components.length;b++){var f=this.geometry.components[b].x;var c=this.geometry.components[b].y;a+=" "+f+" "+c+"\n"}}else{a+="B  "+this.geometry.components[0].components.length+"\n";for(var b=0;b<this.geometry.components[0].components.length;b++){var f=this.geometry.components[0].components[b].x;var c=this.geometry.components[0].components[b].y;a+=" "+f+" "+c+"\n"}}}g=OpenLayers.IAAA_Utils.replaceCad(g,"COORDS_LIST",a);return g},clone:function(){var a=new OpenLayers.IAAA_SRSGeometry(this.geometry.clone(),this.srs);return a},toString:function(){var a="Geometry: "+this.geometry.toString()+"\nSRS: "+this.getSrs();return a},CLASS_NAME:"OpenLayers.IAAA_SRSGeometry"});OpenLayers.Strategy.IAAA_Fixed=OpenLayers.Class(OpenLayers.Strategy.Fixed,{onFeatureSelect:null,onFeatureUnselect:null,initialize:function(a){OpenLayers.Strategy.Fixed.prototype.initialize.apply(this,[a])},merge:function(m){this.layer.destroyFeatures();var k=m.features;if(k&&k.length>0){var l=this.layer.projection;var g=this.layer.map.getProjection();if(g!=l){var f;for(var c=0,a=k.length;c<a;++c){f=k[c].geometry;if(f){var b=new OpenLayers.IAAA_SRSGeometry(f,l);b.transformSrs(g);k[c].geometry=b.geometry.clone()}}}for(var c in k){k[c].showInfo=this.onFeatureSelect;k[c].hideInfo=this.onFeatureUnselect;k[c].clone=function(){var o=new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style);o.showInfo=this.showInfo;o.hideInfo=this.hideInfo;o.clone=this.clone;return o}}this.layer.addFeatures(k)}this.layer.events.triggerEvent("loadend")},CLASS_NAME:"OpenLayers.Strategy.IAAA_Fixed"});function OpenLayersClientFCFacade(U,k){this.map=U;this.markerImageUrl=null;this.markerImageWidth=null;this.markerImageHeight=null;this.markerPopupBgColor="white";this.wmsClientMarkerLabelsColor="black";this.titleSearchLayer="Resultado de la búsqueda";this.wmsInfoWindowPath="serviceInfoFromFacade.html";for(i in k){this[i]=k[i]}this.setVisualizationZoomAndCenter=o;this.setLayerVisibility=A;this.getVisualizationExtent=O;this.setVisualizationExtent=J;this.addWMS_NamedLayerNamedStyle=R;this.addWMS=Y;this.addWMSList=I;this.addWFS=B;this.isClientReady=C;this.addGMLLayer=b;this.activateSubcategory=r;this.addMarker=T;this._getMarkerPoint=X;this.centerWithMarker=l;this._forwardMercator=m;this.addPoint=F;this.addPointList=H;this.highlightPoint=c;this.guardarIncidencia=K;this.pintarIncidencias=g;this.visualizarIncidencias=Q;this.openDojoWindow=M;this.openWMSInfoWindow=f;function O(aa){if(this.isClientReady()){self.setClientReady(false);aa=aa||"EPSG:4230";extAux=this.map.getExtent().clone();punto=coordTransform(this.map.getProjection(),aa,extAux.left,extAux.bottom);xMin=punto[0];yMin=punto[1];punto=coordTransform(this.map.getProjection(),aa,extAux.right,extAux.top);xMax=punto[0];yMax=punto[1];var Z=new LinearRing();Z.addPoint(xMin,yMin);Z.addPoint(xMin,yMax);Z.addPoint(xMax,yMin);Z.addPoint(xMax,yMax);Z.setSrs(aa);self.setClientReady(true);return Z}else{return false}}function J(am,an,al,ao){var al=al||-1;if(this.isClientReady()){for(var ag in this.map.controls){if(this.map.controls[ag].CLASS_NAME=="OpenLayers.Control.IAAA_ToolBar"){this.map.controls[ag].deactivateMeasureTools()}}getIndexWindow().setClientReady(false);extAux=this.map.getExtent();widthAux=extAux.getWidth();heightAux=extAux.getHeight();ratioExtent=widthAux/heightAux;defaultWidth_Geograficas=0.09;defaultHeight_Geograficas=0.09;distance=10000;defaultWidth_UTM=distance;defaultHeight_UTM=distance/ratioExtent;if(am.getBounds()){var aa=am.getBounds().getX();var ap=am.getBounds().getY();var ai=aa+am.getBounds().getWidth();var ac=ap+am.getBounds().getHeight();var ah=aa;var ab=ap;var ak=ai;var ae=ac;var ad=am.getBounds().getX();var Z=am.getBounds().getY();var aj=aa+am.getBounds().getWidth();var af=ap+am.getBounds().getHeight();if(am.getBounds().getWidth()==0){if((this.map.getProjection()=="EPSG:4326")||(this.map.getProjection()=="EPSG:4230")||(this.map.getProjection()=="EPSG:4258")){if(an){punto=coordTransform(an,this.map.getProjection(),aa,ap)}else{punto=coordTransform("EPSG:4230",this.map.getProjection(),aa,ap)}ah=punto[0];ah=ah-defaultWidth_Geograficas/2;ak=ah+defaultWidth_Geograficas}else{if(an){punto=coordTransform(an,this.map.getProjection(),aa,ap)}else{punto=coordTransform("EPSG:23030",this.map.getProjection(),aa,ap)}ah=punto[0];ah=ah-defaultWidth_UTM/2;ak=ah+defaultWidth_UTM}}else{if(an){xAux=am.getBounds().getX();yAux=am.getBounds().getY();punto=coordTransform(an,this.map.getProjection(),xAux,yAux);ah=punto[0];ab=punto[1];xAux2=am.getBounds().getX()+am.getBounds().getWidth();yAux2=am.getBounds().getY()+am.getBounds().getHeight();punto=coordTransform(an,this.map.getProjection(),xAux2,yAux2);ak=punto[0];ae=punto[1]}else{punto=coordTransform("EPSG:23030",this.map.getProjection(),aa,ap)}}if(am.getBounds().getHeight()==0){if((this.map.getProjection()=="EPSG:4326")||(this.map.getProjection()=="EPSG:4230")||(this.map.getProjection()=="EPSG:4258")){if(an){punto=coordTransform(an,this.map.getProjection(),aa,ap)}else{punto=coordTransform("EPSG:4230",this.map.getProjection(),aa,ap)}ab=punto[1];ab=ab-defaultHeight_Geograficas/2;ae=ab+defaultHeight_Geograficas}else{if(an){punto=coordTransform(an,this.map.getProjection(),aa,ap)}else{punto=coordTransform("EPSG:23030",this.map.getProjection(),aa,ap)}ab=punto[1];ab=ab-defaultHeight_UTM/2;ae=ab+defaultHeight_UTM}}auxExtent=this.map.getExtent();newExt=new OpenLayers.Bounds(ah,ab,ak,ae);if(al>=0){u(al)}if(ao==null||ao==true){this.map.zoomToExtent(newExt)}}getIndexWindow().setClientReady(true)}else{return false}}function u(ac){var ad=this.map.baseLayer.scales;if(ac>ad[0]){var ab=ad[0]}else{if(ac<ad[ad.length-1]){var ab=ad[ad.length-1]}else{var aa=false;var Z=0;while((Z<(ad.length-1))&&(!aa)){if((ac<ad[Z])&&(ac>ad[Z+1])){if(ac>((ad[Z])+ad[Z+1])/2){var ab=ad[Z]}else{var ab=ad[Z+1]}aa=true}Z++}}}if(ab!=undefined){this.map.setResAux(ab)}}function o(Z,ac,aa){var ab=new OpenLayers.LonLat(parseFloat(Z),parseFloat(ac));this.map.setCenter(ab,aa,false,false)}function A(Z,ab,ac,aa){return false}function D(aa,ac,af){for(var ae=0;ae<this.map.layers.length;ae++){if(getMap().layers[ae].url==aa){var Z=this.map.layers[ae];for(var ab=0;ab<Z.getLayerList().length;ab++){var ad=Z.getLayerList()[ab];if(ad.name==ac){if((af==ad.getStyleList()[ad.getStyleSelected()].getName())||!af){return[ad,ae,ab]}}}}}return null}function v(Z){if(Z<this.map.layers.length){return this.map.layers[Z].id}else{return null}}function S(aa,ae,ad){if(aa==null){return false}if(((aa=="Google Map")||(aa=="Google"))&&(ae==null)){var Z=new OpenLayers.Layer.IAAA_Google("Google Map",{type:G_NORMAL_MAP});this.map.addLayer(Z);return true}if((aa=="Google Satellite")&&(ae==null)){var Z=new OpenLayers.Layer.IAAA_Google("Google Satellite",{type:G_SATELLITE_MAP});this.map.addLayer(Z);return true}if((aa=="Google Hybrid")&&(ae==null)){var Z=new OpenLayers.Layer.IAAA_Google("Google Hybrid",{type:G_HYBRID_MAP});this.map.addLayer(Z);return true}if((aa=="Yahoo")&&(ae==null)){var ac=new OpenLayers.Layer.Yahoo("Yahoo");this.map.addLayer(ac);return true}if(ae!=null){if(ad==null){var ab=new OpenLayers.Layer.WMS(aa,ae)}else{var ab=new OpenLayers.Layer.WMS(aa,ae,{layers:ad})}this.map.addLayer(ab)}else{return false}}function C(){if(indexReference){if(indexReference.clientReady){return indexReference.clientReady}}return false}function Y(aa,ai,ah,Z,ac,ae,af){if(this.isClientReady()){if(doDisableClient){doDisableClient()}if(showLoadingWMSDiv){showLoadingWMSDiv()}Z=(Z==null)?true:Z;if(!Z){for(var ad in this.map.layers){if(this.map.layers[ad].url==aa){return false}}}ah=ah?ah:(addWMSDefaultVersion?addWMSDefaultVersion:"1.3.0");OpenLayers.IAAA_Utils.initAddElement(OpenLayers.IAAA_Utils.ADD_WMS_FACADE);var ab=af?"WMS-C":"WMS";var ak=OpenLayers.IAAA_Utils.setVersion(ah);var aj=aa;if(aj.indexOf("?")!=-1){if(aj.indexOf("?")==(aj.length-1)){aj=aj.substring(0,aj.length-1)}else{aj=replaceCad(aj,"?","&")}}var ag=OpenLayers.IAAA_Utils.relayServlet+"?URL="+aj+"&outputType=1";if(ah){ag+="&"+ak[0]+"="+ah}ag+="&REQUEST="+ak[1]+"&SERVICE="+ab;OpenLayers.IAAA_Utils.setParserProperties(aa,ai,ah,af,af,false,false,self);OpenLayers.IAAA_Utils.loadXML(ag)}else{return false}}function I(Z,ae,ad,ac,ab,aa){if(this.isClientReady()){OpenLayers.IAAA_Utils.initAddElement(OpenLayers.IAAA_Utils.ADD_WMS_FACADE);OpenLayers.IAAA_Utils.initAddWMSList(Z,ae,ad)}else{return false}}function R(af,au,at,Z,an,ap,ai,ak,ac,aa,al){var ah;for(var ao in this.map.layers){if((this.map.layers[ao].url==af)&&(this.map.layers[ao].name==au)){ah=this.map.layers[ao]}}if(ah==null){return}if(ah.CLASS_NAME=="OpenLayers.layer.IAAA_Server"){var ab=[];if((ai!=null)&&(ai.length>0)){for(var ao in ai){var au=((ak&&ak[ao])||ai[ao]);var ar=null;if(ac&&ac[ao]){ar=[];for(var am in ac[ao]){var aj=aa&&aa[ao]&&aa[ao][am];var ad=al&&al[ao]&&al[ao][am];ar.push({url:ac[ao][am],width:aj,height:aj})}}ab.push(new OpenLayers.IAAA_Style(ai[ao],null,au,ar))}}else{ab.push(new OpenLayers.IAAA_Style("default",null,"Default"))}var ae=new OpenLayers.IAAA_WMS(at,Z,ab,{queryable:an});ah.addLayer(ae);ae.setVisibility(ap)}else{if((!ah.params.LAYERS)||(ah.params.LAYERS=="")){ah.params.LAYERS=at;if((ai!=null)&&(ai.length>0)){ah.params.STYLES=ai[0]}}else{ah.params.LAYERS=ah.params.LAYERS+","+at;if((ai!=null)&&(ai.length>0)){var ag=ah.params.LAYERS.split(",");if(!ah.params.STYLES){var aq=new Array()}else{var aq=ah.params.STYLES.split(",")}for(var ao=aq.length;ao<(ag.length-1);ao++){if((!ah.params.STYLES)||(ah.params.STYLES=="")){ah.params.STYLES="default"}else{ah.params.STYLES=ah.params.STYLES+",default"}}ah.params.STYLES=ah.params.STYLES+","+ai[0]}}ah.setVisibility(ap||ah.getVisibility())}}function b(Z,ac,aa){var ab=new OpenLayers.Layer.IAAA_GML(Z,ac);this.map.addLayer(ab);ab.redraw()}function T(aj,am,ao,ac){var aa=(aj.srs)?aj.srs:"EPSG:23030";if((aj.x!=undefined)&&(aj.y!=undefined)){var al=aj.x;var ai=aj.y}else{if(aj.width&&aj.height){if(ac){var al=aj.getX()+(aj.getWidth()/2);var ai=aj.getY()+(aj.getHeight()/2)}else{var al=aj.getX()+(aj.getWidth()/2);var ai=aj.getY()+(aj.getHeight()/2);this.map.zoomToExtent(new OpenLayers.Bounds(aj.getX(),aj.getY(),aj.getX()+aj.getWidth(),aj.getY()+aj.getHeight()));ac=this.map.getScale()}}else{return false}}for(var af in this.map.layers){if((this.map.layers[af].CLASS_NAME=="OpenLayers.Layer.Markers")||(this.map.layers[af].CLASS_NAME=="OpenLayers.Layer.IAAA_Markers")){this.map.layers[af].clearMarkers();if((this.map.getProjection()==aa)&&(this.map.baseLayer.CLASS_NAME!="OpenLayers.Layer.Google")&&(this.map.baseLayer.CLASS_NAME!="OpenLayers.Layer.IAAA_Google")){var ab=al;var Z=ai}else{if((this.map.baseLayer.CLASS_NAME!="OpenLayers.Layer.Google")&&(this.map.baseLayer.CLASS_NAME!="OpenLayers.Layer.IAAA_Google")){var ag=coordTransform(aa,this.map.getProjection(),al,ai);var ab=ag[0];var Z=ag[1]}else{var ah=coordTransform(aa,"EPSG:900913",al,ai);var ab=ah[0];var Z=ah[1]}}var ae=this._getMarkerPoint(ab,Z,am,ao,null,null,null,this.map.layers[af]);this.map.layers[af].addMarker(ae);var an=new Array();for(var ad in this.map.layers){if(this.map.layers[ad].CLASS_NAME=="OpenLayers.Layer.IAAA_IconsWMS"){an.push(this.map.layers[ad].getVisibility());this.map.layers[ad].setVisibility(false)}}this.map.setCenter(new OpenLayers.LonLat(ab,Z));if(ac){this.map.zoomToScale(ac)}var ak=0;for(var ad in this.map.layers){if(this.map.layers[ad].CLASS_NAME=="OpenLayers.Layer.IAAA_IconsWMS"){this.map.layers[ad].setVisibility(an[ak]);ak++}}return}}}function X(ab,Z,al,am,ac,ae,ad,ak){var ai=new OpenLayers.LonLat(ab,Z);var ah=new OpenLayers.Marker.IAAA_Marker(ai,new OpenLayers.Icon(this.markerImageUrl,new OpenLayers.Size((this.markerImageWidth||10),(this.markerImageHeight||10))),{name:ac});if(ae){ah.id=ae}if(ad){ah.url=ad}if(al){if(navigator.userAgent.indexOf("MSIE 6.0")>=0){var ag=new OpenLayers.Marker(new OpenLayers.LonLat(ab,Z),new OpenLayers.Icon(null,null,new OpenLayers.Pixel(-50,-10)));var aa=OpenLayers.Util.createDiv("et",new OpenLayers.Pixel(0,0),new OpenLayers.Size("100%",20),null,"relative");aa.style.display="block";aa.innerHTML='<table width="100px"><tr><td><TEXT><CENTER><font style="font: bold 8pt arial; color: '+this.wmsClientMarkerLabelsColor+'">'+al+"</Font></CENTER></TEXT></td></tr></table>";ag.icon.imageDiv.style.display="none";ag.icon.imageDiv.appendChild(aa);ak.addMarker(ag)}else{var ag=new OpenLayers.Marker(new OpenLayers.LonLat(ab,Z),new OpenLayers.Icon(null));var aa=OpenLayers.Util.createDiv("et",new OpenLayers.Pixel(0,0),new OpenLayers.Size("100%",20),null,"relative");aa.style.left="-40px";aa.style.visibility="visible";aa.innerHTML='<table width="100px"><tr><td><TEXT><CENTER><font style="font: bold 8pt arial; color: '+this.wmsClientMarkerLabelsColor+'">'+al+"</Font></CENTER></TEXT></td></tr></table>";ag.icon.imageDiv.style.visibility="hidden";ag.icon.imageDiv.appendChild(aa);ak.addMarker(ag)}}if(am){function af(ax){document.getElementById("map").style.cursor="pointer";if(!this.reactivateZoomBox){for(var ar in this.map.controls){if(((this.map.controls[ar].CLASS_NAME=="OpenLayers.Control.ZoomBox")||(this.map.controls[ar].CLASS_NAME=="OpenLayers.Control.IAAA_ZoomBox")||(this.map.controls[ar].CLASS_NAME=="OpenLayers.Control.ZoomIn")||(this.map.controls[ar].CLASS_NAME=="OpenLayers.Control.IAAA_ZoomOut"))&&(this.map.controls[ar].active)&&(!((this.map.controls[ar].handler)&&(this.map.controls[ar].handler.zoomBox)))){this.reactivateZoomBox=true;this.controlIndexAux=ar;this.map.controls[ar].deactivate()}}}while(this.map.popups.length>0){this.map.removePopup(this.map.popups[this.map.popups.length-1])}var aq='<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>';aq+='<div class="olLayerGeoRSSDescription" align="center" style="height:auto; top:50px">';aq+='<font face="Arial" size="1">'+this.description+"</font>";aq+="</div>";var ap=this.description?this.description:"marker";var aw=this.map.getPixelFromLonLat(this.lonlat);var ay=new OpenLayers.Pixel(aw.x+15,aw.y+15);var au=this.map.getLonLatFromPixel(ay);var av=this.markerImageWidth?this.markerImageWidth:10;var an=this.markerImageHeight?this.markerImageHeight:10;var at={size:new OpenLayers.Size(av+2,an),offset:new OpenLayers.Pixel(-8-this.markerImageWidth,-(this.markerImageHeight))};var ao=new OpenLayers.Popup.IAAA_Anchored(ap+"_popup",au,new OpenLayers.IAAA_Size(120,0),aq,at);ao.setBackgroundColor(this.markerPopupBgColor);ao.setSize(new OpenLayers.IAAA_Size(120,"auto"));ao.setOpacity(1);this.map.addPopup(ao);ao.div.style.border="2px solid black"}function aj(an){document.getElementById("map").style.cursor="crossHair";if(this.reactivateZoomBox){this.map.controls[this.controlIndexAux].activate();this.reactivateZoomBox=false}while(this.map.popups.length>0){this.map.removePopup(this.map.popups[this.map.popups.length-1])}OpenLayers.Event.stop(an)}ah.description=am;ah.reactivateZoomBox=false;ah.controlIndexAux=-1;ah.markerImageWidth=this.markerImageWidth;ah.markerImageHeight=this.markerImageHeight;ah.markerPopupBgColor=this.markerPopupBgColor;ah.events.registerPriority("mousemove",ah,af);ah.events.registerPriority("mouseout",ah,aj)}return ah}function r(ae,Z){for(var ad in this.map.layers){if(this.map.layers[ad].CLASS_NAME=="OpenLayers.Layer.IAAA_TooltipMarkers"){this.map.layers[ad].removeAllSubcategories()}else{if(((this.map.layers[ad].CLASS_NAME=="OpenLayers.Layer.WMS")||(this.map.layers[ad].CLASS_NAME=="OpenLayers.Layer.IAAA_WMS")||(this.map.layers[ad].CLASS_NAME=="OpenLayers.Layer.IAAA_IconsWMS"))&&(this.map.layers[ad].tooltipMarkerAux)){this.map.layers[ad].params.LAYERS="";this.map.layers[ad].setVisibility(false)}}}for(var ac in Z){var ab=Z[ac];for(var ad in this.map.layers){if(this.map.layers[ad].CLASS_NAME=="OpenLayers.Layer.IAAA_TooltipMarkers"){while(this.map.popups.length>0){this.map.removePopup(this.map.popups[this.map.popups.length-1])}this.map.layers[ad].addSubcategory(categoryFeatureNameList[ae][ab])}else{if(((this.map.layers[ad].CLASS_NAME=="OpenLayers.Layer.WMS")||(this.map.layers[ad].CLASS_NAME=="OpenLayers.Layer.IAAA_WMS")||(this.map.layers[ad].CLASS_NAME=="OpenLayers.Layer.IAAA_IconsWMS"))&&(this.map.layers[ad].tooltipMarkerAux)){this.map.layers[ad].addLayerInFirstPlace(categoryNameList[ae][ab],categoryStyleList[ae][ab])}}}}var aa=(Z.length>0);for(var ad in this.map.layers){if(this.map.layers[ad].CLASS_NAME=="OpenLayers.Layer.IAAA_TooltipMarkers"){this.map.layers[ad].loadGML()}else{if(((this.map.layers[ad].CLASS_NAME=="OpenLayers.Layer.WMS")||(this.map.layers[ad].CLASS_NAME=="OpenLayers.Layer.IAAA_WMS")||(this.map.layers[ad].CLASS_NAME=="OpenLayers.Layer.IAAA_IconsWMS"))&&(this.map.layers[ad].tooltipMarkerAux)){this.map.layers[ad].setVisibility(aa);if(!aa){this.map.layers[ad].clearTiles()}}}}}function l(ac,af,ae,ab){if((ac.x!=undefined)&&(ac.y!=undefined)){T(ac,af,ae,ab)}else{var ad=new OpenLayers.Bounds(ac.xpoints[0],ac.ypoints[0],ac.xpoints[2],ac.ypoints[1]);var aa=((-1)*(ad.getWidth()/this.map.getSize().w)+(ad.getHeight()/this.map.getSize().h))/2;var Z=new Point(ad.getCenterLonLat().lon,ad.getCenterLonLat().lat);Z.srs=ac.srs;this.addMarker(Z,af,ae,aa)}}function m(ab,aa){var Z=ab*20037508.34/180;var ac=Math.log(Math.tan((90+aa)*Math.PI/360))/(Math.PI/180);ac=ac*20037508.34/180;return new OpenLayers.LonLat(Z,ac)}function B(ab,aa,Z,ac){if(ac){var ad=new OpenLayers.Layer.IAAA_WFS(ab,aa,{typename:Z,visibility:true},{featureClass:OpenLayers.Feature.WFS})}else{var ad=new OpenLayers.Layer.IAAA_WFS(ab,aa,{typename:Z,visibility:true})}this.map.addLayer(ad);if(getTree()){getTree().addNode("WMS",[this.map.layers.length-1])}}function F(ac,ab,ah,af,ae,aj,aa){if(this.isClientReady()){self.setClientReady(false);if(doDisableClient){doDisableClient()}var ak=af||"";var ai=this.map.layers.length-1;var Z=null;while((!Z)&&(ai>=0)){if(this.map.layers[ai].CLASS_NAME=="OpenLayers.Layer.IAAA_Markers"){Z=this.map.layers[ai]}else{ai--}}if(!Z){var Z=new OpenLayers.Layer.IAAA_Markers(this.titleSearchLayer);this.map.addLayer(Z)}if(ah!=U.getProjection()){var ag=coordTransform(ah,U.getProjection(),ac,ab);ac=ag[0];ab=ag[1]}var ad=this._getMarkerPoint(ac,ab,ae,ae,ak,aj,aa);Z.addMarker(ad);if(indexReference.getTree&&indexReference.getTree()){indexReference.getTree().addNode("MAP_MARKERS",[this.map.layers.length-1])}if(doEnableClient){doEnableClient()}self.setClientReady(true)}}function H(ar,ap,ad,ak,al,aq,am){var ag=am||false;ar=decodeURI(ar);if(ap.length==ad.length&&ad.length==ak.length&&ak.length==al.length&&this.isClientReady()){self.setClientReady(false);if(doDisableClient){doDisableClient()}var an=this.map.layers.length-1;var af=false;while((!af)&&(an>=0)){if(((this.map.layers[an].CLASS_NAME=="OpenLayers.Layer.Markers")||(this.map.layers[an].CLASS_NAME=="OpenLayers.Layer.IAAA_Markers"))&&(this.titleSearchLayer==this.map.layers[an].name)){af=true}else{an--}}if(an>=0){var ai=this.map.layers[an]}else{var ai=new OpenLayers.Layer.IAAA_Markers(this.titleSearchLayer);this.map.addLayer(ai)}for(var ao=0;ao<ap.length;ao++){var Z=coordTransform(ak[ao],this.map.getProjection(),ap[ao],ad[ao]);var ah=new OpenLayers.LonLat(Z[0],Z[1]);var ae=new OpenLayers.Marker.IAAA_Marker(ah,new OpenLayers.Icon(this.markerImageUrl,new OpenLayers.Size((this.markerImageWidth||10),(this.markerImageHeight||10))));ae.id=decodeURI(al[ao])+"_"+ai.markers.length;if(aq&&aq[ao]){var aj=document.createElement("DIV");aj.innerHTML='<table width="100px"><tr><td><text><center><font style="font: bold 8pt arial;">'+aq[ao]+"</font></font></center></text></td></tr></table>";aj.style.position="relative";aj.style.left="-43px";ae.icon.imageDiv.appendChild(aj);ae.icon.imageDiv.firstChild.style.cursor="pointer";ae.name=decodeURI(aq[ao]);function ac(au){if(!this.name){return}while(this.map.popups.length>0){this.map.removePopup(this.map.popups[this.map.popups.length-1])}var ay='<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>';ay+='<div class="olLayerGeoRSSDescription" align="center" style="height:auto; top:50px;">';ay+='<font face="Arial" size="1">'+this.name+"</font>";ay+="</div>";var aw=this.description?this.description:"marker";var aA=this.map.getPixelFromLonLat(this.lonlat);var ax=new OpenLayers.Pixel(aA.x+15,aA.y+15);var az=this.map.getLonLatFromPixel(ax);var av={size:new OpenLayers.Size(10,10),offset:new OpenLayers.Pixel(-10,-40)};var at=new OpenLayers.Popup.IAAA_Anchored(aw+"_popup",az,new OpenLayers.IAAA_Size(120,0),ay,av);at.setBackgroundColor("cornsilk");at.setSize(new OpenLayers.IAAA_Size(120,"auto"));at.setOpacity(1);this.map.addPopup(at);at.div.style.border="2px solid black";at.contentDiv.style.padding="0pt"}function ab(at){if(!this.name){return}while(this.map.popups.length>0){this.map.removePopup(this.map.popups[this.map.popups.length-1])}OpenLayers.Event.stop(at)}ae.events.registerPriority("mousemove",ae,ac);ae.events.registerPriority("mouseout",ae,ab)}ai.addMarker(ae);var aa;if(an<0){aa=this.map.layers.length-1}else{aa=an}if(indexReference&&indexReference.getTree&&indexReference.getTree()){indexReference.getTree().addNode("MAP_MARKER",[aa,ai.markers.length-1])}}if(ag){for(var ao in this.map.layers){this.map.layers[ao].redraw()}}if(doEnableClient){doEnableClient()}self.setClientReady(true)}}function c(ae,ad,ab){if(this.isClientReady()){self.setClientReady(false);doDisableClient();for(var aa=0;aa<this.map.layers.length;aa++){var ac=this.map.layers[aa];if((ac.name==ae)&&((ac.CLASS_NAME=="OpenLayers.Layer.Markers")||(ac.CLASS_NAME=="OpenLayers.Layer.IAAA_Markers"))){for(var aa=0;aa<ac.markers.length;aa++){var Z=ac.markers[aa];var af=Z.id;if((ac.CLASS_NAME=="OpenLayers.Layer.IAAA_Markers")&&(af.lastIndexOf("_")>=0)){af=af.substring(0,af.lastIndexOf("_"))}if(af==ad){if(pointImageUrl[ab]){Z.icon.setUrl(pointImageUrl[ab])}else{Z.icon.setUrl(pointImageUrl["default"])}}else{Z.icon.setUrl(pointImageUrl["default"])}}}else{if((ac.CLASS_NAME=="OpenLayers.Layer.Markers")||(ac.CLASS_NAME=="OpenLayers.Layer.IAAA_Markers")){for(var aa=0;aa<ac.markers.length;aa++){var Z=ac.markers[aa];Z.icon.setUrl(pointImageUrl["default"])}}}}self.setClientReady(true);doEnableClient()}else{return false}}function K(ac){if(this.markers.markers[0]){var ab=this.markers.markers[0].lonlat;this.map.events.triggerEvent("iaaa_waitingserver");var Z=a(ac,ab);var aa=new OpenLayers.IAAA_Request.IAAA_WFSRequest("http://barrasona.cps.unizar.es/Incidencias-OWS/ogcwebservice",servlet,"POST",{outputType:"1",REQUEST:Z});aa.doRequest();aa.events.register("loaddata",aa,E);aa.events.register("faildata",aa,G);this.map.events.triggerEvent("iaaa_finishCommunication")}else{alert("PRIMERO DEBES PINTAR UN PUNTO!!!!!!")}}function E(){alert("EXITO!!!!!!!: "+this.response)}function V(){var ae=new OpenLayers.Format.GML();var ac=ae.read(this.response);for(var aj in ac){var ah=ac[aj].geometry;var ab=ac[aj].attributes.id;var ai=ac[aj].attributes.tipo;var ad=ac[aj].attributes.titulo?ac[aj].attributes.titulo:"";var aa=ac[aj].attributes.observaciones?ac[aj].attributes.observaciones:"";var ag=ac[aj].attributes.link?ac[aj].attributes.link:"";if(ag&&!OpenLayers.IAAA_Utils.isURLProtocolValue(ag)){ag="http://"+ag}if(!thematicNames[ai]){alert("No se reconoce el tipo de la incidencia "+ac[aj].attributes.id+". Se le aplica el tipo por defecto.");ai=0}var af={name:ad,description:aa,category:thematicNames[ai],url:ag};var Z=new OpenLayers.Feature.IAAA_Vector(ac[aj].geometry);Z.data=af;alert("leida geometria:"+Z.geometry+"\n con data:"+Z.data.category);getVectorLayer().addFeatures([Z]);if(Z.geometry.CLASS_NAME=="OpenLayers.Geometry.Point"){alert(" getVectorLayer().name:"+getVectorLayer().name+"\n thematicIcons:"+thematicIcons+"\n thematicWidth:"+thematicWidth);getVectorLayer().defineIconStyle(Z,thematicIcons[Z.data.category],new OpenLayers.Size(thematicWidth[Z.data.category],thematicHeight[Z.data.category]))}}}function G(){alert("FALLO!!!!!!!: "+this.response)}function a(aa,Z){return'<?xml version="1.0"?><wfs:Transaction version="1.1.0" service="WFS"	xmlns:gml="http://www.opengis.net/gml" xmlns:ogc="http://www.opengis.net/ogc"	xmlns:wfs="http://www.opengis.net/wfs" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"	xsi:schemaLocation="http://www.opengis.net/wfs/1.0.0/WFS-transaction.xsd"	xmlns:inc="http://idezar.zaragoza.es/wfs"><wfs:Update handle="UPDATE1" typeName="inc:Incidencia">		<wfs:Property>		<wfs:Name>inc:geometria</wfs:Name>			<wfs:Value>				<gml:Point srsName="EPSG:23030">					<gml:coordinates cs="," decimal="." ts=" ">						'+Z.lon+","+Z.lat+"</gml:coordinates>				</gml:Point>			</wfs:Value>		</wfs:Property>		<ogc:Filter>			<ogc:PropertyIsEqualTo>				<ogc:PropertyName>inc:id</ogc:PropertyName>				<ogc:Literal>"+aa+"</ogc:Literal>			</ogc:PropertyIsEqualTo>		</ogc:Filter>	</wfs:Update></wfs:Transaction>"}function q(aa){var ab='<?xml version="1.0" encoding="iso-8859-1"?><wfs:GetFeature version="1.1.0" outputFormat="text/xml; subtype=gml/3.1.1"	xmlns:wfs="http://www.opengis.net/wfs" xmlns:gml="http://www.opengis.net/gml"	xmlns:ogc="http://www.opengis.net/ogc">	<!-- devuelve los datos de la incidencia dado su identificador  -->	<wfs:Query xmlns:inc="http://idezar.zaragoza.es/wfs"		typeName="inc:Incidencia" srsName="EPSG:23030">		<ogc:Filter>';if(aa.length==1){ab=ab+"			<ogc:PropertyIsEqualTo>				<ogc:PropertyName>inc:id</ogc:PropertyName>				<ogc:Literal>"+aa[0]+"</ogc:Literal>			</ogc:PropertyIsEqualTo>"}else{if(aa.length>1){ab=ab+"<ogc:Or>";for(var Z in aa){ab=ab+"			<ogc:PropertyIsEqualTo>				<ogc:PropertyName>inc:id</ogc:PropertyName>				<ogc:Literal>"+aa[Z]+"</ogc:Literal>			</ogc:PropertyIsEqualTo>"}ab=ab+"</ogc:Or>"}}ab=ab+"		</ogc:Filter>	</wfs:Query></wfs:GetFeature>";return ab}function g(ab){this.map.events.triggerEvent("iaaa_waitingserver");var Z=q(OpenLayers.IAAA_Utils.deleteNoIntegerElements(ab));var aa=new OpenLayers.IAAA_Request.IAAA_WFSRequest("http://barrasona.cps.unizar.es/Incidencias-OWS/ogcwebservice",servlet,"POST",{outputType:"1",REQUEST:Z});aa.doRequest();aa.events.register("loaddata",aa,V);aa.events.register("faildata",aa,G);this.map.events.triggerEvent("iaaa_finishCommunication")}function K(ac){if(this.markers.markers[0]){var ab=this.markers.markers[0].lonlat;this.map.events.triggerEvent("iaaa_waitingserver");var Z=a(ac,ab);var aa=new OpenLayers.IAAA_Request.IAAA_WFSRequest("http://barrasona.cps.unizar.es/Incidencias-OWS/ogcwebservice",servlet,"POST",{outputType:"1",REQUEST:Z});aa.doRequest();aa.events.register("loaddata",aa,E);aa.events.register("faildata",aa,G);this.map.events.triggerEvent("iaaa_finishCommunication")}else{alert("PRIMERO DEBES PINTAR UN PUNTO!!!!!!")}}function E(){alert("EXITO!!!!!!!: "+this.response)}function V(){var ae=new OpenLayers.Format.GML();var ac=ae.read(this.response);for(var aj in ac){var ah=ac[aj].geometry;var ab=ac[aj].attributes.id;var ai=ac[aj].attributes.tipo;var ad=ac[aj].attributes.titulo?ac[aj].attributes.titulo:"";var aa=ac[aj].attributes.observaciones?ac[aj].attributes.observaciones:"";var ag=ac[aj].attributes.link?ac[aj].attributes.link:"";if(ag&&!OpenLayers.IAAA_Utils.isURLProtocolValue(ag)){ag="http://"+ag}if(!thematicNames[ai]){alert("No se reconoce el tipo de la incidencia "+ac[aj].attributes.id+". Se le aplica el tipo por defecto.");ai=0}var af={name:ad,description:aa,category:thematicNames[ai],url:ag};var Z=new OpenLayers.Feature.IAAA_Vector(ac[aj].geometry);Z.data=af;alert("leida geometria:"+Z.geometry+"\n con data:"+Z.data.category);getVectorLayer().addFeatures([Z]);if(Z.geometry.CLASS_NAME=="OpenLayers.Geometry.Point"){alert(" getVectorLayer().name:"+getVectorLayer().name+"\n thematicIcons:"+thematicIcons+"\n thematicWidth:"+thematicWidth);getVectorLayer().defineIconStyle(Z,thematicIcons[Z.data.category],new OpenLayers.Size(thematicWidth[Z.data.category],thematicHeight[Z.data.category]))}}}function G(){alert("FALLO!!!!!!!: "+this.response)}function a(aa,Z){return'<?xml version="1.0"?><wfs:Transaction version="1.1.0" service="WFS"	xmlns:gml="http://www.opengis.net/gml" xmlns:ogc="http://www.opengis.net/ogc"	xmlns:wfs="http://www.opengis.net/wfs" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"	xsi:schemaLocation="http://www.opengis.net/wfs/1.0.0/WFS-transaction.xsd"	xmlns:inc="http://idezar.zaragoza.es/wfs"><wfs:Update handle="UPDATE1" typeName="inc:Incidencia">		<wfs:Property>		<wfs:Name>inc:geometria</wfs:Name>			<wfs:Value>				<gml:Point srsName="EPSG:23030">					<gml:coordinates cs="," decimal="." ts=" ">						'+Z.lon+","+Z.lat+"</gml:coordinates>				</gml:Point>			</wfs:Value>		</wfs:Property>		<ogc:Filter>			<ogc:PropertyIsEqualTo>				<ogc:PropertyName>inc:id</ogc:PropertyName>				<ogc:Literal>"+aa+"</ogc:Literal>			</ogc:PropertyIsEqualTo>		</ogc:Filter>	</wfs:Update></wfs:Transaction>"}function q(aa){var ab='<?xml version="1.0" encoding="iso-8859-1"?><wfs:GetFeature version="1.1.0" outputFormat="text/xml; subtype=gml/3.1.1"	xmlns:wfs="http://www.opengis.net/wfs" xmlns:gml="http://www.opengis.net/gml"	xmlns:ogc="http://www.opengis.net/ogc">	<!-- devuelve los datos de la incidencia dado su identificador  -->	<wfs:Query xmlns:inc="http://idezar.zaragoza.es/wfs"		typeName="inc:Incidencia" srsName="EPSG:23030">		<ogc:Filter>';if(aa.length==1){ab=ab+"			<ogc:PropertyIsEqualTo>				<ogc:PropertyName>inc:id</ogc:PropertyName>				<ogc:Literal>"+aa[0]+"</ogc:Literal>			</ogc:PropertyIsEqualTo>"}else{if(aa.length>1){ab=ab+"<ogc:Or>";for(var Z in aa){ab=ab+"			<ogc:PropertyIsEqualTo>				<ogc:PropertyName>inc:id</ogc:PropertyName>				<ogc:Literal>"+aa[Z]+"</ogc:Literal>			</ogc:PropertyIsEqualTo>"}ab=ab+"</ogc:Or>"}}ab=ab+"		</ogc:Filter>	</wfs:Query></wfs:GetFeature>";return ab}function g(ab){this.map.events.triggerEvent("iaaa_waitingserver");var Z=q(OpenLayers.IAAA_Utils.deleteNoIntegerElements(ab));var aa=new OpenLayers.IAAA_Request.IAAA_WFSRequest("http://barrasona.cps.unizar.es/Incidencias-OWS/ogcwebservice",servlet,"POST",{outputType:"1",REQUEST:Z});aa.doRequest();aa.events.register("loaddata",aa,V);aa.events.register("faildata",aa,G);this.map.events.triggerEvent("iaaa_finishCommunication")}function Q(ab){for(var aa in ab){if(ab[aa].geometria.getClass()==0){var Z=p(ab[aa]);this.markers.addMarker(Z);Z.refreshIcon(thematicIcons[Z.data.category],new OpenLayers.Size(thematicWidth[Z.data.category],thematicHeight[Z.data.category]));Z.refreshPopup();Z.registerEventsBehavior()}}}function p(ac){var Z=null;var ab=new OpenLayers.LonLat(ac.getGeometria().getX(),ac.getGeometria().getY());if(!thematicNames[ac.tipo]){alert("No se reconoce el tipo de la incidencia "+ac.id+". Se le aplica el tipo por defecto.");ac.tipo=0}var aa={name:(ac.titulo?ac.titulo:""),category:(ac.tipo?thematicNames[ac.tipo]:thematicNames[0]),description:(ac.observaciones?ac.observaciones:""),url:(ac.link?ac.link:"")};if(aa.url&&!OpenLayers.IAAA_Utils.isURLProtocolValue(aa.url)){aa.url="http://"+aa.url}Z=new OpenLayers.Marker.IAAA_MarkerForm(ab,null,true,aa);Z.id=ac.id;return Z}function M(ac,ah,ad,Z,ab,aa){var ag=window;while(ag.parent&&(ag!=ag.parent)){ag=ag.parent}var ai=ag.document;var af=ag.dojo;af.require("dojo.widget.*");af.require("dojo.widget.ContentPane");af.require("dojo.widget.FloatingPane");af.require("dojo.widget.ResizeHandle");var ae={hasShadow:true,displayMinimizeAction:false,displayMaximizeAction:false,displayCloseAction:true,href:ac,title:ah,executeScripts:true,constrainToContainer:true,style:"z-index:80",titleHeight:"15",id:"facadeDojoWindow"+(new Date()).getTime()};node=ai.createElement("div");node.style.width=ad+"px";node.style.height=Z+"px";node.style.left=(ab!=null)?ab:"5px";node.style.top=(aa!=null)?aa:"5px";ai.body.appendChild(node);dojoWindow=af.widget.createWidget("FloatingPane",ae,node);dojoWindow.resizeTo(ad,Z);dojoWindow.domNode.style.backgroundColor="#FFFFFF";dojoWindow.containerNode.style.backgroundColor="#FFFFFF";return dojoWindow}function f(ab,Z,ac,aa,af,ae,ad){if(indexReference){if(indexReference.serviceInfoWindow){indexReference.serviceInfoWindow.close()}else{if(indexReference.parent&&indexReference.parent.serviceInfoWindow){indexReference.parent.serviceInfoWindow.close()}}}mapReference.OpenLayers.IAAA_Utils.urlWMS=ab;mapReference.OpenLayers.IAAA_Utils.nameWMS=Z;mapReference.OpenLayers.IAAA_Utils.isWMSC=ac;mapReference.OpenLayers.IAAA_Utils.addElementWindow=mapReference.window.open(this.wmsInfoWindowPath,"","left="+ae+",top="+ad+",width="+aa+", height="+af+", scrollbars=yes, resizable=no")}}function Unit(c){this.unit=c;this.canConvert=a;this.equals=b;function a(){return true}function b(f){return(f.unit==this.unit)}}function Unit_metre(){return new Unit("m")}function Unit_degree(){return new Unit("°")}function WGS84ConversionInfo(){this.dx=-1;this.dy=-1;this.dz=-1;this.ex=-1;this.ey=-1;this.ez=-1;this.ppm=-1;this.areaOfUse="";this.equals=a;function a(b){if((this.dx==b.dx)&&(this.dy==b.dy)&&(this.dz==b.dz)&&(this.ex==b.ex)&&(this.ey==b.ey)&&(this.ez==b.ez)&&(this.ppm==b.ppm)&&(this.areaOfUse==b.areaOfUse)){return true}return false}}function Info(b){this.name=b;this.getName=f();this.ensureAngularUnit=a;this.ensureLinearUnit=c;function f(){return this.name}function c(g){if(!new Unit_metre().canConvert(g)){alert("Error: Unit::ensureLinearUnit")}}function a(g){if(!new Unit_degree.canConvert(g)){alert("Error: Unit::ensureAngularUnit")}}}function Ellipsoid(a,q,m,c,k,p){this._super=Info;this._super(a);this.unit=p;this.semiMajorAxis=b("semiMajorAxis",q);this.semiMinorAxis=b("semiMinorAxis",m);this.inverseFlattening=b("inverseFlattening",c);this.ivfDefinitive=k;this.check=b;this.equals=f;this.ensureLinearUnit(p);this.getSemiMinorAxis=l;this.getSemiMajorAxis=o;function l(){return this.semiMinorAxis}function o(){return this.semiMajorAxis}this.createEllipsoid=g;function b(r,u){if(u>0){return u}alert("Error Ellipsoid::check: "+r)}function g(u,v,r,A){if(v==r){return new Spheroid(u,v,false,A)}else{return new Ellipsoid(u,v,r,v/(v-r),false,A)}}function f(r){if(this.semiMajorAxis==r.semiMajorAxis){if(this.semiMinorAxis==r.semiMinorAxis){if(this.inverseFlattening==r.inverseFlattening){return true}}}return false}}Ellipsoid.prototype=Info;function Ellipsoid_FlattenedSphere(b,c,a,f){if(!isFinite(a)){return new Spheroid(b,c,true,f)}else{return new Ellipsoid(b,c,c*(1-1/a),a,true,f)}}function Spheroid(c,a,b,f){this._super=Ellipsoid;this._super(c,this.check("radius",a),a,Infinity,b,f)}Spheroid.prototype=Ellipsoid;function Ellipsoid_WGS84(){return new Ellipsoid_FlattenedSphere("WGS84",6378137,298.257223563,new Unit_metre())}function DatumType(a,c,b){this.name=a;this.value=c;this.key=b}function DatumType_classic(){return new DatumType("CLASSIC",1001,5)}function DatumType_geocentric(){return new DatumType("GEOCENTRIC",1002,15)}function Datum(b,c){this._super=Info;this._super(b);this.datumType=c;this.getDatumType=a;function a(){return this.datumType}}Datum.prototype=Info;function HorizontalDatum(a,c,k,g){this._super=Datum;this._super(a,c);this.ellipsoid=k;this.parameters=g;this.equals=f;this.getEllipsoid=b;this.equals=f;function b(){return this.ellipsoid}function f(l){if(this.getEllipsoid().equals(l.getEllipsoid())){if(this.parameters.equals(l.parameters)){return true}}return false}}HorizontalDatum.prototype=Datum;function Projection(a,m,b,f,q,C,g,p,u){this._super=Info;this._super(a);this.classification=m||"";this.falseNorthing=q;this.falseEasting=C;this.centralMeridian=g;this.centralLatitude=p;this.semiMinor=b;this.semiMajor=f;this.scaleFactor=u;this.getFalseNorthing=l;this.getFalseEasting=k;this.getCentralMeridian=c;this.getCentralLatitude=o;this.getSemiMinor=r;this.getSemiMajor=B;this.getScaleFactor=A;this.getClass=v;function l(){return this.falseNorthing}function k(){return this.falseEasting}function c(){return this.centralMeridian}function o(){return this.centralLatitude}function r(){return this.semiMinor}function B(){return this.semiMajor}function A(){return this.scaleFactor}function v(){return this.classification}}Projection.prototype=Info;function Point2D_Double(a,g){this.x=a||0;this.y=g||0;this.getX=c;this.getY=b;this.setLocation=f;function c(){return this.x}function b(){return this.y}function f(l,k){this.x=l;this.y=k}}function CoordinatePoint(c){this.ord=new Array(c);this.getOrd=a;this.setLocation=b;function a(){return this.getOrd}function b(f,g){this.ord[0]=f;this.ord[1]=g}}function MapProjection(a){this.semiMajor=a.getSemiMajor();this.semiMinor=a.getSemiMinor();this.centralMeridian=degrees2radians(a.getCentralMeridian());this.centralLatitude=degrees2radians(a.getCentralLatitude());this.scaleFactor=a.getScaleFactor();this.falseEasting=a.getFalseEasting();this.falseNorthing=a.getFalseNorthing();this.isSpherical=(this.semiMajor==this.semiMinor);this.es=1-(this.semiMinor*this.semiMinor)/(this.semiMajor*this.semiMajor);this.e=Math.sqrt(this.es);this.MAX_ERROR=1;this.EPS=0.000001;this.TOL=1e-10;this.transform=b;this.inverseTransform=g;this.transform2ptos=f;this.inverseTransform2ptos=c;function b(u,l,o,p,r,q){var m;var k;m=(u==o&&l<p&&l+(r<<1)>p);if(m){l+=2*r;p+=2*r}k=new Point2D_Double();while(--r>=0){k.x=u[l++];k.y=u[l++];this.transform2ptos(k,k,q);o[p++]=k.x;o[p++]=k.y;if(m){l-=4;p-=4}}}function g(u,l,o,p,r,q){var m;var k;m=(u==o&&l<p&&l+(r<<1)>p);if(m){l+=2*r;p+=2*r}var k=new Point2D_Double();while(--r>=0){k.x=u[l++];k.y=u[l++];this.inverseTransform2ptos(k,k,q);o[p++]=k.x;o[p++]=k.y;if(m){l-=4;p-=4}}}function f(p,l,m){var k;var o;k=p.getX();o=p.getY();if(m=="UTM"){l=this.transformUTM(degrees2radians(k),degrees2radians(o),l)}else{if(m=="LAMBERT"){l=this.transformLambert(degrees2radians(k),degrees2radians(o),l)}else{}}return l}function c(r,l,o){var k;var q;var m;var p;m=r.getX();p=l.getY();if(o=="UTM"){l=this.inverseTransformUTM(m,p,l)}else{if(o=="LAMBERT"){l=this.inverseTransformLambert(m,p,l)}else{}}k=radians2degrees(l.getX());q=radians2degrees(l.getY());l.setLocation(k,q);return l}}function TransverseMercatorProjection(O){this._super=MapProjection;this._super(O);var G=1;var F=0.5;var E=0.16666666666666666;var D=0.08333333333333333;var C=0.05;var A=0.03333333333333333;var u=0.023809523809523808;var q=0.017857142857142856;var v=1;var p=0.25;var o=0.046875;var k=0.01953125;var f=0.01068115234375;var a=0.75;var J=0.46875;var I=0.013020833333333334;var H=0.007120768229166667;var m=0.3645833333333333;var g=0.005696614583333333;var M=0.3076171875;var c=1e-10;var b=1e-11;this.ak0=this.semiMajor*this.scaleFactor;this.esp=(this.semiMajor*this.semiMajor)/(this.semiMinor*this.semiMinor)-1;this.en0=v-this.es*(p+this.es*(o+this.es*(k+this.es*f)));this.en1=this.es*(a-this.es*(o+this.es*(k+this.es*f)));this.en2=(t=this.es*this.es)*(J-this.es*(I+this.es*H));this.en3=(t*=this.es)*(m-this.es*g);this.en4=t*this.es*M;this.getZone=B;this.mlfn=r;this.transformUTM=l;this.inverseTransformUTM=K;function B(Q,R){zoneCount=Math.abs(360/R);t=Q-0.5*R;t=radians2degrees(centralMeridian)-t;t=Math.floor(t/R+this.EPS);t-=zoneCount*Math.floor(t/zoneCount);t_int=Math.floor(t);return(t_int)+1}function r(S,Q,R){R*=Q;Q*=Q;return this.en0*S-R*(this.en1+Q*(this.en2+Q*(this.en3+Q*(this.en4))))}function l(aa,X,Y){var aa;var X;var Q;var S;var Z;var V;var ab;var U;var T;var R;X-=this.centralLatitude;aa-=this.centralMeridian;Q=Math.sin(X);S=Math.cos(X);if(this.isSpherical){Z=S*Math.sin(aa);if(Math.abs(Math.abs(Z)-1)<=c){alert("ERROR: TransverseMercatorProjection::transform ERROR_VALUE_TEND_TOWARD_INFINITY")}V=S*Math.cos(aa)/Math.sqrt(1-Z*Z);aa=0.5*this.ak0*Math.log((1+Z)/(1-Z));if((Z=Math.abs(V))>=1){if((Z-1)>c){alert("ERROR: TransverseMercatorProjection::transform ERROR_VALUE_TEND_TOWARD_INFINITY 2")}else{V=0}}else{V=Math.acos(V)}if(X<0){V=-V}X=this.ak0*V}else{ab=Math.abs(S)>c?Q/S:0;ab*=ab;U=S*aa;T=U*U;U/=Math.sqrt(1-this.es*Q*Q);R=this.esp*S*S;X=this.ak0*(this.mlfn(X,Q,S)+Q*U*aa*F*(1+D*T*(5-ab+R*(9+4*R)+A*T*(61+ab*(ab-58)+R*(270-330*ab)+q*T*(1385+ab*(ab*(543-ab)-3111))))));aa=this.ak0*U*(G+E*T*(1-ab+R+C*T*(5+ab*(ab-18)+R*(14-58*ab)+u*T*(61+ab*(ab*(179-ab)-479)))))}aa+=this.falseEasting;X+=this.falseNorthing;if(Y!=null){Y.setLocation(aa,X);return Y}else{return new Point2D_Double(aa,X)}}function K(aa,Y,Z){var aa;var Y;var ab;var X;var V;var U;var S;var T;var ad;var ac;var Q;var R;aa-=this.falseEasting;Y-=this.falseNorthing;if(this.isSpherical){ab=Math.exp(aa/this.ak0);X=0.5*(ab-1/ab);ab=Math.cos(Y/this.ak0);V=Math.asin(Math.sqrt((1-ab*ab)/(1+X*X)));Y=Y<0?-V:V;aa=(Math.abs(X)<=c&&Math.abs(ab)<=c)?this.centralMeridian:Math.atan2(X,ab)+this.centralMeridian}else{U=Y/this.ak0;S=1-this.es;V=U;for(T=10;true;){if(--T<0){alert("ERROR: TransverseMercatorProjection::inverseTransform ERROR_NO_CONVERGENCE")}ad=Math.sin(V);ab=1-this.es*(ad*ad);ab=(this.mlfn(V,ad,Math.cos(V))-U)/(S*ab*Math.sqrt(ab));V-=ab;if(Math.abs(ab)<b){break}}if(Math.abs(V)>=(Math.PI/2)){Y=Y<0?-(Math.PI/2):(Math.PI/2);aa=this.centralMeridian}else{sinphi=Math.sin(V);cosphi=Math.cos(V);ab=Math.abs(cosphi)>c?sinphi/cosphi:0;ac=this.esp*cosphi*cosphi;Q=1-this.es*sinphi*sinphi;X=aa*Math.sqrt(Q)/this.ak0;Q*=ab;ab*=ab;R=X*X;Y=V-(Q*R/(1-this.es))*F*(1-R*D*(5+ab*(3-9*ac)+ac*(1-4*ac)-R*A*(61+ab*(90-252*ac+45*ab)+46*ac-R*q*(1385+ab*(3633+ab*(4095+1574*ab))))));aa=X*(G-R*E*(1+2*ab+ac-R*C*(5+ab*(28+24*ab+8*ac)+6*ac-R*u*(61+ab*(662+ab*(1320+720*ab))))))/cosphi+this.centralMeridian}}Y+=this.centralLatitude;if(Z!=null){Z.setLocation(aa,Y);return Z}else{return new Point2D_Double(aa,Y)}}}TransverseMercatorProjection.prototype=MapProjection;function LambertConformalProjection(H){this._super=MapProjection;this._super(H);this.latitudeToRadians=k;this.cphi2=I;this.msfn=c;this.tsfn=f;function I(Q){var O;var M;var K;var F;var J;O=0.5*this.e;M=(Math.PI/2)-2*Math.atan(Q);for(K=0;K<16;K++){F=this.e*Math.sin(M);J=(Math.PI/2)-2*Math.atan(Q*Math.pow((1-F)/(1+F),O))-M;M+=J;if(Math.abs(J)<=this.TOL){return M}}}function c(F,J){return J/Math.sqrt(1-F*F*this.es)}function f(J,F){F*=this.e;return Math.tan(0.5*((Math.PI/2)-J))/Math.pow((1-F)/(1+F),0.5*this.e)}function k(M,F){var K;var J;K=-90;J=90;if(F?(M>=K&&M<=J):(M>K&&M<J)){return degrees2radians(M)}}var A;var v;var G;var E;var B;var r;var C;var o;var q;var g;var b;var p;var u;var a;var m;A=45.89891889;v=47.69601444;G=this.latitudeToRadians(A,true);E=this.latitudeToRadians(v,true);this.a=this.semiMajor*this.scaleFactor;if(Math.abs(G+E)<this.EPS){alert("ERROR: LambertConformalProjection::transform ERROR_POLE_PROJECTION")}C=Math.cos(G);o=Math.sin(G);B=Math.abs(G-E)>this.EPS;if(this.isSpherical){if(B){r=Math.log(C/Math.cos(E))/Math.log(Math.tan((Math.PI/4)+0.5*E)/Math.tan((Math.PI/4)+0.5*G))}else{r=o}q=C*Math.pow(Math.tan((Math.PI/4)+0.5*G),r)/r;if(Math.abs(Math.abs(this.centralLatitude)-(Math.PI/2))>=this.EPS){g=q*Math.pow(Math.tan((Math.PI/4)+0.5*this.centralLatitude),-r)}else{g=0}}else{b=this.msfn(o,C);p=this.tsfn(G,o);if(B){u=Math.sin(E);a=this.msfn(u,Math.cos(E));m=this.tsfn(E,u);r=Math.log(b/a)/Math.log(p/m)}else{r=o}q=b*Math.pow(p,-r)/r;if(Math.abs(Math.abs(this.centralLatitude)-(Math.PI/2))>=this.EPS){g=q*Math.pow(this.tsfn(this.centralLatitude,Math.sin(this.centralLatitude)),r)}else{g=0}}this.transformLambert=D;this.inverseTransformLambert=l;function D(J,M,F){var K;if(Math.abs(Math.abs(M)-(Math.PI/2))<this.EPS){if(M*r<=0){alert("ERROR: LambertConformalProjection::transform ERROR_POLE_PROJECTION")}else{K=0}}else{if(this.isSpherical){K=Math.pow(Math.tan((Math.PI/4)+0.5*M),-r)}else{K=Math.pow(this.tsfn(M,Math.sin(M)),r)}K*=q}J=r*(J-this.centralMeridian);M=this.a*(g-K*Math.cos(J))+this.falseNorthing;J=this.a*(K*Math.sin(J))+this.falseEasting;if(F!=null){F.setLocation(J,M);return F}else{return new Point2D.Double(J,M)}}function l(J,M,F){var K;J=(J-this.falseEasting)/this.a;M=g-(M-this.falseNorthing)/this.a;K=Math.sqrt(J*J+M*M);if(K>this.EPS){if(r<0){K=-K;J=-J;M=-M}J=this.centralMeridian+Math.atan2(J,M)/r;if(this.isSpherical){M=2*Math.atan(Math.pow(q/K,1/r))-(Math.PI/2)}else{M=this.cphi2(Math.pow(K/q,1/r))}}else{J=this.centralMeridian;M=r<0?-(Math.PI/2):(Math.PI/2)}if(F!=null){F.setLocation(J,M);return F}else{return new Point2D.Double(J,M)}}}LambertConformalProjection.prototype=MapProjection;function MatrixTransform(a,f,c){this.numCol=a||0;this.numRow=f||0;this.elt=c||new Array();this.transformMatrix=b;function b(m,l,p,o,q){srcOffB=l;dstOffB=o;numPtsB=q;inputDimension=this.numCol-1;outputDimension=this.numRow-1;buffer=new Array();if(m==p){upperSrc=srcOffB+numPtsB*inputDimension;if(upperSrc>dstOffB){if(inputDimension>=outputDimension?dstOffB>srcOffB:dstOffB+numPtsB*outputDimension>upperSrc){m=new Array();ii=0;for(kk=srcOffB;kk<=(m.length+srcOffB);kk++){m[ii]=p[kk];ii++}srcOffB=0}}}while(--numPtsB>=0){mix=0;for(var g=0;g<this.numRow;g++){sum=this.elt[mix+inputDimension];for(var k=0;k<inputDimension;k++){sum+=m[srcOffB+k]*this.elt[mix++]}buffer[g]=sum;mix++}w=buffer[outputDimension];for(var g=0;g<outputDimension;g++){p[dstOffB++]=buffer[g]/w}srcOffB+=inputDimension}}}function GeocentricTransform(f){semiMajor=f.getSemiMajorAxis();semiMinor=f.getSemiMinorAxis();this.MAX_ERROR=0.01;this.COS_67P5=0.3826834323650898;this.AD_C=1.0026;this.a=semiMajor;this.b=semiMinor;this.a2=(this.a*this.a);this.b2=(this.b*this.b);this.e2=(this.a2-this.b2)/this.a2;this.ep2=(this.a2-this.b2)/this.b2;this.hasHeight=false;this.getDimSource=c;this.transformGeocentric=b;this.transformGeocentric_inverse=a;function c(){return 2}function b(k,g,o,m,p,l){numPtsB=p;step=0;dimSource=this.getDimSource();this.hasHeight|=(dimSource>=3);error=null;while(--numPtsB>=0){L=degrees2radians(k[g++]);P=degrees2radians(k[g++]);h=l?k[g++]:0;cosLat=Math.cos(P);sinLat=Math.sin(P);rn=this.a/Math.sqrt(1-this.e2*(sinLat*sinLat));o[m++]=(rn+h)*cosLat*Math.cos(L);o[m++]=(rn+h)*cosLat*Math.sin(L);o[m++]=(rn*(1-this.e2)+h)*sinLat;g+=step;m+=step}}function a(k,g,m,l,o){numPtsB=o;step=0;dimSource=this.getDimSource();hasHeight=(dimSource>=3);computeHeight=hasHeight;while(--numPtsB>=0){x=k[g++];y=k[g++];z=k[g++];W2=x*x+y*y;W=Math.sqrt(W2);T0=z*this.AD_C;S0=Math.sqrt(T0*T0+W2);sin_B0=T0/S0;cos_B0=W/S0;sin3_B0=sin_B0*sin_B0*sin_B0;T1=z+this.b*this.ep2*sin3_B0;sum=W-this.a*this.e2*(cos_B0*cos_B0*cos_B0);S1=Math.sqrt(T1*T1+sum*sum);sin_p1=T1/S1;cos_p1=sum/S1;longitude=radians2degrees(Math.atan2(y,x));latitude=radians2degrees(Math.atan(sin_p1/cos_p1));m[l++]=longitude;m[l++]=latitude;if(computeHeight){rn=this.a/Math.sqrt(1-this.e2*(sin_p1*sin_p1));if(cos_p1>=this.COS_67P5){height=W/+cos_p1-rn}else{if(cos_p1<=(-1*this.COS_67P5)){height=W/-cos_p1-rn}else{height=z/sin_p1+rn*(this.e2-1)}}if(this.hasHeight){m[l++]=height}}g+=step;l+=step}}}function startsWith(c,a){if(c.length>=a.length){var b=c.substring(0,a.length);if(b==a){return true}else{return false}}else{return false}}function getZona(a){if(startsWith(a,"EPSG:230")){var b=parseInt(a.substring(new String("EPSG:230").length,a.length));return b}if(startsWith(a,"EPSG:258")){var b=parseInt(a.substring(new String("EPSG:258").length,a.length));return b}}centralMeridianNTF=2.337229167;centralLatitudeNTF=46.8;falseNorthingNTF=2200000;falseEastingNTF=600000;scaleFactorNTF=1;ntfAwgs84=new WGS84ConversionInfo();ntfAwgs84.dx=-168;ntfAwgs84.dy=-60;ntfAwgs84.dz=320;ntfAwgs84.ex=0;ntfAwgs84.ey=0;ntfAwgs84.ez=0;ntfAwgs84.ppm=0;datumNTF=new HorizontalDatum("Nouvelle Triangulation Francaise Paris",new DatumType_classic(),new Ellipsoid_FlattenedSphere("Clarke 1880",6378249.2,293.4660212936269,new Unit_metre()),ntfAwgs84);ellipsoidNTF=datumNTF.getEllipsoid();projectionLambert=new Projection("Lambert Conformal Conic","Lambert",ellipsoidNTF.getSemiMinorAxis(),ellipsoidNTF.getSemiMajorAxis(),falseNorthingNTF,falseEastingNTF,centralMeridianNTF,centralLatitudeNTF,scaleFactorNTF);ntf_LCProjection=new LambertConformalProjection(projectionLambert);gt_ntf=new GeocentricTransform(ellipsoidNTF);zona28=28;centralMeridian28=-183+(zona28*6);zona29=29;centralMeridian29=-183+(zona29*6);zona30=30;centralMeridian30=-183+(zona30*6);zona31=31;centralMeridian31=-183+(zona31*6);zona32=32;centralMeridian32=-183+(zona32*6);zona33=33;centralMeridian33=-183+(zona33*6);zona34=34;centralMeridian34=-183+(zona34*6);zona35=35;centralMeridian35=-183+(zona35*6);zona36=36;centralMeridian36=-183+(zona36*6);zona37=37;centralMeridian37=-183+(zona37*6);zona38=38;centralMeridian38=-183+(zona38*6);centralLatitude=0;falseNorthing=0;falseEasting=500000;scaleFactor=0.9996;ed50Awgs84=new WGS84ConversionInfo();ed50Awgs84.dx=-84;ed50Awgs84.dy=-107;ed50Awgs84.dz=-120;horizDatum=new HorizontalDatum("European Datum 50",new DatumType_classic(),new Ellipsoid_FlattenedSphere("International 1924",6378388,297,new Unit_metre()),ed50Awgs84);ed50=horizDatum.getEllipsoid();horizDatum2=new HorizontalDatum("European Terrestrial Reference System",new DatumType_classic(),new Ellipsoid_FlattenedSphere("GRS 1980",6378137,298.257222,new Unit_metre()),new WGS84ConversionInfo());ellipsoidETRS89=horizDatum2.getEllipsoid();projectionZone28_etrs89=new Projection("ETRS89 / UTM Norte","Transverse_Mercator",ellipsoidETRS89.getSemiMinorAxis(),ellipsoidETRS89.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian28,centralLatitude,scaleFactor);projectionZone29_etrs89=new Projection("ETRS89 / UTM Norte","Transverse_Mercator",ellipsoidETRS89.getSemiMinorAxis(),ellipsoidETRS89.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian29,centralLatitude,scaleFactor);projectionZone30_etrs89=new Projection("ETRS89 / UTM Norte","Transverse_Mercator",ellipsoidETRS89.getSemiMinorAxis(),ellipsoidETRS89.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian30,centralLatitude,scaleFactor);projectionZone31_etrs89=new Projection("ETRS89 / UTM Norte","Transverse_Mercator",ellipsoidETRS89.getSemiMinorAxis(),ellipsoidETRS89.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian31,centralLatitude,scaleFactor);projectionZone32_etrs89=new Projection("ETRS89 / UTM Norte","Transverse_Mercator",ellipsoidETRS89.getSemiMinorAxis(),ellipsoidETRS89.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian32,centralLatitude,scaleFactor);projectionZone33_etrs89=new Projection("ETRS89 / UTM Norte","Transverse_Mercator",ellipsoidETRS89.getSemiMinorAxis(),ellipsoidETRS89.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian33,centralLatitude,scaleFactor);projectionZone34_etrs89=new Projection("ETRS89 / UTM Norte","Transverse_Mercator",ellipsoidETRS89.getSemiMinorAxis(),ellipsoidETRS89.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian34,centralLatitude,scaleFactor);projectionZone35_etrs89=new Projection("ETRS89 / UTM Norte","Transverse_Mercator",ellipsoidETRS89.getSemiMinorAxis(),ellipsoidETRS89.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian35,centralLatitude,scaleFactor);projectionZone36_etrs89=new Projection("ETRS89 / UTM Norte","Transverse_Mercator",ellipsoidETRS89.getSemiMinorAxis(),ellipsoidETRS89.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian36,centralLatitude,scaleFactor);projectionZone37_etrs89=new Projection("ETRS89 / UTM Norte","Transverse_Mercator",ellipsoidETRS89.getSemiMinorAxis(),ellipsoidETRS89.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian37,centralLatitude,scaleFactor);projectionZone38_etrs89=new Projection("ETRS89 / UTM Norte","Transverse_Mercator",ellipsoidETRS89.getSemiMinorAxis(),ellipsoidETRS89.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian38,centralLatitude,scaleFactor);projectionZone28_ed50=new Projection("ED50 / UTM Norte","Transverse_Mercator",ed50.getSemiMinorAxis(),ed50.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian28,centralLatitude,scaleFactor);projectionZone29_ed50=new Projection("ED50 / UTM Norte","Transverse_Mercator",ed50.getSemiMinorAxis(),ed50.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian29,centralLatitude,scaleFactor);projectionZone30_ed50=new Projection("ED50 / UTM Norte","Transverse_Mercator",ed50.getSemiMinorAxis(),ed50.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian30,centralLatitude,scaleFactor);projectionZone31_ed50=new Projection("ED50 / UTM Norte","Transverse_Mercator",ed50.getSemiMinorAxis(),ed50.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian31,centralLatitude,scaleFactor);projectionZone32_ed50=new Projection("ED50 / UTM Norte","Transverse_Mercator",ed50.getSemiMinorAxis(),ed50.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian32,centralLatitude,scaleFactor);projectionZone33_ed50=new Projection("ED50 / UTM Norte","Transverse_Mercator",ed50.getSemiMinorAxis(),ed50.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian33,centralLatitude,scaleFactor);projectionZone34_ed50=new Projection("ED50 / UTM Norte","Transverse_Mercator",ed50.getSemiMinorAxis(),ed50.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian34,centralLatitude,scaleFactor);projectionZone35_ed50=new Projection("ED50 / UTM Norte","Transverse_Mercator",ed50.getSemiMinorAxis(),ed50.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian35,centralLatitude,scaleFactor);projectionZone36_ed50=new Projection("ED50 / UTM Norte","Transverse_Mercator",ed50.getSemiMinorAxis(),ed50.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian36,centralLatitude,scaleFactor);projectionZone37_ed50=new Projection("ED50 / UTM Norte","Transverse_Mercator",ed50.getSemiMinorAxis(),ed50.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian37,centralLatitude,scaleFactor);projectionZone38_ed50=new Projection("ED50 / UTM Norte","Transverse_Mercator",ed50.getSemiMinorAxis(),ed50.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian38,centralLatitude,scaleFactor);etrs89_TMProj28=new TransverseMercatorProjection(projectionZone28_etrs89);etrs89_TMProj29=new TransverseMercatorProjection(projectionZone29_etrs89);etrs89_TMProj30=new TransverseMercatorProjection(projectionZone30_etrs89);etrs89_TMProj31=new TransverseMercatorProjection(projectionZone31_etrs89);etrs89_TMProj32=new TransverseMercatorProjection(projectionZone32_etrs89);etrs89_TMProj33=new TransverseMercatorProjection(projectionZone33_etrs89);etrs89_TMProj34=new TransverseMercatorProjection(projectionZone34_etrs89);etrs89_TMProj35=new TransverseMercatorProjection(projectionZone35_etrs89);etrs89_TMProj36=new TransverseMercatorProjection(projectionZone36_etrs89);etrs89_TMProj37=new TransverseMercatorProjection(projectionZone37_etrs89);etrs89_TMProj38=new TransverseMercatorProjection(projectionZone38_etrs89);ed50_TMProj28=new TransverseMercatorProjection(projectionZone28_ed50);ed50_TMProj29=new TransverseMercatorProjection(projectionZone29_ed50);ed50_TMProj30=new TransverseMercatorProjection(projectionZone30_ed50);ed50_TMProj31=new TransverseMercatorProjection(projectionZone31_ed50);ed50_TMProj32=new TransverseMercatorProjection(projectionZone32_ed50);ed50_TMProj33=new TransverseMercatorProjection(projectionZone33_ed50);ed50_TMProj34=new TransverseMercatorProjection(projectionZone34_ed50);ed50_TMProj35=new TransverseMercatorProjection(projectionZone35_ed50);ed50_TMProj36=new TransverseMercatorProjection(projectionZone36_ed50);ed50_TMProj37=new TransverseMercatorProjection(projectionZone37_ed50);ed50_TMProj38=new TransverseMercatorProjection(projectionZone38_ed50);matrixED502WGS84_positive=[1,0,0,-84,0,1,0,-107,0,0,1,-120,0,0,0,1];matrixED502WGS84_negative=[1,0,0,84,0,1,0,107,0,0,1,120,0,0,0,1];matrixNTF2WGS84_positive=[1,0,0,-168,0,1,0,-60,0,0,1,320,0,0,0,1];matrixNTF2WGS84_negative=[1,0,0,168,0,1,0,60,0,0,1,-320,0,0,0,1];ED502WGS84_positive=new MatrixTransform(4,4,matrixED502WGS84_positive);ED502WGS84_negative=new MatrixTransform(4,4,matrixED502WGS84_negative);NTF2WGS84_positive=new MatrixTransform(4,4,matrixNTF2WGS84_positive);NTF2WGS84_negative=new MatrixTransform(4,4,matrixNTF2WGS84_negative);gt_ed50=new GeocentricTransform(ed50);gt_etrs89=new GeocentricTransform(ellipsoidETRS89);gt_wgs84=new GeocentricTransform(new Ellipsoid_WGS84());function getUTM_ETRS89_zone(a){switch(a){case 28:return etrs89_TMProj28;break;case 29:return etrs89_TMProj29;break;case 30:return etrs89_TMProj30;break;case 31:return etrs89_TMProj31;break;case 32:return etrs89_TMProj32;break;case 33:return etrs89_TMProj33;break;case 34:return etrs89_TMProj34;break;case 35:return etrs89_TMProj35;break;case 36:return etrs89_TMProj36;break;case 37:return etrs89_TMProj37;break;case 38:return etrs89_TMProj38;break;default:alert("Zona "+a+" no disponible en UTM con ETRS89");return etrs89_TMProj30}}function getUTM_ED50_zone(a){switch(a){case 28:return ed50_TMProj28;break;case 29:return ed50_TMProj29;break;case 30:return ed50_TMProj30;break;case 31:return ed50_TMProj31;break;case 32:return ed50_TMProj32;break;case 33:return ed50_TMProj33;break;case 34:return ed50_TMProj34;break;case 35:return ed50_TMProj35;break;case 36:return ed50_TMProj36;break;case 37:return ed50_TMProj37;break;case 38:return ed50_TMProj38;break;default:alert("Zona "+a+" no disponible en UTM con ED50");return ed50_TMProj30}}function transform230XX_4230(a,c,b){srcPts=new Array();srcPts[0]=a;srcPts[1]=c;dstPtsInv2=[0,0];getUTM_ED50_zone(b).inverseTransform(srcPts,0,dstPtsInv2,0,1,"UTM");return dstPtsInv2}function transform4230_230XX(a,c,b){srcPts=new Array();srcPts[0]=a;srcPts[1]=c;dstPtsInv2=[0,0];getUTM_ED50_zone(b).transform(srcPts,0,dstPtsInv2,0,1,"UTM");return dstPtsInv2}function transform230XX_230XX(a,f,b,c){srcPts=new Array();srcPts[0]=a;srcPts[1]=f;dstPtsInv2=[0,0];getUTM_ED50_zone(b).inverseTransform(srcPts,0,dstPtsInv2,0,1,"UTM");dstPts44=[0,0];getUTM_ED50_zone(c).transform(dstPtsInv2,0,dstPts44,0,1,"UTM");return dstPts44}function transform4258_258XX(a,c,b){srcPts=new Array();srcPts[0]=a;srcPts[1]=c;dstPtsInv2=[0,0];getUTM_ETRS89_zone(b).transform(srcPts,0,dstPtsInv2,0,1,"UTM");return dstPtsInv2}function transform258XX_4258(a,c,b){srcPts=new Array();srcPts[0]=a;srcPts[1]=c;dstPtsInv2=[0,0];getUTM_ETRS89_zone(b).inverseTransform(srcPts,0,dstPtsInv2,0,1,"UTM");return dstPtsInv2}function transform4230_258XX(a,c,b){srcPts=new Array();srcPts[0]=a;srcPts[1]=c;dstPts=[0,0,0];gt_ed50.transformGeocentric(srcPts,0,dstPts,0,1,false);srcPts22=[0,0,0];ED502WGS84_positive.transformMatrix(dstPts,0,srcPts22,0,1);dstPts33=[0,0];gt_etrs89.transformGeocentric_inverse(srcPts22,0,dstPts33,0,1,false);dstPtsInv2=[0,0];getUTM_ETRS89_zone(b).transform(dstPts33,0,dstPtsInv2,0,1,"UTM");return dstPtsInv2}function transform258XX_4230(a,c,b){srcPts=new Array();srcPts[0]=a;srcPts[1]=c;dstPtsInv2=[0,0];getUTM_ETRS89_zone(b).inverseTransform(srcPts,0,dstPtsInv2,0,1,"UTM");dstPts=[0,0,0];gt_etrs89.transformGeocentric(dstPtsInv2,0,dstPts,0,1,false);srcPts22=[0,0,0];ED502WGS84_negative.transformMatrix(dstPts,0,srcPts22,0,1);dstPts33=[0,0];gt_ed50.transformGeocentric_inverse(srcPts22,0,dstPts33,0,1,false);return dstPts33}function transform4326_258XX(a,c,b){srcPts=new Array();srcPts[0]=a;srcPts[1]=c;dstPts=[0,0,0];gt_wgs84.transformGeocentric(srcPts,0,dstPts,0,1,false);dstPts33=[0,0];gt_etrs89.transformGeocentric_inverse(dstPts,0,dstPts33,0,1,false);dstPtsInv2=[0,0];getUTM_ETRS89_zone(b).transform(dstPts33,0,dstPtsInv2,0,1,"UTM");return dstPtsInv2}function transform258XX_4326(a,c,b){srcPts=new Array();srcPts[0]=a;srcPts[1]=c;dstPtsInv2=[0,0];getUTM_ETRS89_zone(b).inverseTransform(srcPts,0,dstPtsInv2,0,1,"UTM");dstPts=[0,0,0];gt_etrs89.transformGeocentric(dstPtsInv2,0,dstPts,0,1,false);dstPts33=[0,0];gt_wgs84.transformGeocentric_inverse(dstPts,0,dstPts33,0,1,false);return dstPts33}function transform230XX_258XX(a,f,b,c){srcPts=new Array();srcPts[0]=a;srcPts[1]=f;dstPtsInv2=[0,0];getUTM_ED50_zone(b).inverseTransform(srcPts,0,dstPtsInv2,0,1,"UTM");dstPts=[0,0,0];gt_ed50.transformGeocentric(dstPtsInv2,0,dstPts,0,1,false);srcPts22=[0,0,0];ED502WGS84_positive.transformMatrix(dstPts,0,srcPts22,0,1);dstPts33=[0,0];gt_etrs89.transformGeocentric_inverse(srcPts22,0,dstPts33,0,1,false);dstPts44=[0,0];getUTM_ETRS89_zone(c).transform(dstPts33,0,dstPts44,0,1,"UTM");return dstPts44}function transform258XX_258XX(a,f,b,c){srcPts=new Array();srcPts[0]=a;srcPts[1]=f;dstPtsInv2=[0,0];getUTM_ETRS89_zone(b).inverseTransform(srcPts,0,dstPtsInv2,0,1,"UTM");dstPts44=[0,0];getUTM_ETRS89_zone(c).transform(dstPtsInv2,0,dstPts44,0,1,"UTM");return dstPts44}function transform258XX_230XX(a,f,b,c){srcPts=new Array();srcPts[0]=a;srcPts[1]=f;dstPtsInv2=[0,0];getUTM_ETRS89_zone(b).inverseTransform(srcPts,0,dstPtsInv2,0,1,"UTM");dstPts=[0,0,0];gt_etrs89.transformGeocentric(dstPtsInv2,0,dstPts,0,1,false);srcPts22=[0,0,0];ED502WGS84_negative.transformMatrix(dstPts,0,srcPts22,0,1);dstPts33=[0,0];gt_ed50.transformGeocentric_inverse(srcPts22,0,dstPts33,0,1,false);dstPts44=[0,0];getUTM_ED50_zone(c).transform(dstPts33,0,dstPts44,0,1,"UTM");return dstPts44}function transform230XX_4258(a,c,b){srcPts=new Array();srcPts[0]=a;srcPts[1]=c;dstPtsInv2=[0,0];getUTM_ED50_zone(b).inverseTransform(srcPts,0,dstPtsInv2,0,1,"UTM");dstPts=[0,0,0];gt_ed50.transformGeocentric(dstPtsInv2,0,dstPts,0,1,false);srcPts22=[0,0,0];ED502WGS84_positive.transformMatrix(dstPts,0,srcPts22,0,1);dstPts33=[0,0];gt_etrs89.transformGeocentric_inverse(srcPts22,0,dstPts33,0,1,false);return dstPts33}function transform230XX_4326(a,c,b){srcPts=new Array();srcPts[0]=a;srcPts[1]=c;dstPtsInv2=[0,0];getUTM_ED50_zone(b).inverseTransform(srcPts,0,dstPtsInv2,0,1,"UTM");dstPts=[0,0,0];gt_ed50.transformGeocentric(dstPtsInv2,0,dstPts,0,1,false);srcPts22=[0,0,0];ED502WGS84_positive.transformMatrix(dstPts,0,srcPts22,0,1);dstPts33=[0,0];gt_wgs84.transformGeocentric_inverse(srcPts22,0,dstPts33,0,1,false);return dstPts33}function transform4258_4230(a,b){srcPts=new Array();srcPts[0]=a;srcPts[1]=b;dstPts=[0,0,0];gt_etrs89.transformGeocentric(srcPts,0,dstPts,0,1,false);srcPts22=[0,0,0];ED502WGS84_negative.transformMatrix(dstPts,0,srcPts22,0,1);dstPtsInv=[0,0];gt_ed50.transformGeocentric_inverse(srcPts22,0,dstPtsInv,0,1,false);return dstPtsInv}function transform4230_4258(a,b){srcPts=new Array();srcPts[0]=a;srcPts[1]=b;dstPts=[0,0,0];gt_ed50.transformGeocentric(srcPts,0,dstPts,0,1,false);srcPts22=[0,0,0];ED502WGS84_positive.transformMatrix(dstPts,0,srcPts22,0,1);dstPtsInv=[0,0];gt_etrs89.transformGeocentric_inverse(srcPts22,0,dstPtsInv,0,1,false);return dstPtsInv}function transform4230_4326(a,b){srcPts=new Array();srcPts[0]=a;srcPts[1]=b;dstPts=[0,0,0];gt_ed50.transformGeocentric(srcPts,0,dstPts,0,1,false);srcPts22=[0,0,0];ED502WGS84_positive.transformMatrix(dstPts,0,srcPts22,0,1);dstPtsInv=[0,0];gt_wgs84.transformGeocentric_inverse(srcPts22,0,dstPtsInv,0,1,false);return dstPtsInv}function transform4326_4230(a,b){srcPts=new Array();srcPts[0]=a;srcPts[1]=b;dstPts=[0,0,0];gt_wgs84.transformGeocentric(srcPts,0,dstPts,0,1,false);srcPts22=[0,0,0];ED502WGS84_negative.transformMatrix(dstPts,0,srcPts22,0,1);dstPtsInv=[0,0];gt_ed50.transformGeocentric_inverse(srcPts22,0,dstPtsInv,0,1,false);return dstPtsInv}function transform4258_4326(a,b){srcPts=new Array();srcPts[0]=a;srcPts[1]=b;dstPts=[0,0,0];gt_etrs89.transformGeocentric(srcPts,0,dstPts,0,1,false);dstPtsInv=[0,0];gt_wgs84.transformGeocentric_inverse(dstPts,0,dstPtsInv,0,1,false);return dstPtsInv}function transform4326_4258(a,b){srcPts=new Array();srcPts[0]=a;srcPts[1]=b;dstPts=[0,0,0];gt_wgs84.transformGeocentric(srcPts,0,dstPts,0,1,false);dstPtsInv=[0,0];gt_etrs89.transformGeocentric_inverse(dstPts,0,dstPtsInv,0,1,false);return dstPtsInv}function transform4258_230XX(a,c,b){srcPts=new Array();srcPts[0]=a;srcPts[1]=c;dstPts=[0,0,0];gt_etrs89.transformGeocentric(srcPts,0,dstPts,0,1,false);srcPts22=[0,0,0];ED502WGS84_negative.transformMatrix(dstPts,0,srcPts22,0,1);dstPtsInv=[0,0];gt_ed50.transformGeocentric_inverse(srcPts22,0,dstPtsInv,0,1,false);dstPtsInv2=[0,0];getUTM_ED50_zone(b).transform(dstPtsInv,0,dstPtsInv2,0,1,"UTM");return dstPtsInv2}function transform4326_230XX(a,c,b){srcPts=new Array();srcPts[0]=a;srcPts[1]=c;dstPts=[0,0,0];gt_wgs84.transformGeocentric(srcPts,0,dstPts,0,1,false);srcPts22=[0,0,0];ED502WGS84_negative.transformMatrix(dstPts,0,srcPts22,0,1);dstPtsInv=[0,0];gt_ed50.transformGeocentric_inverse(srcPts22,0,dstPtsInv,0,1,false);dstPtsInv2=[0,0];getUTM_ED50_zone(b).transform(dstPtsInv,0,dstPtsInv2,0,1,"UTM");return dstPtsInv2}function transform4326_27572(a,b){srcPts=new Array();srcPts[0]=a;srcPts[1]=b;dstPtsStep1=[0,0,0];gt_wgs84.transformGeocentric(srcPts,0,dstPtsStep1,0,1,false);srcPts22=[0,0,0];NTF2WGS84_negative.transformMatrix(dstPtsStep1,0,srcPts22,0,1);dstPtsStep2=[0,0];gt_ntf.transformGeocentric_inverse(srcPts22,0,dstPtsStep2,0,1,false);dstPtsStep3=[0,0];ntf_LCProjection.transform(dstPtsStep2,0,dstPtsStep3,0,1,"LAMBERT");return dstPtsStep3}function transform4230_27572(a,b){srcPts=new Array();srcPts[0]=a;srcPts[1]=b;dstPts=[0,0,0];gt_ed50.transformGeocentric(srcPts,0,dstPts,0,1,false);srcPts22=[0,0,0];ED502WGS84_positive.transformMatrix(dstPts,0,srcPts22,0,1);srcPts222=[0,0,0];NTF2WGS84_negative.transformMatrix(srcPts22,0,srcPts222,0,1);dstPts33=[0,0];gt_ntf.transformGeocentric_inverse(srcPts222,0,dstPts33,0,1,false);dstPtsInv2=[0,0];ntf_LCProjection.transform(dstPts33,0,dstPtsInv2,0,1,"LAMBERT");return dstPtsInv2}function transform4258_27572(a,b){srcPts=new Array();srcPts[0]=a;srcPts[1]=b;dstPtsStep1=[0,0,0];gt_etrs89.transformGeocentric(srcPts,0,dstPtsStep1,0,1,false);srcPts22=[0,0,0];NTF2WGS84_negative.transformMatrix(dstPtsStep1,0,srcPts22,0,1);dstPtsStep2=[0,0];gt_ntf.transformGeocentric_inverse(srcPts22,0,dstPtsStep2,0,1,false);dstPtsStep3=[0,0];ntf_LCProjection.transform(dstPtsStep2,0,dstPtsStep3,0,1,"LAMBERT");return dstPtsStep3}function transform230XX_27572(a,c,b){srcPts=new Array();srcPts[0]=a;srcPts[1]=c;dstPtsInv2=[0,0];getUTM_ED50_zone(b).inverseTransform(srcPts,0,dstPtsInv2,0,1,"UTM");dstPts=[0,0,0];gt_ed50.transformGeocentric(dstPtsInv2,0,dstPts,0,1,false);srcPts22=[0,0,0];ED502WGS84_positive.transformMatrix(dstPts,0,srcPts22,0,1);srcPts222=[0,0,0];NTF2WGS84_negative.transformMatrix(srcPts22,0,srcPts222,0,1);pako=[0,0];gt_ntf.transformGeocentric_inverse(srcPts222,0,pako,0,1,false);pako2=[0,0];ntf_LCProjection.transform(pako,0,pako2,0,1,"LAMBERT");return pako2}function transform258XX_27572(a,c,b){srcPts=new Array();srcPts[0]=a;srcPts[1]=c;dstPtsInv2=[0,0];getUTM_ETRS89_zone(b).inverseTransform(srcPts,0,dstPtsInv2,0,1,"UTM");dstPts=[0,0,0];gt_etrs89.transformGeocentric(dstPtsInv2,0,dstPts,0,1,false);srcPts222=[0,0,0];NTF2WGS84_negative.transformMatrix(dstPts,0,srcPts222,0,1);dstPts33=[0,0];gt_ntf.transformGeocentric_inverse(srcPts222,0,dstPts33,0,1,false);dstPts44=[0,0];ntf_LCProjection.transform(dstPts33,0,dstPts44,0,1,"LAMBERT");return dstPts44}function transform27572_4326(a,b){srcPts=new Array();srcPts[0]=a;srcPts[1]=b;dstPtsInv2=[0,0];ntf_LCProjection.inverseTransform(srcPts,0,dstPtsInv2,0,1,"LAMBERT");dstPts=[0,0,0];gt_ntf.transformGeocentric(dstPtsInv2,0,dstPts,0,1,false);srcPts22=[0,0,0];NTF2WGS84_positive.transformMatrix(dstPts,0,srcPts22,0,1);dstPts33=[0,0];gt_wgs84.transformGeocentric_inverse(srcPts22,0,dstPts33,0,1,false);return dstPts33}function transform27572_4230(a,b){srcPts=new Array();srcPts[0]=a;srcPts[1]=b;dstPtsInv2=[0,0];ntf_LCProjection.inverseTransform(srcPts,0,dstPtsInv2,0,1,"LAMBERT");dstPts=[0,0,0];gt_ntf.transformGeocentric(dstPtsInv2,0,dstPts,0,1,false);srcPts22=[0,0,0];NTF2WGS84_positive.transformMatrix(dstPts,0,srcPts22,0,1);srcPts222=[0,0,0];ED502WGS84_negative.transformMatrix(srcPts22,0,srcPts222,0,1);dstPts33=[0,0];gt_ed50.transformGeocentric_inverse(srcPts222,0,dstPts33,0,1,false);return dstPts33}function transform27572_4258(a,b){srcPts=new Array();srcPts[0]=a;srcPts[1]=b;dstPtsInv2=[0,0];ntf_LCProjection.inverseTransform(srcPts,0,dstPtsInv2,0,1,"LAMBERT");dstPts=[0,0,0];gt_ntf.transformGeocentric(dstPtsInv2,0,dstPts,0,1,false);srcPts22=[0,0,0];NTF2WGS84_positive.transformMatrix(dstPts,0,srcPts22,0,1);dstPts33=[0,0];gt_etrs89.transformGeocentric_inverse(srcPts222,0,dstPts33,0,1,false);return dstPts33}function transform27572_230XX(a,c,b){srcPts=new Array();srcPts[0]=a;srcPts[1]=c;dstPtsInv2=[0,0];ntf_LCProjection.inverseTransform(srcPts,0,dstPtsInv2,0,1,"LAMBERT");dstPts=[0,0,0];gt_ntf.transformGeocentric(dstPtsInv2,0,dstPts,0,1,false);srcPts22=[0,0,0];NTF2WGS84_positive.transformMatrix(dstPts,0,srcPts22,0,1);srcPts222=[0,0,0];ED502WGS84_negative.transformMatrix(srcPts22,0,srcPts222,0,1);dstPts33=[0,0];gt_ed50.transformGeocentric_inverse(srcPts222,0,dstPts33,0,1,false);dstPts44=[0,0];getUTM_ED50_zone(b).transform(dstPts33,0,dstPts44,0,1,"UTM");return dstPts44}function transform27572_258XX(a,c,b){srcPts=new Array();srcPts[0]=a;srcPts[1]=c;dstPtsInv2=[0,0];ntf_LCProjection.inverseTransform(srcPts,0,dstPtsInv2,0,1,"LAMBERT");dstPts=[0,0,0];gt_ntf.transformGeocentric(dstPtsInv2,0,dstPts,0,1,false);srcPts22=[0,0,0];NTF2WGS84_positive.transformMatrix(dstPts,0,srcPts22,0,1);dstPts33=[0,0];gt_etrs89.transformGeocentric_inverse(srcPts22,0,dstPts33,0,1,false);dstPts44=[0,0];getUTM_ED50_zone(b).transform(dstPts33,0,dstPts44,0,1,"UTM");return dstPts44}function transform900913_4326(a,f){var c=(a/20037508.34)*180;var b=(f/20037508.34)*180;b=180/Math.PI*(2*Math.atan(Math.exp(b*Math.PI/180))-Math.PI/2);return[c,b]}function transform900913_230XX(a,f,b){var c=transform900913_4326(a,f);return transform4326_230XX(c[0],c[1],b)}function transform900913_258XX(a,f,b){var c=transform900913_4326(a,f);return transform4326_258XX(c[0],c[1],b)}function transform4326_900913(a,f){var c=a*20037508.34/180;var b=Math.log(Math.tan((90+f)*Math.PI/360))/(Math.PI/180);b=b*20037508.34/180;return[c,b]}function transform230XX_900913(a,f,b){var c=transform230XX_4326(a,f,b);return transform4326_900913(c[0],c[1])}function transform258XX_900913(a,f,b){var c=transform258XX_4326(a,f,b);return transform4326_900913(c[0],c[1])}function transform4258_900913(a,f,b){var c=transform4258_4326(a,f,b);return transform4326_900913(c[0],c[1])}function transform900913_4258(a,f,b){var c=transform900913_4326(a,f,b);return transform4326_4258(c[0],c[1])}function transform4230_900913(a,f,b){var c=transform4230_4326(a,f,b);return transform4326_900913(c[0],c[1])}function transform900913_4230(a,f,b){var c=transform900913_4326(a,f,b);return transform4326_4230(c[0],c[1])}function coordTransform(f,c,b,a){destino=new CoordinatePoint(2);if(f==c){destino[0]=b;destino[1]=a;return destino}else{f=new String(f);c=new String(c);if(f=="EPSG:4326"){if(c=="EPSG:4230"){return transform4326_4230(b,a)}else{if(c=="EPSG:4258"){return transform4326_4258(b,a)}else{if(startsWith(c,"EPSG:230")){return transform4326_230XX(b,a,getZona(c))}else{if(startsWith(c,"EPSG:258")){return transform4326_258XX(b,a,getZona(c))}else{if(c=="EPSG:27572"){return transform4326_27572(b,a)}else{if(c=="EPSG:900913"){return transform4326_900913(b,a)}else{alert("El srs "+c+" no estÃ¡ disponible")}}}}}}}else{if(f=="EPSG:4230"){if(c=="EPSG:4326"){return transform4230_4326(b,a)}else{if(c=="EPSG:4258"){return transform4230_4258(b,a)}else{if(startsWith(c,"EPSG:230")){return transform4230_230XX(b,a,getZona(c))}else{if(startsWith(c,"EPSG:258")){return transform4230_258XX(b,a,getZona(c))}else{if(c=="EPSG:27572"){return transform4230_27572(b,a)}else{if(c=="EPSG:900913"){return transform4230_900913(b,a)}else{alert("El srs "+c+" no estÃ¡ disponible")}}}}}}}else{if(f=="EPSG:4258"){if(c=="EPSG:4230"){return transform4258_4230(b,a)}else{if(c=="EPSG:4326"){return transform4258_4326(b,a)}else{if(startsWith(c,"EPSG:230")){return transform4258_230XX(b,a,getZona(c))}else{if(startsWith(c,"EPSG:258")){return transform4258_258XX(b,a,getZona(c))}else{if(c=="EPSG:27572"){return transform4258_27572(b,a)}}}}}if(c=="EPSG:900913"){return transform4258_900913(b,a)}else{alert("El srs "+c+" no estÃ¡ disponible")}}else{if(startsWith(f,"EPSG:230")){if(c=="EPSG:4230"){return transform230XX_4230(b,a,getZona(f))}else{if(c=="EPSG:4258"){return transform230XX_4258(b,a,getZona(f))}else{if(c=="EPSG:4326"){return transform230XX_4326(b,a,getZona(f))}else{if(startsWith(c,"EPSG:230")){return transform230XX_230XX(b,a,getZona(f),getZona(c))}else{if(startsWith(c,"EPSG:258")){return transform230XX_258XX(b,a,getZona(f),getZona(c))}else{if(c=="EPSG:27572"){return transform230XX_27572(b,a,getZona(f))}else{if(c=="EPSG:900913"){return transform230XX_900913(b,a,getZona(f))}else{alert("El srs "+c+" no estÃ¡ disponible")}}}}}}}}else{if(startsWith(f,"EPSG:258")){if(c=="EPSG:4230"){return transform258XX_4230(b,a,getZona(f))}else{if(c=="EPSG:4258"){return transform258XX_4258(b,a,getZona(f))}else{if(c=="EPSG:4326"){return transform258XX_4326(b,a,getZona(f))}else{if(startsWith(c,"EPSG:230")){return transform258XX_230XX(b,a,getZona(f),getZona(c))}else{if(startsWith(c,"EPSG:258")){return transform258XX_258XX(b,a,getZona(f),getZona(c))}else{if(c=="EPSG:27572"){return transform258XX_27572(b,a,getZona(f))}else{if(c=="EPSG:900913"){return transform258XX_900913(b,a,getZona(f))}else{alert("El srs "+c+" no estÃ¡ disponible")}}}}}}}}else{if(f=="EPSG:27572"){if(c=="EPSG:4326"){return transform27572_4326(b,a)}else{if(c=="EPSG:4258"){return transform27572_4258(b,a)}else{if(startsWith(c,"EPSG:230")){return transform27572_230XX(b,a,getZona(c))}else{if(startsWith(c,"EPSG:258")){return transform27572_258XX(b,a,getZona(c))}else{if(c=="EPSG:4230"){return transform27572_4230(b,a)}else{alert("El srs "+c+" no estÃ¡ disponible")}}}}}}else{if(f=="EPSG:900913"){if(c=="EPSG:4326"){return transform900913_4326(b,a)}else{if(startsWith(c,"EPSG:230")){return transform900913_230XX(b,a,getZona(c))}else{if(startsWith(c,"EPSG:258")){return transform900913_258XX(b,a,getZona(c))}else{if(c=="EPSG:4258"){return transform900913_4258(b,a)}else{if(c=="EPSG:4230"){return transform900913_4230(b,a)}else{alert("El srs "+c+" no estÃ¡ disponible")}}}}}}else{alert("El srs "+f+" no estÃ¡ disponible")}}}}}}}}}var supportedSrsList=new Array("EPSG:4258","EPSG:4326","EPSG:4230","EPSG:25828","EPSG:25829","EPSG:25830","EPSG:25831","EPSG:23028","EPSG:23029","EPSG:23030","EPSG:23031","EPSG:900913");var supportedSrsListDescription=new Array("lon-lat, ETRS89","lon-lat, WGS84","lon-lat, ED50","UTM28N, ETRS89","UTM29N, ETRS89","UTM30N, ETRS89","UTM31N, ETRS89","UTM28N, ED50","UTM29N, ED50","UTM30N, ED50","UTM31N, ED50","Spherical Mercator, WGS84");var supportedSrsLongListDescription=new Array("EPSG:4258 (lon-lat, ETRS89)","EPSG:4326 (lon-lat, WGS84)","EPSG:4230 (lon-lat, ED50)","EPSG:25828 (UTM28N, ETRS89)","EPSG:25829 (UTM29N, ETRS89)","EPSG:25830 (UTM30N, ETRS89)","EPSG:25831 (UTM31N, ETRS89)","EPSG:23028 (UTM28N, ED50)","EPSG:23029 (UTM29N, ED50)","EPSG:23030 (UTM30N, ED50)","EPSG:23031 (UTM31N, ED50)");var projectedSrsList=new Array("EPSG:25828","EPSG:25829","EPSG:25830","EPSG:25831","EPSG:23028","EPSG:23029","EPSG:23030","EPSG:23031");var prioritySrsList=new Array("EPSG:4258","EPSG:4326","EPSG:4230","EPSG:25828","EPSG:25829","EPSG:25830","EPSG:25831","EPSG:23028","EPSG:23029","EPSG:23030","EPSG:23031");function getSupportedSrsList(){return supportedSrsList}function setSupportedSrsList(a){supportedSrsList=a}function getSupportedSrs(a){return(supportedSrsList[a])}function isSupportedSrs(c){var b=false;for(var a=0;a<supportedSrsList.length&&b==false;a++){b=(supportedSrsList[a]==c)}return b}function getSupportedSrsDescriptionList(){return supportedSrsListDescription}function setSupportedSrsDescriptionList(a){supportedSrsListDescription=a}function getSupportedSrsDescription(b){for(var a=0;a<supportedSrsList.length;a++){if(supportedSrsList[a]==b){return supportedSrsListDescription[a]}}return""}function getSupportedSrsDescriptionLongList(){return supportedSrsLongListDescription}function setSupportedSrsDescriptionLongList(a){supportedSrsLongListDescription=a}function getSupportedSrsLongDescription(b){for(var a=0;a<supportedSrsList.length;a++){if(supportedSrsList[a]==b){return supportedSrsLongListDescription[a]}}return""}function getProjectedSrsList(){return projectedSrsList}function setProjectedSrsList(a){projectedSrsList=a}function isProjectedSrs(b){var c=false;for(var a=0;a<projectedSrsList.length&&c==false;a++){c=(projectedSrsList[a]==b)}return c}function getPrioritySrsList(){return prioritySrsList}function setPrioritySrsList(a){prioritySrsList=a}function getPrioritySrs(a){return(prioritySrsList[a])}function getDatum(b){var c=getSupportedSrsLongDescription(b);if(c!=""){var a=c.substring(c.indexOf(",")+1,c.length);return a}return""}function Font(C,q,o,p,v){this.fontSize=C||0;this.fontColor=q||"";this.fontFace=o||"";this.fontBold=p||false;this.centeredText=v||false;this.getFontSize=l;this.setFontSize=g;this.getFontColor=c;this.setFontColor=m;this.getFontFace=b;this.setFontFace=B;this.getFontBold=a;this.setFontBold=A;this.getCenteredText=f;this.setCenteredText=r;this.getHTMLStartTag=u;this.getHTMLEndTag=k;function l(){return this.fontSize}function g(D){this.fontSize=D}function c(){return this.fontColor}function m(D){this.fontColor=D}function b(){return this.fontFace}function B(D){this.fontFace=D}function a(){return this.fontBold}function A(D){this.fontBold=D}function f(){return this.centeredText}function r(D){this.centeredText=D}function u(){var D="";if(this.getFontBold()){D+="<b>"}if(this.getCenteredText()){D+="<center>"}D+="<font";if(this.getFontSize()!=0){D+=" size='"+this.getFontSize()+"'"}if(this.getFontColor()!=""){D+=" color='"+this.getFontColor()+"'"}if(this.getFontFace()!=""){D+=" face='"+this.getFontFace()+"'"}D+=">";return D}function k(){var D="</font>";if(this.getCenteredText()){D+="</center>"}if(this.getFontBold()){D+="</b>"}return D}}function GUIComponent(l,k,v,q,D,C){this.x=l||0;this.y=k||0;this.width=v||0;this.height=q||0;this.name=D||"GUIComponent";this.doc=C||"document";this.getX=B;this.setX=u;this.getY=A;this.setY=r;this.getWidth=c;this.setWidth=b;this.getHeight=o;this.setHeight=g;this.getName=p;this.setName=f;this.getDoc=m;this.setDoc=a;function B(){return this.x}function u(E){this.x=E}function A(){return this.y}function r(E){this.y=E}function c(){return this.width}function b(E){this.width=E}function o(){return this.height}function g(E){this.height=E}function p(){return this.name}function f(E){this.name=E}function m(){return this.doc}function a(E){this.doc=E}}function GUITextComponent(o,l,b,q,a,p,c){this._super=GUIComponent;this._super(o,l,b,q,a||"GUITextComponent",p);this.textFontCSS=c||new FontCSS();this.textFont=c||new Font();this.getTextFont=m;this.setTextFont=k;this.getTextFontCSS=g;this.setTextFontCSS=f;function m(){return this.textFont}function k(r){this.textFont=r}function g(){return this.textFontCSS}function f(r){this.textFontCSS=r}}GUITextComponent.prototype=new GUIComponent;function InputText(name,title,text,x,y,doc,textFont,size,readOnly,onKeyUp){this._super=GUITextComponent;this._super(x,y,0,0,name||"inputText",doc,textFont);this.title=title||"";this.text=text||"";this.size=size||9;this.readOnly=readOnly||false;this.onKeyUp=onKeyUp||"";this.getTitle=getTitle;this.setTitle=setTitle;this.getText=getText;this.setText=setText;this.getSize=getSize;this.setSize=setSize;this.getReadOnly=getReadOnly;this.setReadOnly=setReadOnly;this.getValue=getValue;this.setValue=setValue;this.getOnKeyUp=getOnKeyUp;this.setOnKeyUp=setOnKeyUp;this.getHTML=getHTML;function getTitle(){return this.title}function setTitle(newTitle){this.title=newTitle}function getText(){return this.text}function setText(newText){this.text=newText}function getValue(){return(eval(this.getDoc()+"."+this.getName()+"Form."+this.getName()+"Text.value"))}function setValue(newValue){eval(this.getDoc()+"."+this.getName()+"Form."+this.getName()+"Text.value = '"+newValue+"';")}function getSize(){return this.size}function setSize(newSize){this.size=newSize}function getReadOnly(){return this.readOnly}function setReadOnly(newReadOnly){this.readOnly=newReadOnly}function getOnKeyUp(){return this.onKeyUp}function setOnKeyUp(newOnKeyUp){this.onKeyUp=newOnKeyUp}function getHTML(){var str="";str=str+'<form onsubmit="return false;" name="'+this.getName()+'Form" ';if((this.getX()!=-1)||(this.getY()!=-1)){str+='style="position:absolute; ';if(this.getY()!=-1){str=str+"top:"+this.getY()+"px; "}if(this.getX()!=-1){str=str+"left:"+this.getX()+"px;"}str+='"'}str+=">";str+=this.getTextFont().getHTMLStartTag();if(this.getTitle()!=""){str=str+this.getTitle()+"&nbsp&nbsp"}str=str+'<input type="text" name="'+this.getName()+'Text" value="'+this.getText()+'" ';str+='size="'+this.getSize()+'"';if(this.getReadOnly()){str+='readOnly ="true"'}if(this.getOnKeyUp()!=""){str+=' onKeyUp="'+this.getOnKeyUp()+'" '}str+=">";str+=this.getTextFont().getHTMLEndTag();str=str+"</form>";return(str)}}InputText.prototype=new GUITextComponent;function InputTextCSS(b,g,o,k,f,m,c,q,l,p){this._super=InputText;this._super(b,g,o,k,f,m,c,q,l,p);this.getHTML=a;function a(){var r="";r=r+'<form onsubmit="return false;" name="'+this.getName()+'Form" ';if((this.getX()!=-1)||(this.getY()!=-1)){r+='style="position:absolute; ';if(this.getY()!=-1){r=r+"top:"+this.getY()+"px; "}if(this.getX()!=-1){r=r+"left:"+this.getX()+"px;"}r+='"'}r+=">";if(this.getTitle()!=""){r=r+'<font style="'+this.getTextFont().getCSS()+'">';r=r+this.getTitle()+"&nbsp&nbsp";r=r+"</font>"}r=r+'<input type="text" name="'+this.getName()+'Text" value="'+this.getText()+'" ';r+='size="'+this.getSize()+'"';if(this.getReadOnly()){r+='readOnly ="true"'}if(this.getOnKeyUp()!=""){r+=' onKeyUp="'+this.getOnKeyUp()+'" '}r+=' style="'+this.getTextFont().getCSS()+'" ';r+=">";r=r+"</form>";return(r)}}InputTextCSS.prototype=new InputText;function ColorChooser(name,colors,title,colorRGBSelected,x,y,doc,textFont){this._super=GUITextComponent;this._super(x,y,0,0,name||"colorChooser",doc,textFont);this.title=title||"";this.colorRGBSelected=colorReq2Interfaz(colorRGBSelected)||"";this.textFontCSS=null;this.positionType="absolute";this.getColors=getColors;this.setColors=setColors;this.getTitle=getTitle;this.setTitle=setTitle;this.getColorRGBSelected=getColorRGBSelected;this.setColorRGBSelected=setColorRGBSelected;this.setPositionType=setPositionType;this.getPositionType=getPositionType;this.getValue=getValue;this.setValue=setValue;this.getHTML=getHTML;this.activateColorChooser=activateColorChooser;if(colors){this.setColors(colors)}else{var foo=new Array(1);foo[0]="0000FF";this.setColors(foo)}function setPositionType(newPositionType){this.positionType=newPositionType}function getPositionType(){return this.positionType}function colorReq2Interfaz(colorSelected){return(colorSelected.substring(2,8))}function colorNav2Interfaz(colorSelected){return(colorSelected.substring(1,7))}function colorNav2RGB(oldColor){if(OpenLayers.IAAA_Utils.isNetscape()){var hexa=new Array("0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F");aux=oldColor.substr(4);redValue=parseInt(aux);redValueHex=hexa[Math.floor(redValue/16)]+hexa[redValue%16];aux=aux.substr(aux.indexOf(",")+1);greenValue=parseInt(aux);greenValueHex=hexa[Math.floor(greenValue/16)]+hexa[greenValue%16];aux=aux.substr(aux.indexOf(",")+1);blueValue=parseInt(aux);blueValueHex=hexa[Math.floor(blueValue/16)]+hexa[blueValue%16];newColor=redValueHex+greenValueHex+blueValueHex}else{newColor=colorNav2Interfaz(oldColor)}return(newColor)}function getTitle(){return this.title}function setTitle(newTitle){this.title=newTitle}function getColors(){return this.colors}function setColors(newColors){this.colors=new Array(newColors.length);for(var i=0;i<newColors.length;i++){this.colors[i]=newColors[i]}}function getColorRGBSelected(){return this.colorRGBSelected}function setColorRGBSelected(newColor){this.colorRGBSelected=newColor}function getValue(){return(eval(this.getDoc()+".getElementById('"+this.getName()+"InputColorRGB').value"))}function setValue(newColor){eval(this.getDoc()+".getElementById('"+this.getName()+"InputColorRGB').value = '"+newColor.toUpperCase()+"'");_updateTextField(this.getName(),this.getDoc())}function _updateCombo(name,doc,win){d=doc||"document";w=win||"window";var indexSelected=0;indexSelected=eval(d+".getElementById('"+name+"Select').selectedIndex");var newColor=eval(d+".getElementById('"+name+"Select').options["+indexSelected+"].style.backgroundColor");newColor=colorNav2RGB(newColor);eval(d+".getElementById('"+name+"InputColorRGB').value = '"+newColor.toUpperCase()+"'");eval(w+".focus();");if(OpenLayers.IAAA_Utils.isNetscape()){eval(d+".getElementById('"+name+"Select')").style.backgroundColor=newColor}}function _updateTextField(name,doc,win){d=doc||"document";w=win||"window";var newColor=eval(d+".getElementById('"+name+"InputColorRGB').value");if((newColor.length==6)&&(isHex(newColor))){var indexSelected=this.colors.length;eval(d+".getElementById('"+name+"Select').selectedIndex = "+indexSelected+";");eval(d+".getElementById('"+name+"Select').options["+indexSelected+"].style.backgroundColor = '"+newColor+"';");eval(w+".focus();");if(OpenLayers.IAAA_Utils.isNetscape()){eval(d+".getElementById('"+name+"Select')").style.backgroundColor=newColor}}else{alert("Formato de color incorrecto. Utilice el sistema RGB.");newColor=eval(d+".getElementById('"+name+"Select').options["+d+".getElementById('"+name+"Select').selectedIndex].style.backgroundColor;");newColor=colorNav2RGB(newColor);eval(d+".getElementById('"+name+"InputColorRGB').value = '"+newColor.toUpperCase()+"'")}}function getHTML(){var str="";str=str+'<div id="'+this.getName()+'Div"';if(this.getPositionType()=="relative"){str+='style="position:relative; ';if(this.getY()!=-1){str=str+"top:"+this.getY()+"px; "}if(this.getX()!=-1){str=str+"left:"+this.getX()+"px;"}str+='"'}else{if((this.getX()!=-1)||(this.getY()!=-1)){str+='style="position:absolute; ';if(this.getY()!=-1){str=str+"top:"+this.getY()+"px; "}if(this.getX()!=-1){str=str+"left:"+this.getX()+"px;"}str+='"'}}str+=">";str+=this.getTextFont().getHTMLStartTag();str=str+'<select id="'+this.getName()+'Select" name="'+this.getName()+'Select" ';str=str+' style="width:100px;height:20px;';if(OpenLayers.IAAA_Utils.isNetscape()){str=str+"background-color:"+this.getColorRGBSelected()+";"}str=str+'">';for(i=0;i<this.getColors().length;i++){str=str+'<option id="option'+i+'" style="background-color:';str=str+this.getColors()[i];str=str+';">'}var lastPosition=this.getColors().length;str=str+'<option id="option'+lastPosition+'" selected="true" style="background-color:';str=str+this.getColorRGBSelected();str=str+';">';this.getColors()[lastPosition]=this.getColorRGBSelected();str=str+"</select>";var fontCSS="";if(this.getTextFontCSS()!=null){fontCSS=this.getTextFontCSS().getCSS()}str=str+'<input type=text id="'+this.getName()+'InputColorRGB" name="'+this.getName()+'InputColorRGB" value="'+this.getColorRGBSelected().toUpperCase()+'" maxlength="6" style="margin-left:6px;margin-bottom:1px;width:90px;height:20px;'+fontCSS+'"/>';str+=this.getTextFont().getHTMLEndTag();str=str+"</div>";return(str)}function activateColorChooser(doc,win){eval(doc+".getElementById('"+name+"Select').onchange = function(e) { _updateCombo('"+name+"', '"+doc+"', '"+win+"');	} ");eval(doc+".getElementById('"+name+"InputColorRGB').onchange = function(e) { _updateTextField('"+name+"', '"+doc+"', '"+win+"');	} ")}}ColorChooser.prototype=new GUITextComponent;function InputCombo(name,title,values,valueSelected,x,y,doc,textFont,visibility){this._super=GUITextComponent;this._super(x,y,0,0,name||"inputOption",doc,textFont);this.title=title||"";this.values=values||new Array(0);this.valueSelected=valueSelected||"";this.disabled=false;this.visibility=visibility||true;this.getTitle=getTitle;this.setTitle=setTitle;this.getValues=getValues;this.setValues=setValues;this.getValueSelected=getValueSelected;this.setValueSelected=setValueSelected;this.getValue=getValue;this.setValue=setValue;this.getIndexSelected=getIndexSelected;this.getDisabled=getDisabled;this.setDisabled=setDisabled;this.getHTML=getHTML;this.addChangeListener=addChangeListener;this.removeChangeListener=removeChangeListener;this.hideComponent=hideComponent;this.showComponent=showComponent;this.getVisibility=getVisibility;this.setVisibility=setVisibility;this.updateValues=updateValues;function getTitle(){return this.title}function setTitle(newTitle){this.title=newTitle}function getValues(){return this.values}function setValues(newValues){this.values=newValues}function getValueSelected(){return this.valueSelected}function setValueSelected(newValueSelected){this.valueSelected=newValueSelected}function getValue(){var indexSelected=0;indexSelected=eval(this.getDoc()+"."+this.getName()+"Form."+this.getName()+"Select.selectedIndex");return(this.getValues()[indexSelected])}function getIndexSelected(){var indexSelected=0;indexSelected=eval(this.getDoc()+"."+this.getName()+"Form."+this.getName()+"Select.selectedIndex");return(indexSelected)}function getDisabled(){return this.disabled}function setDisabled(newValue){this.disabled=newValue;var auxSelected=eval(this.getDoc()+"."+this.getName()+"Form."+this.getName()+"Select");auxSelected.disabled=newValue}function getVisibility(){return this.visibility}function setVisibility(newVisibility){this.visibility=newVisibility}function setValue(newOption){var encontrado=false;var index=0;while((!encontrado)&&(index<this.getValues().length)){if(this.getValues()[index]==newOption){encontrado=true;eval(this.getDoc()+"."+this.getName()+"Form."+this.getName()+"Select.selectedIndex = "+index+";")}index++}}function getHTML(){var str="";str=str+'<form name="'+this.getName()+'Form" ';str+='style="';if((this.getX()!=-1)||(this.getY()!=-1)){str+="position:absolute; ";if(this.getY()!=-1){str=str+"top:"+this.getY()+"px; "}if(this.getX()!=-1){str=str+"left:"+this.getX()+"px;"}}if(this.getVisibility()){str+=" visibility:visible;"}else{str+=" visibility:hidden;"}str+='"';str+=">";str+=this.getTextFont().getHTMLStartTag();if(this.getTitle()!=""){str=str+this.getTitle()+"&nbsp&nbsp"}str=str+'<select name="'+this.getName()+'Select">';for(i=0;i<this.getValues().length;i++){if(this.getValues()[i]==this.getValueSelected()){str+='<option id="value'+i+'" selected="true">';str+=this.getValues()[i]+"</option>"}else{str+='<option id="value'+i+'">';str+=this.getValues()[i]+"</option>"}}str=str+"</select>";str+=this.getTextFont().getHTMLEndTag();str=str+"</form>";return(str)}function addChangeListener(funct){try{var obj=eval(this.getDoc()+"."+this.getName()+"Form."+this.getName()+"Select");OpenLayers.IAAA_Utils.addEvent(obj,"change",funct)}catch(e){}}function removeChangeListener(funct){var obj=eval(this.getDoc()+"."+this.getName()+"Form."+this.getName()+"Select");removeEvent(obj,"change",funct)}function hideComponent(){var obj=eval(this.getDoc()+"."+this.getName()+"Form");obj.style.visibility="hidden"}function showComponent(){var obj=eval(this.getDoc()+"."+this.getName()+"Form");obj.style.visibility="visible"}function updateValues(newValues){var selectAux=eval(this.getDoc()+"."+this.getName()+"Form."+this.getName()+"Select");for(var i=0;i<selectAux.options.length;i++){selectAux.options[i].text=newValues[i]}}}InputCombo.prototype=new GUITextComponent;function InputComboCSS(name,title,values,valueSelected,x,y,doc,textFont,visibility,labelPosition){this._super=InputCombo;this._super(name,title,values,valueSelected,x,y,doc,textFont,visibility);this.getHTML=getHTML;this.labelPosition=labelPosition||0;this.getLabelPosition=getLabelPosition;this.getDisabled=getDisabled;this.setDisabled=setDisabled;this.setLabelColor=setLabelColor;function getLabelPosition(){return this.labelPosition}function getHTML(){var str="";str=str+'<form name="'+this.getName()+'Form" id="'+this.getName()+'Form"';str+='style="';if((this.getX()!=-1)||(this.getY()!=-1)){str+="position:absolute; ";if(this.getY()!=-1){str=str+"top:"+this.getY()+"px; "}if(this.getX()!=-1){str=str+"left:"+this.getX()+"px;"}}if(this.getVisibility()){str+=" visibility:visible;"}else{str+=" visibility:hidden;"}str+='"';str+=">";if(this.getTitle()!=""){str+='<label id="'+this.getName()+'LabelId" style="';str+=this.getTextFontCSS().getCSS();str+='">';str+="&nbsp;";str+=this.getTitle();str+="</label>"}if(this.getLabelPosition()=="top"){str+="<br>"}str=str+"<select ";if(this.getDisabled()){str=str+"disabled "}str=str+' name="'+this.getName()+'Select" id="'+this.getName()+'Select" style="';str=str+this.getTextFontCSS().getCSS();str=str+'">';for(i=0;i<this.getValues().length;i++){if(this.getValues()[i]==this.getValueSelected()){str+='<option id="value'+i+'" selected="true">';str+=this.getValues()[i]+"</option>"}else{str+='<option id="value'+i+'">';str+=this.getValues()[i]+"</option>"}}str=str+"</select>";str=str+"</form>";return(str)}function setLabelColor(color){eval(doc+".getElementById('"+name+"Select').style.color = '"+color+"';");eval(doc+".getElementById('"+name+"LabelId').style.color = '"+color+"';");this.getTextFontCSS().setColor(color)}function getDisabled(){return this.disabled}function setDisabled(newValue){this.disabled=newValue;var auxForm=eval(this.getDoc()+'.getElementById("'+this.getName()+'Form");');auxForm.disabled=newValue;var auxSelected=eval(this.getDoc()+'.getElementById("'+this.getName()+'Select");');auxSelected.disabled=newValue;if(OpenLayers.IAAA_Utils.isNetscape()){if(newValue){eval(doc+".getElementById('"+name+"Select').style.color = '#808080';");try{eval(doc+".getElementById('"+name+"LabelId').style.color = '#808080';")}catch(e){}}else{eval(doc+".getElementById('"+name+"Select').style.color = '"+this.getTextFontCSS().getColor()+"';");try{eval(doc+".getElementById('"+name+"LabelId').style.color = '"+this.getTextFontCSS().getColor()+"';")}catch(e){}}}}}InputComboCSS.prototype=new InputCombo;function CheckBox(name,doc,checked,label,onMouseOverCheckedImage,onMouseOutCheckedImage,onMouseOverUncheckedImage,onMouseOutUncheckedImage,textFont,visibility){this._super=GUITextComponent;this._super(0,0,0,0,name||"inputText",doc,textFont);this.label=label||"";this.visibility=visibility||"";this.getChecked=getChecked;this.setChecked=setChecked;this.getLabel=getLabel;this.setLabel=setLabel;this.getVisibility=getVisibility;this.setVisibility=setVisibility;this.getHTML=getHTML;this.activate=activate;this.show=show;this.hide=hide;this.addMouseClickListener=addMouseClickListener;this.removeMouseClickListener=removeMouseClickListener;this.updateChecked=updateChecked;function getChecked(){return checked}function setChecked(newChecked){checked=newChecked}function getLabel(){return this.label}function setLabel(newLabel){this.label=newLabel}function getVisibility(){return this.visibility}function setVisibility(newVisibility){this.visibility=newVisibility}function getHTML(){str="";str+='<div id="'+this.getName()+'Id" ';str+='style="position:relative;cursor:pointer;';if(this.getY()!=0){str+="top:"+this.getY()+"px; "}if(this.getX()!=0){str+="left:"+this.getX()+"px; "}if(this.getVisibility()!=""){str+="visibility:'"+this.getVisibility()+"'"}str+='">';str+='<img name="'+this.getName()+'_img" id="'+this.getName()+'_img"';if(checked){str+=' src="'+onMouseOutCheckedImage+'" '}else{str+=' src="'+onMouseOutUncheckedImage+'" '}if(this.getWidth()!=0){str+=" width="+this.getWidth()}if(this.getHeight()!=0){str+=" height="+this.getHeight()}str+=' border="0" align="absmiddle">';if(this.getLabel()){str+="&nbsp;";str+=this.getTextFont().getHTMLStartTag();str+=this.getLabel();str+=this.getTextFont().getHTMLEndTag()}str+="</div>";return str}function activate(){eval(this.getDoc()+'.getElementById("'+this.getName()+"Id\").onclick = function() { _click('"+this.getName()+"'); } ");eval(this.getDoc()+'.getElementById("'+this.getName()+"Id\").onmouseover = function() { _mouseOver('"+this.getName()+"'); } ");eval(this.getDoc()+'.getElementById("'+this.getName()+"Id\").onmouseout = function() { _mouseOut('"+this.getName()+"'); } ")}function show(){eval("document.getElementById('"+name+'Id\').style.visibility = "visible"')}function hide(){eval("document.getElementById('"+name+'Id\').style.visibility = "hidden"')}function addMouseClickListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getName()+'Id")');OpenLayers.IAAA_Utils.addEvent(obj,"click",funct)}function removeMouseClickListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getName()+'Id")');removeEvent(obj,"click",funct)}function updateChecked(){if(checked){eval(doc+'.getElementById("'+name+'_img").src = "'+onMouseOutCheckedImage+'";')}else{eval(doc+'.getElementById("'+name+'_img").src = "'+onMouseOutUncheckedImage+'";')}}function _click(name){checked=!checked;if(checked){eval(doc+'.getElementById("'+name+'_img").src = "'+onMouseOverCheckedImage+'";')}else{eval(doc+'.getElementById("'+name+'_img").src = "'+onMouseOverUncheckedImage+'";')}}function _mouseOut(name){if(checked){eval(doc+'.getElementById("'+name+'_img").src = "'+onMouseOutCheckedImage+'";')}else{eval(doc+'.getElementById("'+name+'_img").src = "'+onMouseOutUncheckedImage+'";')}}function _mouseOver(name){if(checked){eval(doc+'.getElementById("'+name+'_img").src = "'+onMouseOverCheckedImage+'";')}else{eval(doc+'.getElementById("'+name+'_img").src = "'+onMouseOverUncheckedImage+'";')}}}CheckBox.prototype=new GUITextComponent;function CheckBoxCSS(name,doc,checked,label,onMouseOverCheckedImage,onMouseOutCheckedImage,onMouseOverUncheckedImage,onMouseOutUncheckedImage,textFont,visibility){this._super=CheckBox;this._super(name,doc,checked,label,onMouseOverCheckedImage,onMouseOutCheckedImage,onMouseOverUncheckedImage,onMouseOutUncheckedImage,textFont,visibility);this.disableImage="";this.disableImageUnchecked="";this.getHTML=getHTML;this.getLabel=getLabel;this.setLabel=setLabel;this.setLabelColor=setLabelColor;this.setLabelTextAlign=setLabelTextAlign;this.setLabelFontWeight=setLabelFontWeight;this.setLabelFontFamily=setLabelFontFamily;this.getDisabled=getDisabled;this.setDisabled=setDisabled;this.enableElement=enableElement;this.disableElement=disableElement;this.getDisableImage=getDisableImage;this.setDisableImage=setDisableImage;this.getDisableImageUnchecked=getDisableImageUnchecked;this.setDisableImageUnchecked=setDisableImageUnchecked;function getDisabled(){return this.disabled}function setDisabled(newValue){this.disabled=newValue;var auxId=eval(this.getDoc()+'.getElementById("'+this.getName()+'Id");');auxId.disabled=newValue;var auxImg=eval(this.getDoc()+'.getElementById("'+this.getName()+'_img");');auxImg.disabled=newValue;if(newValue){this.disableElement()}else{this.enableElement()}}function getDisableImage(){return this.disableImage}function setDisableImage(newImage){this.disableImage=newImage}function getDisableImageUnchecked(){return this.disableImageUnchecked}function setDisableImageUnchecked(newImage){this.disableImageUnchecked=newImage}function disableElement(){eval(this.getDoc()+'.getElementById("'+this.getName()+'Id").onclick = null; ');eval(this.getDoc()+'.getElementById("'+this.getName()+'Id").onmouseover = null; ');eval(this.getDoc()+'.getElementById("'+this.getName()+'Id").onmouseout = null; ');eval(this.getDoc()+'.getElementById("'+this.getName()+'Id").style.cursor = "default"; ');eval(this.getDoc()+'.getElementById("'+this.getName()+'_img").style.cursor = "default"; ');eval(this.getDoc()+'.getElementById("'+this.getName()+'LabelId").style.cursor = "default"; ');if(this.getDisableImage()!=""&&this.getChecked()){eval(this.getDoc()+'.getElementById("'+this.getName()+'_img").src = "'+this.getDisableImage()+'"; ')}if(this.getDisableImageUnchecked()!=""&&!this.getChecked()){eval(this.getDoc()+'.getElementById("'+this.getName()+'_img").src = "'+this.getDisableImageUnchecked()+'"; ')}if(OpenLayers.IAAA_Utils.isNetscape()){eval(doc+".getElementById('"+name+"LabelId').style.color = '#808080';")}}function enableElement(){this.activate();eval(this.getDoc()+'.getElementById("'+this.getName()+'Id").style.cursor = "pointer"; ');eval(this.getDoc()+'.getElementById("'+this.getName()+'_img").style.cursor = "pointer"; ');eval(this.getDoc()+'.getElementById("'+this.getName()+'LabelId").style.cursor = "pointer"; ');if(this.getDisableImage()!=""&&this.getChecked()){eval(this.getDoc()+'.getElementById("'+this.getName()+'_img").src = "'+onMouseOutCheckedImage+'"; ')}if(OpenLayers.IAAA_Utils.isNetscape()){eval(doc+".getElementById('"+name+"LabelId').style.color = '"+this.getTextFontCSS().getColor()+"';")}}function getHTML(){str="";str+='<div id="'+this.getName()+'Id" ';str+='style="position:relative;cursor:pointer;';if(this.getY()!=0){str+="top:"+this.getY()+"px; "}if(this.getX()!=0){str+="left:"+this.getX()+"px; "}if(this.getVisibility()!=""){str+="visibility:'"+this.getVisibility()+"'"}str+='">';str+='<img name="'+this.getName()+'_img" id="'+this.getName()+'_img"';if(checked){str+=' src="'+onMouseOutCheckedImage+'" '}else{str+=' src="'+onMouseOutUncheckedImage+'" '}if(this.getWidth()!=0){str+=" width="+this.getWidth()}if(this.getHeight()!=0){str+=" height="+this.getHeight()}str+=' border="0" align="absmiddle">';if(this.getLabel()){str+='<label id="'+this.getName()+'LabelId" style="cursor:pointer;';str+=this.getTextFontCSS().getCSS();str+='">';str+="&nbsp;";str+=this.getLabel();str+="</label>"}str+="</div>";return str}function setLabelColor(color){eval(doc+".getElementById('"+name+"LabelId').style.color = '"+color+"';");this.getTextFontCSS().setColor(color)}function setLabelTextAlign(align){eval(doc+".getElementById('"+name+"LabelId').style.textAlign = '"+align+"';")}function setLabelFontWeight(weight){eval(doc+".getElementById('"+name+"LabelId').style.fontWeight  = '"+weight+"';")}function setLabelFontFamily(face){eval(doc+".getElementById('"+name+"LabelId').style.fontFamily = '"+face+"';")}function setLabel(newLabelText){eval(doc+".getElementById('"+name+"LabelId').innerHTML = '"+newLabelText+"';")}function getLabel(){var obj=eval(doc+".getElementById('"+name+"LabelId')");if(obj!=null){return eval(doc+".getElementById('"+name+"LabelId')").innerHTML}else{return this.label}}}CheckBoxCSS.prototype=new CheckBox;function CheckBoxRadioCSS(name,doc,checked,label,onMouseOverCheckedImage,onMouseOutCheckedImage,onMouseOverUncheckedImage,onMouseOutUncheckedImage,textFont,visibility,radioList,radioIndex){this._super=CheckBoxCSS;this._super(name,doc,checked,label,onMouseOverCheckedImage,onMouseOutCheckedImage,onMouseOverUncheckedImage,onMouseOutUncheckedImage,textFont,visibility);this.getRadioList=getRadioList;this.setRadioList=setRadioList;this.getRadioIndex=getRadioIndex;this.setRadioIndex=setRadioIndex;this.deselectRadio=deselectRadio;this.activate=activate;this._mouseOut=_mouseOut;this._mouseOver=_mouseOver;this._click=_click;this.getChecked=getChecked;this.setChecked=setChecked;this.updateChecked=updateChecked;function getRadioList(){return radioList}function setRadioList(newRadioList){radioList=newRadioList}function getRadioIndex(){return radioIndex}function setRadioIndex(newRadioIndex){radioIndex=newRadioIndex}function getChecked(){return checked}function setChecked(newChecked){checked=newChecked}function updateChecked(){if(checked){eval(doc+'.getElementById("'+name+'_img").src = "'+onMouseOutCheckedImage+'";')}else{eval(doc+'.getElementById("'+name+'_img").src = "'+onMouseOutUncheckedImage+'";')}}function deselectRadio(){checked=false;eval(doc+'.getElementById("'+name+'_img").src = "'+onMouseOutUncheckedImage+'";')}function _click(name){checked=!checked;if(checked){for(var i=0;i<radioList.length;i++){if(i!=radioIndex){radioList[i].deselectRadio()}}eval(doc+'.getElementById("'+name+'_img").src = "'+onMouseOverCheckedImage+'";')}else{eval(doc+'.getElementById("'+name+'_img").src = "'+onMouseOverUncheckedImage+'";')}}function _mouseOut(name){if(checked){eval(doc+'.getElementById("'+name+'_img").src = "'+onMouseOutCheckedImage+'";')}else{eval(doc+'.getElementById("'+name+'_img").src = "'+onMouseOutUncheckedImage+'";')}}function _mouseOver(name){if(checked){eval(doc+'.getElementById("'+name+'_img").src = "'+onMouseOverCheckedImage+'";')}else{eval(doc+'.getElementById("'+name+'_img").src = "'+onMouseOverUncheckedImage+'";')}}function activate(){eval(this.getDoc()+'.getElementById("'+this.getName()+"Id\").onclick = function() { _click('"+this.getName()+"'); } ");eval(this.getDoc()+'.getElementById("'+this.getName()+"Id\").onmouseover = function() { _mouseOver('"+this.getName()+"'); } ");eval(this.getDoc()+'.getElementById("'+this.getName()+"Id\").onmouseout = function() { _mouseOut('"+this.getName()+"'); } ")}}CheckBoxRadioCSS.prototype=new CheckBoxCSS;function RadioButton(name,doc,initialPositionSelected,label,onMouseOverCheckedImage,onMouseOutCheckedImage,onMouseOverUncheckedImage,onMouseOutUncheckedImage,textFont,visibility,options,modifiableStyle){this._super=GUITextComponent;this._super(0,0,0,0,name||"inputText",doc,textFont);this.label=label||"";this.visibility=visibility||"";this.initialPositionSelected=initialPositionSelected||0;this.modifiableStyle=modifiableStyle||0;this.getInitialPositionSelected=getInitialPositionSelected;this.setInitialPositionSelected=setInitialPositionSelected;this.getCurrentPositionSelected=getCurrentPositionSelected;this.setCurrentPositionSelected=setCurrentPositionSelected;this.getLabel=getLabel;this.setLabel=setLabel;this.getModifiableStyle=getModifiableStyle;this.setModifiableStyle=setModifiableStyle;this.getVisibility=getVisibility;this.setVisibility=setVisibility;this.getOptions=getOptions;this.setOptions=setOptions;this.getOption=getOption;this.setOption=setOption;this.getHTML=getHTML;this.activate=activate;this.show=show;this.hide=hide;this.addMouseClickListener=addMouseClickListener;this.removeMouseClickListener=removeMouseClickListener;if(options){this.setOptions(options)}function getLabel(){return this.label}function setLabel(newLabel){this.label=newLabel}function getModifiableStyle(){return this.modifiableStyle}function setModifiableStyle(newModifiableStyle){this.modifiableStyle=newModifiableStyle}function getVisibility(){return this.visibility}function setVisibility(newVisibility){this.visibility=newVisibility}function getOptions(){return this.options}function setOptions(newOptions){this.options=new Array(newOptions.length);for(var i=0;i<newOptions.length;i++){this.options[i]=newOptions[i]}}function getOption(i){return this.options[i]}function setOption(i,newOptioni){if(this.options.length<=i){alert("RadioButton: setOption: indice fuera de rango")}else{this.options[i]=newOptioni}}function getInitialPositionSelected(){return this.initialPositionSelected}function setInitialPositionSelected(newChecked){this.initialPositionSelected=newChecked}function getCurrentPositionSelected(){return eval(doc+'.getElementsByName("'+name+'Checked")[0].value;')}function setCurrentPositionSelected(newChecked){var oldChecked=0;oldChecked=eval(doc+'.getElementsByName("'+name+'Checked")[0].value;');for(var i=0;i<options.length;i++){if(newChecked==i){eval(doc+'.images["'+name+i+'"].src = "'+onMouseOutCheckedImage+'";')}else{eval(doc+'.images["'+name+i+'"].src = "'+onMouseOutUncheckedImage+'";')}}eval(doc+'.getElementsByName("'+name+'Checked")[0].value = '+newChecked+";")}function getHTML(){str="";str+='<div id="'+this.getName()+'Id" ';str+='style="position:relative;cursor:pointer;';if(this.getWidth()!=0){str+=" width:"+this.getWidth()+"px;"}if(this.getHeight()!=0){str+=" height:"+this.getHeight()+"px;"}if(this.getY()!=0){str+="top:"+this.getY()+"px; "}if(this.getX()!=0){str+="left:"+this.getX()+"px; "}if(this.getVisibility()!=""){str+="visibility:'"+this.getVisibility()+"'"}str+=' ">';if(this.getLabel()){str+='<label id="'+this.getName()+'LabelId" style="cursor:pointer;';str+=this.getTextFontCSS().getCSS();str+='">';str+="&nbsp;";str+=this.getLabel();str+="</label>"}for(var i=0;i<this.options.length;i++){str+='<div id ="'+this.getName()+i+'Id"';if(!this.getModifiableStyle()[i]){str+="style='visibility:hidden;display:none;'"}str+='><img name="'+this.getName()+i+'" ';if(i==initialPositionSelected){str+=' src="'+onMouseOutCheckedImage+'" '}else{str+=' src="'+onMouseOutUncheckedImage+'" '}str+=' border="0">';if(this.getOption(i)){str+='<label id="'+this.getName()+'LabelId" style="cursor:pointer;';str+=this.getTextFontCSS().getCSS();str+='">';str+="&nbsp;";str+=this.getOption(i);str+="</label>"}str+="</div>"}str+='<input type="hidden" name="'+this.getName()+'Checked" value="'+initialPositionSelected+'">';str+="</div>";return str}function activate(){for(var i=0;i<this.options.length;i++){eval(this.getDoc()+'.getElementById("'+this.getName()+i+"Id\").onclick = function() { _click('"+i+"'); } ");eval(this.getDoc()+'.getElementById("'+this.getName()+i+"Id\").onmouseover = function() { _mouseOver('"+i+"'); } ");eval(this.getDoc()+'.getElementById("'+this.getName()+i+"Id\").onmouseout = function() { _mouseOut('"+i+"'); } ")}}function show(){eval(this.getDoc()+'.getElementById("'+this.getName()+'Id").style.visibility = "visible"');eval(this.getDoc()+'.getElementById("'+this.getName()+'Id").style.display = "block"')}function hide(){eval(this.getDoc()+'.getElementById("'+this.getName()+'Id").style.visibility = "hidden"');eval(this.getDoc()+'.getElementById("'+this.getName()+'Id").style.display = "none"')}function addMouseClickListener(funct){var obj;for(var i=0;i<this.options.length;i++){obj=eval(this.getDoc()+'.getElementById("'+this.getName()+i+'Id")');OpenLayers.IAAA_Utils.addEvent(obj,"click",funct)}}function removeMouseClickListener(funct){var obj;for(var i=0;i<this.options.length;i++){obj=eval(this.getDoc()+'.getElementById("'+this.getName()+i+'Id")');removeEvent(obj,"click",funct)}}function _click(newChecked){var oldChecked=0;oldChecked=eval(doc+'.getElementsByName("'+name+'Checked")[0].value;');eval(doc+'.images["'+name+oldChecked+'"].src = "'+onMouseOutUncheckedImage+'";');eval(doc+'.images["'+name+newChecked+'"].src = "'+onMouseOverCheckedImage+'";');setCurrentPositionSelected(newChecked)}function _mouseOut(newChecked){var oldChecked=0;oldChecked=eval(doc+'.getElementsByName("'+name+'Checked")[0].value;');if(newChecked==oldChecked){eval(doc+'.images["'+name+newChecked+'"].src = "'+onMouseOutCheckedImage+'";')}else{eval(doc+'.images["'+name+newChecked+'"].src = "'+onMouseOutUncheckedImage+'";')}}function _mouseOver(newChecked){var oldChecked=0;oldChecked=eval(doc+'.getElementsByName("'+name+'Checked")[0].value;');if(newChecked==oldChecked){eval(doc+'.images["'+name+newChecked+'"].src = "'+onMouseOverCheckedImage+'";')}else{eval(doc+'.images["'+name+newChecked+'"].src = "'+onMouseOverUncheckedImage+'";')}}}RadioButton.prototype=new GUITextComponent;function DialogBox(x,y,width,height,name,doc,label,buttons,functions,textFont,backgroundColor,borderColor,visibility,zIndex){this._super=GUITextComponent;this._super(x,y,width,height,name||"dialogBox",doc,textFont);this.label=label||"";this.visibility=visibility||"";this.buttons=buttons||"";this.functions=functions||"";this.backgroundColor=backgroundColor||"";this.borderColor=borderColor||"";this.zIndex=zIndex||"10";this.getLabel=getLabel;this.setLabel=setLabel;this.getVisibility=getVisibility;this.setVisibility=setVisibility;this.getFunctions=getFunctions;this.setFunctions=setFunctions;this.getButtons=getButtons;this.setButtons=setButtons;this.getBackgroundColor=getBackgroundColor;this.setBackgroundColor=setBackgroundColor;this.getBorderColor=getBorderColor;this.setBorderColor=setBorderColor;this.resize=resize;this.move=move;this.relocate=relocate;this.center=center;this.getHTML=getHTML;this.activate=activate;this.show=show;this.hide=hide;this.addMouseClickListenerI=addMouseClickListenerI;this.removeMouseClickListenerI=removeMouseClickListenerI;this.addMouseClickListener=addMouseClickListener;this.removeMouseClickListener=removeMouseClickListener;function getLabel(){return this.label}function setLabel(newLabel){this.label=newLabel}function getVisibility(){return this.visibility}function setVisibility(newVisibility){this.visibility=newVisibility}function getFunctions(){return(this.functions)}function setFunctions(newFunctions){return this.functions=newFunctions}function getButtons(){return(this.buttons)}function setButtons(newButtons){this.buttons=newButtons}function getBackgroundColor(){return(this.backgroundColor)}function setBackgroundColor(newBackgroundColor){this.backgroundColor=newBackgroundColor}function getBorderColor(){return(this.borderColor)}function setBorderColor(newBorderColor){this.borderColor=newBorderColor}function move(newX,newY){eval(this.getDoc()+'.getElementById("'+this.getName()+'Id").style.left = "'+newX+'px"');eval(this.getDoc()+'.getElementById("'+this.getName()+'Id").style.top = "'+newY+'px"');for(i=0;i<this.getButtons().length;i++){eval(this.getDoc()+'.getElementById("'+this.getName()+i+'Id").style.left = "'+(parseInt((this.getWidth()/(this.getButtons().length+1))+i*30))+'"')}}function resize(newWidth,newHeight){eval(this.getDoc()+'.getElementById("'+this.getName()+'Id").style.width = "'+newWidth+'"');eval(this.getDoc()+'.getElementById("'+this.getName()+'Id").style.height = "'+newHeight+'"')}function relocate(newX,newY,newWidth,newHeight){this.resize(newWidth,newHeight);this.move(newX,newY)}function center(){if(OpenLayers.IAAA_Utils.isNetscape()){var window=this.getDoc().split("document")[0]+"window";eval("windowWidth = "+window+".innerWidth");eval("windowHeight = "+window+".innerHeight")}else{if(document.body.clientWidth==0){eval("windowWidth = "+this.getDoc()+".documentElement.clientWidth")}else{eval("windowWidth = "+this.getDoc()+".body.clientWidth")}if(document.body.clientHeight==0){eval("windowHeight = "+this.getDoc()+".documentElement.clientHeight")}else{eval("windowHeight = "+this.getDoc()+".body.clientHeight")}}this.setX(parseInt((windowWidth-this.getWidth())/2));this.setY(parseInt((windowHeight-this.getHeight())/2));this.move(this.getX(),this.getY())}function getHTML(){str="";str=str+'<form name="'+this.getName()+'Form"> ';str+='<div  id="'+this.getName()+'Id" ';str+='style="position:absolute; cursor:pointer; ';str+="z-index:"+this.zIndex+"; ";str+="top:"+this.getY()+"px; ";str+="left:"+this.getX()+"px; ";str+=" height: "+this.getHeight()+"px;";str+=" width: "+this.getWidth()+"px;";if(this.getBorderColor()!=""){str+="border: outset "+this.getBorderColor()+";"}else{str+="border: outset black;"}str+="border-width: thin; ";str+="padding: 20px; ";str+="align: center; ";str+=this.getTextFontCSS().getCSS();if(this.getVisibility()!=""){str+="visibility:"+this.getVisibility()+"; "}if(this.getBackgroundColor()!=""){str+="background-color:"+this.getBackgroundColor()+";"}str+='">';if(this.getLabel()){str+='<label id="'+this.getName()+'LabelId" style="cursor:pointer;';str+=this.getTextFontCSS().getCSS();str+='">';str+="&nbsp;";str+=this.getLabel();str+="</label>";str+="<br>"}for(i=0;i<this.getButtons().length;i++){str+='<input type="button" ';str+=' id= "'+this.getName()+i+'Id" ';str+='value="'+this.getButtons()[i];str+='" style="position:relative;cursor:pointer;';str+=this.getTextFontCSS().getCSS();str+="left:"+((this.getWidth()/(this.getButtons().length+1))+i*30)+"px; ";str+="padding: 5px; ";str+=' ">'}str+="</div>";str+="</form>";return str}function activate(){for(var i=0;i<this.getFunctions().length;i++){if(this.getFunctions()[i]!=""){this.addMouseClickListenerI(this.getFunctions()[i],i)}else{this.addMouseClickListenerI(_cancel,i)}}}function show(){eval(this.getDoc()+".getElementById('"+name+'Id\').style.visibility = "visible"')}function hide(){eval(this.getDoc()+".getElementById('"+name+'Id\').style.visibility = "hidden"')}function addMouseClickListenerI(funct,i){var obj=eval(this.getDoc()+'.getElementById("'+this.getName()+i+'Id")');OpenLayers.IAAA_Utils.addEvent(obj,"click",funct)}function removeMouseClickListenerI(funct,i){var obj=eval(this.getDoc()+'.getElementById("'+this.getName()+i+'Id")');removeEvent(obj,"click",funct)}function addMouseClickListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getName()+'Id")');OpenLayers.IAAA_Utils.addEvent(obj,"click",funct)}function removeMouseClickListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getName()+'Id")');removeEvent(obj,"click",funct)}function _cancel(){hide()}function _click(){hide()}}DialogBox.prototype=new GUITextComponent;function FontCSS(r,B,a,u,g){this.fontFamily=r||"";this.fontSize=B||"";this.textAlign=a||"";this.fontWeight=u||"";this.color=g||"";this.getFontFamily=b;this.setFontFamily=l;this.getFontSize=o;this.setFontSize=f;this.getTextAlign=q;this.setTextAlign=k;this.getFontWeight=c;this.setFontWeight=m;this.getColor=A;this.setColor=v;this.getCSS=p;function b(){return this.fontFamily}function l(C){this.fontFamily=C}function o(){return this.fontSize}function f(C){this.fontSize=C}function q(){return this.textAlign}function k(C){this.textAlign=C}function c(){return this.fontWeight}function m(C){this.fontWeight=C}function A(){return this.color}function v(C){this.color=C}function p(){str="";if(this.getFontFamily()!=""){str+="font-family:"+this.getFontFamily()+"; "}if(this.getFontSize()!=""){str+="font-size:"+this.getFontSize()+"; "}if(this.getTextAlign()!=""){str+="text-align:"+this.getTextAlign()+"; "}if(this.getFontWeight()){str+="font-weight:"+this.getFontWeight()+";"}if(this.getColor()!=""){str+="color:"+this.getColor()+";"}return str}}function TextParagraph(name,x,y,width,height,doc,bgColor,url,visibility,borderColor,borderStyle,borderWidth,text,fontCSS){this._super=LayerHTML;this._super(name,x,y,width,height,doc,bgColor,url,visibility,borderColor,borderStyle,borderWidth);this.text=text||"";this.fontCSS=fontCSS||new FontCSS();this.getText=getText;this.setText=setText;this.getFontCSS=getFontCSS;this.setFontCSS=setFontCSS;this.getValue=getValue;this.setValue=setValue;this.getTextParagraphHTML=getTextParagraphHTML;function getText(){return this.text}function setText(newText){this.text=newText}function getFontCSS(){return this.fontCSS}function setFontCSS(newFontCSS){this.fontCSS=newFontCSS}function getTextParagraphHTML(){var str="<form name = '"+this.getName()+"Form'>";str+="<input type='text' readOnly='true' name = '"+this.getName()+"Input' style = 'position:absolute; ";str=str+"visibility: "+this.getVisibility()+"; ";str=str+"border-width: "+this.getBorderWidth()+"px; ";if(this.getBorderStyle()!=""){str=str+"border-style:"+this.getBorderStyle()+"; "}if(this.getBorderColor()!=""){str=str+"border-color:"+this.getBorderColor()+";  "}if(this.getBgColor()!=""){str=str+"background-color:"+this.getBgColor()+";  "}if(this.getUrl()!=""){str=str+"background: url("+this.getUrl()+"); "}if(this.getWidth()!=-1){str=str+"width:"+this.getWidth()+"px; "}if(this.getHeight()!=-1){str=str+"height:"+this.getHeight()+"px; "}if(this.getY()!=-1){str=str+"top:"+this.getY()+"px; "}str=str+"display: block; ";if(this.getX()!=-1){str=str+"left:"+this.getX()+"px;"}str+=this.getFontCSS().getCSS();str+="' value='"+this.getText()+"'>";str=str+"</input>";str=str+"</form>";return str}function getValue(){return eval(this.getDoc()+"."+this.getName()+"Form."+this.getName()+"Input.value")}function setValue(newValue){eval(this.getDoc()+"."+this.getName()+"Form."+this.getName()+'Input.value = "'+newValue+'";')}}TextParagraph.prototype=new LayerHTML;function LayerHTML(name,x,y,width,height,doc,bgColor,url,visibility,borderColor,borderStyle,borderWidth){this._super=GUIComponent;this._super(x,y,width,height,name||"layerName",doc);this.bgColor=bgColor||"";this.url=url||"";this.visibility=visibility||"visible";this.borderColor=borderColor||"";this.borderStyle=borderStyle||"";this.borderWidth=borderWidth||0;this.positionType="absolute";this.zIndex=0;this.getBgColor=getBgColor;this.setBgColor=setBgColor;this.getUrl=getUrl;this.setUrl=setUrl;this.getVisibility=getVisibility;this.setVisibility=setVisibility;this.getBorderColor=getBorderColor;this.setBorderColor=setBorderColor;this.getBorderStyle=getBorderStyle;this.setBorderStyle=setBorderStyle;this.getBorderWidth=getBorderWidth;this.setBorderWidth=setBorderWidth;this.getLayerHTML=getLayerHTML;this.updateBgColor=updateBgColor;this.updateUrl=updateUrl;this.updateLayerHTML=updateLayerHTML;this.updatePosition=updatePosition;this.updateDimensions=updateDimensions;this.updateDisplay=updateDisplay;this.updateBorderColor=updateBorderColor;this.addMouseDownListener=addMouseDownListener;this.removeMouseDownListener=removeMouseDownListener;this.addMouseUpListener=addMouseUpListener;this.removeMouseUpListener=removeMouseUpListener;this.addMouseMoveListener=addMouseMoveListener;this.removeMouseMoveListener=removeMouseMoveListener;this.addMouseOverListener=addMouseOverListener;this.removeMouseOverListener=removeMouseOverListener;this.addMouseOutListener=addMouseOutListener;this.removeMouseOutListener=removeMouseOutListener;this.addMouseClickListener=addMouseClickListener;this.removeMouseClickListener=removeMouseClickListener;this.setPositionType=setPositionType;this.getPositionType=getPositionType;this.setZIndex=setZIndex;this.getZIndex=getZIndex;function setPositionType(newPositionType){this.positionType=newPositionType}function getPositionType(){return this.positionType}function getBgColor(){return this.bgColor}function setBgColor(newBgColor){this.bgColor=newBgColor}function getVisibility(){return this.visibility}function setVisibility(newVisibility){this.visibility=newVisibility}function getUrl(){return this.url}function setUrl(newUrl){this.url=newUrl}function getBorderColor(){return this.borderColor}function setBorderColor(newColor){this.borderColor=newColor}function getBorderStyle(){return this.borderStyle}function setBorderStyle(newStyle){this.borderStyle=newStyle}function getBorderWidth(){return this.borderWidth}function setBorderWidth(newWidth){this.borderWidth=newWidth}function setZIndex(newZIndex){this.zIndex=newZIndex}function getZIndex(){return this.zIndex}function updatePosition(newX,newY){eval(this.getDoc()+'.getElementById("'+this.getName()+'").style.left = "'+newX+'px"');eval(this.getDoc()+'.getElementById("'+this.getName()+'").style.top = "'+newY+'px"')}function updateDimensions(newWidth,newHeight){eval(this.getDoc()+'.getElementById("'+this.getName()+'").style.width= "'+newWidth+'px"');eval(this.getDoc()+'.getElementById("'+this.getName()+'").style.height = "'+newHeight+'px"')}function updateLayerHTML(newX,newY,newWidth,newHeight){eval(this.getDoc()+'.getElementById("'+this.getName()+'").style.left = "'+newX+'px"');eval(this.getDoc()+'.getElementById("'+this.getName()+'").style.top = "'+newY+'px"');if(newWidth>=0){eval(this.getDoc()+'.getElementById("'+this.getName()+'").style.width= "'+newWidth+'px"')}else{eval(this.getDoc()+'.getElementById("'+this.getName()+'").style.width= "0px"')}if(newHeight>=0){eval(this.getDoc()+'.getElementById("'+this.getName()+'").style.height = "'+newHeight+'px"')}else{eval(this.getDoc()+'.getElementById("'+this.getName()+'").style.height = "0px"')}}function updateDisplay(newVisibility){eval(this.getDoc()+'.getElementById("'+this.getName()+"\").style.display = '"+newVisibility+"'")}function updateBgColor(newBgColor){eval(this.getDoc()+'.getElementById("'+this.getName()+'").style.backgroundColor = "'+newBgColor+'"')}function updateUrl(newUrl){alert("Eliminado el mï¿½todo updateURL")}function updateBorderColor(newColor){eval(this.getDoc()+'.getElementById("'+this.getName()+'").style.borderColor = "'+newColor+'"')}function getLayerHTML(){var str="<div id = '"+this.getName()+"' style ='position:"+this.getPositionType()+"; ";str=str+"visibility: "+this.getVisibility()+"; ";str=str+"border-width: "+this.getBorderWidth()+"px; ";if(this.getBorderStyle()!=""){str=str+"border-style:"+this.getBorderStyle()+"; "}if(this.getBorderColor()!=""){str=str+"border-color:"+this.getBorderColor()+";  "}if(this.getBgColor()!=""){str=str+"background-color:"+this.getBgColor()+";  "}if(this.getUrl()!=""){str=str+"background: url("+this.getUrl()+"); "}if(this.getWidth()!=-1){str=str+"width:"+this.getWidth()+"px; "}if(this.getHeight()!=-1){str=str+"height:"+this.getHeight()+"px; "}if(this.getY()!=-1){str=str+"top:"+this.getY()+"px; "}str=str+"display: block; ";if(this.getX()!=-1){str=str+"left:"+this.getX()+"px;"}str=str+"'>";str=str+" <!-- -->";str=str+"</div>";return str}function addMouseDownListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getName()+'")');OpenLayers.IAAA_Utils.addEvent(obj,"mousedown",funct)}function removeMouseDownListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getName()+'")');removeEvent(obj,"mousedown",funct)}function addMouseUpListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getName()+'")');OpenLayers.IAAA_Utils.addEvent(obj,"mouseup",funct)}function removeMouseUpListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getName()+'")');removeEvent(obj,"mouseup",funct)}function addMouseOverListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getName()+'")');OpenLayers.IAAA_Utils.addEvent(obj,"mouseover",funct)}function removeMouseOverListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getName()+'")');removeEvent(obj,"mouseover",funct)}function addMouseOutListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getName()+'")');OpenLayers.IAAA_Utils.addEvent(obj,"mouseout",funct)}function removeMouseOutListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getName()+'")');removeEvent(obj,"mouseout",funct)}function addMouseMoveListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getName()+'")');OpenLayers.IAAA_Utils.addEvent(obj,"mousemove",funct)}function removeMouseMoveListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getName()+'")');removeEvent(obj,"mousemove",funct)}function addMouseClickListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getName()+'")');OpenLayers.IAAA_Utils.addEvent(obj,"click",funct)}function removeMouseClickListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getName()+'")');removeEvent(obj,"click",funct)}}LayerHTML.prototype=new GUIComponent;function ImageHTML(a,c,O,m,K,Q,r,C,U,M,S,R,A,D){this._super=GUIComponent;this._super(S,R,a,c,r||"imageName","");this.altText=O||"";this.border=m||0;this.hspace=K||0;this.lowsrc=Q||"";this.src=C||"";this.vspace=U||0;this.zindex=M||"auto";this.visibility=A||"visible";this.otherHTML=D||"";this.useImageOpacity=false;this.positionType="absolute";this.getAltText=f;this.setAltText=I;this.getBorder=V;this.setBorder=Y;this.getHspace=g;this.setHspace=o;this.getLowsrc=l;this.setLowsrc=u;this.getSrc=q;this.setSrc=E;this.getVspace=v;this.setVspace=F;this.getZindex=k;this.setZindex=p;this.setPositionType=X;this.getPositionType=J;this.getVisibility=b;this.setVisibility=B;this.getOtherHTML=G;this.setOtherHTML=Z;this.getUseImageOpacity=H;this.setUseImageOpacity=T;function X(ab){this.positionType=ab}function J(){return this.positionType}this.getImageHTML=aa;function f(){return this.altText}function I(ab){this.altText=ab}function V(){return this.border}function Y(ab){this.border=ab}function H(){return this.useImageOpacity}function T(ab){this.useImageOpacity=ab}function g(){return this.hspace}function o(ab){this.hspace=ab}function l(){return this.lowsrc}function u(ab){this.lowsrc=ab}function q(){return this.src}function E(ab){this.src=ab}function v(){return this.vspace}function F(ab){this.vspace=ab}function k(){return this.zindex}function p(ab){this.zindex=ab}function b(){return this.visibility}function B(ab){this.visibility=ab}function G(){return this.otherHTML}function Z(ab){this.otherHTML=ab}function aa(){var ab="<img";if(this.getAltText().length>0){ab=ab+" alt= '"+this.getAltText()+"' "}ab=ab+" border = "+this.getBorder();if(this.getHeight()!=0){ab=ab+" height = "+this.getHeight()}ab=ab+" hspace = "+this.getHspace();ab=ab+' name = "'+this.getName()+'"';if(this.getSrc()!=""){if(!OpenLayers.IAAA_Utils.isNetscape()&&isPNGImage(this.getSrc())){ab=ab+' src = "'+getVacioGif()+'"'}else{ab=ab+' src = "'+this.getSrc()+'"'}}ab=ab+" vspace = "+this.getVspace();if(this.getWidth()!=0){ab=ab+" width = "+this.getWidth()}if(this.getZindex().toString().indexOf("auto")!=1){ab=ab+" zindex = "+this.getZindex()}ab=ab+" style ='visibility:"+this.getVisibility()+";";if(this.getPositionType()=="relative"){ab=ab+"position:relative;";if(this.getX()!=-1){ab=ab+"left:"+this.getX()+"px;"}if(this.getY()!=-1){ab=ab+"top:"+this.getY()+"px; "}}else{if((this.getX()!=-1)&&(this.getY()!=-1)){ab=ab+"position:absolute;";ab=ab+"top:"+this.getY()+"px; ";ab=ab+"left:"+this.getX()+"px;"}}if(this.getUseImageOpacity()){if(OpenLayers.IAAA_Utils.isNetscape()){ab+="-moz-opacity:1.0;"}else{ab+="filter:progid:DXImageTransform.Microsoft.Alpha(opacity=100);"}}if(this.getSrc()!=""){if(!OpenLayers.IAAA_Utils.isNetscape()&&isPNGImage(this.getSrc())){ab+='filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+this.getSrc()+'"\', sizingMethod="scale");'}}ab=ab+"'";ab+=this.getOtherHTML();ab=ab+">";return(ab)}}ImageHTML.prototype=new GUIComponent;function ToolButton(name,x,y,width,height,onOutURL,onOverURL,onClickURL,toolBarGroup,toolBarPosition,toolBar,doc,toolTip){this._super=Button;this._super(name,x,y,width,height,onOutURL,onOverURL,onClickURL,doc);this.selected=false;this.toolTip=toolTip||"";this.getSelected=getSelected;this.setSelected=setSelected;this.getToolTip=getToolTip;this.setToolTip=setToolTip;this.getToolButtonHTML=getToolButtonHTML;function getSelected(){return this.selected}function setSelected(newSelected){this.selected=newSelected;_refresh()}function getToolTip(){return this.toolTip}function setToolTip(newToolTip){this.toolTip=newToolTip}function getToolButtonHTML(){var nameImg=this.getName()+"Img";var str="";str=str+'<div id="'+this.getName()+'" ';str=str+'style=" ';if(this.getX()!=-1){str=str+"position:absolute; left:"+this.getX()+"px;"}if(this.getY()!=-1){if(this.getX()==-1){str=str+"position:absolute;"}str=str+"top:"+this.getY()+"px;"}str=str+'" ';var strAux="";if(this.getWidth()!=-1){strAux=strAux+this.getDoc()+"."+nameImg+".style.width='"+this.getWidth()+"px';"}if(this.getHeight()!=-1){strAux=strAux+this.getDoc()+"."+nameImg+".style.height='"+this.getHeight()+"px';"}str=str+'onmouseover="';if(!OpenLayers.IAAA_Utils.isNetscape()&&isPNGImage(this.getOnOverURL())){str=str+this.getDoc()+"."+nameImg+".src='"+getVacioGif()+"';";str=str+strAux;str=str+this.getDoc()+"."+nameImg+".style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale, src="+this.getOnOverURL()+")';"}else{str=str+this.getDoc()+"."+nameImg+".src='"+this.getOnOverURL()+"';";str=str+strAux}str=str+'return true" ';str=str+'onmousedown="';if(!OpenLayers.IAAA_Utils.isNetscape()&&isPNGImage(this.getOnClickURL())){str=str+this.getDoc()+"."+nameImg+".src='"+getVacioGif()+"';";str=str+strAux;str=str+this.getDoc()+"."+nameImg+".style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale, src="+this.getOnClickURL()+")';"}else{str=str+this.getDoc()+"."+nameImg+".src='"+this.getOnClickURL()+"';";str=str+strAux}str=str+'return true" ';str=str+'onmouseup="';if(!OpenLayers.IAAA_Utils.isNetscape()&&isPNGImage(this.getOnOverURL())){str=str+this.getDoc()+"."+nameImg+".src='"+getVacioGif()+"';";str=str+strAux;str=str+this.getDoc()+"."+nameImg+".style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale, src="+this.getOnOverURL()+")';"}else{str=str+this.getDoc()+"."+nameImg+".src='"+this.getOnOverURL()+"';";str=str+strAux}str=str+'return true" ';str=str+'onmouseout = "';if(!OpenLayers.IAAA_Utils.isNetscape()&&isPNGImage(this.getOnOverURL())){str=str+"if (getToolBar().isSelected("+toolBarGroup+", "+toolBarPosition+")) { ";str=str+this.getDoc()+"."+nameImg+".src='"+getVacioGif()+"';";str=str+strAux;str=str+this.getDoc()+"."+nameImg+".style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale, src="+this.getOnClickURL()+")';";str=str+"} else { ";str=str+this.getDoc()+"."+nameImg+".src='"+getVacioGif()+"';";str=str+strAux;str=str+this.getDoc()+"."+nameImg+".style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale, src="+this.getOnOutURL()+")';";str=str+"}"}else{str=str+"if (getToolBar().isSelected("+toolBarGroup+", "+toolBarPosition+")) { ";str=str+this.getDoc()+"."+nameImg+".src = '"+this.getOnClickURL()+"';";str=str+strAux;str=str+"} else { ";str=str+this.getDoc()+"."+nameImg+".src = '"+this.getOnOutURL()+"';";str=str+strAux;str=str+"}"}str=str+"return true\" style='cursor:pointer;'> ";if(this.toolTip!=""){str=str+'<a title="'+this.toolTip+'" >'}str=str+"<img ";str=str+' name = "'+nameImg+'"';if(toolBar.isSelected(toolBarGroup,toolBarPosition)){if(!OpenLayers.IAAA_Utils.isNetscape()&&isPNGImage(this.getOnClickURL())){str=str+'src="'+getVacioGif()+'" '}else{str=str+' src = "'+this.getOnClickURL()+'"'}}else{if(!OpenLayers.IAAA_Utils.isNetscape()&&isPNGImage(this.getOnOutURL())){str=str+'src="'+getVacioGif()+'" '}else{str=str+' src = "'+this.getOnOutURL()+'"'}}str=str+"style='visibility:"+this.getVisibility()+";z-index=1;";if(this.getWidth()!=-1){str=str+"width="+this.getWidth()+"px;"}if(this.getHeight()!=-1){str=str+"height="+this.getHeight()+"px;"}if(toolBar.isSelected(toolBarGroup,toolBarPosition)){if(!OpenLayers.IAAA_Utils.isNetscape()&&isPNGImage(this.getOnClickURL())){str=str+"filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale, src="+this.getOnClickURL()+");"}}else{if(!OpenLayers.IAAA_Utils.isNetscape()&&isPNGImage(this.getOnOutURL())){str=str+"filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale, src="+this.getOnOutURL()+");"}}str=str+"'>";if(this.toolTip!=""){str=str+"</a>"}str=str+"</div>";return(str)}function _refresh(){lastSelectedTool=toolBar.getLastSelectedTool();lastSelectedGroup=toolBar.getLastSelectedGroup();if((lastSelectedTool!=-1)&&(lastSelectedGroup!=-1)){aName=toolBar.getTool(lastSelectedGroup,lastSelectedTool).getName()+"Img";newURL=toolBar.getTool(lastSelectedGroup,lastSelectedTool).getOnOutURL();if(!OpenLayers.IAAA_Utils.isNetscape()&&isPNGImage(newURL)){eval(doc+"."+aName+'.style.filter = "progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale, src='+newURL+')";')}else{eval(doc+"."+aName+'.src = "'+newURL+'"')}}}}ToolButton.prototype=new Button;function Button(I,m,k,A,u,B,f,p,H,a){this._super=LayerHTML;this._super(I,m,k,A,u,H);this.onOutURL=B||"";tempImageOut=new Image();tempImageOut.src=B;this.onClickURL=p||"";tempImageClick=new Image();tempImageClick.src=p;this.onOverURL=f||"";tempImageOver=new Image();tempImageOver.src=f;this.altText="";this.title="";this.onClickFunction=a;this.getOnOutURL=v;this.setOnOutURL=D;this.getOnClickURL=C;this.setOnClickURL=E;this.getOnOverURL=q;this.setOnOverURL=r;this.getAltText=G;this.setAltText=F;this.getTitle=o;this.setTitle=l;this.getButtonHTML=c;this.getSimpleHTML=g;this.getSimpleHTMLOver=b;function v(){return this.onOutURL}function D(J){this.onOutURL=J;tempImage=new Image();tempImage.src=J}function G(){return this.altText}function F(J){this.altText=J}function o(){return this.title}function l(J){this.title=J}function C(){return this.onClickURL}function E(J){this.onClickURL=J;tempImage=new Image();tempImage.src=J}function q(){return this.onOverURL}function r(J){this.onOverURL=J;tempImage=new Image();tempImage.src=J}function c(){var J=new ImageHTML();J.setName(this.getName()+"Img");J.setWidth(this.getWidth());J.setHeight(this.getHeight());J.setSrc(this.getOnOutURL());J.setAltText(this.getAltText());var K="";K=K+'<div id="'+this.getName()+'" ';K=K+'onmouseover="';if(!OpenLayers.IAAA_Utils.isNetscape()&&isPNGImage(this.getOnOverURL())){K=K+this.getDoc()+"."+J.getName()+".src='"+getVacioGif()+"';";K=K+this.getDoc()+"."+J.getName()+".style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale, src="+this.getOnOverURL()+")';"}else{K=K+this.getDoc()+"."+J.getName()+".src='"+this.getOnOverURL()+"';"}K=K+this.getDoc()+"."+J.getName()+".title='"+this.getTitle()+"';";K=K+'return true" ';K=K+'onmousedown="';if(!OpenLayers.IAAA_Utils.isNetscape()&&isPNGImage(this.getOnClickURL())){K=K+this.getDoc()+"."+J.getName()+".src='"+getVacioGif()+"';";K=K+this.getDoc()+"."+J.getName()+".style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale, src="+this.getOnClickURL()+")';"}else{K=K+this.getDoc()+"."+J.getName()+".src='"+this.getOnClickURL()+"';"}K=K+'return true" ';K=K+'onmouseup="';if(!OpenLayers.IAAA_Utils.isNetscape()&&isPNGImage(this.getOnOverURL())){K=K+this.getDoc()+"."+J.getName()+".src='"+getVacioGif()+"';";K=K+this.getDoc()+"."+J.getName()+".style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale, src="+this.getOnOverURL()+")';"}else{K=K+this.getDoc()+"."+J.getName()+".src='"+this.getOnOverURL()+"';"}K=K+'return true" ';K=K+'onmouseout="';if(!OpenLayers.IAAA_Utils.isNetscape()&&isPNGImage(this.getOnOutURL())){K=K+this.getDoc()+"."+J.getName()+".src='"+getVacioGif()+"';";K=K+this.getDoc()+"."+J.getName()+".style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale, src="+this.getOnOutURL()+")';"}else{K=K+this.getDoc()+"."+J.getName()+".src='"+this.getOnOutURL()+"';"}K=K+'return true" ';K=K+'onclick="'+a+'"';K=K+" style='cursor: pointer;";if(this.getZIndex()!=0){K=K+" z-index:"+this.getZIndex()+";"}K=K+" position:"+this.getPositionType()+";";if(this.getX()!=-1){K=K+"left:"+this.getX()+"px;"}if(this.getY()!=-1){K=K+"top:"+this.getY()+"px;"}if(this.getWidth()!=-1){K=K+"width:"+this.getWidth()+"px;"}if(this.getHeight()!=-1){K=K+"height:"+this.getHeight()+"px;"}K=K+"'>";K=K+J.getImageHTML();K=K+"</div>";return(K)}function b(){var J=new ImageHTML();J.setName(this.getName()+"Img");J.setWidth(this.getWidth());J.setHeight(this.getHeight());J.setSrc(this.getOnOutURL());J.setAltText(this.getAltText());var K="";K=K+'<div id="'+this.getName()+'" ';K=K+'onmouseover = "'+this.getDoc()+"."+J.getName()+".src = '";K=K+this.getOnOverURL()+"'; return true\" ";K=K+'onmousedown = "'+this.getDoc()+"."+J.getName()+".src = '";K=K+this.getOnClickURL()+"'; return true\" ";K=K+'onmouseup = "'+this.getDoc()+"."+J.getName()+".src = '";K=K+this.getOnOverURL()+"'; return true\" ";K=K+'onmouseout = "'+this.getDoc()+"."+J.getName()+".src = '";K=K+this.getOnOutURL()+"'; return true\" ";K=K+" style='cursor: pointer;";K=K+"position:relative;";if(this.getX()!=-1){K=K+"left:"+this.getX()+"px;"}if(this.getY()!=-1){K=K+"top:"+this.getY()+"px;"}if(this.getWidth()!=-1){K=K+"width:"+this.getWidth()+"px;"}if(this.getHeight()!=-1){K=K+"height:"+this.getHeight()+"px;"}K=K+"'>";K=K+J.getImageHTML();K=K+"</div>";return(K)}function g(){var J=new ImageHTML();J.setName(this.getName()+"Img");J.setWidth(this.getWidth());J.setHeight(this.getHeight());J.setSrc(this.getOnOutURL());var K="";K=K+'<div id="'+this.getName()+'" ';K=K+this.getOnClickURL()+"'; return true\" ";K=K+" style='cursor: pointer;";K=K+"position:relative;";if(this.getX()!=-1){K=K+"left:"+this.getX()+"px;"}if(this.getY()!=-1){K=K+"top:"+this.getY()+"px;"}if(this.getWidth()!=-1){K=K+"width:"+this.getWidth()+"px;"}if(this.getHeight()!=-1){K=K+"height:"+this.getHeight()+"px;"}K=K+"'>";K=K+J.getImageHTML();K=K+"</div>";return(K)}}Button.prototype=new LayerHTML;function ImageButton(name,x,y,width,height,onOutURL,onOverURL,onClickURL,doc){this._super=LayerHTML;this._super(name,x,y,width,height,doc);this.altText="";this.getAltText=getAltText;this.setAltText=setAltText;this.getHTML=getHTML;this.activate=activate;this.addMouseClickListener=addMouseClickListener;this.removeMouseClickListener=removeMouseClickListener;function getAltText(){return this.altText}function setAltText(newAltText){this.altText=newAltText}function addMouseClickListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getName()+'")');OpenLayers.IAAA_Utils.addEvent(obj,"click",funct)}function removeMouseClickListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getName()+'")');removeEvent(obj,"click",funct)}function getHTML(){var str="";str=str+'<img id="'+this.getName()+'" ';str=str+" style='cursor: pointer;";str=str+"position:relative;";if(this.getX()!=-1){str=str+"left:"+this.getX()+"px;"}if(this.getY()!=-1){str=str+"top:"+this.getY()+"px;"}if(this.getWidth()!=-1){str=str+"width:"+this.getWidth()+"px;"}if(this.getHeight()!=-1){str=str+"height:"+this.getHeight()+"px;"}str=str+"'";str=str+' src="'+onOutURL+'"';if(this.getAltText()!=""){str=str+' alt="'+this.getAltText()+'"'}str=str+" ></img>";return(str)}function activate(){eval(this.getDoc()+'.getElementById("'+this.getName()+'").onclick = function() { _changeImageSource("'+this.getName()+'", "'+onClickURL+'"); } ');eval(this.getDoc()+'.getElementById("'+this.getName()+'").onmouseover = function() { _changeImageSource("'+this.getName()+'", "'+onOverURL+'"); } ');eval(this.getDoc()+'.getElementById("'+this.getName()+'").onmouseout = function() { _changeImageSource("'+this.getName()+'", "'+onOutURL+'"); } ')}function _changeImageSource(name,newImageSource){eval(doc+'.images["'+name+'"].src = "'+newImageSource+'";')}}ImageButton.prototype=new LayerHTML;function ToolBar(k){this._tools=new Array();this._nextPosition=0;this._lastSelectedTool=-1;this._currentSelectedTool=-1;this._lastSelectedGroup=-1;this._currentSelectedGroup=-1;if(k==null){this.structure=1}else{this.structure=k}this.separatorImg=null;this.imgWidth=null;this.imgHeight=null;this.addTool=m;this.getTool=p;this.addToolGroup=c;this.getToolGroup=q;this.getLength=u;this.isSelected=b;this.setSelected=r;this.getLastSelectedTool=a;this.getCurrentSelectedTool=g;this.getLastSelectedGroup=o;this.getCurrentSelectedGroup=l;this.unselectToolBar=f;this.setSeparatorImage=v;this.getToolBarHTML=A;function m(C,B){if((C<0)||(C==null)||(B==null)){alert("Error en ToolBar: addTool: indice fuera de rango")}else{if(C>=this.getLength()){this._tools[C]=new ToolButtonGroup(C)}this._tools[C].addTool(B)}}function c(B){if(B==null){alert("Error en ToolGroup: addTool: indice fuera de rango")}else{this._tools[this._nextPosition]=B;this._nextPosition++}}function p(C,B){if((C<0)||(C==null)||(C>=this.getLength())){alert("Error en ToolBar: getTool: indice de grupo fuera de rango")}else{if((B<0)||(B>=this._tools[C].getLength())||(B==null)){alert("Error en ToolBar: getTool: indice de herramienta fuera de rango")}else{return this._tools[C].getTool(B)}}}function q(B){if((B<0)||(B>=this.getLength())||B==null){alert("Error en ToolBar: getTool: indice fuera de rango")}else{return this._tools[B]}}function u(){return this._nextPosition}function b(B,C){if((B<0)||(B>=this.getLength())){alert("Error en ToolBar: getTool: indice fuera de rango")}else{if((C<0)||(C>=this._tools[B].getLength())){alert("Error en ToolBar: getToolGroup: indice fuera de rango")}else{return(this._tools[B]).getTool(C).getSelected()}}}function r(B,C){if((B<0)||(B>=this.getLength())){alert("Error en ToolBar: getToolGroup: indice fuera de rango")}else{if((C<0)||(C>=this._tools[B].getLength())){alert("Error en ToolBar: getToolButton: indice fuera de rango")}else{this._lastSelectedGroup=this._currentSelectedGroup;this._lastSelectedTool=this._currentSelectedTool;this._currentSelectedGroup=B;this._currentSelectedTool=C;(this._tools[this._currentSelectedGroup]).getTool(this._currentSelectedTool).setSelected(true);if((this._lastSelectedGroup!=-1)&&(this._lastSelectedTool!=-1)){(this._tools[this._lastSelectedGroup]).getTool(this._lastSelectedTool).setSelected(false)}}}}function o(){return this._lastSelectedGroup}function l(){return this._currentSelectedGroup}function a(){return this._lastSelectedTool}function g(){return this._currentSelectedTool}function f(){currGroup=this._currentSelectedGroup;currTool=this._currentSelectedTool;this._lastSelectedGroup=this._currentSelectedGroup;this._lastSelectedTool=this._currentSelectedTool;this._currentSelectedGroup=-1;this._currentSelectedTool=-1;if((currGroup!=-1)&&(currTool!=-1)){(this._tools[currGroup]).getTool(currTool).setSelected(false)}}function v(D,C,B){this.separatorImg=D;this.imgWidth=C;this.imgHeight=B}function A(){var C="";C='<table align="center" valign="middle" cellspacing="0" cellpadding="0" margin="0" id=\'tableToolbar\'><tr>';for(var B=0;B<this.getLength();B++){C+="<td>";C+=this.getToolGroup(B).getToolButtonGroupHTML();C+="</td>";if(this.structure==this.ALL_ROW){C+="</tr><tr>"}if(this.separatorImg!=null){C+='<td><div id="toolBarSeparator'+B+'"  style="';if(this.imgWidth!=null){C+="width:"+this.imgWidth+"px;"}if(this.imgHeight!=null){C+="height:"+this.imgHeight+"px;"}C+="background-image:url('"+this.separatorImg+"');\"><!-- --></div></td>"}if(this.structure==this.ALL_ROW){C+="</tr><tr>"}}C+="</tr></table>";return(C)}}ToolBar.prototype.ONE_ROW=1;ToolBar.prototype.ALL_ROW=2;function ToolButtonGroup(k,a){this._tools=new Array();this._nextPosition=0;this._id=k;this.addTool=c;this.getTool=g;this.getLength=b;this.getToolButtonGroupHTML=f;if(a==null){this.structure=1}else{this.structure=a}function c(l,m){this._tools[l]=m;this._nextPosition++}function g(l){if((l<0)||(l>=this.getLength())||(l==null)){alert("Error en ToolBar: getTool: indice fuera de rango")}else{return this._tools[l]}}function b(){return this._nextPosition}function f(){var m="";if(this.structure==this.SQUARE_ROW){m="<table id='tableToolGroupbar"+this._id+'\' align="center" valign="middle" cellspacing="0" cellpadding="0" margin="0" >';m+="<tr>";m+="<td colspan=3 valign=bottom align=center >";m+=this.getTool(0).getToolButtonHTML();m+="</td>";m+="</tr>";m+="<tr>";m+="<td align=right >";m+=this.getTool(1).getToolButtonHTML();m+="</td><td></td>";m+="<td align=center >";m+=this.getTool(3).getToolButtonHTML();m+="</td></tr>";m+="<tr>";m+="<td colspan=3 align=center >";m+=this.getTool(2).getToolButtonHTML();m+="</td>";m+="</tr>"}else{m="<table id='tableToolGroupbar"+this._id+'\' align="center" valign="middle" cellspacing="0" cellpadding="0" margin="0"  >';m+="<tr>";for(var l=0;l<this.getLength();l++){m+='<td align="center">';m+=this.getTool(l).getToolButtonHTML();m+="</td>";if(this.structure==this.ALL_ROW){m+="</tr><tr>"}else{if((this.structure==this.TWO_ROW)&&(l%2==1)){m+="</tr><tr>"}}}m+="</tr>"}m+="</table>";return(m)}}ToolButtonGroup.prototype.SQUARE_ROW=0;ToolButtonGroup.prototype.ONE_ROW=1;ToolButtonGroup.prototype.ALL_ROW=2;ToolButtonGroup.prototype.TWO_ROW=3;function SelectionSlider(name,title,values,valueSelected,x,y,doc,textFont){this._super=GUITextComponent;this._super(x,y,0,0,name||"inputOption",doc,textFont);this.title=title||"";this.values=values||new Array(0);this.valueSelected=valueSelected||"";this.getTitle=getTitle;this.setTitle=setTitle;this.getValues=getValues;this.setValues=setValues;this.getValueSelected=getValueSelected;this.setValueSelected=setValueSelected;this.getValue=getValue;this.setValue=setValue;this.getHTML=getHTML;this.addChangeListener=addChangeListener;this.removeChangeListener=removeChangeListener;function getTitle(){return this.title}function setTitle(newTitle){this.title=newTitle}function getValues(){return this.values}function setValues(newValues){this.values=newValues}function getValueSelected(){return this.valueSelected}function setValueSelected(newValueSelected){this.valueSelected=newValueSelected}function getValue(){var indexSelected=0;indexSelected=eval(this.getDoc()+"."+this.getName()+"Form."+this.getName()+"Select.selectedIndex");return(this.getValues()[indexSelected])}function setValue(newOption){var encontrado=false;var index=0;while((!encontrado)&&(index<this.getValues().length)){if(this.getValues()[index]==newOption){encontrado=true;eval(this.getDoc()+"."+this.getName()+"Form."+this.getName()+"Select.selectedIndex = "+index+";")}index++}}function getHTML(){var str="";str=str+'<form name="'+this.getName()+'Form" ';if((this.getX()!=-1)||(this.getY()!=-1)){str+='style="position:absolute; ';if(this.getY()!=-1){str=str+"top:"+this.getY()+"px; "}if(this.getX()!=-1){str=str+"left:"+this.getX()+"px;"}str+='"'}str+=">";str+=this.getTextFont().getHTMLStartTag();if(this.getTitle()!=""){str=str+this.getTitle()+"&nbsp&nbsp"}str=str+'<select name="'+this.getName()+'Select">';for(i=0;i<this.getValues().length;i++){if(this.getValues()[i]==this.getValueSelected()){str+='<option id="value'+i+'" selected="true">';str+=this.getValues()[i]+"</option>"}else{str+='<option id="value'+i+'">';str+=this.getValues()[i]+"</option>"}}str=str+"</select>";str+=this.getTextFont().getHTMLEndTag();str=str+"</form>";return(str)}function addChangeListener(funct){var obj=eval(this.getDoc()+"."+this.getName()+"Form."+this.getName()+"Select");OpenLayers.IAAA_Utils.addEvent(obj,"change",funct)}function removeChangeListener(funct){var obj=eval(this.getDoc()+"."+this.getName()+"Form."+this.getName()+"Select");removeEvent(obj,"change",funct)}}SelectionSlider.prototype=new GUITextComponent;function Toggle(name,doc,isExpanded,expandedImage,collapsedImage,textFont,expandedOverImage,collapsedOverImage){this._super=GUITextComponent;this._super(0,0,0,0,name||"aNameForToggle",doc,textFont);this.expanded=isExpanded||true;this.expandedImage=expandedImage;this.collapsedImage=collapsedImage;this.expandedOverImage=expandedOverImage||"";this.collapsedOverImage=collapsedOverImage||"";this.getExpanded=getExpanded;this.setExpanded=setExpanded;this.getExpandedImage=getExpandedImage;this.getCollapsedImage=getCollapsedImage;this.getExpandedOverImage=getExpandedOverImage;this.getCollapsedOverImage=getCollapsedOverImage;this.getHTML=getHTML;this.activate=activate;this.addMouseClickListener=addMouseClickListener;this.removeMouseClickListener=removeMouseClickListener;this.updateExpanded=updateExpanded;this.show=show;this.hide=hide;function doMouseOver(name){if(isExpanded){eval(doc+'.getElementById("'+name+'_img").src = "'+expandedOverImage+'";')}else{eval(doc+'.getElementById("'+name+'_img").src = "'+collapsedOverImage+'";')}}function doMouseOut(name){if(isExpanded){eval(doc+'.getElementById("'+name+'_img").src = "'+expandedImage+'";')}else{eval(doc+'.getElementById("'+name+'_img").src = "'+collapsedImage+'";')}}function getExpanded(){return isExpanded}function setExpanded(newIsExpanded){isExpanded=newIsExpanded}function getExpandedImage(){return this.expandedImage}function setExpandedImage(newExpandedImage){this.expandedImage=newExpandedImage}function getExpandedOverImage(){return this.expandedOverImage}function getCollapsedOverImage(){return this.collapsedOverImage}function getCollapsedImage(){return this.collapsedImage}function setCollapsedImage(newCollapsedImage){this.collapsedImage=newCollapsedImage}function getHTML(){var str="";var toggleImage;str+='<div id="'+name+'"';str+='style="position:relative;cursor:pointer;';if(this.getY()!=0){str+="top:"+this.getY()+"px; "}if(this.getX()!=0){str+="left:"+this.getX()+"px; "}str+='">';str+='<img id="'+name+'_img" ';if(this.getExpanded()){toggleImage=this.getExpandedImage()}else{toggleImage=this.getCollapsedImage()}str+=' src="'+toggleImage+'" ';if(this.getWidth()!=0){str+=" width="+this.getWidth()}if(this.getHeight()!=0){str+=" height="+this.getHeight()}str+=' border="0" align="absmiddle">';str+="</div>";return str}function activate(){eval(doc+'.getElementById("'+name+'").onclick = function() { _click(); } ');if(this.getExpandedOverImage()!=""&&this.getCollapsedOverImage()!=""){eval(doc+'.getElementById("'+name+'_img").onmouseover = function() { doMouseOver("'+name+'"); } ');eval(doc+'.getElementById("'+name+'_img").onmouseout = function() { doMouseOut("'+name+'"); } ')}}function show(){eval(doc+'.getElementById("'+name+'").style.visibility = "visible"')}function hide(){eval(doc+'.getElementById("'+name+'").style.visibility = "hidden"')}function addMouseClickListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+name+'")');OpenLayers.IAAA_Utils.addEvent(obj,"click",funct)}function removeMouseClickListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+name+'")');removeEvent(obj,"click",funct)}function updateExpanded(){if(this.getExpanded()){eval(doc+'.images["'+name+'"].src = "'+this.getExpandedImage()+'";')}else{eval(doc+'.images["'+name+'"].src = "'+this.getCollapsedImage()+'";')}}function _click(){var toggleImage;var visibility="";isExpanded=!isExpanded;if(isExpanded){visibility="visible";display="block"}else{visibility="hidden";display="none"}eval(doc+'.getElementById("'+name+'_content").style.visibility = "'+visibility+'";');eval(doc+'.getElementById("'+name+'_content").style.display = "'+display+'";');if(isExpanded){toggleImage=expandedImage}else{toggleImage=collapsedImage}eval(doc+'.getElementById("'+name+'_img").src = "'+toggleImage+'";')}}Toggle.prototype=new GUITextComponent;function ScaleRenderer(map,x,y,width,height,name,doc,textFont,scaleUnit){this.map=map;this._super=GUITextComponent;this._super(x,y,width,height,name||"scaleDiv",doc,textFont);this.scaleUnit=scaleUnit||"meters";this.getMap=getMap;this.setMap=setMap;this.getScaleUnit=getScaleUnit;this.setScaleUnit=setScaleUnit;this.getHTML=getHTML;this.update=update;this.updatePosition=updatePosition;function getMap(){return this.map}function setMap(newMap){this.map=newMap}function getScaleUnit(){return this.scaleUnit}function setScaleUnit(newScaleUnit){this.scaleUnit=newScaleUnit}function getHTML(){var str="";str+="<div id = '"+this.getName()+"Renderer' style ='position:absolute; ";str+="visibility: visible; ";if(this.getY()!=-1){str+="top:"+(this.getY())+"px; "}str+="display: block; ";if(this.getX()!=-1){str+="left:"+this.getX()+"px; "}str+="'>";str+="<div id = '"+this.getName()+"Bar' style ='position:absolute; ";str+="visibility: visible; ";str+="width:"+this.getWidth()+"px; ";str+="height:"+this.getHeight()+"px; ";str+="top:20px;";str+="display: block; ";str+="background-color:"+this.getTextFont().getFontColor()+"; ";str+="left:0px;'><script><\/script>";str+="</div>";str+=this.getTextFont().getHTMLStartTag();str+="<div id = '"+this.getName()+"TextBegin' style ='position:absolute; ";str+="visibility: visible; ";str+="top:0px; ";str+="display: block; ";str+="left:0px;'>";str+="0";str+="</div>";str+="<div nowrap id = '"+this.getName()+"TextEnd' style ='position:absolute; ";str+="visibility: visible; ";str+="top:0px; ";str+="display: block; ";str+="left:"+(this.getWidth()-10)+"px;'>";str+="0";str+="</div>";str+="</div>";str+=this.getTextFont().getHTMLEndTag();return str}function update(){p0=new OpenLayers.Pixel(0,0);p1=new OpenLayers.Pixel(this.getWidth(),0);dist=this.getMap().getPixelDistanceInMeters(p0,p1);if(this.getScaleUnit()=="miles"){distMiles=dist*0.00062;if(distMiles<1){if(distMiles>0.1){distYards=dist*1.09361;eval(this.getDoc()+'.getElementById("'+this.getName()+'TextEnd").innerHTML = "'+RoundDecimal(distYards,1)+' yd";')}else{distFeet=dist*3.28084;eval(this.getDoc()+'.getElementById("'+this.getName()+'TextEnd").innerHTML = "'+RoundDecimal(distFeet,1)+' ft";')}}else{eval(this.getDoc()+'.getElementById("'+this.getName()+'TextEnd").innerHTML = "'+RoundDecimal(distMiles,1)+' mi";')}}else{if(dist>1000){eval(this.getDoc()+'.getElementById("'+this.getName()+'TextEnd").innerHTML = "'+RoundDecimal(dist/1000,1)+' Km";')}else{if(dist<1){eval(this.getDoc()+'.getElementById("'+this.getName()+'TextEnd").innerHTML = "'+RoundDecimal(dist*100,1)+' cm";')}else{eval(this.getDoc()+'.getElementById("'+this.getName()+'TextEnd").innerHTML = "'+RoundDecimal(dist,1)+' m";')}}}}function updatePosition(newX,newY){eval(this.getDoc()+'.getElementById("'+this.getName()+'Renderer").style.left = "'+newX+'px";');eval(this.getDoc()+'.getElementById("'+this.getName()+'Renderer").style.top = "'+newY+'px";')}}ScaleRenderer.prototype=new GUITextComponent;function ScaleRendererCSS(b,o,m,f,q,c,p,k,g){this._super=ScaleRenderer;this._super(b,o,m,f,q,c,p,k,g);this.positionType="absolute";this.setPositionType=l;this.getPositionType=r;this.getHTML=a;function l(u){this.positionType=u}function r(){return this.positionType}function a(){var u="";u+="<div id = '"+this.getName()+"Renderer' style ='position:"+this.getPositionType()+"; ";u+="visibility: visible; ";if(this.getY()!=-1){u+="top:"+(this.getY())+"px; "}u+="display: block; ";if(this.getX()!=-1){u+="left:"+this.getX()+"px; "}u+="'>";u+="<div id = '"+this.getName()+"Bar' style ='position:absolute; ";u+="visibility: visible; ";u+="width:"+this.getWidth()+"px; ";u+="height:"+this.getHeight()+"px; ";u+="top:20px;";u+="display: block; ";u+="background-color:"+this.getTextFont().getColor()+"; ";u+="left:0px;'><img src='../img/others/vacio_negro.gif' style='height:"+this.getHeight()+"px; width:"+this.getWidth()+"px;'/>";u+="</div>";u+="<div id = '"+this.getName()+"TextBegin' style ='"+this.getTextFont().getCSS()+";position:absolute; ";u+="visibility: visible; ";u+="top:0px; ";u+="display: block; ";u+="left:0px;'>";u+="0";u+="</div>";u+="<div nowrap id = '"+this.getName()+"TextEnd' style ='"+this.getTextFont().getCSS()+";position:absolute; ";u+="visibility: visible;width:"+(this.getWidth()+10)+";";u+="top:0px; ";u+="display: block; ";u+="left:"+(this.getWidth()-10)+"px;'>";u+="0";u+="</div>";u+="</div>";return u}}ScaleRendererCSS.prototype=new ScaleRenderer;function MapMark(F,C,A,o,O,l,p,J,b,I){this.text=F||"";this.coordX=C||0;this.coordY=A||0;this.mapSrs=o||"EPSG:4326";this.color=O||"#FFFFFF";this.fontSize=l||12;this.backgroundColor=p||"";this.urlGif=J||"";this.urlGifWidth=b||5;this.urlGifHeight=I||5;this.getText=c;this.setText=Q;this.getCoordX=u;this.setCoordX=a;this.getCoordY=q;this.setCoordY=S;this.getMapSrs=f;this.setMapSrs=R;this.getColor=m;this.setColor=k;this.getFontSize=g;this.setFontSize=v;this.getBackgroundColor=H;this.setBackgroundColor=D;this.getUrlGif=G;this.setUrlGif=B;this.getUrlGifWidth=M;this.setUrlGifWidth=K;this.getUrlGifHeight=E;this.setUrlGifHeight=r;function c(){return this.text}function Q(T){this.text=T}function u(){return this.coordX}function a(T){this.coordX=T}function q(){return this.coordY}function S(T){this.coordY=T}function f(){return this.mapSrs}function R(T){this.mapSrs=T}function m(){return this.color}function k(T){this.color=T}function g(){return this.fontSize}function v(T){this.fontSize=T}function H(){return this.backgroundColor}function D(T){this.backgroundColor=T}function G(){return this.urlGif}function B(T){this.urlGif=T}function M(){return this.urlGifWidth}function K(T){this.urlGifWidth=T}function E(){return this.urlGifHeight}function r(T){this.urlGifHeight=T}}function MapRenderer(map,x,y,width,height,name,doc){this.map=map;this._super=GUIComponent;this._super(x,y,width,height,name||"mapDiv",doc);this.logoURL="";this.logoX=0;this.logoY=0;this.logo2URL="";this.logo2X=0;this.logo2Y=0;this.mapLayerRendererList=new Array();this.emptyImageURL="../../img/vacio.gif";this.useImageOpacity=false;this.mscRenderers=new Array();this.positionType="absolute";this.getMap=getMap;this.setMap=setMap;this.getMapLayerRendererList=getMapLayerRendererList;this.setMapLayerRendererList=setMapLayerRendererList;this.removeMapLayerRendererList=removeMapLayerRendererList;this.generateHTMLDivContent=generateHTMLDivContent;this.writeMapHTML=writeMapHTML;this.updateMap=updateMap;this.getIdListenerDiv=getIdListenerDiv;this.updateMapPosition=updateMapPosition;this.addClickListener=addClickListener;this.removeClickListener=removeClickListener;this.addMouseDownListener=addMouseDownListener;this.removeMouseDownListener=removeMouseDownListener;this.addMouseMoveListener=addMouseMoveListener;this.removeMouseMoveListener=removeMouseMoveListener;this.addMouseUpListener=addMouseUpListener;this.removeMouseUpListener=removeMouseUpListener;this.addMouseOverListener=addMouseOverListener;this.removeMouseOverListener=removeMouseOverListener;this.addMouseOutListener=addMouseOutListener;this.removeMouseOutListener=removeMouseOutListener;this.addMouseClickListener=addMouseClickListener;this.removeMouseClickListener=removeMouseClickListener;this.getMousePosition=getMousePosition;this.updateMapPrevious=updateMapPrevious;this.hasLayers=hasLayers;this.mustReloadMap=mustReloadMap;this.updateMapLayerFrom=updateMapLayerFrom;this.updateBackgroundPosition=updateBackgroundPosition;this.updateMapPosition2=updateMapPosition2;this.updateMapPosition3=updateMapPosition3;this.buildQuery=buildQuery;this.buildFormat=buildFormat;this.updateMapNoSLD=updateMapNoSLD;this.updateMapSLD=updateMapSLD;this.getLogoURL=getLogoURL;this.setLogoURL=setLogoURL;this.getLogoX=getLogoX;this.setLogoX=setLogoX;this.getLogoY=getLogoY;this.setLogoY=setLogoY;this.updateLogo=updateLogo;this.getLogo2URL=getLogo2URL;this.setLogo2URL=setLogo2URL;this.getLogo2X=getLogo2X;this.setLogo2X=setLogo2X;this.getLogo2Y=getLogo2Y;this.setLogo2Y=setLogo2Y;this.updateLogo2=updateLogo2;this.getUseImageOpacity=getUseImageOpacity;this.setUseImageOpacity=setUseImageOpacity;this.updateDimensions=updateDimensions;this.getEmptyImageURL=getEmptyImageURL;this.setEmptyImageURL=setEmptyImageURL;this.setMscRenderers=setMscRenderers;this.getMscRenderers=getMscRenderers;this.clearMscRenderers=clearMscRenderers;this.deleteMscIndex=deleteMscIndex;this.setPositionType=setPositionType;this.getPositionType=getPositionType;this.clone=clone;this.stopWMSQuery=stopWMSQuery;function clone(){var mapRendererNew=new MapRenderer();mapRendererNew.map=this.map.clone();mapRendererNew.x=this.getX();mapRendererNew.y=this.getY();mapRendererNew.width=this.getWidth();mapRendererNew.height=this.getHeight();mapRendererNew.name=this.getName();mapRendererNew.doc=this.getDoc();mapRendererNew.logoURL=this.getLogoURL();mapRendererNew.logoX=this.setLogoX();mapRendererNew.logoY=this.setLogoY();mapRendererNew.logo2URL=this.getLogo2URL();mapRendererNew.logo2X=this.setLogo2X();mapRendererNew.logo2Y=this.setLogo2Y();mapRendererNew.mapLayerRendererList=new Array(this.mapLayerRendererList.length);for(var i=0;i<this.mapLayerRendererList.length;i++){mapRendererNew.mapLayerRendererList[i]=this.mapLayerRendererList[i].clone()}mapRendererNew.emptyImageURL=this.getEmptyImageURL();mapRendererNew.useImageOpacity=this.getUseImageOpacity();mapRendererNew.mscRenderers=new Array(this.mscRenderers.length);for(var i=0;i<this.mscRenderers.length;i++){mapRendererNew.mscRenderers[i]=this.mscRenderers[i].clone()}mapRendererNew.positionType=this.getPositionType();return mapRendererNew}function getMscRenderers(){return this.mscRenderers}function setMscRenderers(newMscRenderers){this.mscRenderers=newMscRenderers}function getMap(){return this.map}function setMap(newMap){this.map=newMap}function getUseImageOpacity(){return this.useImageOpacity}function setUseImageOpacity(newUseImageOpacity){this.useImageOpacity=newUseImageOpacity}function setPositionType(newPositionType){this.positionType=newPositionType}function getPositionType(){return this.positionType}function generateHTMLDivContent(){str="";for(var jj=0;jj<this.getMap().orderList.length;jj++){jk=this.getMap().orderList[jj].index;if((this.getMap().orderList[jj].layerType==Layer.NAMEDLAYER)||(this.getMap().orderList[jj].layerType==Layer.USERLAYER)){otherHTML="";if((this.getMap().getOnLoadBeginFunct()!=null)&&(this.getMap().getOnLoadEndFunct()!=null)){otherHTML=' onLoad="'+this.getMap().getOnLoadBeginFunct()+jk+this.getMap().getOnLoadEndFunct()+'"'}this.mscRenderers[jk]=new MapServerConnectionRenderer(this,this.getMap().getMapServerConnection(jk),this.getName()+"MapImg"+jk);this.mscRenderers[jk].setUseImageOpacity(this.getUseImageOpacity());str+=this.mscRenderers[jk].getHTML(otherHTML)}else{str+=this.mapLayerRendererList[jk].getHTML()}}if(this.getLogoURL()!=""){str+="<div id='"+this.getName()+"Logo' style='position:absolute; ";str+="top:"+this.getLogoY()+"px; left:"+this.getLogoX()+"px;'>";str+="	<img id='MapRendererLogoID' src='"+this.getLogoURL()+"' />";str+="</div>"}if(this.getLogo2URL()!=""){str+="<div id='"+this.getName()+"Logo2' style='position:absolute; ";str+="top:"+this.getLogo2Y()+"px; left:"+this.getLogo2X()+"px;'>";str+="	<img id='MapRendererLogo2ID' src='"+this.getLogo2URL()+"' />";str+="</div>"}str+="<canvas id='"+this.getName()+"CanvasGeomDiv' style='position:absolute; top:0px; left:0px;' width='"+this.getMap().getWidth()+"' height='"+this.getMap().getHeight()+"'></canvas>";return str}function writeMapHTML(){var str="";str+="<div id = '"+this.getName()+"DivSuperior' style ='position:absolute; ";str+="visibility: visible; ";str+="background-image: url("+getEmptyImageURL()+"); ";str+="width:"+this.getWidth()+"px; ";str+="height:"+this.getHeight()+"px; ";str+="top:"+this.getY()+"px; ";str+="display: block; ";str+="z-index: 2; ";str+="left:"+this.getX()+"px;'>";str+="</div>";str+="<div id = '"+this.getName()+"Div' ";str+=" style ='position:"+this.getPositionType()+"; ";str+="visibility: visible; ";str+="width:"+this.getWidth()+"px; ";str+="height:"+this.getHeight()+"px; ";str+="top:"+this.getY()+"px; ";str+="display: block; ";str+="overflow:hidden; ";str+="left:"+this.getX()+"px;'>";str+=this.generateHTMLDivContent();str+="</div>";return str}function getIdListenerDiv(){return this.getName()+"DivSuperior"}function checkRatioExtent(ext1,ext2){ext1XOffset=ext1.getXMax()-ext1.getXMin();ext1YOffset=ext1.getYMax()-ext1.getYMin();ext2XOffset=ext2.getXMax()-ext2.getXMin();ext2YOffset=ext2.getYMax()-ext2.getYMin();xDiff=RoundDecimal(ext1XOffset-ext2XOffset,5);yDiff=RoundDecimal(ext1YOffset-ext2YOffset,5);if((xDiff==0)&&(yDiff==0)){return true}else{return false}}function updateMapPrevious(){currExt=this.getMap().getCurrentExtent().clone();if(this.getMap().previousExtent()){prevExt=this.getMap().getCurrentExtent().clone();if(checkRatioExtent(currExt,prevExt)){offsetX=currExt.getXMax()-currExt.getXMin();diffX=currExt.getXMax()-prevExt.getXMax();numPixelsX=Math.round((diffX/offsetX)*this.getWidth());offsetY=currExt.getYMax()-currExt.getYMin();diffY=currExt.getYMax()-prevExt.getYMax();numPixelsY=Math.round((diffY/offsetY)*this.getHeight());this.updateMapPosition3(numPixelsX*-1,numPixelsY)}else{this.updateMapPosition3(-1*this.getMap().getWidth(),-1*this.getMap().getHeight())}this.getMap().nextExtent()}eval(this.getDoc()+'.getElementById("'+this.getIdListenerDiv()+'").style.width = "'+this.getWidth()+'px"');eval(this.getDoc()+'.getElementById("'+this.getIdListenerDiv()+'").style.height = "'+this.getHeight()+'px"');eval(this.getDoc()+'.getElementById("'+this.getName()+'Div").style.width = "'+this.getWidth()+'px"');eval(this.getDoc()+'.getElementById("'+this.getName()+'Div").style.height = "'+this.getHeight()+'px"')}function buildQuery(ii){var querySLD="";var query="";if(this.getMap().getMapServerConnection(ii).getQuerySLD()!=null&&this.getMap().getMapServerConnection(ii).getQuerySLD()!=""){if(hasLayers(ii)){querySLD=this.getMap().getMapServerConnection(ii).getQuerySLD()}}else{for(var i=0;i<this.getMap().getMapServerConnection(ii).getLayerList().length;i++){var aNamedLayer=this.getMap().getMapServerConnection(ii).getLayerList()[i];var scale=this.getMap().getScale();var seguir=true;if(!aNamedLayer.getVisibility()){seguir=false}else{if(aNamedLayer.getApplyScaleFilter()){if(scale>aNamedLayer.getMaxScale()||scale<aNamedLayer.getMinScale()){seguir=false}}}if(seguir||aNamedLayer.getChildLayerCount()>0){querySLD+=aNamedLayer.getSLDQuery()}}}if(querySLD!=""){var srsWMS=this.getMap().getDefaultSrs();if(this.getMap().getMapServerConnection(ii).getSrs()!=""){srsWMS=this.getMap().getMapServerConnection(ii).getSrs()}punto=coordTransform(this.getMap().getDefaultSrs(),srsWMS,this.getMap().getCurrentExtent().getXMin(),this.getMap().getCurrentExtent().getYMin());xMin=punto[0];yMin=punto[1];punto=coordTransform(this.getMap().getDefaultSrs(),srsWMS,this.getMap().getCurrentExtent().getXMax(),this.getMap().getCurrentExtent().getYMax());xMax=punto[0];yMax=punto[1];var bBoxViewer=new Array(xMin,xMax,yMax,yMin);if(!this.getMap().getMapServerConnection(ii).getIsOldSLD()){query='<?xml version="1.0" encoding="UTF-8"?>\n<ogc:GetMap xmlns:sld="http://www.opengis.net/sld" xmlns:ogc="http://www.opengis.net/ows" xmlns:gml="http://www.opengis.net/gml" version="1.1.1" service="WMS">\n';if(querySLD.indexOf("<StyledLayerDescriptor")!=-1||querySLD.indexOf("<sld:StyledLayerDescriptor")!=-1){query+=querySLD}else{query+='<StyledLayerDescriptor version="1.0.0" xmlns="http://www.opengis.net/sld" xmlns:gml="http://www.opengis.net/gml" xmlns:wfs="http://www.opengis.net/wfs" xmlns:ogc="http://www.opengis.net/ogc" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://schemas.opengis.net/sld/1.0.0/StyledLayerDescriptor.xsd">\n';query+=querySLD;query+="</StyledLayerDescriptor>"}var format=this.getMap().getMapServerConnection(ii).getFormat();if(this.getMap().getMapServerConnection(ii).getFormat().length>=6){var aux1=new String("IMAGE/");var aux2=this.getMap().getMapServerConnection(ii).getFormat().substring(0,aux1.length);if(aux2.toUpperCase()==aux1){format=this.getMap().getMapServerConnection(ii).getFormat().substring(aux1.length,this.getMap().getMapServerConnection(ii).getFormat().length)}}var transparent=this.getMap().getMapServerConnection(ii).getTransparent().toLowerCase();var versionMsc=this.getMap().getMapServerConnection(ii).getVersion().split(".");if((versionMsc[1]>=1)&&(versionMsc[2]>=1)){query+='<BoundingBox srsName="'+srsWMS+'">\n		<gml:lowerCorner>'+xMin+","+yMin+"		</gml:lowerCorner>\n		<gml:upperCorner>"+xMax+","+yMax+"		</gml:upperCorner>\n</BoundingBox>\n";query+="<Output>\n		<Format>image/"+format.toLowerCase()+"</Format>\n		<Transparent>"+transparent+"</Transparent>\n		<Size>\n				<Width>"+this.getMap().getWidth()+"</Width>\n				<Height>"+this.getMap().getHeight()+"</Height>\n		</Size>\n</Output>\n"}else{query+='<sld:BoundingBox srsName="'+srsWMS+'">\n		<gml:coord>\n				<gml:X>'+xMin+"</gml:X>\n				<gml:Y>"+yMin+"</gml:Y>\n		</gml:coord>\n		<gml:coord>\n				<gml:X>"+xMax+"</gml:X>\n				<gml:Y>"+yMax+"</gml:Y>\n		</gml:coord>\n</sld:BoundingBox>\n";query+="<sld:Output>\n		<sld:Format>image/"+format.toLowerCase()+"</sld:Format>\n		<sld:Transparent>"+transparent+"</sld:Transparent>\n		<sld:Size>\n				<sld:Width>"+this.getMap().getWidth()+"</sld:Width>\n				<sld:Height>"+this.getMap().getHeight()+"</sld:Height>\n		</sld:Size>\n</sld:Output>\n"}query+="<ogc:Exceptions>"+this.getMap().getMapServerConnection(ii).getException()+"</ogc:Exceptions>\n";query+="</ogc:GetMap>\n"}else{query='<?xml version="1.0" encoding="UTF-8"?>\n<GetMap>\n';query+="<StyledLayerDescriptor>\n";query+=querySLD;query+="</StyledLayerDescriptor>\n";var format=this.getMap().getMapServerConnection(ii).getFormat();if(this.getMap().getMapServerConnection(ii).getFormat().length>=6){var aux1=new String("IMAGE/");var aux2=this.getMap().getMapServerConnection(ii).getFormat().substring(0,aux1.length);if(aux2.toUpperCase()==aux1){format=this.getMap().getMapServerConnection(ii).getFormat().substring(aux1.length,this.getMap().getMapServerConnection(ii).getFormat().length)}}var transparent=this.getMap().getMapServerConnection(ii).getTransparent().toUpperCase();query+='<BoundingBox SRS="'+srsWMS+'" minx="'+xMin+'" miny="'+yMin+'" maxx="'+xMax+'" maxy="'+yMax+'" />\n';query+="<Width>"+this.getMap().getWidth()+"</Width>\n";query+="<Height>"+this.getMap().getHeight()+"</Height>\n";query+="<Format><"+format.toUpperCase()+"/></Format>\n";query+="<Transparent><"+transparent+"/></Transparent>\n";query+="<ExceptionFormat>"+this.getMap().getMapServerConnection(ii).getException()+"</ExceptionFormat>\n";query+="</GetMap>\n"}}return query}function buildFormat(ii){var format=this.getMap().getMapServerConnection(ii).getFormat();if(this.getMap().getMapServerConnection(ii).getFormat().length>=6){var aux1=new String("IMAGE/");var aux2=this.getMap().getMapServerConnection(ii).getFormat().substring(0,aux1.length);if(aux2.toUpperCase()==aux1){format=this.getMap().getMapServerConnection(ii).getFormat().substring(aux1.length,this.getMap().getMapServerConnection(ii).getFormat().length)}}return format}function hasLayers(iii){var hayCapas=false;var auxArray=this.getMap().getMapServerConnection(iii).getLayerList();for(var j=0;j<auxArray.length;j++){if(auxArray[j].getVisibility()){if(auxArray[j].getApplyScaleFilter()){if(this.getMap().getScale()<=auxArray[j].getMaxScale()){if(this.getMap().getScale()>=auxArray[j].getMinScale()){hayCapas=true}}}else{hayCapas=true}}else{if(auxArray[j].getChildLayerCount()>0){for(var kk=0;kk<auxArray[j].getChildLayerCount();kk++){aChildNamedLayer=auxArray[j].getChildLayer(kk);if(aChildNamedLayer.getVisibility()){if(aChildNamedLayer.getApplyScaleFilter()){if(this.getMap().getScale()<=aChildNamedLayer.getMaxScale()){if(this.getMap().getScale()>=aChildNamedLayer.getMinScale()){hayCapas=true}}}else{hayCapas=true}}}}}}return hayCapas}function mustReloadMap(iii){var urlImage="";var lastURL="";if(this.getMap().getMapServerConnection(iii).getIsSLD()!=0){urlImage=this.buildQuery(iii);lastURL=this.getMap().getMapServerConnection(iii).getLastRequest()}else{urlImage=this.getMap().getMapImage(iii);lastURL=this.getMap().getMapServerConnection(iii).getLastRequest()}return(lastURL!=urlImage)}function updateMapLayerFrom(index,canvasObj){this.mapLayerRendererList[index].updateMapLayer(canvasObj)}function updateMapNoSLD(iii,isTransparentPNG){var urlImage=this.getMap().getMapImage(iii);if(urlImage==""){this.mscRenderers[iii].updateImage("","hidden",this.getWidth(),this.getHeight(),false)}else{if(this.mustReloadMap(iii)){if(this.hasLayers(iii)){if(this.getMap().getMapServerConnection(iii).getIsSLD()==0){urlImage=this.getMap().getMapImage(iii)}this.getMap().getMapServerConnection(iii).setLastRequest(urlImage);this.mscRenderers[iii].updateImage(urlImage,"visible",this.getWidth(),this.getHeight(),isTransparentPNG)}else{}}else{}}}var ajaxList=new Array();function updateMapSLD(iii,isTransparentPNG){function nuevoAjax(){var xmlhttp=false;try{xmlhttp=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}catch(E){xmlhttp=false}}if(!xmlhttp&&typeof XMLHttpRequest!="undefined"){xmlhttp=new XMLHttpRequest()}return xmlhttp}var urlImage=new String("");if(this.mustReloadMap(iii)){if(this.hasLayers(iii)){var request=this.buildQuery(iii);var imageFormat=this.buildFormat(iii);var numServer=iii;if(numServer>=0&&request!=""){var msc=this.getMap().getMapServerConnection(numServer);var mapServer=msc.getMapServer();var mscAux=this.mscRenderers[iii];var widthAux=this.getWidth();var heightAux=this.getHeight();ajaxList[numServer]=nuevoAjax();var newURLRelayServlet=urlRelayServlet;var paramURLRelayServlet="";if(urlRelayServlet.indexOf("?")!=-1){newURLRelayServlet=urlRelayServlet.substring(0,urlRelayServlet.indexOf("?"));paramURLRelayServlet=urlRelayServlet.substring(urlRelayServlet.indexOf("?")+1,urlRelayServlet.length)}ajaxList[numServer].open("POST",newURLRelayServlet,true);ajaxList[numServer].onreadystatechange=function(){if(ajaxList[numServer].readyState==4){var urlAuxAnterior=urlAux;urlAux=ajaxList[numServer].responseText;urlImage=urlAux;if(urlImage.length!=0){if(msc.getIsVisibleWMS()){mapServer.setURLImage(urlImage);mscAux.updateImage(urlImage,"visible",widthAux,heightAux,isTransparentPNG)}}else{ajaxList[numServer]=nuevoAjax();ajaxList[numServer].open("POST",newURLRelayServlet,true);ajaxList[numServer].onreadystatechange=function(){if(ajaxList[numServer].readyState==4){urlAux=ajaxList[numServer].responseText;urlImage=urlAux;if(urlImage.length!=0){if(msc.getIsVisibleWMS()){mapServer.setURLImage(urlImage);mscAux.updateImage(urlImage,"visible",widthAux,heightAux,isTransparentPNG)}}}};ajaxList[numServer].setRequestHeader("Content-Type","application/x-www-form-urlencoded");ajaxList[numServer].send(urlAuxAnterior)}}};var URL=this.getMap().getMapServerConnection(iii).getMapServer().getURL();var versionMsc=this.getMap().getMapServerConnection(iii).getVersion().split(".");var urlAux="";if(this.getMap().getMapServerConnection(iii).getIsOldSLD()){urlAux="url="+URL+"&REQUEST="+request+"&imageFormat="+imageFormat}else{urlAux="url="+URL+"&request="+request+"&imageFormat="+imageFormat}if(paramURLRelayServlet!=""){urlAux+="&"+paramURLRelayServlet}ajaxList[numServer].setRequestHeader("Content-Type","application/x-www-form-urlencoded");this.getMap().getMapServerConnection(iii).setLastRequest(request);ajaxList[numServer].send(urlAux)}}}}function updateMap(updateMapRenderer){var canvasObj=null;if(updateMapRenderer){this.mscRenderers=new Array();str=this.generateHTMLDivContent();divSup=document.getElementById(this.getName()+"Div");divSup.innerHTML=str;if(this.mapLayerRendererList.length>0){var canvasID=this.getName()+"CanvasGeomDiv";var obj=eval(this.getDoc()+'.getElementById("'+canvasID+'")');if(!OpenLayers.IAAA_Utils.isNetscape()){if(obj){if(typeof G_vmlCanvasManager!="undefined"){canvasObj=G_vmlCanvasManager.initElement(obj)}}}else{canvasObj=obj}}if(canvasObj){var ctx=null;if(canvasObj.getContext){ctx=canvasObj.getContext("2d");ctx.clearRect(0,0,parseInt(this.getMap().getWidth()),parseInt(this.getMap().getHeight()))}}for(var iii=0;iii<this.getMap().getMapServerConnectionCount();iii++){this.getMap().getMapServerConnection(iii).setLastRequest("")}}else{if(this.mapLayerRendererList.length>0){var canvasID=this.getName()+"CanvasGeomDiv";canvasObj=eval(this.getDoc()+'.getElementById("'+canvasID+'")');var ctx=null;if(canvasObj.getContext){ctx=canvasObj.getContext("2d");ctx.clearRect(0,0,parseInt(this.getMap().getWidth()),parseInt(this.getMap().getHeight()))}}}for(var iii=0;iii<this.getMap().getMapServerConnectionCount();iii++){var isTransparentPNG=false;if(!OpenLayers.IAAA_Utils.isNetscape()){var seguir=true;try{var navegatorVersion=navigator.appVersion+"";if(navegatorVersion.indexOf("MSIE 7")!=-1){seguir=false}}catch(e){seguir=true}if(seguir){var format=this.getMap().getMapServerConnection(iii).getFormat().toUpperCase();if(format.indexOf("/")!=-1){format=format.substring(format.indexOf("/")+1,format.length)}if(format=="PNG"){if(this.getMap().getMapServerConnection(iii).getTransparent()=="TRUE"){isTransparentPNG=true}}}}if(this.getMap().getMapServerConnection(iii).getIsSLD()==0){this.updateMapNoSLD(iii,isTransparentPNG)}else{this.updateMapSLD(iii,isTransparentPNG)}}for(var iii=0;iii<this.mapLayerRendererList.length;iii++){this.updateMapLayerFrom(iii,canvasObj)}}function updateBackgroundPosition(){alert("MapRenderer:updateBackgroundPosition is deprecated. Use updateMapPosition instead")}function updateMapPosition(newX,newY){var divName=name+"Div";var obj=eval(this.getDoc()+'.getElementById("'+divName+'")');if(obj){if(newX<0){newLeft=newX*-1;newWidth=this.getWidth();obj.style.left=(this.getX()+newX)+"px "}else{newLeft=0;newWidth=this.getWidth()-newX;obj.style.left=(this.getX()+newX)+"px "}if(newY<0){newTop=newY*-1;newHeight=this.getHeight();obj.style.top=(this.getY()+newY)+"px "}else{newTop=0;newHeight=this.getHeight()-newY;obj.style.top=(this.getY()+newY)+"px "}foo="rect("+newTop+"px "+newWidth+"px "+newHeight+"px "+newLeft+"px)";obj.style.clip=foo}}function updateMapPosition2(newX,newY,index){mscRend=this.mscRenderers[index];if(newX<0){newLeft=newX*-1;newWidth=this.getWidth();mscRend.updateLeft(newX)}else{newLeft=0;newWidth=this.getWidth()-newX;mscRend.updateLeft(newX)}if(newY<0){newTop=newY*-1;newHeight=this.getHeight();mscRend.updateTop(newY)}else{newTop=0;newHeight=this.getHeight()-newY;mscRend.updateTop(newY)}foo="rect("+newTop+"px "+newWidth+"px "+newHeight+"px "+newLeft+"px)";mscRend.updateClip(foo)}function updateMapPosition3(newX,newY){for(var index=0;index<this.getMap().getMapServerConnectionCount();index++){mscRend=this.mscRenderers[index];if(newX<0){newLeft=newX*-1;newWidth=this.getWidth();mscRend.updateLeft(newX)}else{newLeft=0;newWidth=this.getWidth()-newX;mscRend.updateLeft(newX)}if(newY<0){newTop=newY*-1;newHeight=this.getHeight();mscRend.updateTop(newY)}else{newTop=0;newHeight=this.getHeight()-newY;mscRend.updateTop(newY)}foo="rect("+newTop+"px "+newWidth+"px "+newHeight+"px "+newLeft+"px)";mscRend.updateClip(foo)}}function stopWMSQuery(indexWMS){if(indexWMS>=0&&indexWMS<this.getMap().getMapServerConnectionCount()){this.getMap().getMapServerConnection(indexWMS).setLastRequest("");this.getMap().getMapServerConnection(indexWMS).setIsVisibleWMS(false);this.mscRenderers[indexWMS].updateImage("","hidden",this.getWidth(),this.getHeight(),false);var onLoadBeginFunct=this.getMap().getOnLoadBeginFunct();var onLoadEndFunct=this.getMap().getOnLoadEndFunct();eval(onLoadBeginFunct+indexWMS+onLoadEndFunct)}}function addClickListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getIdListenerDiv()+'")');addEvent(obj,"click",funct)}function removeClickListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getIdListenerDiv()+'")');removeEvent(obj,"click",funct)}function addMouseDownListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getIdListenerDiv()+'")');addEvent(obj,"mousedown",funct)}function removeMouseDownListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getIdListenerDiv()+'")');removeEvent(obj,"mousedown",funct)}function addMouseMoveListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getIdListenerDiv()+'")');addEvent(obj,"mousemove",funct)}function removeMouseMoveListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getIdListenerDiv()+'")');removeEvent(obj,"mousemove",funct)}function addMouseUpListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getIdListenerDiv()+'")');addEvent(obj,"mouseup",funct)}function removeMouseUpListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getIdListenerDiv()+'")');removeEvent(obj,"mouseup",funct)}function addMouseOverListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getIdListenerDiv()+'")');addEvent(obj,"mouseover",funct)}function removeMouseOverListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getIdListenerDiv()+'")');removeEvent(obj,"mouseover",funct)}function addMouseOutListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getIdListenerDiv()+'")');addEvent(obj,"mouseout",funct)}function removeMouseOutListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getIdListenerDiv()+'")');removeEvent(obj,"mouseout",funct)}function addMouseClickListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getIdListenerDiv()+'")');addEvent(obj,"click",funct)}function removeMouseClickListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getIdListenerDiv()+'")');removeEvent(obj,"click",funct)}function getMousePosition(e){var _foo=new ScreenPoint();offLeft=0;offTop=0;obj=eval(this.getDoc()+'.getElementById("'+this.getIdListenerDiv()+'")');if(obj){parentObj=obj.parentNode;while(parentObj.style.left){offLeft+=px2int(parentObj.style.left);parentObj=parentObj.parentNode}parentObj=obj.parentNode;while(parentObj.style.top){offTop+=px2int(parentObj.style.top);parentObj=parentObj.parentNode}}offLeft+=this.getX();offTop+=this.getY();if(OpenLayers.IAAA_Utils.isNetscape()){_foo.setX(e.pageX-offLeft);_foo.setY(e.pageY-offTop)}else{var offsetLeft=eval(this.getDoc()+".body.scrollLeft");var offsetTop=eval(this.getDoc()+".body.scrollTop");_foo.setX((e.x+offsetLeft)-offLeft);_foo.setY((e.y+offsetTop)-offTop)}return _foo}function getLogoURL(){return this.logoURL}function setLogoURL(newLogoURL){this.logoURL=newLogoURL}function getLogoX(){return this.logoX}function setLogoX(newLogoX){this.logoX=newLogoX}function getLogoY(){return this.logoY}function setLogoY(newLogoY){this.logoY=newLogoY}function updateLogo(newURL,newX,newY){this.logoX=newX;this.logoY=newY;this.logoURL=newURL;var obj=eval(this.getDoc()+'.getElementById("'+this.getName()+'Logo")');if(obj){obj.style.top=newY;obj.style.left=newX}var objImg=eval(this.getDoc()+'.getElementById("MapRendererLogoID")');if(objImg){objImg.src=newURL}}function getLogo2URL(){return this.logo2URL}function setLogo2URL(newLogo2URL){this.logo2URL=newLogo2URL}function getLogo2X(){return this.logo2X}function setLogo2X(newLogo2X){this.logo2X=newLogo2X}function getLogo2Y(){return this.logo2Y}function setLogo2Y(newLogo2Y){this.logo2Y=newLogo2Y}function updateLogo2(newURL2,newX2,newY2){this.logo2X=newX2;this.logo2Y=newY2;this.logo2URL=newURL2;var obj2=eval(this.getDoc()+'.getElementById("'+this.getName()+'Logo2")');if(obj2){obj2.style.top=newY2;obj2.style.left=newX2}var objImg2=eval(this.getDoc()+'.getElementById("MapRendererLogo2ID")');if(objImg2){objImg2.src=newURL2}}function getMapLayerRendererList(){return this.mapLayerRendererList}function setMapLayerRendererList(newMapLayerRendererList){this.mapLayerRendererList=newMapLayerRendererList}function removeMapLayerRendererList(mapLayerIndex){for(var i=mapLayerIndex;i<this.mapLayerRendererList.length-1;i++){this.mapLayerRendererList[i]=this.mapLayerRendererList[i+1]}this.mapLayerRendererList[this.mapLayerRendererList.length-1]=null;this.mapLayerRendererList.length--}function updateDimensions(newWidth,newHeight){var obj=eval(this.getDoc()+'.getElementById("'+this.getIdListenerDiv()+'")');obj.style.width=newWidth+"px";obj.style.height=newHeight+"px"}function getEmptyImageURL(){return this.emptyImageURL}function setEmptyImageURL(newEmptyImageURL){this.emptyImageURL=newEmptyImageURL}function clearMscRenderers(){this.mscRenderers=new Array()}function deleteMscIndex(index){for(var i=index;i<this.mscRenderers.length-1;i++){this.mscRenderers[i]=this.mscRenderers[i+1]}this.mscRenderers[this.mscRenderers.length-1]=null;this.mscRenderers.length--}}MapRenderer.prototype=new GUIComponent;function OverviewMapRenderer(map,x,y,width,height,name,doc,extentColor){this._super=MapRenderer;this._super(map,x,y,width,height,name||"overviewMapDiv",doc);this.extentColor=extentColor||"#000000";this.zIndex=0;this.getExtentColor=getExtentColor;this.setExtentColor=setExtentColor;this.getOverviewHTML=getOverviewHTML;this.updateExtent=updateExtent;this.addClickListener=addClickListener;this.removeClickListener=removeClickListener;this.addMouseMoveListener=addMouseMoveListener;this.removeMouseMoveListener=removeMouseMoveListener;this.setZIndex=setZIndex;this.getZIndex=getZIndex;var _extentLayer;function getExtentColor(){return this.extentColor}function setExtentColor(newExtentColor){this.extentColor=newExtentColor}function setZIndex(newZIndex){this.zIndex=newZIndex}function getZIndex(){return this.zIndex}function getOverviewHTML(){var str="";_extentLayer=new LayerHTML(this.getName()+"BorderLayer",0,0,0,0,this.getDoc(),"","","visible",this.getExtentColor(),"solid",1);if(this.getZIndex()!=0){_extentLayer.setZIndex(this.getZIndex())}str+=this.writeMapHTML();if(this.getPositionType()!="absolute"){var strAux=str.substring(0,str.lastIndexOf("</div>"));str=strAux+_extentLayer.getLayerHTML();str+="</div>"}else{str+=_extentLayer.getLayerHTML()}return str}function addClickListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getIdListenerDiv()+'")');addEvent(obj,"click",funct);var obj2=eval(this.getDoc()+'.getElementById("'+_extentLayer.getName()+'")');addEvent(obj2,"click",funct)}function removeClickListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getIdListenerDiv()+'")');var obj2=eval(this.getDoc()+'.getElementById("'+this.getName()+'BorderLayer")');removeEvent(obj,"click",funct);removeEvent(obj2,"click",funct)}function addMouseMoveListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getIdListenerDiv()+'")');addEvent(obj,"mousemove",funct);var obj2=eval(this.getDoc()+'.getElementById("'+_extentLayer.getName()+'")');addEvent(obj2,"mousemove",funct)}function removeMouseMoveListener(funct){var obj=eval(this.getDoc()+'.getElementById("'+this.getIdListenerDiv()+'")');removeEvent(obj,"mousemove",funct);var obj2=eval(this.getDoc()+'.getElementById("'+_extentLayer.getName()+'")');addEvent(obj2,"mousemove",funct)}function updateExtent(newExtent){var overviewXMin;var overviewXMax;var overviewYMin;var overviewYMax;if(newExtent.getXMin()<map.getFullExtent().getXMin()){overviewXMin=0}else{if(newExtent.getXMin()>map.getFullExtent().getXMax()){overviewXMin=map.getFullExtent().getXMax()-map.getFullExtent().getXMin()}else{overviewXMin=(newExtent.getXMin()-map.getFullExtent().getXMin())}}if(newExtent.getXMax()>map.getFullExtent().getXMax()){overviewXMax=map.getFullExtent().getXMax()-map.getFullExtent().getXMin()}else{if(newExtent.getXMax()<map.getFullExtent().getXMin()){overviewXMax=0}else{overviewXMax=(newExtent.getXMax()-map.getFullExtent().getXMin())}}if(map.getFullExtent().getYMax()<newExtent.getYMin()){overviewYMin=0}else{if(map.getFullExtent().getYMin()>newExtent.getYMin()){overviewYMin=map.getFullExtent().getYMax()-map.getFullExtent().getYMin()}else{overviewYMin=map.getFullExtent().getYMax()-newExtent.getYMin()}}if(map.getFullExtent().getYMax()<newExtent.getYMax()){overviewYMax=0}else{if(map.getFullExtent().getYMin()>newExtent.getYMax()){overviewYMax=map.getFullExtent().getYMax()-map.getFullExtent().getYMin()}else{overviewYMax=map.getFullExtent().getYMax()-newExtent.getYMax()}}var fullExtentWidth=map.getFullExtent().getXMax()-map.getFullExtent().getXMin();var fullExtentHeight=map.getFullExtent().getYMax()-map.getFullExtent().getYMin();xMinTotal=this.getX()+Math.ceil(map.getWidth()*overviewXMin/fullExtentWidth);yMinTotal=this.getY()+Math.ceil(map.getHeight()*overviewYMin/fullExtentHeight);xMaxTotal=this.getX()+Math.ceil(map.getWidth()*overviewXMax/fullExtentWidth);yMaxTotal=this.getY()+Math.ceil(map.getHeight()*overviewYMax/fullExtentHeight);widthTotal=xMaxTotal-xMinTotal;heightTotal=yMinTotal-yMaxTotal;minValue=3;if(widthTotal<minValue){xMinTotal=xMinTotal-Math.abs(minValue/2);widthTotal=minValue}if(heightTotal<minValue){yMinTotal=yMinTotal-Math.abs(minValue/2);heightTotal=minValue}if(_extentLayer){_extentLayer.updateLayerHTML(xMinTotal,yMaxTotal,widthTotal,heightTotal)}}}OverviewMapRenderer.prototype=new MapRenderer;function StaticOverviewMapRenderer(a,o,m,c,r,b,q,f){this._super=OverviewMapRenderer;this._super(a,o,m,c,r,b,q,f);this.imageURL="";this.getImageURL=p;this.setImageURL=l;this.updateMap=g;this.updateMapFrom=k;function p(){return this.imageURL}function l(u){this.imageURL=u}function g(){for(var u=0;u<this.getMap().getMapServerConnectionCount();u++){this.updateMapFrom(u,this.getImageURL())}}function k(u,E){var v=false;if(!OpenLayers.IAAA_Utils.isNetscape()){var D=true;try{var C=navigator.appVersion+"";if(C.indexOf("MSIE 7")!=-1){D=false}}catch(B){D=true}if(D){var A=this.getMap().getMapServerConnection(u).getFormat().toUpperCase();if(A.indexOf("/")!=-1){A=A.substring(A.indexOf("/")+1,A.length)}if(A=="PNG"){if(this.getMap().getMapServerConnection(u).getTransparent()=="TRUE"){v=true}}}}if(!E){if(this.getMap().getMapServerConnection(u).getIsSLD()==0){E=this.getMap().getMapImage(u)}else{E=this.getMap().getMapServerConnection(u).getMapServer().getURLImage()}}if(E==""){this.mscRenderers[u].updateImage("","hidden",this.getWidth(),this.getHeight(),false)}else{if(this.mustReloadMap(u)){if(this.hasLayers(u)){if(this.getMap().getMapServerConnection(u).getIsSLD()==0){E=this.getMap().getMapImage(u)}else{E=this.getMap().getMapServerConnection(u).getMapServer().getURLImage()}this.mscRenderers[u].updateImage(E,"visible",this.getWidth(),this.getHeight(),v)}else{this.mscRenderers[u].updateImage("","hidden",this.getWidth(),this.getHeight(),v)}}else{this.mscRenderers[u].updateImage("","visible",this.getWidth(),this.getHeight(),v)}}}}StaticOverviewMapRenderer.prototype=new OverviewMapRenderer;function DragBox(mapRenderer,color){this.mapRenderer=mapRenderer;this.color=color||"#00FF00";this.getMapRenderer=getMapRenderer;this.setMapRenderer=setMapRenderer;this.getColor=getColor;this.setColor=setColor;function getMapRenderer(){return this.mapRenderer}function setMapRenderer(newMapRenderer){this.mapRenderer=newMapRenderer}function getColor(){return this.color}function setColor(newColor){this.color=newColor}this.writeDragBox=writeDragBox;this.addMouseDownListener=addMouseDownListener;this.removeMouseDownListener=removeMouseDownListener;this.addMouseUpListener=addMouseUpListener;this.removeMouseUpListener=removeMouseUpListener;this.addMouseMoveListener=addMouseMoveListener;this.removeMouseMoveListener=removeMouseMoveListener;this.getMousePosition=getMousePosition;this.showDragBox=showDragBox;this.updateLayerDragBox=updateLayerDragBox;this.clearLayerDragBox=clearLayerDragBox;var _layer;function writeDragBox(){_layer=new LayerHTML(this.getMapRenderer().getIdListenerDiv()+"unNombre",0,0,-1,-1,this.getMapRenderer().getDoc(),"","","visible",this.getColor(),"dotted",2);return(_layer.getLayerHTML())}function addMouseDownListener(funct){var obj=eval(this.getMapRenderer().getDoc()+'.getElementById("'+this.getMapRenderer().getIdListenerDiv()+'")');addEvent(obj,"mousedown",funct);_layer.addMouseDownListener(funct)}function removeMouseDownListener(funct){var obj=eval(this.getMapRenderer().getDoc()+'.getElementById("'+this.getMapRenderer().getIdListenerDiv()+'")');removeEvent(obj,"mousedown",funct);_layer.removeMouseDownListener(funct)}function addMouseUpListener(funct){var obj=eval(this.getMapRenderer().getDoc()+'.getElementById("'+this.getMapRenderer().getIdListenerDiv()+'")');addEvent(obj,"mouseup",funct);_layer.addMouseUpListener(funct)}function removeMouseUpListener(funct){var obj=eval(this.getMapRenderer().getDoc()+'.getElementById("'+this.getMapRenderer().getIdListenerDiv()+'")');removeEvent(obj,"mouseup",funct);_layer.removeMouseUpListener(funct)}function addMouseMoveListener(funct){var obj=eval(this.getMapRenderer().getDoc()+'.getElementById("'+this.getMapRenderer().getIdListenerDiv()+'")');addEvent(obj,"mousemove",funct);_layer.addMouseMoveListener(funct)}function removeMouseMoveListener(funct){var obj=eval(this.getMapRenderer().getDoc()+'.getElementById("'+this.getMapRenderer().getIdListenerDiv()+'")');removeEvent(obj,"mousemove",funct);_layer.removeMouseMoveListener(funct)}function getMousePosition(e){var _foo=new ScreenPoint();offLeft=0;offTop=0;parentObj=eval(this.getMapRenderer().getDoc()+'.getElementById("'+this.getMapRenderer().getIdListenerDiv()+'").parentNode');while(parentObj.style.left){offLeft+=px2int(parentObj.style.left);parentObj=parentObj.parentNode}parentObj=eval(this.getMapRenderer().getDoc()+'.getElementById("'+this.getMapRenderer().getIdListenerDiv()+'").parentNode');while(parentObj.style.top){offTop+=px2int(parentObj.style.top);parentObj=parentObj.parentNode}offLeft+=this.getMapRenderer().getX();offTop+=this.getMapRenderer().getY();if(OpenLayers.IAAA_Utils.isNetscape()){_foo.setX(e.pageX-offLeft);_foo.setY(e.pageY-offTop)}else{var offsetLeft=eval(this.getMapRenderer().getDoc()+".body.scrollLeft");var offsetTop=eval(this.getMapRenderer().getDoc()+".body.scrollTop");_foo.setX((e.x+offsetLeft)-offLeft);_foo.setY((e.y+offsetTop)-offTop)}return _foo}function showDragBox(){_layer.updateDisplay("block")}function updateLayerDragBox(x,y,width,height){_layer.updateLayerHTML(x,y,width,height)}function clearLayerDragBox(){updateLayerDragBox(-1,-1,0,0);_layer.updateDisplay("none")}}function MapServerConnectionRenderer(mapRenderer,msc,name){this.mapRenderer=mapRenderer;this.msc=msc;this.name=name;this.useImageOpacity=false;this.getMsc=getMsc;this.setMsc=setMsc;this.getMapRenderer=getMapRenderer;this.setMapRenderer=setMapRenderer;this.getName=getName;this.setName=setName;this.getHTML=getHTML;this.updateTop=updateTop;this.updateLeft=updateLeft;this.updateWidth=updateWidth;this.updateHeight=updateHeight;this.updateClip=updateClip;this.updateImage=updateImage;this.getUseImageOpacity=getUseImageOpacity;this.setUseImageOpacity=setUseImageOpacity;this.clone=clone;function clone(){var mscRendererNew=new MapServerConnectionRenderer();mscRendererNew.setMapRenderer(this.getMapRenderer());mscRendererNew.setMsc(this.getMsc());mscRendererNew.setName(this.getName());mscRendererNew.setUseImageOpacity(this.getUseImageOpacity());return mscRendererNew}function getMsc(){return this.msc}function setMsc(newMsc){this.msc=newMsc}function getMapRenderer(){return this.mapRenderer}function setMapRenderer(newMapRenderer){this.mapRenderer=newMapRenderer}function getUseImageOpacity(){return this.useImageOpacity}function setUseImageOpacity(newUseImageOpacity){this.useImageOpacity=newUseImageOpacity}function getName(){return this.name}function setName(newName){this.name=newName}function getHTML(otherHTML){imgg=new ImageHTML(this.getMapRenderer().getWidth(),this.getMapRenderer().getHeight(),"",0,0,"",this.getName(),"",0,"auto",0,0,"hidden",otherHTML);imgg.setUseImageOpacity(this.getUseImageOpacity());return imgg.getImageHTML()}function updateClip(newClip){obj=eval(this.getMapRenderer().getDoc()+'.images["'+this.getName()+'"]');obj.style.clip=newClip}function updateTop(newTop){obj=eval(this.getMapRenderer().getDoc()+'.images["'+this.getName()+'"]');obj.style.top=newTop+"px"}function updateLeft(newLeft){obj=eval(this.getMapRenderer().getDoc()+'.images["'+this.getName()+'"]');obj.style.left=newLeft+"px"}function updateWidth(newWidth){obj=eval(this.getMapRenderer().getDoc()+'.images["'+this.getName()+'"]');obj.style.width=newWidth+"px"}function updateHeight(newHeight){obj=eval(this.getMapRenderer().getDoc()+'.images["'+this.getName()+'"]');obj.style.height=newHeight+"px"}function updateImage(newUrlImage,newVisibility,newWidth,newHeight,isTransparentPNG){isTransparentPNG=isTransparentPNG||false;obj=eval(this.getMapRenderer().getDoc()+'.images["'+this.getName()+'"]');if(newUrlImage!=""){if(isTransparentPNG){var imgProperties="";if(obj.alt){if(obj.alt!=""){imgProperties+=" alt='"+obj.alt+"'"}}if(obj.border){imgProperties+=" border='"+obj.border+"'"}if(obj.hspace){imgProperties+=" hspace='"+obj.hspace+"'"}if(obj.vspace){imgProperties+=" vspace='"+obj.vspace+"'"}if(obj.zindex){imgProperties+=" zindex='"+obj.zindex+"'"}if(obj.onload){if(obj.onload!=""){onLoadWMS=new String(obj.onload);inicio=onLoadWMS.indexOf("{")+1;fin=onLoadWMS.indexOf("}");onLoadWMS=onLoadWMS.substring(inicio,fin);imgProperties+=" onload='"+onLoadWMS+"'"}}obj.onload=null;obj.src=this.getMapRenderer().getEmptyImageURL();this.getMsc().setLastRequest("");var imgStyle="width:"+newWidth+"px; height:"+newHeight+"px;visibility:"+newVisibility+";";if(obj.style.clip&&obj.style.clip!=""){imgStyle+="clip:"+obj.style.clip+";"}imgStyle+="position:"+obj.style.position+";top:"+obj.style.top+";left:"+obj.style.left+";";imgStyle+="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+obj.src+"', sizingMethod='scale')";var strNewHTML="<img style='"+imgStyle+"' src='"+obj.src+"' name='"+obj.name+"'"+imgProperties+" hspace=0 border=0 zindex=auto>";obj.outerHTML=strNewHTML}else{obj.src=newUrlImage}}obj.style.visibility=newVisibility;obj.style.width=newWidth+"px";obj.style.height=newHeight+"px"}}function MapLayerRenderer(mapRenderer,mapLayer,name){this.mapRenderer=mapRenderer;this.mapLayer=mapLayer;this.name=name;this._bufferLabelMarkDiv="";this._bufferMarkDiv="";this.getMapLayer=getMapLayer;this.setMapLayer=setMapLayer;this.getMapRenderer=getMapRenderer;this.setMapRenderer=setMapRenderer;this.getName=getName;this.setName=setName;this.clearSymbols=clearSymbols;this.showSymbols=showSymbols;this.hideSymbols=hideSymbols;this.showLabelSymbols=showLabelSymbols;this.hideLabelSymbols=hideLabelSymbols;this.getHTML=getHTML;this.clone=clone;function clone(){var mapLayerRendererNew=new MapLayerRenderer();mapLayerRendererNew.setMapRenderer(this.getMapRenderer());mapLayerRendererNew.setMapLayer(this.getMapLayer());mapLayerRendererNew.setName(this.getName());mapLayerRendererNew._bufferLabelMarkDiv=this._bufferLabelMarkDiv;mapLayerRendererNew._bufferMarkDiv=this._bufferMarkDiv;return mapLayerRendererNew}function getMapLayer(){return this.mapLayer}function setMapLayer(newMapLayer){this.mapLayer=newMapLayer}function getMapRenderer(){return this.mapRenderer}function setMapRenderer(newMapRenderer){this.mapRenderer=newMapRenderer}function getName(){return this.name}function setName(newName){this.name=newName}function clearSymbols(){var obj=eval(this.getMapRenderer().getDoc()+'.getElementById("'+this.getName()+'GeomDiv")');if(obj!=null){obj.innerHTML=""}var obj=eval(this.getMapRenderer().getDoc()+'.getElementById("'+this.getName()+'MarkDiv")');if(obj!=null){obj.innerHTML=""}var objLabel=eval(this.getMapRenderer().getDoc()+'.getElementById("'+this.getName()+'LabelMarkDiv")');if(objLabel!=null){objLabel.innerHTML=""}}function showSymbols(){var obj=eval(this.getMapRenderer().getDoc()+'.getElementById("'+this.getName()+'GeomDiv")');obj.style.visibility="visible";obj.style.display="block"}function hideSymbols(){var obj=eval(this.getMapRenderer().getDoc()+'.getElementById("'+this.getName()+'GeomDiv")');obj.style.visibility="hidden";obj.style.display="none"}function showLabelSymbols(){var objLabel=eval(this.getMapRenderer().getDoc()+'.getElementById("'+this.getName()+'LabelMarkDiv")');objLabel.style.visibility="visible";objLabel.style.display="block"}function hideLabelSymbols(){var objLabel=eval(this.getMapRenderer().getDoc()+'.getElementById("'+this.getName()+'LabelMarkDiv")');objLabel.style.visibility="hidden";objLabel.style.display="none"}function getHTML(){str="";str+="<div id='"+this.getName()+"GeomDiv' style='position:absolute; top:0px; left:0px;'></div>";str+="<div id='"+this.getName()+"MarkDiv' style='position:absolute; top:0px; left:0px; color:#000000;'></div>";str+="<div id='"+this.getName()+"LabelMarkDiv' style='position:absolute; top:0px; left:0px; color:#000000;'></div>";return str}}function MultipleSymbolRenderer(mapRenderer,mapLayer,name,defaultSymbol){this._super=MapLayerRenderer;this._super(mapRenderer,mapLayer,name);this.defaultSymbol=defaultSymbol||new Symbol();this.symbolList=new Array();this.getSymbol=getSymbol;this.setSymbol=setSymbol;this.removeSymbol=removeSymbol;this.updateMapLayer=updateMapLayer;this.clone=clone;function clone(){var multipleSymbolRendererNew=new MultipleSymbolRenderer();multipleSymbolRendererNew.setMapRenderer(this.getMapRenderer());multipleSymbolRendererNew.setMapLayer(this.getMapLayer());multipleSymbolRendererNew.setName(this.getName());multipleSymbolRendererNew._bufferLabelMarkDiv=this._bufferLabelMarkDiv;multipleSymbolRendererNew._bufferMarkDiv=this._bufferMarkDiv;multipleSymbolRendererNew.defaultSymbol=this.defaultSymbol;multipleSymbolRendererNew.symbolList=new Array(this.symbolList.length);for(var i=0;i<this.symbolList.length;i++){multipleSymbolRendererNew.symbolList[i]=this.symbolList[i]}return multipleSymbolRendererNew}function getSymbol(i){if(this.symbolList[i]){return this.symbolList[i]}else{return this.defaultSymbol}}function setSymbol(newSymbol,i){this.symbolList[i]=newSymbol}function removeSymbol(i){for(var k=i;k<this.symbolList.length-1;k++){this.symbolList[k]=this.symbolList[k+1]}this.symbolList[this.symbolList.length-1]=null;this.symbolList.length--}function updateMapLayer(canvasObj){var seguir=false;if(this.getMapLayer().getVisibility()){if(this.getMapLayer().getApplyScaleFilter()){if(this.getMapRenderer().getMap().getScale()<=this.getMapLayer().getMaxScale()){if(this.getMapRenderer().getMap().getScale()>=this.getMapLayer().getMinScale()){seguir=true}}}else{seguir=true}}if(seguir&&this.getMapLayer().getDrawMapLayer()){this.clearSymbols();var jg="";_bufferLabelMarkDiv="";_bufferMarkDiv="";stt="";recordset=this.getMapLayer().getRecordset();numData=recordset.getVectorialDataCount();for(var jj=0;jj<numData;jj++){geom=recordset.getGeometry(jj);st="";if(geom.getClass()==Geometry.POINT){pointGeom=coordTransform(geom.getSrs(),this.getMapRenderer().getMap().getDefaultSrs(),geom.getX(),geom.getY());xPointGeom=pointGeom[0];yPointGeom=pointGeom[1];coordPoint=new ScreenPoint(xPointGeom,yPointGeom);pixelAux=this.getMapRenderer().getMap().coord2pixel(coordPoint);pixel=new ScreenPoint(Math.round(pixelAux.getX()),Math.round(pixelAux.getY()));var tooltipText2="";if((pixel.getX()>=0)&&(pixel.getX()<=this.getMapRenderer().getMap().getWidth())){if((pixel.getY()>=0)&&(pixel.getY()<=this.getMapRenderer().getMap().getHeight())){sym=this.getSymbol(jj);tooltipText2="";for(var j=0;j<this.getMapLayer().getAttributeLabelList().length;j++){param=this.getMapLayer().getAttributeLabelList()[j];if(tooltipText2!=""){tooltipText2+=", "}tooltipText2+=recordset.getAttributesList(jj)[param]}if(tooltipText2!=""){sym.setX(pixel.getX());sym.setY(pixel.getY());if(sym.getClass()!=Symbol.CANVAS_SYMBOL){sym.setText(tooltipText2);if(!this.getMapLayer().getOnlySymbols()){_bufferLabelMarkDiv+=sym.getLabelHTML()}if(!this.getMapLayer().getOnlyLabels()){_bufferMarkDiv+=sym.getMarkHTML()}}}}}}else{if(geom.getClass()==Geometry.LINE_STRING){var geomTransformed=new LineString();geomTransformed.setSrs(this.getMapRenderer().getMap().getDefaultSrs());for(var h=0;h<geom.getNpoints();h++){pointGeomTransformed=coordTransform(geom.getSrs(),this.getMapRenderer().getMap().getDefaultSrs(),geom.xpoints[h],geom.ypoints[h]);geomTransformed.addPoint(pointGeomTransformed[0],pointGeomTransformed[1])}rect=geomTransformed.getBounds()}else{var geomTransformed=new LinearRing();geomTransformed.setSrs(this.getMapRenderer().getMap().getDefaultSrs());if(geom.getExteriorRing){for(var h=0;h<geom.getExteriorRing().npoints;h++){pointGeomTransformed=coordTransform(geom.getSrs(),this.getMapRenderer().getMap().getDefaultSrs(),geom.getExteriorRing().xpoints[h],geom.getExteriorRing().ypoints[h]);geomTransformed.addPoint(pointGeomTransformed[0],pointGeomTransformed[1])}}else{for(var h=0;h<geom.getNpoints();h++){pointGeomTransformed=coordTransform(geom.getSrs(),this.getMapRenderer().getMap().getDefaultSrs(),geom.xpoints[h],geom.ypoints[h]);geomTransformed.addPoint(pointGeomTransformed[0],pointGeomTransformed[1])}}rect=geomTransformed.getBounds()}mapExtent=this.getMapRenderer().getMap().getCurrentExtent();intersects=!((rect.getX()+rect.getWidth()<=mapExtent.getXMin())||(rect.getY()+rect.getHeight()<=mapExtent.getYMin())||(rect.getX()>=mapExtent.getXMax())||(rect.getY()>=mapExtent.getYMax()));if(intersects){if(!this.getMapLayer().getOnlyLabels()){sym=this.getSymbol(jj);valX=new Array();valY=new Array();for(var kk=0;kk<geomTransformed.npoints;kk++){coordPoint=new ScreenPoint(geomTransformed.xpoints[kk],geomTransformed.ypoints[kk]);pixelAux=this.getMapRenderer().getMap().coord2pixel(coordPoint);valX[kk]=Math.round(pixelAux.getX());valY[kk]=Math.round(pixelAux.getY())}if(sym.getClass()==Symbol.IMAGE_SYMBOL){if(geomTransformed.npoints==4){sym.setX(valX[geomTransformed.npoints-1]);sym.setY(valY[geomTransformed.npoints-1]);_bufferMarkDiv+=sym.getMarkHTML(valX,valY)}else{_bufferMarkDiv+=sym.getMarkHTML()}}else{if(sym.getClass()==Symbol.CANVAS_SYMBOL&&canvasObj){var canvas=canvasObj;canvas.style.width=this.getMapRenderer().getMap().getWidth()+"px";canvas.style.height=this.getMapRenderer().getMap().getHeight()+"px";var ctx=null;if(canvas.getContext){ctx=canvas.getContext("2d")}if(ctx!=null){if(geomTransformed.getClass()==Geometry.LINE_STRING){if(valX.length>0){ctx.beginPath();ctx.moveTo(valX[0],valY[0])}for(var i=1;i<valX.length;i++){ctx.lineTo(valX[i],valY[i])}ctx.lineWidth=3;if(sym.getDoFillPolygon()){ctx.fillStyle="rgba("+sym.getRGBAColorCad()+")";ctx.fill()}else{ctx.strokeStyle="rgba("+sym.getRGBAColorCad()+")";ctx.stroke()}ctx.closePath()}else{if(valX.length>0){ctx.beginPath();ctx.moveTo(valX[0],valY[0])}for(var i=1;i<valX.length;i++){ctx.lineTo(valX[i],valY[i])}ctx.lineWidth=3;ctx.fillStyle="rgba("+sym.getRGBAColorCad()+")";ctx.fill();ctx.closePath()}}}else{if(jg==""){jg=new jsGraphics(this.getName()+"GeomDiv");jg.setPrintable(true);jg.clear()}if(geomTransformed.getClass()==Geometry.LINE_STRING){jg.setColor(sym.getColor());jg.setStroke(3);jg.drawPolyline(valX,valY)}else{jg.setColor(sym.getColor());jg.setStroke(3);jg.fillPolygon(valX,valY)}}}}xCenter=0;yCenter=0;if(geomTransformed.getClass()==Geometry.LINE_STRING){numPuntos=geomTransformed.npoints;indexCenter=Math.floor(numPuntos/2);if((numPuntos%2)==0){x0=geomTransformed.xpoints[indexCenter-1];y0=geomTransformed.ypoints[indexCenter-1];x1=geomTransformed.xpoints[indexCenter];y1=geomTransformed.ypoints[indexCenter];xOffset=x1-x0;yOffset=y1-y0;xCenter=x0+(xOffset/2);yCenter=y0+(yOffset/2)}else{xCenter=geomTransformed.xpoints[indexCenter];yCenter=geomTransformed.ypoints[indexCenter]}}else{rectangle=geomTransformed.getBounds();xCenter=rectangle.getX()+(rectangle.getWidth()/2);yCenter=rectangle.getY()+(rectangle.getHeight()/2)}coordPoint=new ScreenPoint(xCenter,yCenter);pixelAux=this.getMapRenderer().getMap().coord2pixel(coordPoint);pixel=new ScreenPoint(Math.round(pixelAux.getX()),Math.round(pixelAux.getY()));if((pixel.getX()>=0)&&(pixel.getX()<=this.getMapRenderer().getMap().getWidth())){if((pixel.getY()>=0)&&(pixel.getY()<=this.getMapRenderer().getMap().getHeight())){sym=this.getSymbol();tooltipText2="";for(var j=0;j<this.getMapLayer().getAttributeLabelList().length;j++){param=this.getMapLayer().getAttributeLabelList()[j];if(tooltipText2!=""){tooltipText2+=", "}tooltipText2+=recordset.getAttributesList(jj)[param]}if(tooltipText2!=""){sym.setX(pixel.getX());sym.setY(pixel.getY());if(sym.getClass()!=Symbol.CANVAS_SYMBOL){sym.setText(tooltipText2);_bufferLabelMarkDiv+=sym.getLabelHTML()}}}}}else{}}}if(!this.getMapLayer().getOnlySymbols()){var obj=eval(this.getMapRenderer().getDoc()+'.getElementById("'+this.getName()+'LabelMarkDiv")');obj.innerHTML+=_bufferLabelMarkDiv}var obj2=eval(this.getMapRenderer().getDoc()+'.getElementById("'+this.getName()+'MarkDiv")');if(obj2){obj2.innerHTML+=_bufferMarkDiv}if(!this.getMapLayer().getOnlyLabels()){var obj3=eval(this.getMapRenderer().getDoc()+'.getElementById("'+this.getName()+'GeomDiv")');if(jg!=""){jg.paint()}}}else{if(!this.getMapLayer().getOnlySymbols()){var obj=eval(this.getMapRenderer().getDoc()+'.getElementById("'+this.getName()+'LabelMarkDiv")');obj.innerHTML=""}var obj2=eval(this.getMapRenderer().getDoc()+'.getElementById("'+this.getName()+'MarkDiv")');obj2.innerHTML="";if(!this.getMapLayer().getOnlyLabels()){var obj3=eval(this.getMapRenderer().getDoc()+'.getElementById("'+this.getName()+'GeomDiv")');obj3.innerHTML=""}}}}MultipleSymbolRenderer.prototype=new MapLayerRenderer;function SingleSymbolRenderer(a,b,c,f){this._super=MultipleSymbolRenderer;this._super(a,b,c,f);this.getSymbol=g;this.setSymbol=k;this.clone=l;function g(){return this.defaultSymbol}function k(m){this.defaultSymbol=m}function l(){var o=new SingleSymbolRenderer();o.setMapRenderer(this.getMapRenderer());o.setMapLayer(this.getMapLayer());o.setName(this.getName());o._bufferLabelMarkDiv=this._bufferLabelMarkDiv;o._bufferMarkDiv=this._bufferMarkDiv;o.defaultSymbol=this.defaultSymbol;o.symbolList=new Array(this.symbolList.length);for(var m=0;m<this.symbolList.length;m++){o.symbolList[m]=this.symbolList[m]}return o}}SingleSymbolRenderer.prototype=new MultipleSymbolRenderer;function Symbol(b,m,k,c){this.name=b||"aName";this.getName=a;this.setName=f;function a(){return this.name}function f(u){this.name=u}this.x=m||0;this.y=k||0;this.getX=r;this.setX=l;this.getY=p;this.setY=g;function r(){return this.x}function l(u){this.x=u}function p(){return this.y}function g(u){this.y=u}this.color=c||"#084A84";this.getColor=q;this.setColor=o;function q(){return this.color}function o(u){this.color=u}}Symbol.LABEL_SYMBOL=0;Symbol.IMAGE_LABEL_SYMBOL=1;Symbol.IMAGE_SYMBOL=2;Symbol.CANVAS_SYMBOL=3;function LabelSymbol(J,p,m,u,B,H,G){this._super=Symbol;this._super(J,p,m);this.text=u||"";this.fontCSS=B||new FontCSS();this.offsetX=H||0;this.offsetY=G||0;this.labelWidth="80px";this.applyHalo=false;this.haloColor="#000000";this.getText=b;this.setText=C;this.getFontCSS=o;this.setFontCSS=F;this.getLabelHTML=v;this.getHTML=f;this.getOffsetX=c;this.setOffsetX=r;this.getOffsetY=a;this.setOffsetY=q;this.getLabelWidth=g;this.setLabelWidth=l;this.setApplyHalo=D;this.getApplyHalo=A;this.setHaloColor=k;this.getHaloColor=E;this.getClass=I;function b(){return this.text}function C(K){this.text=K}function o(){return this.fontCSS}function F(K){this.fontCSS=K}function g(){return this.labelWidth}function l(K){this.labelWidth=K}function A(){return this.applyHalo}function D(K){this.applyHalo=K}function E(){return this.haloColor}function k(K){this.haloColor=K}function f(){return this.getLabelHTML()}function c(){return this.offsetX}function r(K){this.offsetX=K}function a(){return this.offsetY}function q(K){this.offsetY=K}function v(){st="";pixelX=this.getX()-40+this.getOffsetX();pixelY=this.getY()+this.getOffsetY();if(this.getApplyHalo()){var M=this.getFontCSS().getColor();var K=this.getFontCSS();K.setColor(this.getHaloColor());st+='<label style="position:absolute; top:'+(pixelY-1)+"px;";st+=" left:"+(pixelX-1)+"px; font-family:monospace;";st+=K.getCSS();st+=" border-width: "+0+"px; border-style:solid;border-color:black;";st+=" text-align: center; ";st+=" width:"+this.getLabelWidth()+';">';st+=this.getText();st+="</label>";K.setColor(M)}st+='<label style="position:absolute; top:'+pixelY+"px;";st+=" left:"+pixelX+"px; font-family:monospace;";st+=this.getFontCSS().getCSS();st+=" border-width: "+0+"px; border-style:solid;border-color:black;";st+=" text-align: center; ";st+=" width:"+this.getLabelWidth()+';">';st+=this.getText();st+="</label>";return st}function I(){return Symbol.LABEL_SYMBOL}}LabelSymbol.prototype=new Symbol;function ImageLabelSymbol(E,g,c,k,o,f,C,q,A,u){this._super=LabelSymbol;this._super(E,g,c,k,q,A,u);this.imageURL=o||"";this.imageWidth=f||0;this.imageHeight=C||0;this.getImageURL=m;this.setImageURL=r;this.getImageWidth=p;this.setImageWidth=v;this.getImageHeight=a;this.setImageHeight=l;this.getHTML=b;this.getMarkHTML=B;this.getClass=D;function m(){return this.imageURL}function r(F){this.imageURL=F}function p(){return this.imageWidth}function v(F){this.imageWidth=F}function a(){return this.imageHeight}function l(F){this.imageHeight=F}function b(){st=this.getLabelHTML();st+this.getMarkHTML();return st}function B(){var I=false;if(!OpenLayers.IAAA_Utils.isNetscape()){var M=true;try{var K=navigator.appVersion+"";if(K.indexOf("MSIE 7")!=-1){M=false}}catch(J){M=true}if(M){var H=this.getImageURL();if(H.substring(H.length-4,H.length)==".png"){I=true}}}st="";st+="<img ";st+=' id="'+this.getName()+'Img"';if(I){st+=' src="'+getVacioGif()+'" '}else{st+=' src="'+this.getImageURL()+'" '}var G=this.getX()-Math.floor(this.getImageWidth()/2);var F=this.getY()-Math.floor(this.getImageHeight()/2);st+=' style="position:absolute; top:'+F+"px;";st+=" left:"+G+"px;";if(this.getImageWidth()>0){st+=" width:"+this.getImageWidth()+"px;"}if(this.getImageHeight()>0){st+=" height:"+this.getImageHeight()+"px;"}if(I){st+="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src="+this.getImageURL()+", sizingMethod=scale);"}st+='" />';return st}function D(){return Symbol.IMAGE_LABEL_SYMBOL}}ImageLabelSymbol.prototype=new LabelSymbol;function ImageSymbol(b,q,p,v,c,o,k,l,g,f){this._super=ImageLabelSymbol;this._super(b,q,p,v,c,o,k,l,g,f);this.onLoadImageFunction="";this.getClass=u;this.getHTML=a;this.getMarkHTML=m;this.setOnLoadImageFunction=A;this.getOnLoadImageFunction=r;function a(){st+this.getMarkHTML();return st}function m(O,K){var Q=O||new Array(0);var M=K||new Array(0);var J=false;if(!OpenLayers.IAAA_Utils.isNetscape()){var H=true;try{var C=navigator.appVersion+"";if(C.indexOf("MSIE 7")!=-1){H=false}}catch(I){H=true}if(H){var F=this.getImageURL();if(F.substring(F.length-4,F.length)==".png"){J=true}}}st="";st+="<img ";st+=' id="'+this.getName()+'"';if(J){st+=' src="'+getVacioGif()+'" '}else{st+=' src="'+this.getImageURL()+'" '}var G=this.getX();var E=this.getY();st+=' style="position:absolute; top:'+E+"px;";st+=" left:"+G+"px;";if(Q.length==4&&M.length==4){var D=Q[1]-Q[3];var B=M[1]-M[3];st+=" width:"+D+"px;";st+=" height:"+B+"px;"}else{if(this.getImageWidth()>0){st+=" width:"+this.getImageWidth()+"px;"}if(this.getImageHeight()>0){st+=" height:"+this.getImageHeight()+"px;"}}if(J){st+="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src="+this.getImageURL()+", sizingMethod=scale);"}st+='"';if(this.getImageWidth()<=0||this.getImageHeight()<=0){st+=' onload="'+this.getOnLoadImageFunction()+';"'}st+=" />";return st}function u(){return Symbol.IMAGE_SYMBOL}function r(){return this.onLoadImageFunction}function A(B){this.onLoadImageFunction=B}}ImageSymbol.prototype=new ImageLabelSymbol;function CanvasSymbol(b,u,q,k,c,g,f){this._super=Symbol;this._super(b,u,q,k);this.alphaValue=c||1;this.doFillPolygon=g||false;this.doStripedFill=f||false;this.getClass=v;this.getHTML=a;this.getRGBAColorCad=o;this.setAlphaValue=B;this.getAlphaValue=r;this.setDoFillPolygon=l;this.getDoFillPolygon=p;this.setDoStripedFill=m;this.getDoStripedFill=A;function v(){return Symbol.CANVAS_SYMBOL}function a(){return""}function o(){var E="";var C=this.getColor();if(C.indexOf("#")!=-1){C=C.substring(C.indexOf("#")+1,C.length)}if(C.length==6){var F=C.substring(0,2);var G=C.substring(2,4);var D=C.substring(4,6);E=parseInt(F,16)+","+parseInt(G,16)+","+parseInt(D,16);E+=","+this.getAlphaValue()}return E}function r(){return this.alphaValue}function B(C){this.alphaValue=C}function p(){return this.doFillPolygon}function l(C){this.doFillPolygon=C}function A(){return this.doStripedFill}function m(C){this.doStripedFill=C}}CanvasSymbol.prototype=new Symbol;function createNewExtent(b,a,g,f,c){return new Extent(b,a,g,f,c)}function createNewRectangle2D_Double(c,b,f,a){return new Rectangle2D_Double(c,b,f,a)}function createNewLinearRing(a,b,c){return new LinearRing(a,b,c)}function createNewPolygon(a,b){return new Polygon(a,b)}function createNewPoint(a,b){return new Point(a,b)}function createNewPoint2D_Double(a,b){return new Point2D_Double(a,b)}function createNewScreenPoint(a,b){return new ScreenPoint(a,b)}function createNewFont(c,a,f,b){return new Font(c,a,f,b)}function createNewFont(f,b,g,c,a){return new Font(f,b,g,c,a)}function createNewFontCSS(a,g,f,c,b){return new FontCSS(a,g,f,c,b)}function createNewCheckBox(b,l,m,k,g,p,o,f,c,a){return new CheckBox(b,l,m,k,g,p,o,f,c,a)}function createNewCheckBoxCSS(b,l,m,k,g,p,o,f,c,a){return new CheckBoxCSS(b,l,m,k,g,p,o,f,c,a)}function createNewScaleRendererCSS(a,l,k,c,o,b,m,g,f){return new ScaleRendererCSS(a,l,k,c,o,b,m,g,f)}function createNewInputTextCSS(a,f,m,g,c,l,b,p,k,o){return new InputTextCSS(a,f,m,g,c,l,b,p,k,o)}function createNewColorChooser(c,b,k,m,a,l,g,f){return new ColorChooser(c,b,k,m,a,l,g,f)}function createNewLayerTreeRenderer_dojo(g,b,f,a,c){return new LayerTreeRenderer_dojo(g,b,f,a,c)}function createNewBasicLayerTreeRenderer_dojo(c,a,b){return new BasicLayerTreeRenderer_dojo(c,a,b)}function createNewTreeNode(b,a,m,p,l,g,k,r,o,q,c,f){return new TreeNode(b,a,m,p,l,g,k,r,o,q,c,f)}function createNewMapRenderer(k,b,l,f,a,c,g){return new MapRenderer(k,b,l,f,a,c,g)}function createNewSingleSymbolRenderer(a,b,c,f){return new SingleSymbolRenderer(a,b,c,f)}function Geometry(c){this.srs=c||"EPSG:4326";this.getSrs=b;this.setSrs=a;function b(){return this.srs}function a(f){this.srs=f}}Geometry.POINT=0;Geometry.LINE_STRING=1;Geometry.LINEAR_RING=2;Geometry.POLYGON=3;function Point2D_Double(a,l){this.x=a||0;this.y=l||0;this.getX=c;this.setX=k;this.getY=b;this.setY=g;this.setLocation=f;function c(){return this.x}function k(m){this.x=m}function b(){return this.y}function g(m){this.y=m}function f(o,m){this.setX(o);this.setY(m)}}Point2D_Double.prototype=new Geometry;function Rectangle2D_Double(o,m,A,r){this.x=o||0;this.y=m||0;this.width=A||0;this.height=r||0;this.getX=C;this.setX=v;this.getY=B;this.setY=u;this.getWidth=b;this.setWidth=a;this.getHeight=p;this.setHeight=g;this.setRect=k;this.isEmpty=q;this.contains=l;this.getBounds=f;this.containsBbox=D;this.toPolygon=c;function C(){return this.x}function v(E){this.x=E}function B(){return this.y}function u(E){this.y=E}function b(){return this.width}function a(E){this.width=E}function p(){return this.height}function g(E){this.height=E}function k(H,G,F,E){this.setX(H);this.setY(G);this.setWidth(F);this.setHeight(E)}function q(){return(this.width<=0)||(this.height<=0)}function l(E,F){x0=this.getX();y0=this.getY();return(E>=x0&&F>=y0&&E<x0+this.getWidth()&&F<y0+this.getHeight())}function f(){if((this._bounds==null)||(this._bounds.x!=this.x)||(this._bounds.y!=this.y)||(this._bounds.width!=this.width)||(this._bounds.height!=this.height)){this._bounds=new Rectangle2D_Double(o,m,A,r);this._bounds.setSrs(this.getSrs())}return this._bounds}function D(J){var F=this.getX();var I=this.getX()+this.getWidth();var O=this.getY();var G=this.getY()+this.getHeight();var K=J.getX();var E=J.getX()+J.getWidth();var H=J.getY();var M=J.getY()+J.getHeight();return((F<=K&&K<=I)||(I<=E&&E<=I)||(O<=H&&H<=G)||(O<=M&&M<=G))}function c(){var G=new Array();G[0]=this.getX();G[1]=this.getX();G[2]=this.getX()+this.getWidth();G[3]=this.getX()+this.getWidth();var F=new Array();F[0]=this.getY();F[1]=this.getY()+this.getHeight();F[2]=this.getY()+this.getHeight();F[3]=this.getY();var H=new LinearRing(G,F,G.length);var E=new Polygon(H,new Array(0));E.setSrs(this.getSrs());return E}}Rectangle2D_Double.prototype=new Geometry;function Point(a,f){this._super=Point2D_Double;this._super(a,f);this._bounds=null;this.getBounds=c;this.getClass=b;function c(){if((this._bounds==null)||(this._bounds.x!=this.x)||(this._bounds.y!=this.y)){this._bounds=new Rectangle2D_Double(a,f,0,0);this._bounds.setSrs(this.getSrs())}return this._bounds}function b(){return Geometry.POINT}}Point.prototype=new Point2D_Double;function Curve(){}Curve.prototype=new Geometry;function Surface(){}Surface.prototype=new Geometry;function LineString(b,m,q){this.npoints=q||0;this.xpoints=b||new Array(0);this.ypoints=m||new Array(0);this._bounds=null;this.getNpoints=l;this.getLength=u;this._getLength=r;this.getStartPoint=p;this.getEndPoint=g;this.addPoint=c;this.getBounds=o;this.setBounds=v;this.move=k;this._calculateBounds=a;this.getClass=A;this.isInRectangle=f;function l(){return this.npoints}function u(){var B=0;for(i=0;i<=this.getNpoints()-2;i++){B+=this._getLength(i)}return B}function r(B){if((B>=0)&&(B<=this.npoints-2)){return Math.sqrt((this.xpoints[B+1]-this.xpoints[B])*(this.xpoints[B+1]-this.xpoints[B])+(this.ypoints[B+1]-this.ypoints[B])*(this.ypoints[B+1]-this.ypoints[B]))}else{return 0}}function p(){return new Point(this.xpoints[0],this.ypoints[0])}function g(){return new Point(this.xpoints[this.npoints-1],this.ypoints[this.npoints-1])}function c(B,C){this.xpoints[this.npoints]=B;this.ypoints[this.npoints]=C;this.npoints++;if(this._bounds!=null){if(B<this._bounds.x){this._bounds.width=this._bounds.width+(this._bounds.x-B);this._bounds.x=B}else{this._bounds.width=Math.max(this._bounds.width,B-this._bounds.x)}if(C<this._bounds.y){this._bounds.height=this._bounds.height+(this._bounds.y-C);this._bounds.y=C}else{this._bounds.height=Math.max(this._bounds.height,C-this._bounds.y)}}}function o(){if(this._bounds==null){this._bounds=a(this.xpoints,this.ypoints,this.npoints,this.getSrs())}return this._bounds}function v(B,E,C,D){this._bounds=new Rectangle2D_Double(B,E,C,D)}function k(C,B){for(i=0;i<this.npoints;i++){this.xpoints[i]+=C;this.ypoints[i]+=B}this._bounds=a(this.xpoints,this.ypoints,this.npoints,this.getSrs())}function a(C,D,E,B){boundsMinX=Number.MAX_VALUE;boundsMinY=Number.MAX_VALUE;boundsMaxX=-Number.MAX_VALUE;boundsMaxY=-Number.MAX_VALUE;if(E>0){boundsMinX=C[0];boundsMinY=D[0];boundsMaxX=C[0];boundsMaxY=D[0]}for(i=1;i<E;i++){x=C[i];boundsMinX=Math.min(boundsMinX,x);boundsMaxX=Math.max(boundsMaxX,x);y=D[i];boundsMinY=Math.min(boundsMinY,y);boundsMaxY=Math.max(boundsMaxY,y)}this._bounds=new Rectangle2D_Double(boundsMinX,boundsMinY,boundsMaxX-boundsMinX,boundsMaxY-boundsMinY);this._bounds.setSrs(B);return this._bounds}function A(){return Geometry.LINE_STRING}function f(B,G,F){for(var D=0;D<this.getNpoints();D++){var E=this.xpoints[D];var C=this.ypoints[D];if(F.contains(E,C)){return true}}return false}}LineString.prototype=new Curve;function Line(g,m,f,k){this.segmentsIntersect=l;this.npoints=2;this.xpoints=new Array(2);this.xpoints[0]=g;this.xpoints[1]=f;this.ypoints=new Array(2);this.ypoints[0]=m;this.ypoints[1]=k;this.addPoint=c;this.intersect=a;function c(){}function l(q,u,p,r){xa=this.xpoints[0];ya=this.ypoints[0];xb=this.xpoints[1];yb=this.ypoints[1];var o=b(xa,ya,xb,yb,q,u,p,r);if(o==null){return false}if(Math.abs(xa-xb)>Math.abs(ya-yb)){if(o.getX()>Math.max(xa,xb)||o.getX()<Math.min(xa,xb)){return false}}else{if(o.getY()>Math.max(ya,yb)||o.getY()<Math.min(ya,yb)){return false}}if(Math.abs(q-p)>Math.abs(u-r)){if(o.getX()>Math.max(q,p)||o.getX()<Math.min(q,p)){return false}}else{if(o.getY()>Math.max(u,r)||o.getY()<Math.min(u,r)){return false}}return true}function b(p,C,J,B,H,A,G,v){var u=((J-p)*(v-A)-(B-C)*(G-H));var D=((C-A)*(G-H)-(p-H)*(v-A));if(u==0){if(D==0){if((p<J&&(J<H||J<G))||(p>J&&(J>H||J>G))){return new Point(J,B)}else{return new Point(p,C)}}else{return null}}var o=D/u;var q=((C-A)*(J-p)-(p-H)*(B-C));var I=q/u;if(0<=o&&o<=1&&0<=I&&I<=1){var F=(p+(J-p)*o);var E=(C+(B-C)*o);return new Point(F,E)}else{return null}}function a(B,p,v,o,r,A,q,u){return b(B,p,v,o,r,A,q,u)}}Line.prototype=new LineString;function LinearRing(f,g,k){this._super=LineString;this._super(f,g,k);this.contains=c;this.isClockWise=b;this.getClass=a;function c(l,p){if(this.getBounds().contains(l,p)){hits=0;ySave=0;var m=0;while((m<this.npoints)&&(this.ypoints[m]==p)){m++}for(var o=0;o<this.npoints;o++){j=(m+1)%this.npoints;dx=this.xpoints[j]-this.xpoints[m];dy=this.ypoints[j]-this.ypoints[m];if(dy!=0){rx=l-this.xpoints[m];ry=p-this.ypoints[m];if((this.ypoints[j]==p)&&(this.xpoints[j]>=l)){ySave=this.ypoints[m]}if((this.ypoints[m]==p)&&(this.xpoints[m]>=l)){if((ySave>p)!=(g[j]>p)){hits--}}s=ry/dy;if((s>=0)&&(s<=1)&&((s*dx)>=rx)){hits++}}m=j}return(hits%2)!=0}return false}function b(){N=this.npoints;i=0;j=0;area=0;for(i=0;i<N;i++){j=(i+1)%N;area+=this.xpoints[i]*this.ypoints[j];area-=this.ypoints[i]*this.xpoints[j]}return(area<0)}function a(){return Geometry.LINEAR_RING}}LinearRing.prototype=new LineString;function Polygon(u,f){this.exteriorRing=u;this.interiorRings=f||new Array(0);this.numInteriorRings=this.interiorRings.length||0;this.getExteriorRing=l;this.setExteriorRing=p;this.getInteriorRings=A;this.getNumInteriorRings=b;this.getArea=a;this._getRingArea=m;this.getPerimeter=k;this.getBounds=q;this.getClass=v;this.contains=g;this.intersects=o;this.transformSrs=c;this.setSrs=r;function r(D){this.srs=D;this.exteriorRing.setSrs(D);for(var C=0;C<f.length;C++){this.interiorRings[C].setSrs(D)}}function l(){return this.exteriorRing}function p(C){this.exteriorRing=C}function b(){return this.numInteriorRings}function A(){return this.interiorRings}function a(){extArea=m(this.exteriorRing);for(var C=0;C<this.interiorRings.length;C++){extArea-=m(this.interiorRings[C])}return extArea}function m(C){N=C.npoints;i=0;j=0;area=0;for(i=0;i<N;i++){j=(i+1)%N;area+=C.xpoints[i]*C.ypoints[j];area-=C.ypoints[i]*C.xpoints[j]}area/=2;return(area<0?-1*area:area)}function q(){return this.exteriorRing.getBounds()}function k(){return this.exteriorRing.getLength()}function v(){return Geometry.POLYGON}function g(D,F){var C=this.exteriorRing.contains(D,F);if(C){for(var E=0;E<this.interiorRings.length&&C;E++){C=!(this.interiorRing[E].contains(D,F))}}return C}function o(C){if(C.getSrs()!=this.getSrs()){C=C.transformSrs(this.getSrs())}var F=true;if(!this.getBounds().containsBbox(C.getBounds())){if(!C.getBounds().containsBbox(this.getBounds())){F=false}}if(F){for(var D=0;D<this.exteriorRing.npoints;D++){if(C.contains(this.exteriorRing.xpoints[D],this.exteriorRing.ypoints[D])){return true}}for(var D=0;D<C.exteriorRing.npoints;D++){if(this.contains(C.exteriorRing.xpoints[D],C.exteriorRing.ypoints[D])){return true}}var E=B(this,C);if(E){return true}var E=B(C,this);if(E){return true}}else{return false}return false}function B(F,D){for(var H=0;H<F.exteriorRing.npoints;H++){var E=null;if(H!=(F.exteriorRing.npoints-1)){E=new Line(F.exteriorRing.xpoints[H],F.exteriorRing.ypoints[H],F.exteriorRing.xpoints[H+1],F.exteriorRing.ypoints[H+1])}else{if((F.exteriorRing.xpoints[H]!=F.exteriorRing.xpoints[0])||(F.exteriorRing.ypoints[H]!=F.exteriorRing.ypoints[0])){E=new Line(F.exteriorRing.xpoints[H],F.exteriorRing.ypoints[H],F.exteriorRing.xpoints[0],F.exteriorRing.ypoints[0])}}if(E!=null){for(var G=0;G<D.exteriorRing.npoints;G++){var C=null;if(G!=(D.exteriorRing.npoints-1)){C=new Line(D.exteriorRing.xpoints[G],D.exteriorRing.ypoints[G],D.exteriorRing.xpoints[G+1],D.exteriorRing.ypoints[G+1])}else{if((D.exteriorRing.xpoints[G]!=D.exteriorRing.xpoints[0])||(D.exteriorRing.ypoints[G]!=D.exteriorRing.ypoints[0])){C=new Line(D.exteriorRing.xpoints[G],D.exteriorRing.ypoints[G],D.exteriorRing.xpoints[0],D.exteriorRing.ypoints[0])}}if(C!=null){if(E.segmentsIntersect(C.xpoints[0],C.ypoints[0],C.xpoints[1],C.ypoints[2])){return true}}}}}return false}function c(G){if(this.getSrs()!=G){var D=new Polygon(this.exteriorRing,this.interiorRings);for(var F=0;F<this.exteriorRing.npoints;F++){var C=mapReference.coordTransform(this.getSrs(),G,this.exteriorRing.xpoints[F],this.exteriorRing.ypoints[F]);D.exteriorRing.xpoints[F]=C[0];D.exteriorRing.ypoints[F]=C[1]}for(var F=0;F<this.interiorRings.length;F++){for(var E=0;E<this.interiorRings[F].npoints;E++){var C=mapReference.coordTransform(this.getSrs(),G,this.interiorRings[F].xpoints[E],this.interiorRings[F].ypoints[E]);D.interiorRings[F].xpoints[E]=C[0];D.interiorRings[F].ypoints[E]=C[1]}}D.setSrs(G)}this.exteriorRing=D.exteriorRing;this.interiorRings=D.interiorRings;this.setSrs(D.getSrs());return this}}Polygon.prototype=new Surface;function resize(){var b=getWindowWidth(this);var a=getWindowHeight(this);getMap().resize(b,a)}function _calculateExtentResized(c,b){newExt=new OpenLayers.Bounds();var a=(map.getExtent().getWidth()/2)*(1/b);newExt.right=map.getCenter().lon+a;newExt.left=map.getCenter().lon-a;var f=(map.getExtent().getHeight()/2)*(1/c);newExt.top=map.getCenter().lat+f;newExt.bottom=map.getCenter().lat-f;return newExt}function getWindowWidth(a){if(OpenLayers.IAAA_Utils.isNetscape()){return(a.innerWidth)}else{if(a.document.body.clientWidth==0){return(a.document.documentElement.clientWidth)}else{return a.document.body.clientWidth}}}function getWindowHeight(a){if(OpenLayers.IAAA_Utils.isNetscape()){return(a.innerHeight-14)}else{if(a.document.body.clientWidth==0){return(a.document.documentElement.clientHeight)}else{return a.document.body.clientHeight}}}var oldWindowWidth;var oldWindowHeight;var allFinished=0;var resizeDialog=null;function setWindowSizeVars(b,a){oldWindowWidth=b;oldWindowHeight=a}function getWindowWidth(a){if(OpenLayers.IAAA_Utils.isNetscape()){return(a.innerWidth)}else{if(a.document.body.clientWidth==0){return(a.document.documentElement.clientWidth)}else{return a.document.body.clientWidth}}}function setWindowWidth(b,c,a){if(OpenLayers.IAAA_Utils.isNetscape()){b.innerWidth=c}else{b.resizeTo(minWidthSizeWin,a)}}function getWindowHeight(a){if(OpenLayers.IAAA_Utils.isNetscape()){return(a.innerHeight-14)}else{if(a.document.body.clientWidth==0){return(a.document.documentElement.clientHeight)}else{return a.document.body.clientHeight}}}function setWindowHeight(b,c,a){if(OpenLayers.IAAA_Utils.isNetscape()){b.innerHeight=a;b.innerHeight-=14}else{b.resizeTo(c,minHeightSizeWin)}}function _adjustWindowSize(){var c=getWindowWidth(parent);var a=getWindowHeight(parent);if(OpenLayers.IAAA_Utils.isNetscape()){c+=14}if((minWidthSizeWin!=-1)&&(c<minWidthSizeWin)){setWindowWidth(parent,minWidthSizeWin,a);c=getWindowWidth(parent)}if((minHeightSizeWin!=-1)&&(a<minHeightSizeWin)){setWindowHeight(parent,c,minHeightSizeWin+30)}windowWidth=getWindowWidth(parent);windowHeight=getWindowHeight(parent);windowMapWidth=getWindowWidth(parent.mapFrame);windowMapHeight=getWindowHeight(parent.mapFrame);windowLegendWidth=0;if(layerTreeRenderersInNewWindow){if(parent.legendFrame){var b=4;if(OpenLayers.IAAA_Utils.isNetscape()){b=6}windowLegendWidth=(windowWidth-windowMapWidth)-b}}resizeMapToMinimumWidth=false;resizeMapToMinimumHeight=false;if(windowMapWidth<getMap().minWidth){windowMapWidth=getMap().minWidth;windowWidth=windowMapWidth+windowLegendWidth;resizeMapToMinimumWidth=true}if(windowMapWidth<minWidthSizeMap){resizeMapToMinimumWidth=true}if((windowMapHeight<minHeightSizeMap)||(windowMapHeight<getMap().minHeight)){resizeMapToMinimumHeight=true}if(resizeMapToMinimumWidth){if(windowWidth>=(minWidthSizeMap+20)){widthDiff=0}else{widthDiff=(minWidthSizeMap+20-windowWidth)}}else{widthDiff=0}heightStuff=toolBarZoneHeight-optionZoneHeight-22;if(resizeMapToMinimumHeight){if(windowHeight>=(minHeightSizeMap+heightStuff)){if(windowMapHeight<getMap().minHeight){windowMapHeight=getMap().minHeight;heightDiff=(windowMapHeight+heightStuff-windowHeight)}else{heightDiff=0}}else{if(windowMapHeight<getMap().minHeight){windowMapHeight=getMap().minHeight;heightDiff=(windowMapHeight+heightStuff-windowHeight)}else{heightDiff=(minHeightSizeMap+heightStuff-windowHeight)}}}else{heightDiff=0}if((widthDiff!=0)||(heightDiff!=0)){parent.resizeBy(widthDiff,heightDiff)}}var enableResize=true;function doEnableResize(){enableResize=true}function doDisableResize(){enableResize=false}function confirmResize(){if(enableResize){if(navigator.userAgent.indexOf("MSIE 5.0")>=0){allFinished+=1}else{allFinished=3}do_resize()}}function do_resize(){if(allFinished==3){if(resizeDialog){resizeDialog.hide();indexReference.doDisableClient();resizeDialog.center();resizeDialog.show()}allFinished=0}}function _calculateExtentResized(c,b){newExt=new OpenLayers.Bounds();var a=(map.getExtent().getWidth()/2)*(1/b);newExt.right=map.getCenter().lon+a;newExt.left=map.getCenter().lon-a;var f=(map.getExtent().getHeight()/2)*(1/c);newExt.top=map.getCenter().lat+f;newExt.bottom=map.getCenter().lat-f;return newExt}function _updateOptionZone(){minimunOptionZone=optionZoneY;newTop=(mapZoneY+newMapHeight+gapOptionScaleRendererZone);if(newTop>=minimunOptionZone){getScaleZone().style.top=newTop+"px";getOptionZone().style.top=newTop+"px";if(getFooterZone()){getFooterZone().style.top=newTop+"px"}document.getElementById("optionZoneSeparator1").style.top=(newTop-7)+"px";document.getElementById("optionZoneSeparator2").style.top=(newTop-6)+"px"}else{getScaleZone().style.top=minimunOptionZone+"px";getOptionZone().style.top=minimunOptionZone+"px";if(getFooterZone()){getFooterZone().style.top=minimunOptionZone+"px"}document.getElementById("optionZoneSeparator1").style.top=(minimunOptionZone-7)+"px";document.getElementById("optionZoneSeparator2").style.top=(minimunOptionZone-6)+"px"}document.getElementById("optionZone").style.width=getWindowWidth(parent.mapFrame)+"px";document.getElementById("scaleZone").style.width=getWindowWidth(parent.mapFrame)+"px";if(getFooterZone()){getFooterZone().style.width=getWindowWidth(parent.mapFrame)+"px"}document.getElementById("optionZoneSeparator1").style.width=getWindowWidth(parent.mapFrame)+"px";document.getElementById("optionZoneSeparator2").style.width=getWindowWidth(parent.mapFrame)+"px"}function _updateToolbarZone(){}function _updateLayerTreeZone(){if(showLayerTreeRenderers){if(parent.legendFrame){if(parent.legendFrame.document.getElementById("disableClientDiv")){parent.legendFrame.document.getElementById("disableClientDiv").style.width=getWindowWidth(parent.legendFrame)}}else{getLayerTreeZone().style.left=(gapMapLayerZoneX)+"px";getLayerTreeZone().style.top=(gapMapLayerZoneY)+"px"}}}function _updateMapZone(c,l){factorX=c/oldWindowWidth;factorY=l/oldWindowHeight;var g=map.size.w;var p=map.size.h;newCurrExt=_calculateExtentResized(factorX,factorY);map.div.style.width=map.size.w*factorX;map.div.style.height=map.size.h*factorY;oldWindowWidth=c;oldWindowHeight=l;map.size=new OpenLayers.Size(map.div.style.width,map.div.style.height);var o=map.div.style.height.split("px")[0]-p;map.updateSize(true);var a=map.getCenter();var q=map.getZoomForExtent(newCurrExt);map.setCenter(a,q,null,null,true);if(map.getToolBar()){for(var f=0;f<4;f++){var b=document.getElementById("bottomDiv_"+f);if(b){var m=b.style.top.split("px")[0];var k=parseInt(m)+parseInt(o);b.style.top=k+"px"}}}}function _yesChangeWindow(){_changeWindowSize();indexReference.doEnableClient()}function _noChangeWindow(){indexReference.doEnableClient();if(resizeDialog){resizeDialog.hide()}}function _changeWindowSize(b){var a=b||false;allFinished=0;_adjustWindowSize();if(showLayerTreeRenderers){if(layerTreeRenderersInNewWindow){windowWidth=getWindowWidth(parent.mapFrame)-mapZoneX-5}else{windowWidth=getWindowWidth(parent)-mapZoneX-5-legendZoneWidth-gapMapLayerZoneX}}else{windowWidth=getWindowWidth(parent)-mapZoneX}windowHeight=getWindowHeight(parent.mapFrame)-toolBarZoneHeight-optionZoneHeight-22;map.resize(getWindowWidth(parent.mapFrame),getWindowHeight(parent.mapFrame));if(showScaleRenderer){}if(resizeDialog){resizeDialog.hide()}}function _changeWindowSizeEnd(){};